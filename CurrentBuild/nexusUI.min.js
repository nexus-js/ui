function getTemplate(e,t,s){e.canvasID=t,e.canvas=document.getElementById(t),e.context=e.canvas.getContext("2d"),e.canvas.height=window.getComputedStyle(document.getElementById(t),null).getPropertyValue("height").replace("px",""),e.canvas.width=window.getComputedStyle(document.getElementById(t),null).getPropertyValue("width").replace("px",""),e.height=parseInt(window.getComputedStyle(document.getElementById(t),null).getPropertyValue("height").replace("px","")),e.width=parseInt(window.getComputedStyle(document.getElementById(t),null).getPropertyValue("width").replace("px","")),300==e.width&&150==e.height&&(e.canvas.width=e.defaultSize.width,e.canvas.height=e.defaultSize.height,e.width=e.defaultSize.width,e.height=e.defaultSize.height),e.offset=new nx.canvasOffset(nx.findPosition(e.canvas).left,nx.findPosition(e.canvas).top),e.center={x:e.width/2,y:e.height/2},e.corners={TLx:0,TLy:0,TRx:this.width,TRy:0,BRx:this.width,BRy:this.height,BLx:0,BLy:this.height},e.lineWidth=2,e.padding=2,e.colors=new Object,e.colors.accent=nx.colors.accent,e.colors.fill=nx.colors.fill,e.colors.border=nx.colors.border,e.colors.accentborder=nx.colors.accentborder,e.colors.black=nx.colors.black,e.colors.white=nx.colors.white,e.colors.highlight=nx.colors.highlight,e.hexToRgb=nx.hexToRgb,e.clickPos=new nx.point(0,0),e.clickPos.touches=new Array,e.clicked=!1,e.value=0,e.nodePos=new Array,e.deltaMove=new Object,e.nxThrottlePeriod=nx.nxThrottlePeriod,e.nxThrottle=nx.nxThrottle,e.isBeingDragged=!1,e.label=!1,nx.addNxObject(e),e.isRecording=!1,e.tapeNum=0,e.recorder=null,e.nxTransmit=nx.nxTransmit,e.transmissionProtocol="ajax",e.ajaxRequestType="post",e.transmitCommand=s?s:"nexusTransmit",e.oscName="/"+t,e.ajaxTransmit=nx.ajaxTransmit,e.iosTransmit=nx.iosTransmit,nx.editmode&&(e.canvas.style.border="solid 1px #888"),e.localTransmit=function(t){nx.globalLocalTransmit(e.canvasID,e.localObject,e.localParameter,t)},e.localObject="dial1",e.localParameter="value",e.getCursorPosition=nx.getCursorPosition,e.getTouchPosition=nx.getTouchPosition,e.is_touch_device="ontouchstart"in document.documentElement?!0:!1,e.drawLabel=nx.drawLabel,e.preClick=function(t){e.offset=new nx.canvasOffset(nx.findPosition(e.canvas).left,nx.findPosition(e.canvas).top),document.addEventListener("mousemove",e.preMove,!1),document.addEventListener("mouseup",e.preRelease,!1),e.clickPos=e.getCursorPosition(t,e.offset);for(var s=0;s<e.clickPos.touches.length;s++);e.clicked=!0,e.deltaMove.x=0,e.deltaMove.y=0,nx.editmode?(e.isBeingDragged=!0,globaldragid=e.canvasID,nx.highlightEditedObj(e.canvasID),showSettings()):e.click(t)},e.preMove=function(t){e.movehandle=0;var s=e.getCursorPosition(t,e.offset);if(e.deltaMove.y=s.y-e.clickPos.y,e.deltaMove.x=s.x-e.clickPos.x,e.clickPos=s,nx.editmode){if(e.isBeingDragged){var i=~~(t.clientY/canvasgridy)*canvasgridy,l=~~(t.clientX/canvasgridx)*canvasgridx;e.canvas.style.top=i+"px",e.canvas.style.left=l+"px"}}else e.move(t)},e.preRelease=function(){document.removeEventListener("mousemove",e.preMove,!1),e.clicked=!1,nx.editmode?e.isBeingDragged=!1:e.release(),document.removeEventListener("mouseup",e.preRelease,!1)},e.preTouch=function(t){e.clickPos=e.getTouchPosition(t,e.offset),e.clicked=!0,e.deltaMove.x=0,e.deltaMove.y=0,nx.editmode?(e.isBeingDragged=!0,globaldragid=e.canvasID,nx.highlightEditedObj(e.canvasID),showSettings()):e.touch(t)},e.preTouchMove=function(t){if(e.clicked){var s=e.getTouchPosition(t,e.offset);if(e.deltaMove.y=s.y-e.clickPos.y,e.deltaMove.x=s.x-e.clickPos.x,e.clickPos=s,nx.editmode){if(e.isBeingDragged){var i=~~(t.clientY/canvasgridy)*canvasgridy,l=~~(t.clientX/canvasgridx)*canvasgridx;e.canvas.style.top=i+"px",e.canvas.style.left=l+"px"}}else e.touchMove(t)}},e.preTouchRelease=function(){e.clicked&&(e.clicked=!1),nx.editmode?e.isBeingDragged=!1:e.touchRelease()},e.draw=function(){},e.click=function(){},e.move=function(){},e.release=function(){},e.touch=function(){e.click()},e.touchMove=function(){e.move()},e.touchRelease=function(){e.release()},e.adjustSizeIfDefault=function(){300==e.width&&150==e.height&&(e.canvas.width=e.defaultSize.width,e.canvas.height=e.defaultSize.height,e.width=e.defaultSize.width,e.height=e.defaultSize.height)},e.makeRoundedBG=function(){this.bgLeft=this.lineWidth,this.bgRight=this.width-this.lineWidth,this.bgTop=this.lineWidth,this.bgBottom=this.height-this.lineWidth,this.bgHeight=this.bgBottom-this.lineWidth,this.bgWidth=this.bgRight-this.lineWidth,nx.makeRoundRect(e.context,e.bgLeft,e.bgTop,e.bgWidth,e.bgHeight)},e.erase=function(){e.context.clearRect(0,0,e.width,e.height)},e.hideCursor=function(){e.canvas.style.cursor="none"},e.showCursor=function(){e.canvas.style.cursor="auto"},nx.getHandlers(e)}function toggle(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:100,height:100},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.on=!1,this.fontsize=this.width>=50?20:11,this.init=function(){self.draw()},this.draw=function(){with(this.context)clearRect(0,0,this.canvas.width,canvas.height);with(this.makeRoundedBG(),this.context)strokeStyle=self.colors.border,fillStyle=self.width>40&&self.height>40?self.colors.fill:self.on?self.colors.accent:self.colors.border,lineWidth=this.lineWidth,stroke(),fill();if(self.width>40&&self.height>40)if(this.on)with(nx.makeRoundRect(this.context,this.bgLeft+this.padding,this.bgTop+this.padding,this.bgWidth-2*this.padding,this.bgHeight/2.1),this.context)fillStyle=self.colors.accent,strokeStyle=self.colors.accent,stroke(),fill(),fillStyle=self.colors.white,font="bold "+self.fontsize+"px courier",textAlign="center",fillText("on",this.canvas.width/2,this.bgHeight/4.5+this.lineWidth+this.padding+5);else with(nx.makeRoundRect(this.context,this.bgLeft+this.padding,this.bgBottom-this.padding-this.bgHeight/2.1,this.bgWidth-2*this.padding,this.bgHeight/2.1),this.context)fillStyle=self.colors.border,strokeStyle=self.colors.border,stroke(),fill(),fillStyle=self.colors.white,font="bold "+self.fontsize+"px courier",textAlign="center",fillText("off",this.canvas.width/2,this.bgBottom-this.padding-this.bgHeight/4.5+5);else with(this.context)fillStyle=self.colors.white,font="bold "+self.fontsize+"px courier",textAlign="center",self.on?fillText("on",this.canvas.width/2,this.canvas.height/2+self.fontsize/3.5):fillText("off",this.canvas.width/2,this.canvas.height/2+self.fontsize/3.5);self.drawLabel()},this.click=function(){self.on=self.on?!1:!0,self.draw(),self.nxTransmit(nx.boolToVal(self.on))},this.move=function(){},this.release=function(){},this.touch=function(){self.on=self.on?!1:!0,self.draw(),self.nxTransmit(nx.boolToVal(self.on))},this.touchMove=function(){},this.touchRelease=function(){},this.init()}function dial(target,transmitCommand,uiIndex){function init(){return self.circle_size=Math.min(self.center.x,self.center.y)-self.lineWidth,self.dial_position_length=self.circle_size+self.lineWidth,self.width<101&&(self.dial_position_length--,self.dial_position_length--),self.draw(),1}var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:100,height:100},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.circle_size=1,this.dial_position_length=6,this.accentWidth=this.width<101||this.width<101?1*this.lineWidth:2*this.lineWidth,this.value=.5,this.responsivity=.005,this.toCartesian=nx.toCartesian,this.throttle=nx.throttle,this.clip=nx.clip,this.aniStart=0,this.aniStop=1,this.aniMove=.01,this.draw=function(){var dial_angle=2*(1-self.value)*Math.PI+1.5*Math.PI,dial_position=2*(self.value+.25)*Math.PI,point=self.toCartesian(self.dial_position_length,dial_angle);with(self.isRecording&&self.recorder.write(self.tapeNum,self.value),self.context)clearRect(0,0,self.width,self.height),strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,beginPath(),arc(self.center.x,self.center.y,self.circle_size,0,2*Math.PI,!0),fill(),stroke(),closePath(),beginPath(),lineWidth=self.accentWidth,arc(self.center.x,self.center.y,self.circle_size,.5*Math.PI,dial_position,!1),lineTo(self.center.x,self.center.y),globalAlpha=.1,fillStyle=self.colors.accent,fill(),globalAlpha=1,closePath(),beginPath(),lineWidth=self.accentWidth,arc(self.center.x,self.center.y,self.circle_size,.5*Math.PI,dial_position,!1),strokeStyle=self.colors.accent,stroke(),closePath(),beginPath(),lineWidth=self.accentWidth,strokeStyle=self.colors.accent,moveTo(self.center.x,self.center.y),lineTo(point.x+self.center.x,point.y+self.center.y),stroke(),closePath(),beginPath(),fillStyle=self.colors.accent,arc(self.center.x,self.center.y,self.circle_size/15+6,0,2*Math.PI,!1),fill(),closePath();self.drawLabel()},this.click=function(){self.nxTransmit(parseInt(self.value)),self.draw(),self.aniStart=self.value},this.move=function(){self.value=self.clip(self.value-self.deltaMove.y*self.responsivity,0,1),self.nxTransmit(self.value),self.draw()},this.release=function(){self.aniStop=self.value},this.touch=function(){self.nxTransmit(self.value),self.draw(),self.aniStart=self.value},this.touchMove=function(){self.value=self.clip(self.value-self.deltaMove.y*self.responsivity,0,1),self.nxTransmit(self.value),self.draw()},this.touchRelease=function(){self.aniStop=self.value},this.animate=function(e){switch(e){case"bounce":nx.aniItems.push(self.aniBounce);break;case"none":nx.aniItems.splice(nx.aniItems.indexOf(self.aniBounce))}},this.aniBounce=function(){self.clicked||(self.value+=self.aniMove,self.aniStop<self.aniStart&&(self.stopPlaceholder=self.aniStop,self.aniStop=self.aniStart,self.aniStart=self.stopPlaceholder),self.aniMove=nx.bounce(self.value,self.aniStart,self.aniStop,self.aniMove),self.draw(),self.nxTransmit(self.value))},init()}function button(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:100,height:100},this.getTemplate=getTemplate,getTemplate(self,target,transmitCommand),this.value=1,this.transmitRelease=!1,this.mode="impulse";var imageButton=0;this.image=null,this.imageHover=null,this.imageTouch=null,this.init=function(){return this.image&&(imageButton=1),self.draw(),1},this.draw=function(){with(self.context)clearRect(0,0,self.width,self.height),lineWidth=self.lineWidth,imageButton?self.clicked?self.imageTouch?drawImage(self.imageTouch,0,0):(fillStyle=self.colors.highlight,strokeStyle=self.colors.accent,drawImage(self.image,0,0),globalAlpha=.5,fillRect(0,0,self.width,self.height),strokeRect(0,0,self.width,self.height),globalAlpha=1):drawImage(self.image,0,0):(self.clicked?self.clicked&&(fillStyle=self.colors.accent,strokeStyle=self.colors.accent):(fillStyle=self.colors.fill,strokeStyle=self.colors.border),beginPath(),arc(self.center.x,self.center.y,Math.min(self.center.x,self.center.y)-self.lineWidth/2,0,2*Math.PI,!0),fill(),stroke(),closePath(),self.clicked&&"node"==self.mode&&(globalAlpha=.15,fillStyle="#fff",beginPath(),arc(self.clickPos.x,self.clickPos.y,Math.min(self.center.x,self.center.y)/2,0,2*Math.PI,!0),fill(),closePath(),beginPath(),arc(self.clickPos.x,self.clickPos.y,Math.min(self.center.x,self.center.y)/3,0,2*Math.PI,!0),fill(),closePath(),beginPath(),arc(self.clickPos.x,self.clickPos.y,Math.min(self.center.x,self.center.y)/4,0,2*Math.PI,!0),fill(),closePath(),beginPath(),arc(self.clickPos.x,self.clickPos.y,Math.min(self.center.x,self.center.y)/5,0,2*Math.PI,!0),fill(),closePath(),globalAlpha=1)),self.drawLabel()},this.click=function(){"node"==self.mode?self.nxTransmit([self.value*nx.boolToVal(self.clicked),self.clickPos.x,self.clickPos.y]):self.nxTransmit(self.value*nx.boolToVal(self.clicked)),self.draw()},this.move=function(){"node"==self.mode&&(self.nxTransmit([self.value*nx.boolToVal(self.clicked),self.clickPos.x,self.clickPos.y]),self.draw())},this.release=function(){(self.transmitRelease||"toggle"==self.mode)&&self.nxTransmit(self.value*nx.boolToVal(self.clicked)),self.draw()},this.touch=function(){self.click()},this.touchMove=function(){self.move()},this.touchRelease=function(){self.release()},this.setImage=function(e){self.image=new Image,self.image.onload=function(){self.draw()},imageButton=1,self.image.src=e},this.setHoverImage=function(e){self.imageHover=new Image,self.imageHover.onload=function(){self.draw()},self.imageHover.src=e,self.draw()},this.setTouchImage=function(e){self.imageTouch=new Image,self.imageTouch.onload=function(){self.draw()},self.imageTouch.src=e,self.draw()},this.init()}function keyboard(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:400,height:100},self.getTemplate=getTemplate,self.getTemplate(self,target,transmitCommand),self.octaves=2;var width=self.canvas.width/(12*self.octaves)/1.75,w_height=self.height,b_height=4*w_height/7,w_width=3*width,b_width=2*width,black_dis=[0,0,0,0,0,0,0,0,1,3,4,5],white_dis=[[0,2],[4,5],[7,9],[9,11],[13,14],[16,17],[19,21]],order=[0,2,4,5,7,9,11,1,3,6,8,10],keys=new Array;self.lineWidth=1;var note_new,note_old;this.init=function(){document.addEventListener("keydown",self.type),document.addEventListener("keyup",self.untype),width=self.canvas.width/(12*self.octaves)/1.75,w_height=self.height,b_height=4*w_height/7,w_width=3*width,b_width=2*width;var e,t,s;for(t=0;t<self.octaves;t++)for(s=0;12>s;s++)if(e=order[s]+12*t,7>s){var i=w_width*(s+7*t),l=s+1,o=w_width*(l+7*t);keys.push([0,s,0,i,o,e])}else{var n=black_dis[s],a=b_width*(1+n+n/2)+7*t*w_width,f=n+1,c=b_width*(1+f+n/2)+7*t*w_width;keys.push([0,n,1,a,c,e])}return self.draw(),1},this.draw=function(){var m,i,d,xx,dis;for(m=0;m<self.octaves;m++)for(i=0;12>i;i++)if(d=12*m+i,0==keys[d][2]){var k=keys[d][1],x=k*w_width+7*m*w_width;with(self.context)lineWidth=self.lineWidth,0==keys[d][0]?(fillStyle=self.colors.fill,fillRect(x,0,w_width,w_height),strokeStyle=self.colors.border,strokeRect(x,0,w_width,w_height)):(fillStyle=self.colors.accent,fillRect(x,0,w_width,w_height))}else with(dis=keys[d][1],xx=dis*(b_width+b_width/2)+b_width+7*m*w_width,self.context)lineWidth=self.lineWidth,fillStyle=0==keys[d][0]?self.colors.black:self.colors.accent,fillRect(xx,0,b_width,b_height);with(self.context)strokeStyle=self.colors.border,lineWidth=3,strokeRect(0,0,self.width,self.height);self.drawLabel()},this.change_cell=function(e,t){null!=e&&keys[e].splice(0,1,t)},this.whichKey_pressed=function(e,t){var s,i,l,o=0;if(b_height>t)for(s=0;s<self.octaves;s++){for(i=7;12>i;i++){var n=12*s+i;if(e>keys[n][3]&&e<=keys[n][4]){note_new=n,o=1;break}}if(0==o)for(l=0;7>l;l++){var a=(white_dis[l][0]+21*s)*width,f=(white_dis[l][1]+21*s)*width;if(e>a&&f>=e){var c=12*s+l;note_new=c;break}}}else if(t>b_height&&w_height>t)for(s=0;s<self.octaves;s++)for(i=0;7>i;i++){var n=12*s+i;e>keys[n][3]&&e<keys[n][4]&&(note_new=n)}else note_new=null},this.click=function(){self.whichKey_pressed(self.clickPos.x,self.clickPos.y),self.change_cell(note_new,1),note_old=note_new,midi_note=keys[note_new][5];var e=[midi_note,1];self.nxTransmit(e),console.log(e),self.draw()},this.move=function(){self.clicked&&(self.whichKey_pressed(self.clickPos.x,self.clickPos.y),note_old!=note_new&&(self.change_cell(note_old,0),self.change_cell(note_new,1),midi_note=keys[note_new][5],self.nxTransmit([midi_note,1]),midi_note=keys[note_old][5],self.nxTransmit([midi_note,0]),self.draw())),note_old=note_new},this.release=function(){for(j=0;j<self.octaves;j++)for(i=0;12>i;i++){var e=12*j+i;self.change_cell(e,0)}midi_note=keys[note_new][5],self.nxTransmit([midi_note,0]),self.draw()},this.touch=function(){self.whichKey_pressed(self.clickPos.x,self.clickPos.y),self.change_cell(note_new,1),note_old=note_new,midi_note=keys[note_new][5],self.nxTransmit([midi_note,1]),self.draw()},this.touchMove=function(e){self.clicked&&(self.clickPos=self.getTouchPosition(e,self.offset),self.whichKey_pressed(this.clickPos.x,this.clickPos.y),note_old!=note_new&&(self.change_cell(note_old,0),self.change_cell(note_new,1),midi_note=keys[note_new][5],self.nxTransmit([midi_note,1]),midi_note=keys[note_old][5],self.nxTransmit([midi_note,0]),self.draw())),note_old=note_new},this.touchRelease=function(){for(j=0;j<self.octaves;j++)for(i=0;12>i;i++){var e=12*j+i;self.change_cell(e,0)}midi_note=keys[note_new][5],self.nxTransmit([midi_note,0]),self.draw()},this.type=function(e){var t=e.which;if(e.which>47&&e.which<91){var s=[81,50,87,51,69,82,53,84,54,89,55,85],i=[0,7,1,8,2,3,9,4,10,5,11,6],l=s.indexOf(t);-1!=l&&(note_new=i[l],self.change_cell(note_new,1),note_old=note_new,midi_note=keys[note_new][5],self.nxTransmit(midi_note),self.draw())}},this.untype=function(e){var t=e.which;if(e.which>47&&e.which<91){var s=[81,50,87,51,69,82,53,84,54,89,55,85],i=[0,7,1,8,2,3,9,4,10,5,11,6],l=s.indexOf(t);-1!=l&&(note_old=i[l],self.change_cell(note_old,0),midi_note=keys[note_new][5],self.nxTransmit(midi_note),self.draw())}},this.init()}function position(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:300,height:200},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.nodeSize=15,this.values=[0,0],this.default_text="touch to control",this.throttle=nx.throttle,this.clip=nx.clip,this.init=function(){self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context)strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),null!=self.nodePos[0]?self.drawNode():(fillStyle=self.colors.border,font="14px courier",fillText(self.default_text,10,20));self.drawLabel()},this.drawNode=function(){with(self.nodePos[0]<self.bgLeft+self.nodeSize?self.nodePos[0]=self.bgLeft+self.nodeSize:self.nodePos[0]>self.bgRight-self.nodeSize&&(self.nodePos[0]=self.bgRight-self.nodeSize),self.nodePos[1]<self.bgTop+self.nodeSize?self.nodePos[1]=self.bgTop+self.nodeSize:self.nodePos[1]>self.bgBottom-self.nodeSize&&(self.nodePos[1]=self.bgBottom-self.nodeSize),self.context)globalAlpha=.2,beginPath(),strokeStyle=self.colors.accent,lineWidth=2,moveTo(self.nodePos[0],0+self.padding),lineTo(self.nodePos[0],self.height-self.padding),moveTo(0+self.padding,self.nodePos[1]),lineTo(self.width-self.padding,self.nodePos[1]),stroke(),closePath(),globalAlpha=1,beginPath(),fillStyle=self.colors.accent,strokeStyle=self.colors.border,lineWidth=self.lineWidth,arc(self.nodePos[0],self.nodePos[1],self.nodeSize,0,2*Math.PI,!0),fill(),closePath()},this.scaleNode=function(){var e=self.width-2*self.lineWidth-2*self.padding-2*self.nodeSize,t=self.height-2*self.lineWidth-2*self.padding-2*self.nodeSize,s=self.nodePos[0]-self.nodeSize-self.lineWidth-self.padding,i=self.nodePos[1]-self.nodeSize-self.lineWidth-self.padding,l=nx.clip(s/e,0,1),o=nx.clip(i/t,0,1);return self.values=[nx.prune(l,3),nx.prune(o,3)],self.values},this.click=function(){self.nodePos[0]=self.clickPos.x,self.nodePos[1]=self.clickPos.y,self.draw();var e=self.scaleNode();self.nxTransmit([e[0],e[1],"click"])},this.move=function(){if(self.clicked){self.nodePos[0]=self.clickPos.x,self.nodePos[1]=self.clickPos.y,self.draw();var e=self.scaleNode();self.nxTransmit([e[0],e[1],"move"])}},this.release=function(){var e=self.scaleNode();self.nxTransmit([e[0],e[1],"release"])},this.animate=function(e){switch(e){case"bounce":nx.aniItems.push(self.aniBounce);break;case"none":nx.aniItems.splice(nx.aniItems.indexOf(self.aniBounce))}},this.aniBounce=function(){!self.clicked&&self.nodePos[0]&&(self.nodePos[0]+=self.deltaMove.x/2,self.nodePos[1]+=self.deltaMove.y/2,self.deltaMove.x=nx.bounce(self.nodePos[0],self.bgLeft+self.nodeSize,self.width-self.bgLeft-self.nodeSize,self.deltaMove.x),self.deltaMove.y=nx.bounce(self.nodePos[1],self.bgTop+self.nodeSize,self.height-self.bgTop-self.nodeSize,self.deltaMove.y),self.draw(),self.nxTransmit(self.scaleNode()))},this.init()}function matrix(target,transmitCommand,uiIndex){var self=this;this.uiIndex=uiIndex,this.defaultSize={width:200,height:200},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand);var i;this.row=3,this.col=3,this.on=!1,this.off=3,this.matrix,this.matrixLevels,this.cellHgt,this.cellWid,this.pos,this.init=function(){for(self.matrix=new Array(self.row),self.matrixLevels=new Array(self.row),i=0;i<self.matrix.length;i++)self.matrix[i]=new Array(self.col),self.matrixLevels[i]=new Array(self.col);for(i=0;i<self.row;i++)for(j=0;j<self.col;j++)self.matrix[i][j]=0,self.matrixLevels[i][j]=1;self.draw()},this.draw=function(){with(this.cellWid=(this.canvas.width-2*this.off)/this.col,this.cellHgt=(this.canvas.height-2*this.off)/this.row,this.makeRoundedBG(),this.context)strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=this.lineWidth,stroke(),fill();for(i=0;i<this.row;i++)for(j=0;j<this.col;j++){var st_x=j*this.cellWid+this.padding+this.lineWidth,st_y=i*this.cellHgt+this.padding+this.lineWidth;this.cellWid*this.matrix[i][j],this.cellHgt*this.matrix[i][j],(j+1)*this.cellWid+this.off/2,(i+1)*this.cellHgt+this.off+this.off/2;var boxwid=this.cellWid-this.padding-this.lineWidth,boxhgt=this.cellHgt-this.padding-this.lineWidth;with(nx.makeRoundRect(this.context,st_x,st_y,boxwid,boxhgt),this.context)if(strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=this.lineWidth,stroke(),fill(),this.matrix[i][j]>0){var level=Math.abs(this.matrix[i][j]-1),x1=st_x,y1=st_y+this.cellHgt*level-5*level,x2=boxwid+x1,y2=boxhgt*this.matrix[i][j]+y1,depth=6;beginPath(),this.matrix[i][j]>.95?(moveTo(x1+depth,y1),lineTo(x2-depth,y1),quadraticCurveTo(x2,y1,x2,y1+depth)):(moveTo(x1,y1),lineTo(x2,y1)),lineTo(x2,y2-depth),quadraticCurveTo(x2,y2,x2-depth,y2),lineTo(x1+depth,y2),quadraticCurveTo(x1,y2,x1,y2-depth),this.matrix[i][j]>.95?(lineTo(x1,y1+depth),quadraticCurveTo(x1,y1,x1+depth,y1)):lineTo(x1,y1),closePath(),fillStyle=self.colors.accent,fill()}}self.drawLabel()};var whichCell;this.click=function(e){for(i=0;i<self.row;i++)for(j=0;j<self.col;j++){var t=j*self.cellWid+self.off/2,s=i*self.cellHgt+self.off+self.off/2;if(t<self.clickPos.x&&self.clickPos.x<t+self.cellWid&&s<self.clickPos.y&&self.clickPos.y<s+self.cellHgt){1!=e.shiftKey&&(self.matrix[i][j]=self.matrix[i][j]>0?0:self.matrixLevels[i][j]),whichCell=[i,j];break}}self.nxTransmit(self.matrix),self.draw()},this.move=function(){self.clicked&&(delta_value=Math.min(1,Math.max(0,self.matrix[whichCell[0]][whichCell[1]]+.01*-1*self.deltaMove.y)),self.matrix[whichCell[0]][whichCell[1]]=delta_value,self.matrixLevels[whichCell[0]][whichCell[1]]=delta_value,self.nxTransmit(self.matrix),self.draw())},this.release=function(){},this.touch=function(e){for(i=0;i<self.row;i++)for(j=0;j<self.col;j++){var t=j*self.cellWid+self.off/2,s=i*self.cellHgt+self.off+self.off/2;if(t<self.clickPos.x&&self.clickPos.x<t+self.cellWid&&s<self.clickPos.y&&self.clickPos.y<s+self.cellHgt){1!=e.shiftKey&&(self.matrix[i][j]=self.matrix[i][j]>0?0:self.matrixLevels[i][j]),whichCell=[i,j];break}}self.nxTransmit(self.matrix),self.draw()},this.touchMove=function(){self.clicked&&(delta_value=Math.min(1,Math.max(0,self.matrix[whichCell[0]][whichCell[1]]+.01*-1*self.deltaMove.y)),self.matrix[whichCell[0]][whichCell[1]]=delta_value,self.matrixLevels[whichCell[0]][whichCell[1]]=delta_value,self.draw()),self.nxTransmit(self.matrix)},this.touchRelease=function(){},this.init()}function slider(target,transmitCommand,uiIndex){var self=this;this.uiIndex=uiIndex,this.defaultSize={width:50,height:200},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.value=.7,this.realSpace={x:self.width-2*self.padding,y:self.height-2*self.padding},this.sliderWidth=self.realSpace.x,this.throttle=nx.throttle,this.clip=nx.clip,this.label=self.oscName,this.mode="absolute",this.init=function(){null!=this.canvas.getAttribute("label")&&(this.label=this.canvas.getAttribute("label")),self.draw()},this.draw=function(){self.erase(),self.makeRoundedBG(),self.value;var x1=self.padding,y1=self.height-self.value*self.height,x2=self.padding+self.sliderWidth,y2=self.height-self.padding,depth=2*self.padding;with(this.context)strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),strokeStyle=this.colors.accent,fillStyle=this.colors.border,lineWidth=5,globalAlpha=.4,beginPath(),self.value>.97?(moveTo(x1+depth,y1),lineTo(x2-depth,y1),quadraticCurveTo(x2,y1,x2,y1+depth)):(moveTo(x1,y1),lineTo(x2,y1)),lineTo(x2,y2-depth),quadraticCurveTo(x2,y2,x2-depth,y2),lineTo(x1+depth,y2),quadraticCurveTo(x1,y2,x1,y2-depth),self.value>.95?(lineTo(x1,y1+depth),quadraticCurveTo(x1,y1,x1+depth,y1)):lineTo(x1,y1),self.value>.03&&fill(),closePath(),y1-=10,y1<self.padding?y1=self.padding:y1>self.height-self.padding-20&&(y1=self.height-self.padding-10),globalAlpha=.8,beginPath(),nx.makeRoundRect(self.context,x1,y1,x2-self.padding,10),fillStyle=self.colors.border,fill(),strokeStyle=self.colors.white,lineWidth=1,closePath(),globalAlpha=1,beginPath(),strokeStyle=self.colors.accent,lineWidth=3,moveTo(x1+3,y1+7),lineTo(x2-3,y1+7),stroke(),closePath(),save(),translate(self.width/2,0),rotate(Math.PI/2),textAlign="left",textBaseline="middle",font="bold 15px courier",fillStyle=self.colors.border,fillText(self.label,self.width/2,0),restore()},this.click=function(){self.move()},this.move=function(){"absolute"==self.mode?self.clicked&&(self.value=Math.abs(nx.clip(self.clickPos.y/self.height,.01,.98)-1),self.draw()):"relative"==self.mode&&self.clicked&&(self.value=nx.clip(self.value+-1*self.deltaMove.y/self.height,.01,.98),self.draw());var e=(self.value-.02)*(1/.97);self.nxTransmit(e)},this.release=function(){},this.touch=function(){self.move()},this.touchMove=function(){self.move()},this.touchRelease=function(){},this.init()}function multislider(target,transmitCommand,uiIndex){var self=this;this.uiIndex=uiIndex,this.defaultSize={width:300,height:200},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.sliders=15,this.values=new Array;for(var i=0;i<this.sliders;i++)this.values.push(.7-i*(.3/this.sliders));this.sliderClicked=0,this.realSpace={x:self.width-2*self.padding,y:self.height-2*self.padding},this.sliderWidth=self.realSpace.x/self.sliders,this.oldSliderToMove,this.throttle=nx.throttle,this.clip=nx.clip,this.init=function(){nx.getHandlers(self),self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),this.context)for(strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),strokeStyle=this.colors.accent,fillStyle=this.colors.accent,lineWidth=5,i=0;i<self.sliders;i++)beginPath(),moveTo(self.padding+i*self.sliderWidth,self.height-self.values[i]*self.height),lineTo(self.padding+i*self.sliderWidth+self.sliderWidth,self.height-self.values[i]*self.height),stroke(),lineTo(self.padding+i*self.sliderWidth+self.sliderWidth,self.height-self.padding),lineTo(self.padding+i*self.sliderWidth,self.height-self.padding),globalAlpha=.3-.1*(i%3),fill(),closePath(),globalAlpha=1;self.drawLabel()},this.click=function(){self.oldSliderToMove=!1,self.move()},this.move=function(){if(self.clicked){var e=Math.floor(self.clickPos.x/self.sliderWidth);if(e=nx.clip(e,0,self.sliders-1),self.values[e]=nx.clip(nx.invert(self.clickPos.y/self.height),0,1),self.oldSliderToMove){var t=e-self.oldSliderToMove;if(t>1){var s=(self.values[e]-self.values[self.oldSliderToMove])/t;for(i=1;t>i;i++)self.values[self.oldSliderToMove+i]=self.values[self.oldSliderToMove]+s*i}if(-1>t){var s=(self.values[e]-self.values[self.oldSliderToMove])/Math.abs(t);for(i=-1;i>t;i--)self.values[self.oldSliderToMove+i]=self.values[e]+s*i}}self.oldSliderToMove=e,self.draw()}self.nxTransmit(self.values)},this.release=function(){},this.touch=function(){self.oldSliderToMove=!1,self.move()},this.touchMove=function(){self.move()},this.touchRelease=function(){},this.setNumberOfSliders=function(e){this.sliders=e,this.values=new Array;for(var t=0;t<this.sliders;t++)this.values.push(.5);this.sliderWidth=self.realSpace.x/self.sliders,this.init()}}function select(e,t,s){var i=this;isNaN(s)||(i.uiIndex=s),this.defaultSize={width:200,height:30},this.getTemplate=getTemplate,this.getTemplate(i,e,t),i.choices=[],this.init=function(){i.canvas.ontouchstart=null,i.canvas.ontouchmove=null,i.canvas.ontouchend=null,i.canvas.getAttribute("choices")&&(i.choices=i.canvas.getAttribute("choices"),i.choices=i.choices.split(","));var e='<select id="'+i.canvasID+'" style="height:'+i.height+"px;width:"+i.width+"px;font-size:"+i.height/2+'px" onchange="'+i.canvasID+'.change(this)"></select><canvas height="1px" width="1px"></canvas>';$("#"+i.canvasID).replaceWith(e),i.canvas=document.getElementById(i.canvasID);for(var t=0;t<i.choices.length;t++){var s=document.createElement("option");s.text=i.choices[t],s.value=i.choices[t],i.canvas.add(s,null)}},this.change=function(e){i.value=e.value,i.nxTransmit(i.value)},this.init()}function tilt(target,transmitCommand,uiIndex){var self=this;this.uiIndex=uiIndex,this.defaultSize={width:100,height:100},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.tiltLR,this.tiltFB,this.z,this.scaledX,this.scaledY,this.scaledZ,this.defaultText="TILT",this.throttle=nx.throttle,this.clip=nx.clip,self.deviceOrientationHandler=function(){document.getElementById(self.canvasID).style.webkitTransform="rotate("+self.tiltLR+"deg) rotate3d(1,0,0, "+-1*self.tiltFB+"deg)",document.getElementById(self.canvasID).style.MozTransform="rotate("+self.tiltLR+"deg)",document.getElementById(self.canvasID).style.transform="rotate("+self.tiltLR+"deg) rotate3d(1,0,0, "+-1*self.tiltFB+"deg)",self.scaledX=nx.prune(self.tiltLR/90,3),self.scaledY=nx.prune(self.tiltFB/90,3),self.scaledZ=nx.prune(self.z,3),self.nxTransmit([self.scaledX,self.scaledY,self.scaledZ])},this.init=function(){self.draw(),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",function(e){self.tiltLR=e.gamma,self.tiltFB=e.beta,self.z=e.alpha,self.deviceOrientationHandler()},!1):window.OrientationEvent?window.addEventListener("MozOrientation",function(e){self.tiltLR=90*e.x,self.tiltFB=-90*e.y,self.z=e.z,self.deviceOrientationHandler()},!1):console.log("Not supported on your device or browser.")},this.draw=function(){with(self.erase(),self.context){strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth;var grd=self.context.createRadialGradient(self.width/3,self.height/5,self.width/20,self.width/3,self.height/5,self.width);grd.addColorStop(0,self.colors.white),grd.addColorStop(1,self.colors.accent),fillStyle=grd,fillStyle=self.colors.fill,fillRect(0,0,self.width,self.height),strokeStyle=self.colors.border,lineWidth=10,strokeRect(0,0,self.width,self.height),globalAlpha=.4,fillStyle=self.colors.accent,font="bold "+self.height/5+"px gill sans",textAlign="center",fillText(self.defaultText,self.width/2,self.height/2+self.height/15),globalAlpha=1}self.drawLabel()},this.scaleNode=function(){return self.values=[nx.prune(self.nodePos[0]/self.width,3),nx.prune(self.nodePos[1]/self.height,3)],self.values},this.init()}function sandbox(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:400,height:300},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand);var i,toySize=60,trashWall=toySize+20,dragging=-1,Toys=new Array,ToyColors=["red","orange","yellow","green","blue","purple","black","pink"],ToyOptions=new Array;for(self.options=4,i=0;i<self.options;i++){var xpos=10+toySize/2,ypos=i*(toySize+12)+11+toySize/2;ToyOptions[i]={color:ToyColors[i%8],xpos:xpos,ypos:ypos,wid:toySize,hgt:toySize}}this.isInsideCircle=function(e,t){return e.x>t.xpos-t.wid/2&&e.x<t.xpos+t.wid/2&&e.y>t.ypos-t.hgt/2&&e.y<t.ypos+t.hgt/2?!0:!1},this.init=function(){self.createUISpaces(),self.drawSpaces(),self.drawToyOptions(),self.drawToys()},this.draw=function(){self.drawSpaces(),self.drawToyOptions(),self.drawToys(),self.drawLabel()},this.createUISpaces=function(){for(self.UISpaces=[{field:"main",xpos:65,ypos:5,wid:self.canvas.width-95,hgt:self.canvas.height-10,hint:"sandbox"},{field:"holder",xpos:5,ypos:5,wid:70,hgt:self.canvas.height-10,hint:""}],i=0;i<this.UISpaces.length;i++)this.UISpaces[i].xpos2=this.UISpaces[i].xpos+this.UISpaces[i].wid,this.UISpaces[i].ypos2=this.UISpaces[i].ypos+this.UISpaces[i].hgt,this.UISpaces[i].centerx=this.UISpaces[i].xpos+this.UISpaces[i].wid/2,this.UISpaces[i].centery=this.UISpaces[i].ypos+this.UISpaces[i].hgt/2
},self.click=function(){for(i=0;i<ToyOptions.length;i++)if(self.isInsideCircle(self.clickPos,ToyOptions[i])){var e={xpos:ToyOptions[i].xpos,ypos:ToyOptions[i].xpos,wid:ToyOptions[i].wid,hgt:ToyOptions[i].hgt,color:ToyOptions[i].color,shape:ToyOptions[i].shape};Toys.push(e),dragging=Toys.length-1}for(i=0;i<Toys.length;i++)self.isInsideCircle(self.clickPos,Toys[i])&&(dragging=i);self.nxTransmit([dragging,Toys[dragging].xpos,Toys[dragging].ypos])},self.move=function(){self.clicked&&-1!=dragging&&(Toys[dragging].xpos=self.clickPos.x,Toys[dragging].ypos=self.clickPos.y,self.drawToys(),self.nxTransmit([dragging,Toys[dragging].xpos,Toys[dragging].ypos]))},self.release=function(){for(dragging=-1,i=Toys.length-1;i>-1;i--)Toys[i].xpos<trashWall&&Toys.splice(i,1);self.drawToys()},self.touch=function(e){self.click(e)},self.touchMove=function(e){self.move(e)},self.touchRelease=function(e){self.release(e)},self.drawToyOptions=function(){with(self.context)for(i=0;i<ToyOptions.length;i++)globalAlpha=.4,fillStyle=ToyOptions[i].color,beginPath(),arc(ToyOptions[i].xpos,ToyOptions[i].ypos,toySize/2,2*Math.PI,!1),fill(),closePath(),fillStyle=self.colors.accent,beginPath(),arc(ToyOptions[i].xpos,ToyOptions[i].ypos,toySize/2,2*Math.PI,!1),fill(),globalAlpha=1},self.drawToys=function(){with(self.context){for(clearRect(0,0,self.width,self.height),self.drawSpaces(),self.drawToyOptions(),i=0;i<Toys.length;i++)globalAlpha=.4,fillStyle=Toys[i].color,beginPath(),arc(Toys[i].xpos,Toys[i].ypos,toySize/2,2*Math.PI,!1),fill(),fillStyle=self.colors.accent,beginPath(),arc(Toys[i].xpos,Toys[i].ypos,toySize/2,2*Math.PI,!1),fill();globalAlpha=1}},self.drawSpaces=function(){with(self.context)for(lineWidth=self.lineWidth,strokeStyle=self.colors.border,fillStyle=self.colors.fill,i=0;i<self.UISpaces.length;i++){var space=self.UISpaces[i];nx.makeRoundRect(self.context,space.xpos,space.ypos,space.wid,space.hgt),stroke(),fill()}},this.init()}function joints(target,transmitCommand,uiIndex){var self=this;this.uiIndex=uiIndex,this.defaultSize={width:400,height:400},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.nodeSize=35,this.values=[0,0],this.nodePos=[50,50],this.joints=[{x:self.width/1.2,y:self.height/1.2},{x:self.width/2,y:self.height/1.3},{x:self.width/4.2,y:self.height/1.1},{x:self.width/1.4,y:self.height/2.2},{x:self.width/2.1,y:self.height/1.8},{x:self.width/5,y:self.height/2.4},{x:self.width/2.8,y:self.height/6},{x:self.width/6,y:self.height/3.7}],this.connections=new Array,this.threshold=self.width/3,this.default_text="click or touch to control a node",this.throttle=nx.throttle,this.clip=nx.clip,this.init=function(){self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context){strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),null!=self.nodePos[0]?self.drawNode():(fillStyle=self.colors.border,font="14px courier",fillText(self.default_text,10,20)),fillStyle=self.colors.accent,strokeStyle=self.colors.border,lineWidth=self.lineWidth;for(var i in self.joints){beginPath(),arc(self.joints[i].x,self.joints[i].y,self.nodeSize/2,0,2*Math.PI,!0),fill(),closePath();var cnctX=Math.abs(self.joints[i].x-self.nodePos[0]),cnctY=Math.abs(self.joints[i].y-self.nodePos[1]),strength=cnctX+cnctY;if(strength<self.threshold){beginPath(),moveTo(self.joints[i].x,self.joints[i].y),lineTo(self.nodePos[0],self.nodePos[1]),strokeStyle=self.colors.accent,lineWidth=nx.scale(strength,0,self.threshold,self.nodeSize/2,5),stroke(),closePath();var scaledstrength=nx.scale(strength,0,self.threshold,1,0);self.connections.push([i,scaledstrength])}}}self.drawLabel()},this.drawNode=function(){with(self.nodePos[0]<self.bgLeft+self.nodeSize?self.nodePos[0]=self.bgLeft+self.nodeSize:self.nodePos[0]>self.bgRight-self.nodeSize&&(self.nodePos[0]=self.bgRight-self.nodeSize),self.nodePos[1]<self.bgTop+self.nodeSize?self.nodePos[1]=self.bgTop+self.nodeSize:self.nodePos[1]>self.bgBottom-self.nodeSize&&(self.nodePos[1]=self.bgBottom-self.nodeSize),self.context)globalAlpha=1,beginPath(),fillStyle=self.colors.accent,strokeStyle=self.colors.border,lineWidth=self.lineWidth,arc(self.nodePos[0],self.nodePos[1],self.nodeSize,0,2*Math.PI,!0),fill(),closePath()},this.scaleNode=function(){return self.values=[nx.prune(self.nodePos[0]/self.width,3),nx.prune(self.nodePos[1]/self.height,3)],self.values},this.click=function(){self.nodePos[0]=self.clickPos.x,self.nodePos[1]=self.clickPos.y,self.draw(),self.nxTransmit(self.connections),self.connections=new Array},this.move=function(){self.clicked&&(self.nodePos[0]=self.clickPos.x,self.nodePos[1]=self.clickPos.y,self.draw(),{"self.clickPos.x":self.clickPos.x,"self.clickPos.y":self.clickPos.y,"self.nodePos[0]":self.nodePos[0],"self.nodePos[1]":self.nodePos[1],"self.offset":self.offset},self.nxTransmit(self.connections),self.connections=new Array)},this.release=function(){},this.touch=function(){self.nodePos[0]=self.clickPos.x,self.nodePos[1]=self.clickPos.y,self.draw(),self.nxTransmit(self.connections),self.connections=new Array},this.touchMove=function(){self.clicked&&(self.nodePos[0]=self.clickPos.x,self.nodePos[1]=self.clickPos.y,self.draw(),self.nxTransmit(self.connections),self.connections=new Array)},this.touchRelease=function(){},this.animate=function(e){switch(e){case"bounce":nx.aniItems.push(self.aniBounce);break;case"none":nx.aniItems.splice(nx.aniItems.indexOf(self.aniBounce))}},this.aniBounce=function(){!self.clicked&&self.nodePos[0]&&(self.nodePos[0]+=self.deltaMove.x/2,self.nodePos[1]+=self.deltaMove.y/2,self.deltaMove.x=nx.bounce(self.nodePos[0],self.bgLeft+self.nodeSize,self.width-self.bgLeft-self.nodeSize,self.deltaMove.x),self.deltaMove.y=nx.bounce(self.nodePos[1],self.bgTop+self.nodeSize,self.height-self.bgTop-self.nodeSize,self.deltaMove.y),self.draw(),self.nxTransmit(self.scaleNode()))},this.init()}function colors(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:200,height:200},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand);var color_table,color_width=self.canvas.width-2*self.padding,color_height=self.canvas.height-2*self.padding,saturation=100;self.color=[0,0,0];var i;this.init=function(){for(color_table=new Array(color_width),i=0;i<color_table.length;i++)color_table[i]=new Array(color_height);for(i=0;color_width>i;i++)for(h=Math.round(255/color_width*i),j=0;color_height>j;j++)s=saturation,l=Math.round(100/color_height*j),color_table[i][j]=[h,s,l];self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context)fillStyle=self.colors.fill,strokeStyle=self.colors.border,fill(),stroke();for(i=0;color_width>i;i++)for(j=0;color_height>j;j++)with(hue=color_table[i][j][0],sat=color_table[i][j][1],lum=color_table[i][j][2],self.context)beginPath(),fillStyle="hsl("+hue+", "+sat+"%, "+lum+"%)",fillRect(i+self.padding,j+self.padding,255/color_width,100/color_height),fill(),closePath();self.drawLabel()},this.click=function(){var e=self.context.getImageData(self.clickPos.x,self.clickPos.y,1,1);self.color=[e.data[0],e.data[1],e.data[2]],self.nxTransmit(self.color)},this.move=function(e){self.click(e)},this.touch=function(e){self.click(e)},this.touchMove=function(e){self.click(e)},this.init()}function pixels(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:300,height:300},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),self.dim={x:10,y:10},self.mode="write",this.init=function(){self.px={wid:(self.width-2*self.padding)/self.dim.x,hgt:(self.height-2*self.padding)/self.dim.y},self.screen=new Array;for(var e=0;e<self.dim.y;e++){self.screen[e]=new Array;for(var t=0;t<self.dim.x;t++)self.screen[e][t]=[0,0,0]}self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context)fillStyle=self.colors.fill,strokeStyle=self.colors.border,fill(),stroke();self.drawLabel()},this.reset=function(){self.draw()},this.click=function(e){var pixX=~~(self.clickPos.x/self.px.wid),scaledX=pixX*self.px.wid+self.padding,pixY=~~(self.clickPos.y/self.px.hgt),scaledY=pixY*self.px.hgt+self.padding;if(self.lastpx={x:scaledX,y:scaledY},"write"==self.mode){with(self.context)globalAlpha=.3,fillStyle=self.colors.accent,fillRect(scaledX,scaledY,2*self.px.wid,2*self.px.hgt),globalAlpha=1;var imgData=self.context.getImageData(self.clickPos.x,self.clickPos.y,1,1);self.screen[pixY][pixX]=[imgData.data[0],imgData.data[1],imgData.data[2]];var imgData=self.context.getImageData(self.clickPos.x+self.px.wid,self.clickPos.y,1,1);self.screen[pixY][pixX+1]=[imgData.data[0],imgData.data[1],imgData.data[2]];var imgData=self.context.getImageData(self.clickPos.x,self.clickPos.y+self.px.hgt,1,1);self.screen[pixY+1][pixX]=[imgData.data[0],imgData.data[1],imgData.data[2]];var imgData=self.context.getImageData(self.clickPos.x+self.px.wid,self.clickPos.y+self.px.hgt,1,1);self.screen[pixY+1][pixX+1]=[imgData.data[0],imgData.data[1],imgData.data[2]]}self.send(pixX,pixY)},this.move=function(){var pixX=~~(self.clickPos.x/self.px.wid);pixX=nx.clip(pixX,0,self.dim.x-2);var scaledX=pixX*self.px.wid+self.padding,pixY=~~(self.clickPos.y/self.px.hgt);pixY=nx.clip(pixY,0,self.dim.y-2);var scaledY=pixY*self.px.hgt+self.padding;if(scaledX!=self.lastpx.x||scaledY!=self.lastpx.y){if(self.lastpx={x:scaledX,y:scaledY},"write"==self.mode){with(self.context)globalAlpha=.1,fillStyle=self.colors.accent,fillRect(scaledX,scaledY,2*self.px.wid,2*self.px.hgt),globalAlpha=1;var imgData=self.context.getImageData(self.clickPos.x,self.clickPos.y,1,1);self.screen[pixY][pixX]=[imgData.data[0],imgData.data[1],imgData.data[2]];var imgData=self.context.getImageData(self.clickPos.x+self.px.wid,self.clickPos.y,1,1);self.screen[pixY][pixX+1]=[imgData.data[0],imgData.data[1],imgData.data[2]];var imgData=self.context.getImageData(self.clickPos.x,self.clickPos.y+self.px.hgt,1,1);self.screen[pixY+1][pixX]=[imgData.data[0],imgData.data[1],imgData.data[2]];var imgData=self.context.getImageData(self.clickPos.x+self.px.wid,self.clickPos.y+self.px.hgt,1,1);self.screen[pixY+1][pixX+1]=[imgData.data[0],imgData.data[1],imgData.data[2]]}self.send(pixX,pixY)}},this.release=function(){},this.touch=function(e){self.click(e)},this.touchMove=function(e){self.move(e)},this.touchRelease=function(e){self.release(e)},this.send=function(e,t){"write"==self.mode?self.nxTransmit(self.screen):"read"==self.mode&&self.nxTransmit(self.screen[t][e])},this.init()}function number(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:100,height:50},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.value=0,this.throttle=nx.throttle,this.clip=nx.clip,this.init=function(){self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context)strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),fillStyle=self.colors.black,textAlign="left",font=.6*self.height+"px courier",textBaseline="middle",fillText(self.value,10,self.height/2-1)},this.click=function(){},this.move=function(){self.clicked&&(self.value+=-1*self.deltaMove.y,self.draw(),self.nxTransmit(self.value))},this.release=function(){},this.touch=function(){},this.touchMove=function(e){self.move(e)},this.touchRelease=function(){},this.animate=function(e){switch(e){case"bounce":nx.aniItems.push(self.aniBounce);break;case"none":nx.aniItems.splice(nx.aniItems.indexOf(self.aniBounce))}},this.aniBounce=function(){!self.clicked&&self.nodePos[0]&&(self.nodePos[0]+=self.deltaMove.x/2,self.nodePos[1]+=self.deltaMove.y/2,self.deltaMove.x=nx.bounce(self.nodePos[0],self.bgLeft+self.nodeSize,self.width-self.bgLeft-self.nodeSize,self.deltaMove.x),self.deltaMove.y=nx.bounce(self.nodePos[1],self.bgTop+self.nodeSize,self.height-self.bgTop-self.nodeSize,self.deltaMove.y),self.draw(),self.nxTransmit(self.value))},this.init()}function comment(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:100,height:50},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.value="comment",this.size=14,this.throttle=nx.throttle,this.clip=nx.clip,this.init=function(){self.draw()},this.draw=function(){with(self.erase(),self.context)globalAlpha=1,fillStyle=self.colors.fill,fillRect(0,0,self.width,self.height),strokeStyle=self.colors.border,lineWidth=3,beginPath(),moveTo(0,self.height),lineTo(self.width,self.height),strokeStyle=self.colors.accent,stroke(),closePath(),globalAlpha=1,fillStyle=self.colors.black,textAlign="left",font=self.size+"px Gill Sans";nx.wrapText(self.context,self.value,6,3+self.size,self.width-6,self.size)},this.init()}function message(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:100,height:50},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.value="a message",this.size=13,this.init=function(){this.value=self.canvas.getAttribute("label"),self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context){strokeStyle=self.colors.border,fillStyle=self.clicked?self.colors.accent:self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),globalAlpha=.2;var grd=self.context.createLinearGradient(0,0,0,self.height);grd.addColorStop(0,self.colors.fill),grd.addColorStop(1,self.colors.black),fillStyle=grd,fill(),globalAlpha=1,fillStyle=self.colors.black,textAlign="left",font=self.size+"px Gill Sans"}nx.wrapText(self.context,self.value,5,1+self.size,self.width-6,self.size)},this.click=function(){self.draw(),self.nxTransmit(self.value)},this.release=function(){self.draw()},this.touch=function(e){self.click(e)},this.touchRelease=function(){self.draw()},this.init()}function panel(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:100,height:100},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.value=0,this.throttle=nx.throttle,this.clip=nx.clip,this.init=function(){self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context)strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill()},this.init()}function banner(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:125,height:50},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.message1="Powered by",this.message2="• Nexus UI •",this.message3="nexusosc.com",this.init=function(){self.draw()},this.draw=function(){with(self.context)globalAlpha=.1,fillStyle=self.colors.accent,beginPath(),moveTo(0,10),lineTo(10,self.height/2+5),lineTo(0,self.height),lineTo(30,self.height),lineTo(30,10),fill(),moveTo(self.width-30,10),lineTo(self.width-30,self.height),lineTo(self.width,self.height),lineTo(self.width-10,self.height/2+5),lineTo(self.width,10),fill(),closePath(),globalAlpha=1,fillStyle=self.colors.accent,fillRect(15,0,self.width-30,self.height-10),fillStyle=self.colors.white,font=self.height/5+"px courier",textAlign="center",fillText(self.message1,self.width/2,self.height/3.3),fillText(self.message2,self.width/2,2*(self.height/3.3)),fillStyle=self.colors.black,beginPath(),moveTo(15,self.height-10),lineTo(30,self.height),lineTo(30,self.height-10),lineTo(15,self.height-10),fill(),moveTo(self.width-15,self.height-10),lineTo(self.width-30,self.height),lineTo(self.width-30,self.height-10),lineTo(self.width-15,self.height-10),fill(),closePath();this.click=function(){window.location="http://www.nexusosc.com"}},this.init()}function multitouch(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:300,height:300},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.nodeSize=self.width/10,this.nodes=new Array,this.values=[0,0],this.default_text="multi touch",this.throttle=nx.throttle,this.clip=nx.clip,this.rainbow=["#00f","#04f","#08F","0AF","0FF"],this.mode="normal",this.rows=10,this.cols=10,this.getHue=function(e){var t=256>e?e:Math.max(512-e,0),s=e>256?e-256:0;s=256>s?s:Math.max(512-s,0);var i=e>512?e-512:0;return i=256>i?i:Math.max(512-i,0),"rgb("+t+","+s+","+i+")"},this.init=function(){self.draw()},this.draw=function(){with(self.erase(),self.makeRoundedBG(),self.context)if(strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),"matrix"==self.mode)for(var i=0;i<self.rows;i++)for(var j=0;j<self.cols;j++)with(self.context){beginPath(),fillStyle=self.colors.accent,strokeStyle=self.colors.border,lineWidth=1;var circx=i*self.width/self.rows+self.width/self.rows/2,circy=j*self.height/self.cols+self.height/self.cols/2;arc(circx,circy,self.height/self.cols/2,0,2*Math.PI,!0),stroke(),fillStyle=self.colors.border,textAlign="center",textBaseline="middle";var thisarea={xpos:i*self.width/self.rows,ypos:j*self.height/self.cols,wid:self.width/self.rows,hgt:self.height/self.cols};if(self.clickPos.touches.length>=1)for(var k=0;k<self.clickPos.touches.length;k++)nx.isInside(self.clickPos.touches[k],thisarea)&&(globalAlpha=.5,fillStyle=self.colors.accent,fill(),globalAlpha=.3,fillStyle=self.rainbow[k],fill(),globalAlpha=1);closePath()}else if(self.clickPos.touches.length>=1)for(var i=0;i<self.clickPos.touches.length;i++)with(self.context)globalAlpha=.5,beginPath(),fillStyle=self.colors.accent,strokeStyle=self.colors.border,lineWidth=self.lineWidth,arc(self.clickPos.touches[i].x,self.clickPos.touches[i].y,self.nodeSize,0,2*Math.PI,!0),fill(),closePath(),globalAlpha=.3,beginPath(),fillStyle=self.rainbow[i],strokeStyle=self.colors.border,lineWidth=self.lineWidth,arc(self.clickPos.touches[i].x,self.clickPos.touches[i].y,self.nodeSize,0,2*Math.PI,!0),fill(),closePath(),globalAlpha=1;else fillStyle=self.colors.border,font="14px courier",textAlign="center",fillText(self.default_text,self.width/2,self.height/2);self.drawLabel()},this.click=function(){self.draw(),self.sendit()},this.move=function(){self.clicked&&(self.draw(),self.sendit())},this.release=function(){self.clickPos.touches.length>1?self.clicked=!0:self.clickPos.touches=new Array,self.draw(),self.sendit()},this.touch=function(){self.draw(),self.sendit()},this.touchMove=function(){self.clicked&&(self.draw(),self.sendit())},this.touchRelease=function(){self.release()},this.sendit=function(){self.values=new Array;for(var e=0;e<self.clickPos.touches.length;e++)self.values.push(self.clickPos.touches[e].x/self.canvas.width),self.values.push(nx.invert(self.clickPos.touches[e].y/self.canvas.height));for(var e=self.values.length;10>e;e++)self.values.push(0);self.nxTransmit(self.values)},this.init()}function metroball(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:300,height:200},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.CurrentBalls=new Array,this.UISpaces=new Array;var globalMetro,ballPos=new Object,clickField=null,tempo=1,quantize=!1,tilt=0;self.tiltLR,self.tiltFB,self.z;var i;this.init=function(){self.createUISpaces(),globalMetro=setInterval(self.canvasID+".pulse()",20),window.DeviceOrientationEvent?window.addEventListener("deviceorientation",function(e){self.tiltLR=e.gamma,self.tiltFB=e.beta,self.z=e.alpha,self.tilt()},!1):window.OrientationEvent?window.addEventListener("MozOrientation",function(e){self.tiltLR=90*e.x,self.tiltFB=-90*e.y,self.z=e.z,self.tilt()},!1):console.log("Not supported on your device or browser.")},this.createUISpaces=function(){self.UISpaces=[{field:"main",xpos:5,ypos:45,wid:self.width-10,hgt:self.height-45-self.padding,hint:"click to add"},{field:"delete",xpos:45,ypos:5,wid:self.width-50,hgt:35,hint:"swipe to delete"},{field:"quantize",xpos:5,ypos:5,wid:35,hgt:35,hint:"Q"}];for(var e=0;e<self.UISpaces.length;e++)self.UISpaces[e].xpos2=self.UISpaces[e].xpos+self.UISpaces[e].wid,self.UISpaces[e].ypos2=self.UISpaces[e].ypos+self.UISpaces[e].hgt,self.UISpaces[e].centerx=self.UISpaces[e].xpos+self.UISpaces[e].wid/2,self.UISpaces[e].centery=self.UISpaces[e].ypos+self.UISpaces[e].hgt/2},this.pulse=function(){with(self.context)clearRect(0,0,self.width,self.height);self.drawSpaces(),self.drawBalls(),self.drawLabel()},this.drawSpaces=function(){with(self.context){for(lineWidth=3,strokeStyle=self.colors.border,fillStyle=self.colors.fill,i=0;i<self.UISpaces.length;i++){var space=self.UISpaces[i];nx.makeRoundRect(self.context,space.xpos,space.ypos,space.wid,space.hgt),stroke(),"quantize"==space.field&&quantize?(fillStyle=self.colors.accent,fill(),fillStyle=self.colors.fill):fill()}for(lineWidth=2,fillStyle=self.colors.border,lineStyle="#ffffff",font="bold 14px courier",textAlign="center",i=0;i<self.UISpaces.length;i++){var space=self.UISpaces[i];fillText(space.hint,space.centerx,space.centery+5)}}},this.drawBalls=function(){with(self.context)for(i=0;i<self.CurrentBalls.length;i++)self.CurrentBalls[i].move(),self.CurrentBalls[i].draw()},this.click=function(){for(ballPos=self.clickPos,i=0;i<self.UISpaces.length;i++)nx.isInside(ballPos,self.UISpaces[i])&&(clickField=self.UISpaces[i].field);switch(clickField){case"main":self.addNewMB(ballPos);break;case"delete":self.deleteMB(ballPos);break;case"quantize":self.toggleQuantization()}},this.move=function(){switch(ballPos=self.clickPos,clickField){case"delete":self.deleteMB(ballPos);break;case"tempo":self.moveTempo(ballPos)}},this.release=function(){clickField=null},this.touch=function(e){self.click(e)},this.touchMove=function(e){self.move(e)},this.touchRelease=function(e){self.release(e)},this.deleteMB=function(e){for(i=self.CurrentBalls.length-1;i>=0;i--)Math.abs(self.CurrentBalls[i].xpos-e.x)<10&&self.CurrentBalls[i].kill();for(i=0;i<self.CurrentBalls.length;i++)self.CurrentBalls[i].SelfIndex=i},this.addNewMB=function(e){var t=self.CurrentBalls.length;self.CurrentBalls[t]=new self.Ball(t,e.x,e.y)},this.toggleQuantization=function(){quantize=quantize?!1:!0},this.tilt=function(){var e=nx.prune(self.tiltLR/90,3),t=nx.prune(self.tiltFB/90,3);nx.prune(self.z,3),tilt=10*e,tempo=Math.pow(t+1,3)},this.Ball=function(SelfIndex,SelfX,SelfY){this.SelfIndex=SelfIndex,this.space=self.UISpaces[0],this.color=self.colors.accent,this.xpos=SelfX,this.ypos=SelfY,this.size=10,this.direction=1,this.speed=(this.space.hgt-(this.ypos-this.space.ypos))/20,this.speedQ=5,quantize&&(this.ypos=this.space.hgt+13),this.move=function(){this.ypos=quantize?this.ypos+this.speedQ*this.direction*tempo:this.ypos+this.speed*this.direction*tempo,(this.ypos>this.space.ypos2-this.size-2||this.ypos<this.space.ypos+this.size+2)&&this.bounce(),this.ypos<this.space.ypos+this.size?this.ypos=this.space.ypos+this.size+5:this.ypos>this.space.ypos+this.space.hgt-this.size&&(this.ypos=this.space.ypos+this.space.hgt-this.size-5),this.xpos=this.xpos+tilt,this.xpos<this.space.xpos?this.xpos=this.space.xpos2:this.xpos>this.space.xpos2&&(this.xpos=this.space.xpos)},this.bounce=function(){this.direction/2+1,this.bounceside=(this.direction+1)/2,this.direction=-1*this.direction;var e=this.xpos/this.space.wid;self.nxTransmit([e,this.bounceside,this.SelfIndex])},this.kill=function(){self.CurrentBalls.splice(this.SelfIndex,1)},this.draw=function(){with(self.context)beginPath(),fillStyle=this.color,1==this.direction?(this.radius=this.size*Math.abs(2*((this.ypos-this.space.ypos-this.space.hgt/2)/(this.space.hgt-this.space.ypos))),this.radius=this.radius/2+this.size/2,this.radius=this.size,this.radius=this.speed,this.radius=Math.abs(15-this.speed)):(this.radius=this.size*Math.abs(2-Math.abs(2*((this.ypos-this.space.ypos-this.space.hgt/2)/(this.space.hgt-this.space.ypos)))),this.radius=this.radius/2+this.size/2,this.radius=this.size,this.radius=Math.abs(15-this.speed)),arc(this.xpos,this.ypos,this.radius,0,2*Math.PI,!0),shadowColor=this.color,shadowBlur=2,fill(),shadowBlur=0}},this.init()}function string(target,transmitCommand,uiIndex){var self=this;isNaN(uiIndex)||(self.uiIndex=uiIndex),this.defaultSize={width:300,height:200},this.getTemplate=getTemplate,this.getTemplate(self,target,transmitCommand),this.nodeSize=15,this.values=[0,0],this.numberofstrings=8,this.strings=new Array,this.rainbow=[self.colors.accent,self.colors.black,self.colors.border],this.abovestring=new Array,this.default_text="touch to control",this.throttle=nx.throttle,this.clip=nx.clip;var stringdiv;this.init=function(){stringdiv=self.height/(self.numberofstrings+1);for(var e=0;e<self.numberofstrings;e++)self.strings[e]={x1:self.padding,y1:stringdiv*(1+e),x2:self.width-self.padding,y2:stringdiv*(e+1),held:!1,vibrating:!1,force:0,maxstretch:0,stretch:0,direction:0,above:!1};self.draw(),nx.aniItems.push(self.draw)},this.setStrings=function(e){self.numberofstrings=e,self.strings=new Array,self.init()},this.pluck=function(e){var t=e;self.nxTransmit([t,self.clickPos.x/self.width]),self.strings[t].force=self.clickPos.y-self.strings[t].y1,self.strings[t].maxstretch=Math.abs(self.clickPos.y-self.strings[t].y1),self.strings[t].stretch=self.clickPos.y-self.strings[t].y1,self.strings[t].vibrating=!0,self.strings[t].direction=(self.clickPos.y-self.strings[t].y1)/Math.abs(self.clickPos.y-self.strings[t].y1)*((self.clickPos.y-self.strings[t].y1)/-1.2)},this.draw=function(){with(self.rainbow[0]=self.colors.accent,self.erase(),self.makeRoundedBG(),self.context){strokeStyle=self.colors.border,fillStyle=self.colors.fill,lineWidth=self.lineWidth,stroke(),fill(),strokeStyle=self.colors.accent;for(var i=0;i<self.strings.length;i++){var st=self.strings[i];st.vibrating?(st.maxstretch<0&&(st.vibrating=!1,st.held=!1),st.stretch=st.stretch+st.direction,Math.abs(st.stretch)>st.maxstretch&&(st.direction*=-1,st.stretch=st.stretch+st.direction,st.maxstretch=st.maxstretch-1,st.direction=st.direction/Math.abs(st.direction)*(st.maxstretch/1),console.log(st.maxstretch),console.log(Math.abs(st.stretch))),beginPath(),moveTo(st.x1,st.y1),quadraticCurveTo(self.width/2,st.y1+st.stretch,st.x2,st.y2),stroke(),closePath(),st.on=!0):st.held?(beginPath(),moveTo(st.x1,st.y1),quadraticCurveTo(self.clickPos.x,self.clickPos.y,st.x2,st.y2),stroke(),closePath(),st.on=!0):(beginPath(),moveTo(st.x1,st.y1),lineTo(st.x2,st.y2),stroke(),closePath(),st.on&&(st.on=!1))}}self.drawLabel()},this.click=function(){for(var e=0;e<self.numberofstrings;e++)self.strings[e].above=self.clickPos.y<self.strings[e].y1;self.draw()},this.move=function(){if(self.clicked)for(var e=0;e<self.strings.length;e++)self.strings[e].above!=self.clickPos.y<self.strings[e].y1&&(self.strings[e].held=!0,console.log(e))},this.release=function(){for(var e=0;e<self.strings.length;e++)self.strings[e].held&&(self.pluck(e),console.log("1"))},this.init()}var nxManager=function(){var manager=this;this.nxObjects=new Array,this.nxThrottlePeriod=20,this.elemTypeArr=new Array,this.aniItems=new Array,this.editmode=!1,this.showLabels=!1,this.oscIp="127.0.0.1",canvasgridy=50,canvasgridx=50,this.colorize=function(aspect,newCol){for(newCol||(newCol=aspect,aspect="accent"),eval("manager.colors."+aspect+" = '"+newCol+"';"),i=0;i<this.nxObjects.length;i++)eval("this.nxObjects[i].colors."+aspect+" = '"+newCol+"';"),this.nxObjects[i].draw()},this.addNxObject=function(e){this.nxObjects.push(e)},this.setNxThrottlePeriod=function(e){for(manager.nxThrottlePeriod=e,i=0;i<manager.nxObjects.length;i++)manager.nxObjects[i].nxThrottlePeriod=manager.nxThrottlePeriod},this.is_touch_device="ontouchstart"in document.documentElement?!0:!1,this.canvasOffset=function(e,t){this.left=e,this.top=t},this.findPosition=function(e){var t=document.body,s=document.defaultView,i=document.documentElement,l=document.createElement("div");l.style.paddingLeft=l.style.width="1px",t.appendChild(l);var o=2==l.offsetWidth;t.removeChild(l),l=e.getBoundingClientRect();var n=i.clientTop||t.clientTop||0,a=i.clientLeft||t.clientLeft||0,f=s.pageYOffset||o&&i.scrollTop||t.scrollTop,c=s.pageXOffset||o&&i.scrollLeft||t.scrollLeft;return{top:l.top+f-n,left:l.left+c-a}},this.setTransmissionProtocol=function(e){for(i=0;i<this.nxObjects.length;i++)this.nxObjects[i].transmissionProtocol=e},this.setTransmitCommand=function(e){for(i=0;i<this.nxObjects.length;i++)this.nxObjects[i].transmitCommand=e},this.nxTransmit=function(e){e=manager.prune(e,3),"none"==this.transmissionProtocol||("ajax"==this.transmissionProtocol?(Array.isArray(e)&&(e=e.join(),e=e.replace(/\,/g," ")),this.ajaxTransmit(this.transmitCommand,this.oscName,this.uiIndex,e,manager.oscIp)):"ios"==this.transmissionProtocol?this.iosTransmit(this.transmitCommand,this.oscName,this.uiIndex,e):"android"==this.transmissionProtocol||"local"==this.transmissionProtocol&&this.localTransmit(e))},this.globalLocalTransmit=function(){},this.ajaxTransmit=function(e,t,s,i,l){"post"==this.ajaxRequestType?s?$.post(e,{oscName:t,oscIp:l,id:s,data:i}):$.post(e,{oscName:t,oscIp:l,data:i}):"get"==this.ajaxRequestType&&(s?$.ajax(e,{oscName:t,id:s,data:i}):$.ajax(e,{oscName:t,data:i}))},this.iosTransmit=function(e,t,s,i){var l="nexus://"+s+"?"+t+"="+i;window.location.href=l},this.androidTransmit=function(){},this.getHandlers=function(e){manager.is_touch_device?(e.canvas.ontouchstart=e.preTouch,e.canvas.ontouchmove=e.nxThrottle(e.preTouchMove,e.nxThrottlePeriod),e.canvas.ontouchend=e.preTouchRelease):e.canvas.addEventListener("mousedown",e.preClick,!1)},this.point=function(e,t){this.x=e,this.y=t},this.getCursorPosition=function(e,t){var s,i;void 0!=e.pageX&&void 0!=e.pageY?(s=e.pageX,i=e.pageY):(s=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=e.clientY+document.body.scrollTop+document.documentElement.scrollTop),s-=t.left,i-=t.top;var l=new nx.point(s,i);return l.touches=[{x:s,y:i}],l},this.getTouchPosition=function(e,t){var s,i;s=e.targetTouches[0].pageX,i=e.targetTouches[0].pageY,s-=t.left,i-=t.top;var l=new nx.point(s,i);l.touches=new Array;for(var o=0;o<e.targetTouches.length;o++)l.touches.push({x:e.targetTouches[o].pageX,y:e.targetTouches[o].pageY});return l},this.nxThrottle=function(e,t){var s;return function(){var i=this,l=arguments;s||(s=setTimeout(function(){s=null;try{e.apply(i,l)}catch(t){console.log(t)}},t))}},this.toCartesian=function(e,t){var s=Math.cos(t),i=Math.sin(t),l=new nx.point(e*s,-1*e*i);return l},this.toPolar=function(e,t){var s=Math.sqrt(e*e+t*t),i=Math.atan2(t,e);0>i&&(i+=2*Math.PI);var l=new nx.point(s,i);return l},this.clip=function(e,t,s){var i=Math.min(s,Math.max(t,e));return i},this.text=function(context,text,position){with(position||(position=[10,10]),context)beginPath(),font="bold 12px sans-serif",fillText(text,position[0],position[1]),closePath()},this.drawLabel=function(){if(manager.showLabels)with(this.context)globalAlpha=.9,fillStyle=this.colors.fill,fillRect(this.width-100,this.height-20,100,20),globalAlpha=1,beginPath(),fillStyle=this.colors.border,font="bold 15px courier",textAlign="center",fillText(this.oscName,this.width-50,this.height-5),textAlign="left",closePath()},this.boolToVal=function(e){return e?1:0},this.prune=function(e,t){var t=Math.pow(10,t);return"number"==typeof e&&(e=Math.round(e*t)/t),e},this.scale=function(e,t,s,i,l){return outNum=(e-t)*(l-i)/(s-t)+i},this.invert=function(e){return manager.scale(e,1,0,0,1)},this.mtof=function(e){var t=440*Math.pow(2,(e-69)/12);return t},this.colors={accent:"#ff5500",fill:"#f5f5f5",border:"#999",accentborder:"#aa2200",black:"#000",white:"#FFF",highlight:"rgba(255,85,0,0.5)"},this.randomNum=function(e){var t=Math.floor(Math.random()*e);return t},this.randomColor=function(){var e="rgb("+this.randomNum(250)+","+this.randomNum(250)+","+this.randomNum(250)+")";return e},this.hexToRgb=function(e,t){var s=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(s,function(e,t,s,i){return t+t+s+s+i+i});var i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);t||(t=.5);var l=parseInt(i[1],16),o=parseInt(i[2],16),n=parseInt(i[3],16);return"rgba("+l+","+o+","+n+","+t+")"},this.makeRoundRect=function(e,t,s,i,l){var o=t,n=s,a=i+o,f=l+n,c=2;e.beginPath(),e.moveTo(o+c,n),e.lineTo(a-c,n),e.quadraticCurveTo(a,n,a,n+c),e.lineTo(a,f-c),e.quadraticCurveTo(a,f,a-c,f),e.lineTo(o+c,f),e.quadraticCurveTo(o,f,o,f-c),e.lineTo(o,n+c),e.quadraticCurveTo(o,n,o+c,n),e.closePath()
},this.isInside=function(e,t){return e.x>t.xpos&&e.x<t.xpos+t.wid&&e.y>t.ypos&&e.y<t.ypos+t.hgt?!0:!1},this.blockMove=function(e){"CANVAS"==e.target.tagName&&e.preventDefault()},this.startPulse=function(){manager.pulseInt=setInterval("nx.pulse()",30)},this.stopPulse=function(){clearInterval(manager.pulseInt)},this.pulse=function(){for(var e=0;e<manager.aniItems.length;e++)manager.aniItems[e]()},this.bounce=function(e,t,s,i){return e>t&&s>e?i:t>=e?Math.abs(i):e>=s?-1*Math.abs(i):void 0},this.addStylesheet=function(){var e="<style>select {background: transparent;-webkit-appearance: none;width: 150px;padding: 5px 5px;font-size: 16px;color:#888;border: solid 2px #CCC;border-radius: 6;outline: black;cursor:pointer;background-color:#F7F7F7;font-family:gill sans;}body {user-select: none;-moz-user-select: none;-webkit-user-select: none;cursor:pointer;}</style>";$("body").append(e)},this.wrapText=function(e,t,s,i,l,o){for(var n=t.split(" "),a="",f=0;f<n.length;f++){var c=a+n[f]+" ",h=e.measureText(c),r=h.width;r>l&&f>0?(e.fillText(a,s,i),a=n[f]+" ",i+=o):a=c}e.fillText(a,s,i)},this.metas=document.getElementsByTagName("meta"),this.setViewport=function(e){for(i=0;i<manager.metas.length;i++)"viewport"==manager.metas[i].name&&(manager.metas[i].content="minimum-scale="+e+", maximum-scale="+e)},this.highlightEditedObj=function(){$("canvas").css("border","solid 1px #ccc"),$("canvas").css("z-index",1),$("#"+globaldragid).css("border","solid 2px black"),$("#"+globaldragid).css("z-index",2)}},nx=new nxManager;nx.onload=function(){},$(document).ready(function(){var allcanvi=document.getElementsByTagName("canvas");for(i=0;i<allcanvi.length;i++){var nxId=allcanvi[i].getAttribute("nx"),elemCount=0;for(j=0;j<nx.elemTypeArr.length;j++)nx.elemTypeArr[j]==nxId&&elemCount++;if(nx.elemTypeArr.push(nxId),!allcanvi[i].id){var idNum=elemCount+1;allcanvi[i].id=nxId+idNum}nxId&&eval(allcanvi[i].id+" = new "+nxId+"('"+allcanvi[i].id+"', '../nexusPHP/nexusOSCRelay.php', "+idNum+");")}nx.is_touch_device&&(document.addEventListener("touchmove",nx.blockMove,!0),document.addEventListener("touchstart",nx.blockMove,!0)),nx.addStylesheet(),nx.onload()});