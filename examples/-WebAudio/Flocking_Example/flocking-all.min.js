/*! Flocking 0.1.0 (July 1, 2014), Copyright 2014 Colin Clark | flockingjs.org */

!function(a,b){function c(a){var b=a.length,c=fb.type(a);return fb.isWindow(a)?!1:1===a.nodeType&&b?!0:"array"===c||"function"!==c&&(0===b||"number"==typeof b&&b>0&&b-1 in a)}function d(a){var b=ob[a]={};return fb.each(a.match(hb)||[],function(a,c){b[c]=!0}),b}function e(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=fb.expando+Math.random()}function f(a,c,d){var e;if(d===b&&1===a.nodeType)if(e="data-"+c.replace(sb,"-$1").toLowerCase(),d=a.getAttribute(e),"string"==typeof d){try{d="true"===d?!0:"false"===d?!1:"null"===d?null:+d+""===d?+d:rb.test(d)?JSON.parse(d):d}catch(f){}pb.set(a,c,d)}else d=b;return d}function g(){return!0}function h(){return!1}function i(){try{return T.activeElement}catch(a){}}function j(a,b){for(;(a=a[b])&&1!==a.nodeType;);return a}function k(a,b,c){if(fb.isFunction(b))return fb.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return fb.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(Cb.test(b))return fb.filter(b,a,c);b=fb.filter(b,a)}return fb.grep(a,function(a){return bb.call(b,a)>=0!==c})}function l(a,b){return fb.nodeName(a,"table")&&fb.nodeName(1===b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function m(a){return a.type=(null!==a.getAttribute("type"))+"/"+a.type,a}function n(a){var b=Mb.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function o(a,b){for(var c=a.length,d=0;c>d;d++)qb.set(a[d],"globalEval",!b||qb.get(b[d],"globalEval"))}function p(a,b){var c,d,e,f,g,h,i,j;if(1===b.nodeType){if(qb.hasData(a)&&(f=qb.access(a),g=fb.extend({},f),j=f.events,qb.set(b,g),j)){delete g.handle,g.events={};for(e in j)for(c=0,d=j[e].length;d>c;c++)fb.event.add(b,e,j[e][c])}pb.hasData(a)&&(h=pb.access(a),i=fb.extend({},h),pb.set(b,i))}}function q(a,c){var d=a.getElementsByTagName?a.getElementsByTagName(c||"*"):a.querySelectorAll?a.querySelectorAll(c||"*"):[];return c===b||c&&fb.nodeName(a,c)?fb.merge([a],d):d}function r(a,b){var c=b.nodeName.toLowerCase();"input"===c&&Jb.test(a.type)?b.checked=a.checked:("input"===c||"textarea"===c)&&(b.defaultValue=a.defaultValue)}function s(a,b){if(b in a)return b;for(var c=b.charAt(0).toUpperCase()+b.slice(1),d=b,e=$b.length;e--;)if(b=$b[e]+c,b in a)return b;return d}function t(a,b){return a=b||a,"none"===fb.css(a,"display")||!fb.contains(a.ownerDocument,a)}function u(b){return a.getComputedStyle(b,null)}function v(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=qb.get(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&t(d)&&(f[g]=qb.access(d,"olddisplay",z(d.nodeName)))):f[g]||(e=t(d),(c&&"none"!==c||!e)&&qb.set(d,"olddisplay",e?c:fb.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function w(a,b,c){var d=Tb.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function x(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=fb.css(a,c+Zb[f],!0,e)),d?("content"===c&&(g-=fb.css(a,"padding"+Zb[f],!0,e)),"margin"!==c&&(g-=fb.css(a,"border"+Zb[f]+"Width",!0,e))):(g+=fb.css(a,"padding"+Zb[f],!0,e),"padding"!==c&&(g+=fb.css(a,"border"+Zb[f]+"Width",!0,e)));return g}function y(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=u(a),g=fb.support.boxSizing&&"border-box"===fb.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Pb(a,b,f),(0>e||null==e)&&(e=a.style[b]),Ub.test(e))return e;d=g&&(fb.support.boxSizingReliable||e===a.style[b]),e=parseFloat(e)||0}return e+x(a,b,c||(g?"border":"content"),d,f)+"px"}function z(a){var b=T,c=Wb[a];return c||(c=A(a,b),"none"!==c&&c||(Qb=(Qb||fb("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(b.documentElement),b=(Qb[0].contentWindow||Qb[0].contentDocument).document,b.write("<!doctype html><html><body>"),b.close(),c=A(a,b),Qb.detach()),Wb[a]=c),c}function A(a,b){var c=fb(b.createElement(a)).appendTo(b.body),d=fb.css(c[0],"display");return c.remove(),d}function B(a,b,c,d){var e;if(fb.isArray(b))fb.each(b,function(b,e){c||ac.test(a)?d(a,e):B(a+"["+("object"==typeof e?b:"")+"]",e,c,d)});else if(c||"object"!==fb.type(b))d(a,b);else for(e in b)B(a+"["+e+"]",b[e],c,d)}function C(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(hb)||[];if(fb.isFunction(c))for(;d=f[e++];)"+"===d[0]?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function D(a,b,c,d){function e(h){var i;return f[h]=!0,fb.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||g||f[j]?g?!(i=j):void 0:(b.dataTypes.unshift(j),e(j),!1)}),i}var f={},g=a===rc;return e(b.dataTypes[0])||!f["*"]&&e("*")}function E(a,c){var d,e,f=fb.ajaxSettings.flatOptions||{};for(d in c)c[d]!==b&&((f[d]?a:e||(e={}))[d]=c[d]);return e&&fb.extend(!0,a,e),a}function F(a,c,d){for(var e,f,g,h,i=a.contents,j=a.dataTypes;"*"===j[0];)j.shift(),e===b&&(e=a.mimeType||c.getResponseHeader("Content-Type"));if(e)for(f in i)if(i[f]&&i[f].test(e)){j.unshift(f);break}if(j[0]in d)g=j[0];else{for(f in d){if(!j[0]||a.converters[f+" "+j[0]]){g=f;break}h||(h=f)}g=g||h}return g?(g!==j[0]&&j.unshift(g),d[g]):void 0}function G(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];for(f=k.shift();f;)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}function H(){return setTimeout(function(){Ac=b}),Ac=fb.now()}function I(a,b){fb.each(b,function(b,c){for(var d=(Gc[b]||[]).concat(Gc["*"]),e=0,f=d.length;f>e;e++)if(d[e].call(a,b,c))return})}function J(a,b,c){var d,e,f=0,g=Fc.length,h=fb.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=Ac||H(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:fb.extend({},b),opts:fb.extend(!0,{specialEasing:{}},c),originalProperties:b,originalOptions:c,startTime:Ac||H(),duration:c.duration,tweens:[],createTween:function(b,c){var d=fb.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?h.resolveWith(a,[j,b]):h.rejectWith(a,[j,b]),this}}),k=j.props;for(K(k,j.opts.specialEasing);g>f;f++)if(d=Fc[f].call(j,a,k,j.opts))return d;return I(j,k),fb.isFunction(j.opts.start)&&j.opts.start.call(a,j),fb.fx.timer(fb.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}function K(a,b){var c,d,e,f,g;for(c in a)if(d=fb.camelCase(c),e=b[d],f=a[c],fb.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=fb.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function L(a,c,d){var e,f,g,h,i,j,k,l,m,n=this,o=a.style,p={},q=[],r=a.nodeType&&t(a);d.queue||(l=fb._queueHooks(a,"fx"),null==l.unqueued&&(l.unqueued=0,m=l.empty.fire,l.empty.fire=function(){l.unqueued||m()}),l.unqueued++,n.always(function(){n.always(function(){l.unqueued--,fb.queue(a,"fx").length||l.empty.fire()})})),1===a.nodeType&&("height"in c||"width"in c)&&(d.overflow=[o.overflow,o.overflowX,o.overflowY],"inline"===fb.css(a,"display")&&"none"===fb.css(a,"float")&&(o.display="inline-block")),d.overflow&&(o.overflow="hidden",n.always(function(){o.overflow=d.overflow[0],o.overflowX=d.overflow[1],o.overflowY=d.overflow[2]})),i=qb.get(a,"fxshow");for(e in c)if(g=c[e],Cc.exec(g)){if(delete c[e],j=j||"toggle"===g,g===(r?"hide":"show")){if("show"!==g||i===b||i[e]===b)continue;r=!0}q.push(e)}if(h=q.length){i=qb.get(a,"fxshow")||qb.access(a,"fxshow",{}),"hidden"in i&&(r=i.hidden),j&&(i.hidden=!r),r?fb(a).show():n.done(function(){fb(a).hide()}),n.done(function(){var b;qb.remove(a,"fxshow");for(b in p)fb.style(a,b,p[b])});for(e=0;h>e;e++)f=q[e],k=n.createTween(f,r?i[f]:0),p[f]=i[f]||fb.style(a,f),f in i||(i[f]=k.start,r&&(k.end=k.start,k.start="width"===f||"height"===f?1:0))}}function M(a,b,c,d,e){return new M.prototype.init(a,b,c,d,e)}function N(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=Zb[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function O(a){return fb.isWindow(a)?a:9===a.nodeType&&a.defaultView}var P,Q,R=typeof b,S=a.location,T=a.document,U=T.documentElement,V=a.jQuery,W=a.$,X={},Y=[],Z="2.0.0",$=Y.concat,_=Y.push,ab=Y.slice,bb=Y.indexOf,cb=X.toString,db=X.hasOwnProperty,eb=Z.trim,fb=function(a,b){return new fb.fn.init(a,b,P)},gb=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,hb=/\S+/g,ib=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,jb=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,kb=/^-ms-/,lb=/-([\da-z])/gi,mb=function(a,b){return b.toUpperCase()},nb=function(){T.removeEventListener("DOMContentLoaded",nb,!1),a.removeEventListener("load",nb,!1),fb.ready()};fb.fn=fb.prototype={jquery:Z,constructor:fb,init:function(a,c,d){var e,f;if(!a)return this;if("string"==typeof a){if(e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:ib.exec(a),!e||!e[1]&&c)return!c||c.jquery?(c||d).find(a):this.constructor(c).find(a);if(e[1]){if(c=c instanceof fb?c[0]:c,fb.merge(this,fb.parseHTML(e[1],c&&c.nodeType?c.ownerDocument||c:T,!0)),jb.test(e[1])&&fb.isPlainObject(c))for(e in c)fb.isFunction(this[e])?this[e](c[e]):this.attr(e,c[e]);return this}return f=T.getElementById(e[2]),f&&f.parentNode&&(this.length=1,this[0]=f),this.context=T,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):fb.isFunction(a)?d.ready(a):(a.selector!==b&&(this.selector=a.selector,this.context=a.context),fb.makeArray(a,this))},selector:"",length:0,toArray:function(){return ab.call(this)},get:function(a){return null==a?this.toArray():0>a?this[this.length+a]:this[a]},pushStack:function(a){var b=fb.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a,b){return fb.each(this,a,b)},ready:function(a){return fb.ready.promise().done(a),this},slice:function(){return this.pushStack(ab.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},map:function(a){return this.pushStack(fb.map(this,function(b,c){return a.call(b,c,b)}))},end:function(){return this.prevObject||this.constructor(null)},push:_,sort:[].sort,splice:[].splice},fb.fn.init.prototype=fb.fn,fb.extend=fb.fn.extend=function(){var a,c,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[1]||{},i=2),"object"==typeof h||fb.isFunction(h)||(h={}),j===i&&(h=this,--i);j>i;i++)if(null!=(a=arguments[i]))for(c in a)d=h[c],e=a[c],h!==e&&(k&&e&&(fb.isPlainObject(e)||(f=fb.isArray(e)))?(f?(f=!1,g=d&&fb.isArray(d)?d:[]):g=d&&fb.isPlainObject(d)?d:{},h[c]=fb.extend(k,g,e)):e!==b&&(h[c]=e));return h},fb.extend({expando:"jQuery"+(Z+Math.random()).replace(/\D/g,""),noConflict:function(b){return a.$===fb&&(a.$=W),b&&a.jQuery===fb&&(a.jQuery=V),fb},isReady:!1,readyWait:1,holdReady:function(a){a?fb.readyWait++:fb.ready(!0)},ready:function(a){(a===!0?--fb.readyWait:fb.isReady)||(fb.isReady=!0,a!==!0&&--fb.readyWait>0||(Q.resolveWith(T,[fb]),fb.fn.trigger&&fb(T).trigger("ready").off("ready")))},isFunction:function(a){return"function"===fb.type(a)},isArray:Array.isArray,isWindow:function(a){return null!=a&&a===a.window},isNumeric:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},type:function(a){return null==a?String(a):"object"==typeof a||"function"==typeof a?X[cb.call(a)]||"object":typeof a},isPlainObject:function(a){if("object"!==fb.type(a)||a.nodeType||fb.isWindow(a))return!1;try{if(a.constructor&&!db.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(b){return!1}return!0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},error:function(a){throw new Error(a)},parseHTML:function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||T;var d=jb.exec(a),e=!c&&[];return d?[b.createElement(d[1])]:(d=fb.buildFragment([a],b,e),e&&fb(e).remove(),fb.merge([],d.childNodes))},parseJSON:JSON.parse,parseXML:function(a){var c,d;if(!a||"string"!=typeof a)return null;try{d=new DOMParser,c=d.parseFromString(a,"text/xml")}catch(e){c=b}return(!c||c.getElementsByTagName("parsererror").length)&&fb.error("Invalid XML: "+a),c},noop:function(){},globalEval:function(a){var b,c=eval;a=fb.trim(a),a&&(1===a.indexOf("use strict")?(b=T.createElement("script"),b.text=a,T.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(a){return a.replace(kb,"ms-").replace(lb,mb)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b,d){var e,f=0,g=a.length,h=c(a);if(d){if(h)for(;g>f&&(e=b.apply(a[f],d),e!==!1);f++);else for(f in a)if(e=b.apply(a[f],d),e===!1)break}else if(h)for(;g>f&&(e=b.call(a[f],f,a[f]),e!==!1);f++);else for(f in a)if(e=b.call(a[f],f,a[f]),e===!1)break;return a},trim:function(a){return null==a?"":eb.call(a)},makeArray:function(a,b){var d=b||[];return null!=a&&(c(Object(a))?fb.merge(d,"string"==typeof a?[a]:a):_.call(d,a)),d},inArray:function(a,b,c){return null==b?-1:bb.call(b,a,c)},merge:function(a,c){var d=c.length,e=a.length,f=0;if("number"==typeof d)for(;d>f;f++)a[e++]=c[f];else for(;c[f]!==b;)a[e++]=c[f++];return a.length=e,a},grep:function(a,b,c){var d,e=[],f=0,g=a.length;for(c=!!c;g>f;f++)d=!!b(a[f],f),c!==d&&e.push(a[f]);return e},map:function(a,b,d){var e,f=0,g=a.length,h=c(a),i=[];if(h)for(;g>f;f++)e=b(a[f],f,d),null!=e&&(i[i.length]=e);else for(f in a)e=b(a[f],f,d),null!=e&&(i[i.length]=e);return $.apply([],i)},guid:1,proxy:function(a,c){var d,e,f;return"string"==typeof c&&(d=a[c],c=a,a=d),fb.isFunction(a)?(e=ab.call(arguments,2),f=function(){return a.apply(c||this,e.concat(ab.call(arguments)))},f.guid=a.guid=a.guid||fb.guid++,f):b},access:function(a,c,d,e,f,g,h){var i=0,j=a.length,k=null==d;if("object"===fb.type(d)){f=!0;for(i in d)fb.access(a,c,i,d[i],!0,g,h)}else if(e!==b&&(f=!0,fb.isFunction(e)||(h=!0),k&&(h?(c.call(a,e),c=null):(k=c,c=function(a,b,c){return k.call(fb(a),c)})),c))for(;j>i;i++)c(a[i],d,h?e:e.call(a[i],i,c(a[i],d)));return f?a:k?c.call(a):j?c(a[0],d):g},now:Date.now,swap:function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e}}),fb.ready.promise=function(b){return Q||(Q=fb.Deferred(),"complete"===T.readyState?setTimeout(fb.ready):(T.addEventListener("DOMContentLoaded",nb,!1),a.addEventListener("load",nb,!1))),Q.promise(b)},fb.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(a,b){X["[object "+b+"]"]=b.toLowerCase()}),P=fb(T),function(a,b){function c(a){return tb.test(a+"")}function d(){var a,b=[];return a=function(c,d){return b.push(c+=" ")>A.cacheLength&&delete a[b.shift()],a[c]=d}}function e(a){return a[O]=!0,a}function f(a){var b=H.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function g(a,b,c,d){var e,f,g,h,i,j,k,l,m,p;if((b?b.ownerDocument||b:P)!==H&&G(b),b=b||H,c=c||[],!a||"string"!=typeof a)return c;if(1!==(h=b.nodeType)&&9!==h)return[];if(J&&!d){if(e=ub.exec(a))if(g=e[1]){if(9===h){if(f=b.getElementById(g),!f||!f.parentNode)return c;if(f.id===g)return c.push(f),c}else if(b.ownerDocument&&(f=b.ownerDocument.getElementById(g))&&N(b,f)&&f.id===g)return c.push(f),c}else{if(e[2])return bb.apply(c,b.getElementsByTagName(a)),c;if((g=e[3])&&Q.getElementsByClassName&&b.getElementsByClassName)return bb.apply(c,b.getElementsByClassName(g)),c}if(Q.qsa&&(!K||!K.test(a))){if(l=k=O,m=b,p=9===h&&a,1===h&&"object"!==b.nodeName.toLowerCase()){for(j=n(a),(k=b.getAttribute("id"))?l=k.replace(xb,"\\$&"):b.setAttribute("id",l),l="[id='"+l+"'] ",i=j.length;i--;)j[i]=l+o(j[i]);m=ob.test(a)&&b.parentNode||b,p=j.join(",")}if(p)try{return bb.apply(c,m.querySelectorAll(p)),c}catch(q){}finally{k||b.removeAttribute("id")}}}return w(a.replace(lb,"$1"),b,c,d)}function h(a,b){var c=b&&a,d=c&&(~b.sourceIndex||Z)-(~a.sourceIndex||Z);if(d)return d;if(c)for(;c=c.nextSibling;)if(c===b)return-1;return a?1:-1}function i(a,c,d){var e;return d?b:(e=a.getAttributeNode(c))&&e.specified?e.value:a[c]===!0?c.toLowerCase():null}function j(a,c,d){var e;return d?b:e=a.getAttribute(c,"type"===c.toLowerCase()?1:2)}function k(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function l(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function m(a){return e(function(b){return b=+b,e(function(c,d){for(var e,f=a([],c.length,b),g=f.length;g--;)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function n(a,b){var c,d,e,f,h,i,j,k=U[a+" "];if(k)return b?0:k.slice(0);for(h=a,i=[],j=A.preFilter;h;){(!c||(d=mb.exec(h)))&&(d&&(h=h.slice(d[0].length)||h),i.push(e=[])),c=!1,(d=nb.exec(h))&&(c=d.shift(),e.push({value:c,type:d[0].replace(lb," ")}),h=h.slice(c.length));for(f in A.filter)!(d=sb[f].exec(h))||j[f]&&!(d=j[f](d))||(c=d.shift(),e.push({value:c,type:f,matches:d}),h=h.slice(c.length));if(!c)break}return b?h.length:h?g.error(a):U(a,i).slice(0)}function o(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function p(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=S++;return b.first?function(b,c,f){for(;b=b[d];)if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=R+" "+f;if(g){for(;b=b[d];)if((1===b.nodeType||e)&&a(b,c,g))return!0}else for(;b=b[d];)if(1===b.nodeType||e)if(j=b[O]||(b[O]={}),(i=j[d])&&i[0]===k){if((h=i[1])===!0||h===z)return h===!0}else if(i=j[d]=[k],i[1]=a(b,c,g)||z,i[1]===!0)return!0}}function q(a){return a.length>1?function(b,c,d){for(var e=a.length;e--;)if(!a[e](b,c,d))return!1;return!0}:a[0]}function r(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(!c||c(f,d,e))&&(g.push(f),j&&b.push(h));return g}function s(a,b,c,d,f,g){return d&&!d[O]&&(d=s(d)),f&&!f[O]&&(f=s(f,g)),e(function(e,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=e||v(b||"*",h.nodeType?[h]:h,[]),q=!a||!e&&b?p:r(p,m,a,h,i),s=c?f||(e?a:o||d)?[]:g:q;if(c&&c(q,s,h,i),d)for(j=r(s,n),d(j,[],h,i),k=j.length;k--;)(l=j[k])&&(s[n[k]]=!(q[n[k]]=l));if(e){if(f||a){if(f){for(j=[],k=s.length;k--;)(l=s[k])&&j.push(q[k]=l);f(null,s=[],j,i)}for(k=s.length;k--;)(l=s[k])&&(j=f?db.call(e,l):m[k])>-1&&(e[j]=!(g[j]=l))}}else s=r(s===g?s.splice(o,s.length):s),f?f(null,g,s,i):bb.apply(g,s)})}function t(a){for(var b,c,d,e=a.length,f=A.relative[a[0].type],g=f||A.relative[" "],h=f?1:0,i=p(function(a){return a===b},g,!0),j=p(function(a){return db.call(b,a)>-1},g,!0),k=[function(a,c,d){return!f&&(d||c!==E)||((b=c).nodeType?i(a,c,d):j(a,c,d))}];e>h;h++)if(c=A.relative[a[h].type])k=[p(q(k),c)];else{if(c=A.filter[a[h].type].apply(null,a[h].matches),c[O]){for(d=++h;e>d&&!A.relative[a[d].type];d++);return s(h>1&&q(k),h>1&&o(a.slice(0,h-1)).replace(lb,"$1"),c,d>h&&t(a.slice(h,d)),e>d&&t(a=a.slice(d)),e>d&&o(a))}k.push(c)}return q(k)}function u(a,b){var c=0,d=b.length>0,f=a.length>0,h=function(e,h,i,j,k){var l,m,n,o=[],p=0,q="0",s=e&&[],t=null!=k,u=E,v=e||f&&A.find.TAG("*",k&&h.parentNode||h),w=R+=null==u?1:Math.random()||.1;for(t&&(E=h!==H&&h,z=c);null!=(l=v[q]);q++){if(f&&l){for(m=0;n=a[m++];)if(n(l,h,i)){j.push(l);break}t&&(R=w,z=++c)}d&&((l=!n&&l)&&p--,e&&s.push(l))}if(p+=q,d&&q!==p){for(m=0;n=b[m++];)n(s,o,h,i);if(e){if(p>0)for(;q--;)s[q]||o[q]||(o[q]=_.call(j));o=r(o)}bb.apply(j,o),t&&!e&&o.length>0&&p+b.length>1&&g.uniqueSort(j)}return t&&(R=w,E=u),s};return d?e(h):h}function v(a,b,c){for(var d=0,e=b.length;e>d;d++)g(a,b[d],c);return c}function w(a,b,c,d){var e,f,g,h,i,j=n(a);if(!d&&1===j.length){if(f=j[0]=j[0].slice(0),f.length>2&&"ID"===(g=f[0]).type&&9===b.nodeType&&J&&A.relative[f[1].type]){if(b=(A.find.ID(g.matches[0].replace(yb,zb),b)||[])[0],!b)return c;a=a.slice(f.shift().value.length)}for(e=sb.needsContext.test(a)?0:f.length;e--&&(g=f[e],!A.relative[h=g.type]);)if((i=A.find[h])&&(d=i(g.matches[0].replace(yb,zb),ob.test(f[0].type)&&b.parentNode||b))){if(f.splice(e,1),a=d.length&&o(f),!a)return bb.apply(c,d),c;break}}return D(a,j)(d,b,!J,c,ob.test(a)),c}function x(){}var y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O="sizzle"+-new Date,P=a.document,Q={},R=0,S=0,T=d(),U=d(),V=d(),W=!1,X=function(){return 0},Y=typeof b,Z=1<<31,$=[],_=$.pop,ab=$.push,bb=$.push,cb=$.slice,db=$.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},eb="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",gb="[\\x20\\t\\r\\n\\f]",hb="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ib=hb.replace("w","w#"),jb="\\["+gb+"*("+hb+")"+gb+"*(?:([*^$|!~]?=)"+gb+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+ib+")|)|)"+gb+"*\\]",kb=":("+hb+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+jb.replace(3,8)+")*)|.*)\\)|)",lb=new RegExp("^"+gb+"+|((?:^|[^\\\\])(?:\\\\.)*)"+gb+"+$","g"),mb=new RegExp("^"+gb+"*,"+gb+"*"),nb=new RegExp("^"+gb+"*([>+~]|"+gb+")"+gb+"*"),ob=new RegExp(gb+"*[+~]"),pb=new RegExp("="+gb+"*([^\\]'\"]*)"+gb+"*\\]","g"),qb=new RegExp(kb),rb=new RegExp("^"+ib+"$"),sb={ID:new RegExp("^#("+hb+")"),CLASS:new RegExp("^\\.("+hb+")"),TAG:new RegExp("^("+hb.replace("w","w*")+")"),ATTR:new RegExp("^"+jb),PSEUDO:new RegExp("^"+kb),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+gb+"*(even|odd|(([+-]|)(\\d*)n|)"+gb+"*(?:([+-]|)"+gb+"*(\\d+)|))"+gb+"*\\)|)","i"),"boolean":new RegExp("^(?:"+eb+")$","i"),needsContext:new RegExp("^"+gb+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+gb+"*((?:-\\d)?\\d*)"+gb+"*\\)|)(?=[^-]|$)","i")},tb=/^[^{]+\{\s*\[native \w/,ub=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,vb=/^(?:input|select|textarea|button)$/i,wb=/^h\d$/i,xb=/'|\\/g,yb=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,zb=function(a,b){var c="0x"+b-65536;return c!==c?b:0>c?String.fromCharCode(c+65536):String.fromCharCode(c>>10|55296,1023&c|56320)};try{bb.apply($=cb.call(P.childNodes),P.childNodes),$[P.childNodes.length].nodeType}catch(Ab){bb={apply:$.length?function(a,b){ab.apply(a,cb.call(b))}:function(a,b){for(var c=a.length,d=0;a[c++]=b[d++];);a.length=c-1}}}C=g.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},G=g.setDocument=function(a){var d=a?a.ownerDocument||a:P;return d!==H&&9===d.nodeType&&d.documentElement?(H=d,I=d.documentElement,J=!C(d),Q.getElementsByTagName=f(function(a){return a.appendChild(d.createComment("")),!a.getElementsByTagName("*").length}),Q.attributes=f(function(a){return a.className="i",!a.getAttribute("className")}),Q.getElementsByClassName=f(function(a){return a.innerHTML="<div class='a'></div><div class='a i'></div>",a.firstChild.className="i",2===a.getElementsByClassName("i").length}),Q.sortDetached=f(function(a){return 1&a.compareDocumentPosition(H.createElement("div"))}),Q.getById=f(function(a){return I.appendChild(a).id=O,!d.getElementsByName||!d.getElementsByName(O).length}),Q.getById?(A.find.ID=function(a,b){if(typeof b.getElementById!==Y&&J){var c=b.getElementById(a);return c&&c.parentNode?[c]:[]}},A.filter.ID=function(a){var b=a.replace(yb,zb);return function(a){return a.getAttribute("id")===b}}):(A.find.ID=function(a,c){if(typeof c.getElementById!==Y&&J){var d=c.getElementById(a);return d?d.id===a||typeof d.getAttributeNode!==Y&&d.getAttributeNode("id").value===a?[d]:b:[]}},A.filter.ID=function(a){var b=a.replace(yb,zb);return function(a){var c=typeof a.getAttributeNode!==Y&&a.getAttributeNode("id");return c&&c.value===b}}),A.find.TAG=Q.getElementsByTagName?function(a,b){return typeof b.getElementsByTagName!==Y?b.getElementsByTagName(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){for(;c=f[e++];)1===c.nodeType&&d.push(c);return d}return f},A.find.CLASS=Q.getElementsByClassName&&function(a,b){return typeof b.getElementsByClassName!==Y&&J?b.getElementsByClassName(a):void 0},L=[],K=[],(Q.qsa=c(d.querySelectorAll))&&(f(function(a){a.innerHTML="<select><option selected=''></option></select>",a.querySelectorAll("[selected]").length||K.push("\\["+gb+"*(?:value|"+eb+")"),a.querySelectorAll(":checked").length||K.push(":checked")}),f(function(a){var b=H.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("t",""),a.querySelectorAll("[t^='']").length&&K.push("[*^$]="+gb+"*(?:''|\"\")"),a.querySelectorAll(":enabled").length||K.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),K.push(",.*:")})),(Q.matchesSelector=c(M=I.webkitMatchesSelector||I.mozMatchesSelector||I.oMatchesSelector||I.msMatchesSelector))&&f(function(a){Q.disconnectedMatch=M.call(a,"div"),M.call(a,"[s!='']:x"),L.push("!=",kb)}),K=K.length&&new RegExp(K.join("|")),L=L.length&&new RegExp(L.join("|")),N=c(I.contains)||I.compareDocumentPosition?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},X=I.compareDocumentPosition?function(a,b){if(a===b)return W=!0,0;var c=b.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(b);return c?1&c||!Q.sortDetached&&b.compareDocumentPosition(a)===c?a===d||N(P,a)?-1:b===d||N(P,b)?1:F?db.call(F,a)-db.call(F,b):0:4&c?-1:1:a.compareDocumentPosition?-1:1}:function(a,b){var c,e=0,f=a.parentNode,g=b.parentNode,i=[a],j=[b];if(a===b)return W=!0,0;if(!f||!g)return a===d?-1:b===d?1:f?-1:g?1:F?db.call(F,a)-db.call(F,b):0;if(f===g)return h(a,b);for(c=a;c=c.parentNode;)i.unshift(c);for(c=b;c=c.parentNode;)j.unshift(c);for(;i[e]===j[e];)e++;return e?h(i[e],j[e]):i[e]===P?-1:j[e]===P?1:0},H):H},g.matches=function(a,b){return g(a,null,null,b)},g.matchesSelector=function(a,b){if((a.ownerDocument||a)!==H&&G(a),b=b.replace(pb,"='$1']"),!(!Q.matchesSelector||!J||L&&L.test(b)||K&&K.test(b)))try{var c=M.call(a,b);if(c||Q.disconnectedMatch||a.document&&11!==a.document.nodeType)return c}catch(d){}return g(b,H,null,[a]).length>0},g.contains=function(a,b){return(a.ownerDocument||a)!==H&&G(a),N(a,b)},g.attr=function(a,c){(a.ownerDocument||a)!==H&&G(a);var d=A.attrHandle[c.toLowerCase()],e=d&&d(a,c,!J);return e===b?Q.attributes||!J?a.getAttribute(c):(e=a.getAttributeNode(c))&&e.specified?e.value:null:e},g.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},g.uniqueSort=function(a){var b,c=[],d=0,e=0;if(W=!Q.detectDuplicates,F=!Q.sortStable&&a.slice(0),a.sort(X),W){for(;b=a[e++];)b===a[e]&&(d=c.push(e));for(;d--;)a.splice(c[d],1)}return a},B=g.getText=function(a){var b,c="",d=0,e=a.nodeType;if(e){if(1===e||9===e||11===e){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=B(a)}else if(3===e||4===e)return a.nodeValue}else for(;b=a[d];d++)c+=B(b);return c},A=g.selectors={cacheLength:50,createPseudo:e,match:sb,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(yb,zb),a[3]=(a[4]||a[5]||"").replace(yb,zb),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||g.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&g.error(a[0]),a},PSEUDO:function(a){var b,c=!a[5]&&a[2];return sb.CHILD.test(a[0])?null:(a[4]?a[2]=a[4]:c&&qb.test(c)&&(b=n(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(yb,zb).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=T[a+" "];return b||(b=new RegExp("(^|"+gb+")"+a+"("+gb+"|$)"))&&T(a,function(a){return b.test("string"==typeof a.className&&a.className||typeof a.getAttribute!==Y&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=g.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h;if(q){if(f){for(;p;){for(l=b;l=l[p];)if(h?l.nodeName.toLowerCase()===r:1===l.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){for(k=q[O]||(q[O]={}),j=k[a]||[],n=j[0]===R&&j[1],m=j[0]===R&&j[2],l=n&&q.childNodes[n];l=++n&&l&&l[p]||(m=n=0)||o.pop();)if(1===l.nodeType&&++m&&l===b){k[a]=[R,n,m];break}}else if(s&&(j=(b[O]||(b[O]={}))[a])&&j[0]===R)m=j[1];else for(;(l=++n&&l&&l[p]||(m=n=0)||o.pop())&&((h?l.nodeName.toLowerCase()!==r:1!==l.nodeType)||!++m||(s&&((l[O]||(l[O]={}))[a]=[R,m]),l!==b)););return m-=e,m===d||m%d===0&&m/d>=0}}},PSEUDO:function(a,b){var c,d=A.pseudos[a]||A.setFilters[a.toLowerCase()]||g.error("unsupported pseudo: "+a);return d[O]?d(b):d.length>1?(c=[a,a,"",b],A.setFilters.hasOwnProperty(a.toLowerCase())?e(function(a,c){for(var e,f=d(a,b),g=f.length;g--;)e=db.call(a,f[g]),a[e]=!(c[e]=f[g])}):function(a){return d(a,0,c)}):d}},pseudos:{not:e(function(a){var b=[],c=[],d=D(a.replace(lb,"$1"));return d[O]?e(function(a,b,c,e){for(var f,g=d(a,null,e,[]),h=a.length;h--;)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),!c.pop()}}),has:e(function(a){return function(b){return g(a,b).length>0}}),contains:e(function(a){return function(b){return(b.textContent||b.innerText||B(b)).indexOf(a)>-1}}),lang:e(function(a){return rb.test(a||"")||g.error("unsupported lang: "+a),a=a.replace(yb,zb).toLowerCase(),function(b){var c;do if(c=J?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===I},focus:function(a){return a===H.activeElement&&(!H.hasFocus||H.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeName>"@"||3===a.nodeType||4===a.nodeType)return!1;return!0},parent:function(a){return!A.pseudos.empty(a)},header:function(a){return wb.test(a.nodeName)},input:function(a){return vb.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||b.toLowerCase()===a.type)},first:m(function(){return[0]}),last:m(function(a,b){return[b-1]}),eq:m(function(a,b,c){return[0>c?c+b:c]}),even:m(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:m(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a
}),lt:m(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:m(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}};for(y in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})A.pseudos[y]=k(y);for(y in{submit:!0,reset:!0})A.pseudos[y]=l(y);D=g.compile=function(a,b){var c,d=[],e=[],f=V[a+" "];if(!f){for(b||(b=n(a)),c=b.length;c--;)f=t(b[c]),f[O]?d.push(f):e.push(f);f=V(a,u(e,d))}return f},A.pseudos.nth=A.pseudos.eq,x.prototype=A.filters=A.pseudos,A.setFilters=new x,Q.sortStable=O.split("").sort(X).join("")===O,G(),[0,0].sort(X),Q.detectDuplicates=W,f(function(a){if(a.innerHTML="<a href='#'></a>","#"!==a.firstChild.getAttribute("href"))for(var b="type|href|height|width".split("|"),c=b.length;c--;)A.attrHandle[b[c]]=j}),f(function(a){if(null!=a.getAttribute("disabled"))for(var b=eb.split("|"),c=b.length;c--;)A.attrHandle[b[c]]=i}),fb.find=g,fb.expr=g.selectors,fb.expr[":"]=fb.expr.pseudos,fb.unique=g.uniqueSort,fb.text=g.getText,fb.isXMLDoc=g.isXML,fb.contains=g.contains}(a);var ob={};fb.Callbacks=function(a){a="string"==typeof a?ob[a]||d(a):fb.extend({},a);var c,e,f,g,h,i,j=[],k=!a.once&&[],l=function(b){for(c=a.memory&&b,e=!0,i=g||0,g=0,h=j.length,f=!0;j&&h>i;i++)if(j[i].apply(b[0],b[1])===!1&&a.stopOnFalse){c=!1;break}f=!1,j&&(k?k.length&&l(k.shift()):c?j=[]:m.disable())},m={add:function(){if(j){var b=j.length;!function d(b){fb.each(b,function(b,c){var e=fb.type(c);"function"===e?a.unique&&m.has(c)||j.push(c):c&&c.length&&"string"!==e&&d(c)})}(arguments),f?h=j.length:c&&(g=b,l(c))}return this},remove:function(){return j&&fb.each(arguments,function(a,b){for(var c;(c=fb.inArray(b,j,c))>-1;)j.splice(c,1),f&&(h>=c&&h--,i>=c&&i--)}),this},has:function(a){return a?fb.inArray(a,j)>-1:!(!j||!j.length)},empty:function(){return j=[],h=0,this},disable:function(){return j=k=c=b,this},disabled:function(){return!j},lock:function(){return k=b,c||m.disable(),this},locked:function(){return!k},fireWith:function(a,b){return b=b||[],b=[a,b.slice?b.slice():b],!j||e&&!k||(f?k.push(b):l(b)),this},fire:function(){return m.fireWith(this,arguments),this},fired:function(){return!!e}};return m},fb.extend({Deferred:function(a){var b=[["resolve","done",fb.Callbacks("once memory"),"resolved"],["reject","fail",fb.Callbacks("once memory"),"rejected"],["notify","progress",fb.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return fb.Deferred(function(c){fb.each(b,function(b,f){var g=f[0],h=fb.isFunction(a[b])&&a[b];e[f[1]](function(){var a=h&&h.apply(this,arguments);a&&fb.isFunction(a.promise)?a.promise().done(c.resolve).fail(c.reject).progress(c.notify):c[g+"With"](this===d?c.promise():this,h?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?fb.extend(a,d):d}},e={};return d.pipe=d.then,fb.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b,c,d,e=0,f=ab.call(arguments),g=f.length,h=1!==g||a&&fb.isFunction(a.promise)?g:0,i=1===h?a:fb.Deferred(),j=function(a,c,d){return function(e){c[a]=this,d[a]=arguments.length>1?ab.call(arguments):e,d===b?i.notifyWith(c,d):--h||i.resolveWith(c,d)}};if(g>1)for(b=new Array(g),c=new Array(g),d=new Array(g);g>e;e++)f[e]&&fb.isFunction(f[e].promise)?f[e].promise().done(j(e,d,f)).fail(i.reject).progress(j(e,c,b)):--h;return h||i.resolveWith(d,f),i.promise()}}),fb.support=function(b){var c=T.createElement("input"),d=T.createDocumentFragment(),e=T.createElement("div"),f=T.createElement("select"),g=f.appendChild(T.createElement("option"));return c.type?(c.type="checkbox",b.checkOn=""!==c.value,b.optSelected=g.selected,b.reliableMarginRight=!0,b.boxSizingReliable=!0,b.pixelPosition=!1,c.checked=!0,b.noCloneChecked=c.cloneNode(!0).checked,f.disabled=!0,b.optDisabled=!g.disabled,c=T.createElement("input"),c.value="t",c.type="radio",b.radioValue="t"===c.value,c.setAttribute("checked","t"),c.setAttribute("name","t"),d.appendChild(c),b.checkClone=d.cloneNode(!0).cloneNode(!0).lastChild.checked,b.focusinBubbles="onfocusin"in a,e.style.backgroundClip="content-box",e.cloneNode(!0).style.backgroundClip="",b.clearCloneStyle="content-box"===e.style.backgroundClip,fb(function(){var c,d,f="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",g=T.getElementsByTagName("body")[0];g&&(c=T.createElement("div"),c.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",g.appendChild(c).appendChild(e),e.innerHTML="",e.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",fb.swap(g,null!=g.style.zoom?{zoom:1}:{},function(){b.boxSizing=4===e.offsetWidth}),a.getComputedStyle&&(b.pixelPosition="1%"!==(a.getComputedStyle(e,null)||{}).top,b.boxSizingReliable="4px"===(a.getComputedStyle(e,null)||{width:"4px"}).width,d=e.appendChild(T.createElement("div")),d.style.cssText=e.style.cssText=f,d.style.marginRight=d.style.width="0",e.style.width="1px",b.reliableMarginRight=!parseFloat((a.getComputedStyle(d,null)||{}).marginRight)),g.removeChild(c))}),b):b}({});var pb,qb,rb=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,sb=/([A-Z])/g;e.uid=1,e.accepts=function(a){return a.nodeType?1===a.nodeType||9===a.nodeType:!0},e.prototype={key:function(a){if(!e.accepts(a))return 0;var b={},c=a[this.expando];if(!c){c=e.uid++;try{b[this.expando]={value:c},Object.defineProperties(a,b)}catch(d){b[this.expando]=c,fb.extend(a,b)}}return this.cache[c]||(this.cache[c]={}),c},set:function(a,b,c){var d,e=this.key(a),f=this.cache[e];if("string"==typeof b)f[b]=c;else if(fb.isEmptyObject(f))this.cache[e]=b;else for(d in b)f[d]=b[d]},get:function(a,c){var d=this.cache[this.key(a)];return c===b?d:d[c]},access:function(a,c,d){return c===b||c&&"string"==typeof c&&d===b?this.get(a,c):(this.set(a,c,d),d!==b?d:c)},remove:function(a,c){var d,e,f=this.key(a),g=this.cache[f];if(c===b)this.cache[f]={};else{fb.isArray(c)?e=c.concat(c.map(fb.camelCase)):c in g?e=[c]:(e=fb.camelCase(c),e=e in g?[e]:e.match(hb)||[]),d=e.length;for(;d--;)delete g[e[d]]}},hasData:function(a){return!fb.isEmptyObject(this.cache[a[this.expando]]||{})},discard:function(a){delete this.cache[this.key(a)]}},pb=new e,qb=new e,fb.extend({acceptData:e.accepts,hasData:function(a){return pb.hasData(a)||qb.hasData(a)},data:function(a,b,c){return pb.access(a,b,c)},removeData:function(a,b){pb.remove(a,b)},_data:function(a,b,c){return qb.access(a,b,c)},_removeData:function(a,b){qb.remove(a,b)}}),fb.fn.extend({data:function(a,c){var d,e,g=this[0],h=0,i=null;if(a===b){if(this.length&&(i=pb.get(g),1===g.nodeType&&!qb.get(g,"hasDataAttrs"))){for(d=g.attributes;h<d.length;h++)e=d[h].name,0===e.indexOf("data-")&&(e=fb.camelCase(e.substring(5)),f(g,e,i[e]));qb.set(g,"hasDataAttrs",!0)}return i}return"object"==typeof a?this.each(function(){pb.set(this,a)}):fb.access(this,function(c){var d,e=fb.camelCase(a);if(g&&c===b){if(d=pb.get(g,a),d!==b)return d;if(d=pb.get(g,e),d!==b)return d;if(d=f(g,e,b),d!==b)return d}else this.each(function(){var d=pb.get(this,e);pb.set(this,e,c),-1!==a.indexOf("-")&&d!==b&&pb.set(this,a,c)})},null,c,arguments.length>1,null,!0)},removeData:function(a){return this.each(function(){pb.remove(this,a)})}}),fb.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=qb.get(a,b),c&&(!d||fb.isArray(c)?d=qb.access(a,b,fb.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=fb.queue(a,b),d=c.length,e=c.shift(),f=fb._queueHooks(a,b),g=function(){fb.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),f.cur=e,e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return qb.get(a,c)||qb.access(a,c,{empty:fb.Callbacks("once memory").add(function(){qb.remove(a,[b+"queue",c])})})}}),fb.fn.extend({queue:function(a,c){var d=2;return"string"!=typeof a&&(c=a,a="fx",d--),arguments.length<d?fb.queue(this[0],a):c===b?this:this.each(function(){var b=fb.queue(this,a,c);fb._queueHooks(this,a),"fx"===a&&"inprogress"!==b[0]&&fb.dequeue(this,a)})},dequeue:function(a){return this.each(function(){fb.dequeue(this,a)})},delay:function(a,b){return a=fb.fx?fb.fx.speeds[a]||a:a,b=b||"fx",this.queue(b,function(b,c){var d=setTimeout(b,a);c.stop=function(){clearTimeout(d)}})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,c){var d,e=1,f=fb.Deferred(),g=this,h=this.length,i=function(){--e||f.resolveWith(g,[g])};for("string"!=typeof a&&(c=a,a=b),a=a||"fx";h--;)d=qb.get(g[h],a+"queueHooks"),d&&d.empty&&(e++,d.empty.add(i));return i(),f.promise(c)}});var tb,ub,vb=/[\t\r\n]/g,wb=/\r/g,xb=/^(?:input|select|textarea|button)$/i;fb.fn.extend({attr:function(a,b){return fb.access(this,fb.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){fb.removeAttr(this,a)})},prop:function(a,b){return fb.access(this,fb.prop,a,b,arguments.length>1)},removeProp:function(a){return this.each(function(){delete this[fb.propFix[a]||a]})},addClass:function(a){var b,c,d,e,f,g=0,h=this.length,i="string"==typeof a&&a;if(fb.isFunction(a))return this.each(function(b){fb(this).addClass(a.call(this,b,this.className))});if(i)for(b=(a||"").match(hb)||[];h>g;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(vb," "):" ")){for(f=0;e=b[f++];)d.indexOf(" "+e+" ")<0&&(d+=e+" ");c.className=fb.trim(d)}return this},removeClass:function(a){var b,c,d,e,f,g=0,h=this.length,i=0===arguments.length||"string"==typeof a&&a;if(fb.isFunction(a))return this.each(function(b){fb(this).removeClass(a.call(this,b,this.className))});if(i)for(b=(a||"").match(hb)||[];h>g;g++)if(c=this[g],d=1===c.nodeType&&(c.className?(" "+c.className+" ").replace(vb," "):"")){for(f=0;e=b[f++];)for(;d.indexOf(" "+e+" ")>=0;)d=d.replace(" "+e+" "," ");c.className=a?fb.trim(d):""}return this},toggleClass:function(a,b){var c=typeof a,d="boolean"==typeof b;return this.each(fb.isFunction(a)?function(c){fb(this).toggleClass(a.call(this,c,this.className,b),b)}:function(){if("string"===c)for(var e,f=0,g=fb(this),h=b,i=a.match(hb)||[];e=i[f++];)h=d?h:!g.hasClass(e),g[h?"addClass":"removeClass"](e);else(c===R||"boolean"===c)&&(this.className&&qb.set(this,"__className__",this.className),this.className=this.className||a===!1?"":qb.get(this,"__className__")||"")})},hasClass:function(a){for(var b=" "+a+" ",c=0,d=this.length;d>c;c++)if(1===this[c].nodeType&&(" "+this[c].className+" ").replace(vb," ").indexOf(b)>=0)return!0;return!1},val:function(a){var c,d,e,f=this[0];{if(arguments.length)return e=fb.isFunction(a),this.each(function(d){var f,g=fb(this);1===this.nodeType&&(f=e?a.call(this,d,g.val()):a,null==f?f="":"number"==typeof f?f+="":fb.isArray(f)&&(f=fb.map(f,function(a){return null==a?"":a+""})),c=fb.valHooks[this.type]||fb.valHooks[this.nodeName.toLowerCase()],c&&"set"in c&&c.set(this,f,"value")!==b||(this.value=f))});if(f)return c=fb.valHooks[f.type]||fb.valHooks[f.nodeName.toLowerCase()],c&&"get"in c&&(d=c.get(f,"value"))!==b?d:(d=f.value,"string"==typeof d?d.replace(wb,""):null==d?"":d)}}}),fb.extend({valHooks:{option:{get:function(a){var b=a.attributes.value;return!b||b.specified?a.value:a.text}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],!(!c.selected&&i!==e||(fb.support.optDisabled?c.disabled:null!==c.getAttribute("disabled"))||c.parentNode.disabled&&fb.nodeName(c.parentNode,"optgroup"))){if(b=fb(c).val(),f)return b;g.push(b)}return g},set:function(a,b){for(var c,d,e=a.options,f=fb.makeArray(b),g=e.length;g--;)d=e[g],(d.selected=fb.inArray(fb(d).val(),f)>=0)&&(c=!0);return c||(a.selectedIndex=-1),f}}},attr:function(a,c,d){var e,f,g=a.nodeType;if(a&&3!==g&&8!==g&&2!==g)return typeof a.getAttribute===R?fb.prop(a,c,d):(1===g&&fb.isXMLDoc(a)||(c=c.toLowerCase(),e=fb.attrHooks[c]||(fb.expr.match.boolean.test(c)?ub:tb)),d===b?e&&"get"in e&&null!==(f=e.get(a,c))?f:(f=fb.find.attr(a,c),null==f?b:f):null!==d?e&&"set"in e&&(f=e.set(a,d,c))!==b?f:(a.setAttribute(c,d+""),d):void fb.removeAttr(a,c))},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(hb);if(f&&1===a.nodeType)for(;c=f[e++];)d=fb.propFix[c]||c,fb.expr.match.boolean.test(c)&&(a[d]=!1),a.removeAttribute(c)},attrHooks:{type:{set:function(a,b){if(!fb.support.radioValue&&"radio"===b&&fb.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(a,c,d){var e,f,g,h=a.nodeType;if(a&&3!==h&&8!==h&&2!==h)return g=1!==h||!fb.isXMLDoc(a),g&&(c=fb.propFix[c]||c,f=fb.propHooks[c]),d!==b?f&&"set"in f&&(e=f.set(a,d,c))!==b?e:a[c]=d:f&&"get"in f&&null!==(e=f.get(a,c))?e:a[c]},propHooks:{tabIndex:{get:function(a){return a.hasAttribute("tabindex")||xb.test(a.nodeName)||a.href?a.tabIndex:-1}}}}),ub={set:function(a,b,c){return b===!1?fb.removeAttr(a,c):a.setAttribute(c,c),c}},fb.each(fb.expr.match.boolean.source.match(/\w+/g),function(a,c){var d=fb.expr.attrHandle[c]||fb.find.attr;fb.expr.attrHandle[c]=function(a,c,e){var f=fb.expr.attrHandle[c],g=e?b:(fb.expr.attrHandle[c]=b)!=d(a,c,e)?c.toLowerCase():null;return fb.expr.attrHandle[c]=f,g}}),fb.support.optSelected||(fb.propHooks.selected={get:function(a){var b=a.parentNode;return b&&b.parentNode&&b.parentNode.selectedIndex,null}}),fb.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){fb.propFix[this.toLowerCase()]=this}),fb.each(["radio","checkbox"],function(){fb.valHooks[this]={set:function(a,b){return fb.isArray(b)?a.checked=fb.inArray(fb(a).val(),b)>=0:void 0}},fb.support.checkOn||(fb.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var yb=/^key/,zb=/^(?:mouse|contextmenu)|click/,Ab=/^(?:focusinfocus|focusoutblur)$/,Bb=/^([^.]*)(?:\.(.+)|)$/;fb.event={global:{},add:function(a,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r=qb.get(a);if(r){for(d.handler&&(g=d,d=g.handler,f=g.selector),d.guid||(d.guid=fb.guid++),(j=r.events)||(j=r.events={}),(h=r.handle)||(h=r.handle=function(a){return typeof fb===R||a&&fb.event.triggered===a.type?b:fb.event.dispatch.apply(h.elem,arguments)},h.elem=a),c=(c||"").match(hb)||[""],k=c.length;k--;)i=Bb.exec(c[k])||[],o=q=i[1],p=(i[2]||"").split(".").sort(),o&&(m=fb.event.special[o]||{},o=(f?m.delegateType:m.bindType)||o,m=fb.event.special[o]||{},l=fb.extend({type:o,origType:q,data:e,handler:d,guid:d.guid,selector:f,needsContext:f&&fb.expr.match.needsContext.test(f),namespace:p.join(".")},g),(n=j[o])||(n=j[o]=[],n.delegateCount=0,m.setup&&m.setup.call(a,e,p,h)!==!1||a.addEventListener&&a.addEventListener(o,h,!1)),m.add&&(m.add.call(a,l),l.handler.guid||(l.handler.guid=d.guid)),f?n.splice(n.delegateCount++,0,l):n.push(l),fb.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q=qb.hasData(a)&&qb.get(a);if(q&&(i=q.events)){for(b=(b||"").match(hb)||[""],j=b.length;j--;)if(h=Bb.exec(b[j])||[],n=p=h[1],o=(h[2]||"").split(".").sort(),n){for(l=fb.event.special[n]||{},n=(d?l.delegateType:l.bindType)||n,m=i[n]||[],h=h[2]&&new RegExp("(^|\\.)"+o.join("\\.(?:.*\\.|)")+"(\\.|$)"),g=f=m.length;f--;)k=m[f],!e&&p!==k.origType||c&&c.guid!==k.guid||h&&!h.test(k.namespace)||d&&d!==k.selector&&("**"!==d||!k.selector)||(m.splice(f,1),k.selector&&m.delegateCount--,l.remove&&l.remove.call(a,k));g&&!m.length&&(l.teardown&&l.teardown.call(a,o,q.handle)!==!1||fb.removeEvent(a,n,q.handle),delete i[n])}else for(n in i)fb.event.remove(a,n+b[j],c,d,!0);fb.isEmptyObject(i)&&(delete q.handle,qb.remove(a,"events"))}},trigger:function(c,d,e,f){var g,h,i,j,k,l,m,n=[e||T],o=db.call(c,"type")?c.type:c,p=db.call(c,"namespace")?c.namespace.split("."):[];if(h=i=e=e||T,3!==e.nodeType&&8!==e.nodeType&&!Ab.test(o+fb.event.triggered)&&(o.indexOf(".")>=0&&(p=o.split("."),o=p.shift(),p.sort()),k=o.indexOf(":")<0&&"on"+o,c=c[fb.expando]?c:new fb.Event(o,"object"==typeof c&&c),c.isTrigger=f?2:3,c.namespace=p.join("."),c.namespace_re=c.namespace?new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,c.result=b,c.target||(c.target=e),d=null==d?[c]:fb.makeArray(d,[c]),m=fb.event.special[o]||{},f||!m.trigger||m.trigger.apply(e,d)!==!1)){if(!f&&!m.noBubble&&!fb.isWindow(e)){for(j=m.delegateType||o,Ab.test(j+o)||(h=h.parentNode);h;h=h.parentNode)n.push(h),i=h;i===(e.ownerDocument||T)&&n.push(i.defaultView||i.parentWindow||a)}for(g=0;(h=n[g++])&&!c.isPropagationStopped();)c.type=g>1?j:m.bindType||o,l=(qb.get(h,"events")||{})[c.type]&&qb.get(h,"handle"),l&&l.apply(h,d),l=k&&h[k],l&&fb.acceptData(h)&&l.apply&&l.apply(h,d)===!1&&c.preventDefault();return c.type=o,f||c.isDefaultPrevented()||m._default&&m._default.apply(n.pop(),d)!==!1||!fb.acceptData(e)||k&&fb.isFunction(e[o])&&!fb.isWindow(e)&&(i=e[k],i&&(e[k]=null),fb.event.triggered=o,e[o](),fb.event.triggered=b,i&&(e[k]=i)),c.result}},dispatch:function(a){a=fb.event.fix(a);var c,d,e,f,g,h=[],i=ab.call(arguments),j=(qb.get(this,"events")||{})[a.type]||[],k=fb.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){for(h=fb.event.handlers.call(this,a,j),c=0;(f=h[c++])&&!a.isPropagationStopped();)for(a.currentTarget=f.elem,d=0;(g=f.handlers[d++])&&!a.isImmediatePropagationStopped();)(!a.namespace_re||a.namespace_re.test(g.namespace))&&(a.handleObj=g,a.data=g.data,e=((fb.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),e!==b&&(a.result=e)===!1&&(a.preventDefault(),a.stopPropagation()));return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,c){var d,e,f,g,h=[],i=c.delegateCount,j=a.target;if(i&&j.nodeType&&(!a.button||"click"!==a.type))for(;j!==this;j=j.parentNode||this)if(j.disabled!==!0||"click"!==a.type){for(e=[],d=0;i>d;d++)g=c[d],f=g.selector+" ",e[f]===b&&(e[f]=g.needsContext?fb(f,this).index(j)>=0:fb.find(f,this,null,[j]).length),e[f]&&e.push(g);e.length&&h.push({elem:j,handlers:e})}return i<c.length&&h.push({elem:this,handlers:c.slice(i)}),h},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,c){var d,e,f,g=c.button;return null==a.pageX&&null!=c.clientX&&(d=a.target.ownerDocument||T,e=d.documentElement,f=d.body,a.pageX=c.clientX+(e&&e.scrollLeft||f&&f.scrollLeft||0)-(e&&e.clientLeft||f&&f.clientLeft||0),a.pageY=c.clientY+(e&&e.scrollTop||f&&f.scrollTop||0)-(e&&e.clientTop||f&&f.clientTop||0)),a.which||g===b||(a.which=1&g?1:2&g?3:4&g?2:0),a}},fix:function(a){if(a[fb.expando])return a;var b,c,d,e=a.type,f=a,g=this.fixHooks[e];for(g||(this.fixHooks[e]=g=zb.test(e)?this.mouseHooks:yb.test(e)?this.keyHooks:{}),d=g.props?this.props.concat(g.props):this.props,a=new fb.Event(f),b=d.length;b--;)c=d[b],a[c]=f[c];return 3===a.target.nodeType&&(a.target=a.target.parentNode),g.filter?g.filter(a,f):a},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==i()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===i()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&fb.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(a){return fb.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){a.result!==b&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c,d){var e=fb.extend(new fb.Event,c,{type:a,isSimulated:!0,originalEvent:{}});d?fb.event.trigger(e,null,b):fb.event.dispatch.call(b,e),e.isDefaultPrevented()&&c.preventDefault()}},fb.removeEvent=function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c,!1)},fb.Event=function(a,b){return this instanceof fb.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||a.getPreventDefault&&a.getPreventDefault()?g:h):this.type=a,b&&fb.extend(this,b),this.timeStamp=a&&a.timeStamp||fb.now(),void(this[fb.expando]=!0)):new fb.Event(a,b)},fb.Event.prototype={isDefaultPrevented:h,isPropagationStopped:h,isImmediatePropagationStopped:h,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=g,a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=g,a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=g,this.stopPropagation()}},fb.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){fb.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return(!e||e!==d&&!fb.contains(d,e))&&(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),fb.support.focusinBubbles||fb.each({focus:"focusin",blur:"focusout"},function(a,b){var c=0,d=function(a){fb.event.simulate(b,a.target,fb.event.fix(a),!0)};fb.event.special[b]={setup:function(){0===c++&&T.addEventListener(a,d,!0)},teardown:function(){0===--c&&T.removeEventListener(a,d,!0)}}}),fb.fn.extend({on:function(a,c,d,e,f){var g,i;if("object"==typeof a){"string"!=typeof c&&(d=d||c,c=b);for(i in a)this.on(i,c,d,a[i],f);return this}if(null==d&&null==e?(e=c,d=c=b):null==e&&("string"==typeof c?(e=d,d=b):(e=d,d=c,c=b)),e===!1)e=h;else if(!e)return this;return 1===f&&(g=e,e=function(a){return fb().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=fb.guid++)),this.each(function(){fb.event.add(this,a,e,d,c)})},one:function(a,b,c,d){return this.on(a,b,c,d,1)},off:function(a,c,d){var e,f;if(a&&a.preventDefault&&a.handleObj)return e=a.handleObj,fb(a.delegateTarget).off(e.namespace?e.origType+"."+e.namespace:e.origType,e.selector,e.handler),this;if("object"==typeof a){for(f in a)this.off(f,c,a[f]);return this}return(c===!1||"function"==typeof c)&&(d=c,c=b),d===!1&&(d=h),this.each(function(){fb.event.remove(this,a,d,c)})},trigger:function(a,b){return this.each(function(){fb.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?fb.event.trigger(a,b,c,!0):void 0}});var Cb=/^.[^:#\[\.,]*$/,Db=fb.expr.match.needsContext,Eb={children:!0,contents:!0,next:!0,prev:!0};fb.fn.extend({find:function(a){var b,c,d,e=this.length;if("string"!=typeof a)return b=this,this.pushStack(fb(a).filter(function(){for(d=0;e>d;d++)if(fb.contains(b[d],this))return!0}));for(c=[],d=0;e>d;d++)fb.find(a,this[d],c);return c=this.pushStack(e>1?fb.unique(c):c),c.selector=(this.selector?this.selector+" ":"")+a,c},has:function(a){var b=fb(a,this),c=b.length;return this.filter(function(){for(var a=0;c>a;a++)if(fb.contains(this,b[a]))return!0})},not:function(a){return this.pushStack(k(this,a||[],!0))},filter:function(a){return this.pushStack(k(this,a||[],!1))},is:function(a){return!!a&&("string"==typeof a?Db.test(a)?fb(a,this.context).index(this[0])>=0:fb.filter(a,this).length>0:this.filter(a).length>0)},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=Db.test(a)||"string"!=typeof a?fb(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&fb.find.matchesSelector(c,a))){c=f.push(c);break}return this.pushStack(f.length>1?fb.unique(f):f)},index:function(a){return a?"string"==typeof a?bb.call(fb(a),this[0]):bb.call(this,a.jquery?a[0]:a):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){var c="string"==typeof a?fb(a,b):fb.makeArray(a&&a.nodeType?[a]:a),d=fb.merge(this.get(),c);return this.pushStack(fb.unique(d))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}}),fb.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return fb.dir(a,"parentNode")},parentsUntil:function(a,b,c){return fb.dir(a,"parentNode",c)},next:function(a){return j(a,"nextSibling")},prev:function(a){return j(a,"previousSibling")},nextAll:function(a){return fb.dir(a,"nextSibling")},prevAll:function(a){return fb.dir(a,"previousSibling")},nextUntil:function(a,b,c){return fb.dir(a,"nextSibling",c)},prevUntil:function(a,b,c){return fb.dir(a,"previousSibling",c)},siblings:function(a){return fb.sibling((a.parentNode||{}).firstChild,a)},children:function(a){return fb.sibling(a.firstChild)},contents:function(a){return fb.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:fb.merge([],a.childNodes)}},function(a,b){fb.fn[a]=function(c,d){var e=fb.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=fb.filter(d,e)),this.length>1&&(Eb[a]||fb.unique(e),"p"===a[0]&&e.reverse()),this.pushStack(e)}}),fb.extend({filter:function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?fb.find.matchesSelector(d,a)?[d]:[]:fb.find.matches(a,fb.grep(b,function(a){return 1===a.nodeType}))},dir:function(a,c,d){for(var e=[],f=d!==b;(a=a[c])&&9!==a.nodeType;)if(1===a.nodeType){if(f&&fb(a).is(d))break;e.push(a)}return e},sibling:function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c}});var Fb=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Gb=/<([\w:]+)/,Hb=/<|&#?\w+;/,Ib=/<(?:script|style|link)/i,Jb=/^(?:checkbox|radio)$/i,Kb=/checked\s*(?:[^=]|=\s*.checked.)/i,Lb=/^$|\/(?:java|ecma)script/i,Mb=/^true\/(.*)/,Nb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ob={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ob.optgroup=Ob.option,Ob.tbody=Ob.tfoot=Ob.colgroup=Ob.caption=Ob.col=Ob.thead,Ob.th=Ob.td,fb.fn.extend({text:function(a){return fb.access(this,function(a){return a===b?fb.text(this):this.empty().append((this[0]&&this[0].ownerDocument||T).createTextNode(a))},null,a,arguments.length)},append:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=l(this,a);b.appendChild(a)}})},prepend:function(){return this.domManip(arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=l(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return this.domManip(arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},remove:function(a,b){for(var c,d=a?fb.filter(a,this):this,e=0;null!=(c=d[e]);e++)b||1!==c.nodeType||fb.cleanData(q(c)),c.parentNode&&(b&&fb.contains(c.ownerDocument,c)&&o(q(c,"script")),c.parentNode.removeChild(c));return this},empty:function(){for(var a,b=0;null!=(a=this[b]);b++)1===a.nodeType&&(fb.cleanData(q(a,!1)),a.textContent="");return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return fb.clone(this,a,b)})},html:function(a){return fb.access(this,function(a){var c=this[0]||{},d=0,e=this.length;if(a===b&&1===c.nodeType)return c.innerHTML;if("string"==typeof a&&!Ib.test(a)&&!Ob[(Gb.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Fb,"<$1></$2>");try{for(;e>d;d++)c=this[d]||{},1===c.nodeType&&(fb.cleanData(q(c,!1)),c.innerHTML=a);c=0}catch(f){}}c&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=fb.map(this,function(a){return[a.nextSibling,a.parentNode]}),b=0;return this.domManip(arguments,function(c){var d=a[b++],e=a[b++];e&&(fb(this).remove(),e.insertBefore(c,d))},!0),b?this:this.remove()},detach:function(a){return this.remove(a,!0)},domManip:function(a,b,c){a=$.apply([],a);var d,e,f,g,h,i,j=0,k=this.length,l=this,o=k-1,p=a[0],r=fb.isFunction(p);if(r||!(1>=k||"string"!=typeof p||fb.support.checkClone)&&Kb.test(p))return this.each(function(d){var e=l.eq(d);r&&(a[0]=p.call(this,d,e.html())),e.domManip(a,b,c)});if(k&&(d=fb.buildFragment(a,this[0].ownerDocument,!1,!c&&this),e=d.firstChild,1===d.childNodes.length&&(d=e),e)){for(f=fb.map(q(d,"script"),m),g=f.length;k>j;j++)h=d,j!==o&&(h=fb.clone(h,!0,!0),g&&fb.merge(f,q(h,"script"))),b.call(this[j],h,j);if(g)for(i=f[f.length-1].ownerDocument,fb.map(f,n),j=0;g>j;j++)h=f[j],Lb.test(h.type||"")&&!qb.access(h,"globalEval")&&fb.contains(i,h)&&(h.src?fb._evalUrl(h.src):fb.globalEval(h.textContent.replace(Nb,"")))}return this}}),fb.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){fb.fn[a]=function(a){for(var c,d=[],e=fb(a),f=e.length-1,g=0;f>=g;g++)c=g===f?this:this.clone(!0),fb(e[g])[b](c),_.apply(d,c.get());return this.pushStack(d)}}),fb.extend({clone:function(a,b,c){var d,e,f,g,h=a.cloneNode(!0),i=fb.contains(a.ownerDocument,a);if(!(fb.support.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||fb.isXMLDoc(a)))for(g=q(h),f=q(a),d=0,e=f.length;e>d;d++)r(f[d],g[d]);if(b)if(c)for(f=f||q(a),g=g||q(h),d=0,e=f.length;e>d;d++)p(f[d],g[d]);else p(a,h);return g=q(h,"script"),g.length>0&&o(g,!i&&q(a,"script")),h},buildFragment:function(a,b,c,d){for(var e,f,g,h,i,j,k=0,l=a.length,m=b.createDocumentFragment(),n=[];l>k;k++)if(e=a[k],e||0===e)if("object"===fb.type(e))fb.merge(n,e.nodeType?[e]:e);else if(Hb.test(e)){for(f=f||m.appendChild(b.createElement("div")),g=(Gb.exec(e)||["",""])[1].toLowerCase(),h=Ob[g]||Ob._default,f.innerHTML=h[1]+e.replace(Fb,"<$1></$2>")+h[2],j=h[0];j--;)f=f.firstChild;fb.merge(n,f.childNodes),f=m.firstChild,f.textContent=""}else n.push(b.createTextNode(e));for(m.textContent="",k=0;e=n[k++];)if((!d||-1===fb.inArray(e,d))&&(i=fb.contains(e.ownerDocument,e),f=q(m.appendChild(e),"script"),i&&o(f),c))for(j=0;e=f[j++];)Lb.test(e.type||"")&&c.push(e);return m},cleanData:function(a){for(var b,c,d,e=a.length,f=0,g=fb.event.special;e>f;f++){if(c=a[f],fb.acceptData(c)&&(b=qb.access(c)))for(d in b.events)g[d]?fb.event.remove(c,d):fb.removeEvent(c,d,b.handle);pb.discard(c),qb.discard(c)}},_evalUrl:function(a){return fb.ajax({url:a,type:"GET",dataType:"text",async:!1,global:!1,success:fb.globalEval})}}),fb.fn.extend({wrapAll:function(a){var b;return fb.isFunction(a)?this.each(function(b){fb(this).wrapAll(a.call(this,b))}):(this[0]&&(b=fb(a,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){for(var a=this;a.firstElementChild;)a=a.firstElementChild;return a}).append(this)),this)},wrapInner:function(a){return this.each(fb.isFunction(a)?function(b){fb(this).wrapInner(a.call(this,b))}:function(){var b=fb(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=fb.isFunction(a);return this.each(function(c){fb(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){fb.nodeName(this,"body")||fb(this).replaceWith(this.childNodes)}).end()}});var Pb,Qb,Rb=/^(none|table(?!-c[ea]).+)/,Sb=/^margin/,Tb=new RegExp("^("+gb+")(.*)$","i"),Ub=new RegExp("^("+gb+")(?!px)[a-z%]+$","i"),Vb=new RegExp("^([+-])=("+gb+")","i"),Wb={BODY:"block"},Xb={position:"absolute",visibility:"hidden",display:"block"},Yb={letterSpacing:0,fontWeight:400},Zb=["Top","Right","Bottom","Left"],$b=["Webkit","O","Moz","ms"];fb.fn.extend({css:function(a,c){return fb.access(this,function(a,c,d){var e,f,g={},h=0;if(fb.isArray(c)){for(e=u(a),f=c.length;f>h;h++)g[c[h]]=fb.css(a,c[h],!1,e);return g}return d!==b?fb.style(a,c,d):fb.css(a,c)},a,c,arguments.length>1)},show:function(){return v(this,!0)},hide:function(){return v(this)},toggle:function(a){var b="boolean"==typeof a;return this.each(function(){(b?a:t(this))?fb(this).show():fb(this).hide()})}}),fb.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Pb(a,"opacity");
return""===c?"1":c}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(a,c,d,e){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var f,g,h,i=fb.camelCase(c),j=a.style;return c=fb.cssProps[i]||(fb.cssProps[i]=s(j,i)),h=fb.cssHooks[c]||fb.cssHooks[i],d===b?h&&"get"in h&&(f=h.get(a,!1,e))!==b?f:j[c]:(g=typeof d,"string"===g&&(f=Vb.exec(d))&&(d=(f[1]+1)*f[2]+parseFloat(fb.css(a,c)),g="number"),null==d||"number"===g&&isNaN(d)||("number"!==g||fb.cssNumber[i]||(d+="px"),fb.support.clearCloneStyle||""!==d||0!==c.indexOf("background")||(j[c]="inherit"),h&&"set"in h&&(d=h.set(a,d,e))===b||(j[c]=d)),void 0)}},css:function(a,c,d,e){var f,g,h,i=fb.camelCase(c);return c=fb.cssProps[i]||(fb.cssProps[i]=s(a.style,i)),h=fb.cssHooks[c]||fb.cssHooks[i],h&&"get"in h&&(f=h.get(a,!0,d)),f===b&&(f=Pb(a,c,e)),"normal"===f&&c in Yb&&(f=Yb[c]),""===d||d?(g=parseFloat(f),d===!0||fb.isNumeric(g)?g||0:f):f}}),Pb=function(a,c,d){var e,f,g,h=d||u(a),i=h?h.getPropertyValue(c)||h[c]:b,j=a.style;return h&&(""!==i||fb.contains(a.ownerDocument,a)||(i=fb.style(a,c)),Ub.test(i)&&Sb.test(c)&&(e=j.width,f=j.minWidth,g=j.maxWidth,j.minWidth=j.maxWidth=j.width=i,i=h.width,j.width=e,j.minWidth=f,j.maxWidth=g)),i},fb.each(["height","width"],function(a,b){fb.cssHooks[b]={get:function(a,c,d){return c?0===a.offsetWidth&&Rb.test(fb.css(a,"display"))?fb.swap(a,Xb,function(){return y(a,b,d)}):y(a,b,d):void 0},set:function(a,c,d){var e=d&&u(a);return w(a,c,d?x(a,b,d,fb.support.boxSizing&&"border-box"===fb.css(a,"boxSizing",!1,e),e):0)}}}),fb(function(){fb.support.reliableMarginRight||(fb.cssHooks.marginRight={get:function(a,b){return b?fb.swap(a,{display:"inline-block"},Pb,[a,"marginRight"]):void 0}}),!fb.support.pixelPosition&&fb.fn.position&&fb.each(["top","left"],function(a,b){fb.cssHooks[b]={get:function(a,c){return c?(c=Pb(a,b),Ub.test(c)?fb(a).position()[b]+"px":c):void 0}}})}),fb.expr&&fb.expr.filters&&(fb.expr.filters.hidden=function(a){return a.offsetWidth<=0&&a.offsetHeight<=0},fb.expr.filters.visible=function(a){return!fb.expr.filters.hidden(a)}),fb.each({margin:"",padding:"",border:"Width"},function(a,b){fb.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+Zb[d]+b]=f[d]||f[d-2]||f[0];return e}},Sb.test(a)||(fb.cssHooks[a+b].set=w)});var _b=/%20/g,ac=/\[\]$/,bc=/\r?\n/g,cc=/^(?:submit|button|image|reset|file)$/i,dc=/^(?:input|select|textarea|keygen)/i;fb.fn.extend({serialize:function(){return fb.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=fb.prop(this,"elements");return a?fb.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!fb(this).is(":disabled")&&dc.test(this.nodeName)&&!cc.test(a)&&(this.checked||!Jb.test(a))}).map(function(a,b){var c=fb(this).val();return null==c?null:fb.isArray(c)?fb.map(c,function(a){return{name:b.name,value:a.replace(bc,"\r\n")}}):{name:b.name,value:c.replace(bc,"\r\n")}}).get()}}),fb.param=function(a,c){var d,e=[],f=function(a,b){b=fb.isFunction(b)?b():null==b?"":b,e[e.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(c===b&&(c=fb.ajaxSettings&&fb.ajaxSettings.traditional),fb.isArray(a)||a.jquery&&!fb.isPlainObject(a))fb.each(a,function(){f(this.name,this.value)});else for(d in a)B(d,a[d],c,f);return e.join("&").replace(_b,"+")},fb.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){fb.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),fb.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)},bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}});var ec,fc,gc=fb.now(),hc=/\?/,ic=/#.*$/,jc=/([?&])_=[^&]*/,kc=/^(.*?):[ \t]*([^\r\n]*)$/gm,lc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,mc=/^(?:GET|HEAD)$/,nc=/^\/\//,oc=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,pc=fb.fn.load,qc={},rc={},sc="*/".concat("*");try{fc=S.href}catch(tc){fc=T.createElement("a"),fc.href="",fc=fc.href}ec=oc.exec(fc.toLowerCase())||[],fb.fn.load=function(a,c,d){if("string"!=typeof a&&pc)return pc.apply(this,arguments);var e,f,g,h=this,i=a.indexOf(" ");return i>=0&&(e=a.slice(i),a=a.slice(0,i)),fb.isFunction(c)?(d=c,c=b):c&&"object"==typeof c&&(f="POST"),h.length>0&&fb.ajax({url:a,type:f,dataType:"html",data:c}).done(function(a){g=arguments,h.html(e?fb("<div>").append(fb.parseHTML(a)).find(e):a)}).complete(d&&function(a,b){h.each(d,g||[a.responseText,b,a])}),this},fb.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){fb.fn[b]=function(a){return this.on(b,a)}}),fb.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:fc,type:"GET",isLocal:lc.test(ec[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":sc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":fb.parseJSON,"text xml":fb.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?E(E(a,fb.ajaxSettings),b):E(fb.ajaxSettings,a)},ajaxPrefilter:C(qc),ajaxTransport:C(rc),ajax:function(a,c){function d(a,c,d,h){var j,l,s,t,v,x=c;2!==u&&(u=2,i&&clearTimeout(i),e=b,g=h||"",w.readyState=a>0?4:0,j=a>=200&&300>a||304===a,d&&(t=F(m,w,d)),t=G(m,t,w,j),j?(m.ifModified&&(v=w.getResponseHeader("Last-Modified"),v&&(fb.lastModified[f]=v),v=w.getResponseHeader("etag"),v&&(fb.etag[f]=v)),204===a?x="nocontent":304===a?x="notmodified":(x=t.state,l=t.data,s=t.error,j=!s)):(s=x,(a||!x)&&(x="error",0>a&&(a=0))),w.status=a,w.statusText=(c||x)+"",j?p.resolveWith(n,[l,x,w]):p.rejectWith(n,[w,x,s]),w.statusCode(r),r=b,k&&o.trigger(j?"ajaxSuccess":"ajaxError",[w,m,j?l:s]),q.fireWith(n,[w,x]),k&&(o.trigger("ajaxComplete",[w,m]),--fb.active||fb.event.trigger("ajaxStop")))}"object"==typeof a&&(c=a,a=b),c=c||{};var e,f,g,h,i,j,k,l,m=fb.ajaxSetup({},c),n=m.context||m,o=m.context&&(n.nodeType||n.jquery)?fb(n):fb.event,p=fb.Deferred(),q=fb.Callbacks("once memory"),r=m.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,getResponseHeader:function(a){var b;if(2===u){if(!h)for(h={};b=kc.exec(g);)h[b[1].toLowerCase()]=b[2];b=h[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===u?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return u||(a=t[c]=t[c]||a,s[a]=b),this},overrideMimeType:function(a){return u||(m.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>u)for(b in a)r[b]=[r[b],a[b]];else w.always(a[w.status]);return this},abort:function(a){var b=a||v;return e&&e.abort(b),d(0,b),this}};if(p.promise(w).complete=q.add,w.success=w.done,w.error=w.fail,m.url=((a||m.url||fc)+"").replace(ic,"").replace(nc,ec[1]+"//"),m.type=c.method||c.type||m.method||m.type,m.dataTypes=fb.trim(m.dataType||"*").toLowerCase().match(hb)||[""],null==m.crossDomain&&(j=oc.exec(m.url.toLowerCase()),m.crossDomain=!(!j||j[1]===ec[1]&&j[2]===ec[2]&&(j[3]||("http:"===j[1]?"80":"443"))===(ec[3]||("http:"===ec[1]?"80":"443")))),m.data&&m.processData&&"string"!=typeof m.data&&(m.data=fb.param(m.data,m.traditional)),D(qc,m,c,w),2===u)return w;k=m.global,k&&0===fb.active++&&fb.event.trigger("ajaxStart"),m.type=m.type.toUpperCase(),m.hasContent=!mc.test(m.type),f=m.url,m.hasContent||(m.data&&(f=m.url+=(hc.test(f)?"&":"?")+m.data,delete m.data),m.cache===!1&&(m.url=jc.test(f)?f.replace(jc,"$1_="+gc++):f+(hc.test(f)?"&":"?")+"_="+gc++)),m.ifModified&&(fb.lastModified[f]&&w.setRequestHeader("If-Modified-Since",fb.lastModified[f]),fb.etag[f]&&w.setRequestHeader("If-None-Match",fb.etag[f])),(m.data&&m.hasContent&&m.contentType!==!1||c.contentType)&&w.setRequestHeader("Content-Type",m.contentType),w.setRequestHeader("Accept",m.dataTypes[0]&&m.accepts[m.dataTypes[0]]?m.accepts[m.dataTypes[0]]+("*"!==m.dataTypes[0]?", "+sc+"; q=0.01":""):m.accepts["*"]);for(l in m.headers)w.setRequestHeader(l,m.headers[l]);if(m.beforeSend&&(m.beforeSend.call(n,w,m)===!1||2===u))return w.abort();v="abort";for(l in{success:1,error:1,complete:1})w[l](m[l]);if(e=D(rc,m,c,w)){w.readyState=1,k&&o.trigger("ajaxSend",[w,m]),m.async&&m.timeout>0&&(i=setTimeout(function(){w.abort("timeout")},m.timeout));try{u=1,e.send(s,d)}catch(x){if(!(2>u))throw x;d(-1,x)}}else d(-1,"No Transport");return w},getJSON:function(a,b,c){return fb.get(a,b,c,"json")},getScript:function(a,c){return fb.get(a,b,c,"script")}}),fb.each(["get","post"],function(a,c){fb[c]=function(a,d,e,f){return fb.isFunction(d)&&(f=f||e,e=d,d=b),fb.ajax({url:a,type:c,dataType:f,data:d,success:e})}}),fb.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(a){return fb.globalEval(a),a}}}),fb.ajaxPrefilter("script",function(a){a.cache===b&&(a.cache=!1),a.crossDomain&&(a.type="GET")}),fb.ajaxTransport("script",function(a){if(a.crossDomain){var b,c;return{send:function(d,e){b=fb("<script>").prop({async:!0,charset:a.scriptCharset,src:a.url}).on("load error",c=function(a){b.remove(),c=null,a&&e("error"===a.type?404:200,a.type)}),T.head.appendChild(b[0])},abort:function(){c&&c()}}}});var uc=[],vc=/(=)\?(?=&|$)|\?\?/;fb.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=uc.pop()||fb.expando+"_"+gc++;return this[a]=!0,a}}),fb.ajaxPrefilter("json jsonp",function(c,d,e){var f,g,h,i=c.jsonp!==!1&&(vc.test(c.url)?"url":"string"==typeof c.data&&!(c.contentType||"").indexOf("application/x-www-form-urlencoded")&&vc.test(c.data)&&"data");return i||"jsonp"===c.dataTypes[0]?(f=c.jsonpCallback=fb.isFunction(c.jsonpCallback)?c.jsonpCallback():c.jsonpCallback,i?c[i]=c[i].replace(vc,"$1"+f):c.jsonp!==!1&&(c.url+=(hc.test(c.url)?"&":"?")+c.jsonp+"="+f),c.converters["script json"]=function(){return h||fb.error(f+" was not called"),h[0]},c.dataTypes[0]="json",g=a[f],a[f]=function(){h=arguments},e.always(function(){a[f]=g,c[f]&&(c.jsonpCallback=d.jsonpCallback,uc.push(f)),h&&fb.isFunction(g)&&g(h[0]),h=g=b}),"script"):void 0}),fb.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(a){}};var wc=fb.ajaxSettings.xhr(),xc={0:200,1223:204},yc=0,zc={};a.ActiveXObject&&fb(a).on("unload",function(){for(var a in zc)zc[a]();zc=b}),fb.support.cors=!!wc&&"withCredentials"in wc,fb.support.ajax=wc=!!wc,fb.ajaxTransport(function(a){var c;return fb.support.cors||wc&&!a.crossDomain?{send:function(d,e){var f,g,h=a.xhr();if(h.open(a.type,a.url,a.async,a.username,a.password),a.xhrFields)for(f in a.xhrFields)h[f]=a.xhrFields[f];a.mimeType&&h.overrideMimeType&&h.overrideMimeType(a.mimeType),a.crossDomain||d["X-Requested-With"]||(d["X-Requested-With"]="XMLHttpRequest");for(f in d)h.setRequestHeader(f,d[f]);c=function(a){return function(){c&&(delete zc[g],c=h.onload=h.onerror=null,"abort"===a?h.abort():"error"===a?e(h.status||404,h.statusText):e(xc[h.status]||h.status,h.statusText,"string"==typeof h.responseText?{text:h.responseText}:b,h.getAllResponseHeaders()))}},h.onload=c(),h.onerror=c("error"),c=zc[g=yc++]=c("abort"),h.send(a.hasContent&&a.data||null)},abort:function(){c&&c()}}:void 0});var Ac,Bc,Cc=/^(?:toggle|show|hide)$/,Dc=new RegExp("^(?:([+-])=|)("+gb+")([a-z%]*)$","i"),Ec=/queueHooks$/,Fc=[L],Gc={"*":[function(a,b){var c,d,e=this.createTween(a,b),f=Dc.exec(b),g=e.cur(),h=+g||0,i=1,j=20;if(f){if(c=+f[2],d=f[3]||(fb.cssNumber[a]?"":"px"),"px"!==d&&h){h=fb.css(e.elem,a,!0)||c||1;do i=i||".5",h/=i,fb.style(e.elem,a,h+d);while(i!==(i=e.cur()/g)&&1!==i&&--j)}e.unit=d,e.start=h,e.end=f[1]?h+(f[1]+1)*c:c}return e}]};fb.Animation=fb.extend(J,{tweener:function(a,b){fb.isFunction(a)?(b=a,a=["*"]):a=a.split(" ");for(var c,d=0,e=a.length;e>d;d++)c=a[d],Gc[c]=Gc[c]||[],Gc[c].unshift(b)},prefilter:function(a,b){b?Fc.unshift(a):Fc.push(a)}}),fb.Tween=M,M.prototype={constructor:M,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||"swing",this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(fb.cssNumber[c]?"":"px")},cur:function(){var a=M.propHooks[this.prop];return a&&a.get?a.get(this):M.propHooks._default.get(this)},run:function(a){var b,c=M.propHooks[this.prop];return this.pos=b=this.options.duration?fb.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):M.propHooks._default.set(this),this}},M.prototype.init.prototype=M.prototype,M.propHooks={_default:{get:function(a){var b;return null==a.elem[a.prop]||a.elem.style&&null!=a.elem.style[a.prop]?(b=fb.css(a.elem,a.prop,""),b&&"auto"!==b?b:0):a.elem[a.prop]},set:function(a){fb.fx.step[a.prop]?fb.fx.step[a.prop](a):a.elem.style&&(null!=a.elem.style[fb.cssProps[a.prop]]||fb.cssHooks[a.prop])?fb.style(a.elem,a.prop,a.now+a.unit):a.elem[a.prop]=a.now}}},M.propHooks.scrollTop=M.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},fb.each(["toggle","show","hide"],function(a,b){var c=fb.fn[b];fb.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(N(b,!0),a,d,e)}}),fb.fn.extend({fadeTo:function(a,b,c,d){return this.filter(t).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=fb.isEmptyObject(a),f=fb.speed(b,c,d),g=function(){var b=J(this,fb.extend({},a),f);g.finish=function(){b.stop(!0)},(e||qb.get(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,c,d){var e=function(a){var b=a.stop;delete a.stop,b(d)};return"string"!=typeof a&&(d=c,c=a,a=b),c&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,c=null!=a&&a+"queueHooks",f=fb.timers,g=qb.get(this);if(c)g[c]&&g[c].stop&&e(g[c]);else for(c in g)g[c]&&g[c].stop&&Ec.test(c)&&e(g[c]);for(c=f.length;c--;)f[c].elem!==this||null!=a&&f[c].queue!==a||(f[c].anim.stop(d),b=!1,f.splice(c,1));(b||!d)&&fb.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=qb.get(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=fb.timers,g=d?d.length:0;for(c.finish=!0,fb.queue(this,a,[]),e&&e.cur&&e.cur.finish&&e.cur.finish.call(this),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),fb.each({slideDown:N("show"),slideUp:N("hide"),slideToggle:N("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){fb.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),fb.speed=function(a,b,c){var d=a&&"object"==typeof a?fb.extend({},a):{complete:c||!c&&b||fb.isFunction(a)&&a,duration:a,easing:c&&b||b&&!fb.isFunction(b)&&b};return d.duration=fb.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in fb.fx.speeds?fb.fx.speeds[d.duration]:fb.fx.speeds._default,(null==d.queue||d.queue===!0)&&(d.queue="fx"),d.old=d.complete,d.complete=function(){fb.isFunction(d.old)&&d.old.call(this),d.queue&&fb.dequeue(this,d.queue)},d},fb.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2}},fb.timers=[],fb.fx=M.prototype.init,fb.fx.tick=function(){var a,c=fb.timers,d=0;for(Ac=fb.now();d<c.length;d++)a=c[d],a()||c[d]!==a||c.splice(d--,1);c.length||fb.fx.stop(),Ac=b},fb.fx.timer=function(a){a()&&fb.timers.push(a)&&fb.fx.start()},fb.fx.interval=13,fb.fx.start=function(){Bc||(Bc=setInterval(fb.fx.tick,fb.fx.interval))},fb.fx.stop=function(){clearInterval(Bc),Bc=null},fb.fx.speeds={slow:600,fast:200,_default:400},fb.fx.step={},fb.expr&&fb.expr.filters&&(fb.expr.filters.animated=function(a){return fb.grep(fb.timers,function(b){return a===b.elem}).length}),fb.fn.offset=function(a){if(arguments.length)return a===b?this:this.each(function(b){fb.offset.setOffset(this,a,b)});var c,d,e=this[0],f={top:0,left:0},g=e&&e.ownerDocument;if(g)return c=g.documentElement,fb.contains(c,e)?(typeof e.getBoundingClientRect!==R&&(f=e.getBoundingClientRect()),d=O(g),{top:f.top+d.pageYOffset-c.clientTop,left:f.left+d.pageXOffset-c.clientLeft}):f},fb.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=fb.css(a,"position"),l=fb(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=fb.css(a,"top"),i=fb.css(a,"left"),j=("absolute"===k||"fixed"===k)&&(f+i).indexOf("auto")>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),fb.isFunction(b)&&(b=b.call(a,c,h)),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},fb.fn.extend({position:function(){if(this[0]){var a,b,c=this[0],d={top:0,left:0};return"fixed"===fb.css(c,"position")?b=c.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),fb.nodeName(a[0],"html")||(d=a.offset()),d.top+=fb.css(a[0],"borderTopWidth",!0),d.left+=fb.css(a[0],"borderLeftWidth",!0)),{top:b.top-d.top-fb.css(c,"marginTop",!0),left:b.left-d.left-fb.css(c,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||U;a&&!fb.nodeName(a,"html")&&"static"===fb.css(a,"position");)a=a.offsetParent;return a||U})}}),fb.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(c,d){var e="pageYOffset"===d;fb.fn[c]=function(f){return fb.access(this,function(c,f,g){var h=O(c);return g===b?h?h[d]:c[f]:void(h?h.scrollTo(e?a.pageXOffset:g,e?g:a.pageYOffset):c[f]=g)},c,f,arguments.length,null)}}),fb.each({Height:"height",Width:"width"},function(a,c){fb.each({padding:"inner"+a,content:c,"":"outer"+a},function(d,e){fb.fn[e]=function(e,f){var g=arguments.length&&(d||"boolean"!=typeof e),h=d||(e===!0||f===!0?"margin":"border");return fb.access(this,function(c,d,e){var f;return fb.isWindow(c)?c.document.documentElement["client"+a]:9===c.nodeType?(f=c.documentElement,Math.max(c.body["scroll"+a],f["scroll"+a],c.body["offset"+a],f["offset"+a],f["client"+a])):e===b?fb.css(c,d,h):fb.style(c,d,e,h)},c,g?e:b,g,null)}})}),fb.fn.size=function(){return this.length},fb.fn.andSelf=fb.fn.addBack,"object"==typeof module&&"object"==typeof module.exports?module.exports=fb:"function"==typeof define&&define.amd&&define("jquery",[],function(){return fb}),"object"==typeof a&&"object"==typeof a.document&&(a.jQuery=a.$=fb)}(window);var fluid_1_5=fluid_1_5||{},fluid=fluid||fluid_1_5;!function(a,b){"use strict";function c(a,b,c,d){for(var e=a[c],f=0;f<d.length-1;++f)e=d[f+1](e,c);b[c]=e}function d(a,c,d,e){for(var f=0;d>f;++f)a=e(a,c[f],f,b.makeArray(c));return a}function e(a,b,c,e){for(var f=[],g=0;g<a.length;++g){var h=d(a[g],b,c,e[g]);void 0!==h&&f.push(h)}return f}b.version="Infusion 1.5",b.Error=Error,b.environment={fluid:b};var f=window||{};b.defeatLogging=!0,b.activityTracing=!1,b.activityTrace=[];var g=/(%\w+)/g;b.renderOneActivity=function(a,b){for(var c=b===!0?[]:["    while "],d=a.message,e=g.lastIndex=0;;){var f=g.exec(d);if(!f)break;var h=f[1].substring(1);c.push(d.substring(e,f.index)),c.push(a.args[h]),e=g.lastIndex}return e<d.length&&c.push(d.substring(e)),c},b.renderActivity=function(a,c){return c=c||b.renderOneActivity,b.transform(a,c)},b.getActivityStack=function(){var a=b.globalThreadLocal();return a.activityStack||(a.activityStack=[]),a.activityStack},b.describeActivity=b.getActivityStack,b.logActivity=function(a){a=a||b.describeActivity();var c=b.renderActivity(a).reverse();b.log("Current activity: "),b.each(c,function(a){b.doLog(a)})},b.pushActivity=function(a,c,d){var e={type:a,message:c,args:d,time:(new Date).getTime()};b.activityTracing&&b.activityTrace.push(e),b.passLogLevel(b.logLevel.TRACE)&&b.doLog(b.renderOneActivity(e,!0));var f=b.getActivityStack();f.push(e)},b.popActivity=function(a){a=a||1,b.activityTracing&&b.activityTrace.push({pop:a});var c=b.getActivityStack(),d=c.length-a;c.length=0>d?0:d},b.FluidError=function(a){this.message=a,this.stack=(new Error).stack},b.FluidError.prototype=new Error,b.builtinFail=function(a,c,d){b.log.apply(null,[b.logLevel.FAIL,"ASSERTION FAILED: "].concat(c)),b.logActivity(d);var e=c.join("");if(a)throw new b.FluidError(e);e["Assertion failure - check console for details"]()};var h=[!1];b.fail=function(){var a=b.makeArray(arguments),c=b.makeArray(b.describeActivity());b.popActivity(c.length);var d=h[0];"boolean"==typeof d?b.builtinFail(d,a,c):"function"==typeof d&&d(a,c)},b.pushSoftFailure=function(a){"boolean"==typeof a||"function"==typeof a?h.unshift(a):-1===a&&h.shift()},b.notrycatch=!0,b.tryCatch=function(a,c,d){if(d=d||b.identity,b.notrycatch){var e=a();return d(),e}try{return a()}catch(f){if(!c)throw f;c(f)}finally{d()}},b.expect=function(a,c,d){b.transform(b.makeArray(c),function(c){"undefined"==typeof d[c]&&b.fail(a+" missing required parameter "+c)})},b.isLogging=function(){return i[0].priority>b.logLevel.IMPORTANT.priority},b.isLogLevel=function(a){return b.isMarker(a)&&void 0!==a.priority},b.passLogLevel=function(a){return a.priority<=i[0].priority},b.setLogging=function(a){var c;"boolean"==typeof a?c=b.logLevel[a?"INFO":"IMPORTANT"]:b.isLogLevel(a)?c=a:b.fail("Unrecognised fluid logging level ",a),i.unshift(c)},b.setLogLevel=b.setLogging,b.popLogging=function(){return 1===i.length?i[0]:i.shift()},b.doLog=function(a){var b=a.join("");"undefined"!=typeof console?console.debug?console.debug.apply(console,a):"function"==typeof console.log?console.log.apply(console,a):console.log(b):"undefined"!=typeof YAHOO?YAHOO.log(b):"undefined"!=typeof opera&&opera.postError(b)},b.log=function(){var a=b.makeArray(arguments),c=b.logLevel.INFO;if(b.isLogLevel(a[0])&&(c=a.shift()),b.passLogLevel(c)){var d=b.renderTimestamp(new Date)+":  ",e=[d].concat(a);b.doLog(e)}},b.identity=function(a){return a},b.isValue=function(a){return void 0!==a&&null!==a},b.isPrimitive=function(a){var b=typeof a;return!a||"string"===b||"boolean"===b||"number"===b||"function"===b},b.isArrayable=function(a){return a&&(a.jquery||"[object Array]"===Object.prototype.toString.call(a))},b.isPlainObject=function(a){if(!a)return!1;var b=Object.prototype.toString.call(a);return"[object Array]"===b||"[object Object]"===b},b.isDOMNode=function(a){return a&&"number"==typeof a.nodeType},b.isDOMish=function(a){return b.isDOMNode(a)||a.jquery},b.isComponent=function(a){return a&&a.typeName&&a.id},b.freshContainer=function(a){return b.isArrayable(a)?[]:{}},b.copy=function(c){return b.isPrimitive(c)?c:a.extend(!0,b.freshContainer(c),c)},b.makeArray=function(a){var c=[];if(null!==a&&void 0!==a)if(b.isPrimitive(a)||"number"!=typeof a.length)c.push(a);else for(var d=0;d<a.length;++d)c[d]=a[d];return c},b.transform=function(a){var d=b.freshContainer(a);if(b.isArrayable(a))for(var e=0;e<a.length;++e)c(a,d,e,arguments);else for(var f in a)c(a,d,f,arguments);return d},b.each=function(a,c){if(b.isArrayable(a))for(var d=0;d<a.length;++d)c(a[d],d);else for(var e in a)c(a[e],e)},b.make_find=function(a){var c=a?!1:void 0;return function(d,e,f){var g;if(b.isArrayable(d)){for(var h=0;h<d.length;++h)if(g=e(d[h],h),g!==c)return a?d[h]:g}else for(var i in d)if(g=e(d[i],i),g!==c)return a?d[i]:g;return f}},b.find=b.make_find(!1),b.find_if=b.make_find(!0),b.accumulate=function(a,b,c){for(var d=0;d<a.length;++d)c=b(a[d],c,d);return c},b.remove_if=function(a,c,d){if(b.isArrayable(a))for(var e=0;e<a.length;++e)c(a[e],e)&&(d&&d.push(a[e]),a.splice(e,1),--e);else for(var f in a)c(a[f],f)&&(d&&(d[f]=a[f]),delete a[f]);return d||a},b.generate=function(a,b,c){for(var d=[],e=0;a>e;++e)d[e]=c?b(e):b;return d},b.iota=function(a,b){b=b||0;for(var c=[],d=0;a>d;++d)c[c.length]=b++;return c},b.getMembers=function(a,c){return b.transform(a,function(a){return b.get(a,c)})},b.filterKeys=function(c,d,e){return b.remove_if(a.extend({},c),function(b,c){return e^-1===a.inArray(c,d)})},b.censorKeys=function(a,c){return b.filterKeys(a,c,!0)},b.makeFlatten=function(a){return function(c){var d=[];return b.each(c,function(){d.push(arguments[a])}),d}},b.keys=b.makeFlatten(1),b.values=b.makeFlatten(0),b.contains=function(c,d){return c?b.isArrayable(c)?-1!==a.inArray(d,c):b.find(c,function(a){return d===a?!0:void 0}):void 0},b.keyForValue=function(a,c){return b.find(a,function(a,b){return c===a?b:void 0})},b.findKeyInObject=b.keyForValue,b.arrayToHash=function(a){var c={};return b.each(a,function(a){c[a]=!0}),c},b.clear=function(a){if(b.isArrayable(a))a.length=0;else for(var c in a)delete a[c]},b.compareStringLength=function(a){return a?function(a,b){return a.length-b.length}:function(a,b){return b.length-a.length}},b.logLevelsSpec={FATAL:0,FAIL:5,WARN:10,IMPORTANT:12,INFO:15,TRACE:20},b.logLevel=b.transform(b.logLevelsSpec,function(a,b){return{type:"fluid.marker",value:b,priority:a}});var i=[b.logLevel.IMPORTANT];b.VALUE={type:"fluid.marker",value:"VALUE"},b.NO_VALUE={type:"fluid.marker",value:"NO_VALUE"},b.EXPAND={type:"fluid.marker",value:"EXPAND"},b.EXPAND_NOW={type:"fluid.marker",value:"EXPAND_NOW"},b.isMarker=function(a,b){return a&&"object"==typeof a&&"fluid.marker"===a.type?b?a.value===b.value:!0:!1},b.model={},b.model.copyModel=function(c,d){b.clear(c),a.extend(!0,c,d)},b.model.parseEL=function(a){return""===a?[]:String(a).split(".")},b.model.composePath=function(a,b){return""===a?b:""===b?a:a+"."+b},b.model.composeSegments=function(){return b.makeArray(arguments).join(".")},b.path=b.model.composeSegments,b.composePath=b.model.composePath,b.requireDataBinding=function(){b.fail("Please include DataBinding.js in order to operate complex model accessor configuration")},b.model.setWithStrategy=b.model.getWithStrategy=b.requireDataBinding,b.model.resolvePathSegment=function(a,b,c,d){return!d&&a.resolvePathSegment?a.resolvePathSegment(b):c&&void 0===a[b]?a[b]={}:a[b]},b.model.pathToSegments=function(a,c){var d=c&&c.parser?c.parser.parse:b.model.parseEL,e="number"==typeof a||"string"==typeof a?d(a):a;return e},b.model.accessImpl=function(a,c,d,e,f,g,h){var i=b.model.pathToSegments(c,e),j=0;f&&(j=f.length,i=f.concat(i));var k=d===b.NO_VALUE?0:1;return a=h(a,i,j,e,k),d===b.NO_VALUE||d===b.VALUE?g?{root:a,segs:i}:a:void(a[i[i.length-1]]=d)},b.model.accessSimple=function(a,c,d,e,f,g){return b.model.accessImpl(a,c,d,e,f,g,b.model.traverseSimple)},b.model.traverseSimple=function(a,c,d,e,f){for(var g=e,h=c.length-f,i=0;h>i;++i){if(!a)return a;var j=c[i];a=e&&e[j]?e[j]:b.model.resolvePathSegment(a,j,1===f,g),e=null}return a},b.model.setSimple=function(a,c,d,e,f){b.model.accessSimple(a,c,d,e,f,!1)},b.model.getSimple=function(a,c,d,e){return null===c||void 0===c||0===c.length?a:b.model.accessSimple(a,c,b.NO_VALUE,d,e,!1)},b.decodeAccessorArg=function(a){return a&&a!==b.model.defaultGetConfig&&a!==b.model.defaultSetConfig?"environment"===a.type?a.value:void 0:null},b.set=function(a,c,d,e,f){var g=b.decodeAccessorArg(e);void 0===g?b.model.setWithStrategy(a,c,d,e,f):b.model.setSimple(a,c,d,g,f)},b.get=function(a,c,d,e){var f=b.decodeAccessorArg(d);return void 0===f?b.model.getWithStrategy(a,c,d,e):b.model.accessImpl(a,c,b.NO_VALUE,f,null,!1,b.model.traverseSimple)},b.model.setBeanValue=b.set,b.model.getBeanValue=b.get,b.getGlobalValue=function(a,c){return a?(c=c||b.environment,b.get(f,a,{type:"environment",value:c})):void 0},b.bind=function(a,c,d){return a[c].apply(a,b.makeArray(d))},b.invokeGlobalFunction=function(a,c,d){var e=b.getGlobalValue(a,d);return e?e.apply(null,c||[]):void b.fail("Error invoking global function: "+a+" could not be located")},b.registerGlobalFunction=function(a,c,d){d=d||b.environment,b.set(f,a,c,{type:"environment",value:d})},b.setGlobalValue=b.registerGlobalFunction,b.registerNamespace=function(a,c){c=c||b.environment;var d=b.getGlobalValue(a,c);return d||(d={},b.setGlobalValue(a,d,c)),d},b.dumpEl=b.identity,b.renderTimestamp=b.identity,b.registerNamespace("fluid.event"),b.generateUniquePrefix=function(){return Math.floor(1e12*Math.random()).toString(36)+"-"};var j=b.generateUniquePrefix();b.fluidInstance=j;var k=1;b.allocateGuid=function(){return j+k++},b.event.identifyListener=function(a){return"string"==typeof a||a.$$fluid_guid||(a.$$fluid_guid=b.allocateGuid()),a.$$fluid_guid},b.event.impersonateListener=function(a,c){b.event.identifyListener(a),c.$$fluid_guid=a.$$fluid_guid},b.event.mapPriority=function(a,b){return null===a||void 0===a?b:"last"===a?Number.MAX_VALUE:"first"===a?-Number.MAX_VALUE:-a},b.priorityComparator=function(a,b){return a.priority-b.priority},b.event.sortListeners=function(a){var c=[];return b.each(a,function(a){void 0!==a.length?c=c.concat(a):c.push(a)}),c.sort(b.priorityComparator)},b.event.invokeListener=function(a,c){return"string"==typeof a&&(a=b.event.resolveListener({globalName:a})),a.apply(null,c)},b.event.resolveListener=function(a){if(a.globalName){var c=b.getGlobalValue(a.globalName);c?a=c:b.fail("Unable to look up name "+a.globalName+" as a global function")}return a},b.nameComponent=function(a){return a?"component with typename "+a.typeName+" and id "+a.id:"[unknown component]"},b.event.nameEvent=function(a,c){return c+" of "+b.nameComponent(a)},b.makeEventFirer=function(a,c,d,e){function f(e,f,h){if(e&&!g.destroyed){b.log(b.logLevel.TRACE,"Firing event "+d+" to list of "+e.length+" listeners");for(var i=0;i<e.length;++i){var j=e[i];j.listener=b.event.resolveListener(j.listener);var k=j.listener;if(!j.predicate||j.predicate(k,f)){var l,m=(h?h(k):k).apply(null,f);if((c&&m===!1||g.destroyed)&&(l=!1),a&&(l=m),void 0!==l)return l}}}}var g,h=b.event.identifyListener,i=function(){g.listeners={},g.byId={},g.sortedListeners=[],g.addListener=function(c,d,e,f,i){if(g.destroyed&&b.fail("Cannot add listener to destroyed event firer "+g.name),c){a&&(d="unicast"),"string"==typeof c&&(c={globalName:c});var j=h(c);d=d||j;var k={listener:c,predicate:e,namespace:d,softNamespace:i,priority:b.event.mapPriority(f,g.sortedListeners.length)};if(g.byId[j]=k,i){var l=g.listeners[d]=b.makeArray(g.listeners[d]);l.push(k)}else g.listeners[d]=k;g.sortedListeners=b.event.sortListeners(g.listeners)}},g.addListener.apply(null,arguments)};return g={eventId:b.allocateGuid(),ownerId:e,name:d,typeName:"fluid.event.firer",destroy:function(){g.destroyed=!0},addListener:function(){i.apply(null,arguments)},removeListener:function(a){if(g.listeners){var c,d;if("string"==typeof a){c=a;var e=g.listeners[a];if(!e)return;a=void 0!==e.length?e:e.listener}"function"==typeof a&&(d=h(a),d||b.fail("Cannot remove unregistered listener function ",a," from event "+g.name));var f=g.byId[d],i=f&&f.softNamespace;c=c||f&&f.namespace||d,delete g.byId[d],i?b.remove_if(g.listeners[c],function(a){return a.listener.$$fluid_guid===d}):delete g.listeners[c],g.sortedListeners=b.event.sortListeners(g.listeners)}},fireToListeners:function(a,b,c){return f(a,b,c)},fire:function(){return f(g.sortedListeners,arguments)}}},b.event.getEventFirer=b.makeEventFirer,b.fireEvent=function(a,c,d){var e=b.get(a,c);e&&e.fire.apply(null,b.makeArray(d))},b.event.addListenerToFirer=function(a,c,d,e){if(e=e||b.identity,b.isArrayable(c))for(var f=0;f<c.length;++f)b.event.addListenerToFirer(a,c[f],d,e);else"function"==typeof c||"string"==typeof c?e(a).addListener(c,d):c&&"object"==typeof c&&e(a).addListener(c.listener,d||c.namespace,c.predicate,c.priority,c.softNamespace)},b.event.resolveListenerRecord=function(a){return{records:a}},b.expandOptions=function(a){b.fail("fluid.expandOptions could not be loaded - please include FluidIoC.js in order to operate IoC-driven event with descriptor "+a)},b.mergeListeners=function(a,c,d){b.each(d,function(d,e){var f,g;if("{"===e.charAt(0))f=b.expandOptions(e,a),f||b.fail("Error in listener record: key "+e+' could not be looked up to an event firer - did you miss out "events." when referring to an event firer?');
else{var h=e.indexOf(".");-1!==h&&(g=e.substring(h+1),e=e.substring(0,h)),c[e]||b.fail("Listener registered for event "+e+" which is not defined for this component"),f=c[e]}var i=b.event.resolveListenerRecord(d,a,e,g,!0);b.event.addListenerToFirer(f,i.records,g,i.adderWrapper)})},b.eventFromRecord=function(a,c,d){var e,f=a&&("string"!=typeof a||"{"===a.charAt(0));return f?b.event.resolveEvent?e=b.event.resolveEvent(d,c,a):b.fail("fluid.event.resolveEvent could not be loaded - please include FluidIoC.js in order to operate IoC-driven event with descriptor ",a):e=b.makeEventFirer("unicast"===a,"preventable"===a,b.event.nameEvent(d,c),d.id),e},b.instantiateFirers=function(a,c){b.each(c.events,function(c,d){a.events[d]=b.eventFromRecord(c,d,a)})},b.mergeListenerPolicy=function(a,c,d){var e="{"!==d.charAt(0)&&-1!==d.indexOf(".");return e?c||a:b.arrayConcatPolicy(a,c)},b.makeMergeListenersPolicy=function(a){return function(c,d){return c=c||{},b.each(d,function(b,d){c[d]=a(c[d],b,d)}),c}},b.unique=function(a){return b.remove_if(a,function(b,c){return!b||c>0&&b===a[c-1]})},b.arrayConcatPolicy=function(a,c){return b.makeArray(a).concat(b.makeArray(c))},b.typeTag=function(a){return a?{typeName:a,id:b.allocateGuid()}:null},b.staticEnvironment=b.typeTag("fluid.staticEnvironment"),b.singleThreadLocal=function(a){var b=a();return function(a){return void 0===a?b:b=a}},b.threadLocal=b.singleThreadLocal,b.globalThreadLocal=b.threadLocal(function(){return b.typeTag("fluid.dynamicEnvironment")});var l=1,m={},n={},o=function(a,c,d){var e=!0;return d?e=1===c.length:c=b.makeArray(c),b.each(c,function(c){if(c&&!a.gradeHash[c]){var d="{"===c.charAt(0),f=(d?null:e?b.rawDefaults(c):b.getGradedDefaults(c))||{},g=m[c]||l-1;a.lastTick=Math.max(a.lastTick,g),a.gradeHash[c]=!0,a.gradeChain.push(c),a.optionsChain.push(f);for(var h=b.makeArray(f.gradeNames),i=0;i<h.length;++i){var j=h[i],k="autoInit"===j;e?k||o(a,j):a.gradeHash[j]||k||(a.gradeHash[j]=!0,a.gradeChain.push(j))}}}),a};b.resolveGradeStructure=function(a,c){var d={lastTick:0,gradeChain:[],gradeHash:{},optionsChain:[]};return o(d,(b.makeArray(c).reverse()||[]).concat([a]),!0)};var p={};b.gradeNamesToKey=function(a,b){return a+"|"+b.join("|")},b.hasGrade=function(a,c){return a&&a.gradeNames?b.contains(a.gradeNames,c):!1},b.resolveGrade=function(c,d,e){for(var f=b.resolveGradeStructure(d,e),g=f.optionsChain.reverse(),h={},i=0;i<g.length;++i)g[i]&&g[i].mergePolicy&&(h=a.extend(!0,h,g[i].mergePolicy));g=[h,{}].concat(g);var j=b.merge.apply(null,g);return j.gradeNames=f.gradeChain,b.hasGrade(c,"autoInit")&&j.gradeNames.push("autoInit"),{defaults:j,lastTick:f&&f.lastTick}},b.getGradedDefaults=function(a,c){c=b.makeArray(c);var d=b.gradeNamesToKey(a,c),e=p[d];if(e){for(var f=0,g=e.defaults.gradeNames||[],h=0;h<g.length;++h)f=Math.max(f,m[g[h]]||0);f>e.lastTick&&(b.log("Clearing cache for component "+a+" with gradeNames ",g),e=null)}if(!e){var i=b.rawDefaults(a);if(!i)return i;e=p[d]=b.resolveGrade(i,a,c)}return e.defaults},b.annotateListeners=function(a,c){c.listeners&&(c.listeners=b.transform(c.listeners,function(c){var d=b.makeArray(c);return b.transform(d,function(c){return b.isPrimitive(c)||(c.componentSource=a),c})}))},b.rawDefaults=function(a,c){if(void 0===c)return n[a];b.pushActivity("registerDefaults","registering defaults for grade %componentName with options %options",{componentName:a,options:c});var d=b.expandCompact?b.expandCompact(c):b.copy(c);b.annotateListeners(a,d),n[a]=d,m[a]=l++,b.popActivity()},b.doIndexDefaults=function(a,c,d,e){for(var f=b.makeArray(e.gradeNames),g=0;g<f.length;++g)if(!b.hasGrade(c,f[g]))return;for(var h="function"==typeof e.indexFunc?e.indexFunc:b.getGlobalValue(e.indexFunc),i=h(c)||[],j=0;j<i.length;++j)(d[i[j]]=d[i[j]]||[]).push(a)},b.indexDefaults=function(a,c){var d={};for(var e in n){var f=b.getGradedDefaults(e);b.doIndexDefaults(e,f,d,c)}return d},b.defaults=function(a,c){return void 0===c?b.getGradedDefaults(a):(c&&c.options&&b.fail("Probable error in options structure for "+a+' with option named "options" - perhaps you meant to write these options at top level in fluid.defaults? - ',c),b.rawDefaults(a,c),b.hasGrade(c,"autoInit")&&b.makeComponent(a,b.getGradedDefaults(a)),void 0)},b.makeComponent=function(c,d){if(d.gradeNames&&0!==d.gradeNames.length){if(!d.initFunction){for(var e=[],f=0;f<d.gradeNames.length;++f){var g=d.gradeNames[f],h=b.rawDefaults(g);h||"autoInit"===g||e.push(g)}b.fail(0===e.length?"Cannot autoInit component "+c+" which does not have an initFunction defined":"The grade hierarchy of component with typeName "+c+" is incomplete - it inherits from the following grade(s): "+e.join(", ")+" for which the grade definitions are corrupt or missing. Please check the files which might include these  grades and ensure they are readable and have been loaded by this instance of Infusion")}}else b.fail("Cannot autoInit component "+c+" which does not have any gradeNames defined");var i=function(){return b.initComponent(c,arguments)},j=b.getGlobalValue(c);j&&a.extend(i,j),b.setGlobalValue(c,i)},b.makeComponents=function(a){b.each(a,function(a,c){var d={gradeNames:b.makeArray(a).concat(["autoInit"])};b.defaults(c,d)})},b.model.mergeModel=function(c,d){if(!b.isPrimitive(c)){var e=b.copy(d);a.extend(!0,d,c),a.extend(!0,d,e)}return d};var q={};b.derefMergePolicy=function(a){return(a?a["*"]:q)||q},b.compileMergePolicy=function(a){var c={},d={},e={builtins:c,defaultValues:d};return a?(b.each(a,function(a,f){var g={},h=!0;if("function"==typeof a)g.func=a;else if("object"==typeof a)g=a;else if(b.isDefaultValueMergePolicy(a))b.set(d,f,"{that}.options."+a),e.hasDefaults=!0,h=!1;else for(var i=a.split(/\s*,\s*/),j=0;j<i.length;++j)g[i[j]]=!0;h&&b.set(c,b.composePath(f,"*"),g)}),e):e},b.isDefaultValueMergePolicy=function(a){return"string"==typeof a&&-1===a.indexOf(",")&&!/replace|preserve|nomerge|noexpand/.test(a)},b.mergeOneImpl=function(a,c,d,e,f,g,h){var i=a,j=b.isPrimitive(a);return void 0!==c&&(f.func||null===c||!b.isPlainObject(c)||b.isDOMish(c)||c===b.VALUE||f.preserve||f.nomerge?(e[d]=void 0,i=f.func?f.func.call(null,a,c,h[g-1],h,g):b.isValue(a)&&f.preserve?b.model.mergeModel(a,c):c):j&&(i=a=b.freshContainer(c))),i},b.fetchMergeChildren=function(a,c,d,e,f,g){for(var h=b.derefMergePolicy(f),i=e.length-1;i>=0;--i){var j=e[i];if(void 0!==j&&(b.each(j,function(b,h){a.hasOwnProperty(h)||(d[c]=h,g.strategy(a,h,c+1,d,e,f))}),h.replace))break}return a},b.inEvaluationMarker={__CURRENTLY_IN_EVALUATION__:!0},b.destroyedMarker={__COMPONENT_DESTROYED__:!0},b.strategyRecursionBailout=50,b.makeMergeStrategy=function(a){var c=function(c,f,g,h,i,j){if(g>b.strategyRecursionBailout&&b.fail("Overflow/circularity in options merging, current path is ",h," at depth ",g,' - please protect components from merging using the "nomerge" merge policy'),b.isPrimitive(c))return void 0;b.isTracing&&b.tracing.pathCount.push(b.path(h.slice(0,g)));var k;if(c.hasOwnProperty(f)){if(k=c[f],!a.evaluateFully)return k}else c[f]=b.inEvaluationMarker;void 0===i&&(h=b.makeArray(h),i=e(a.sources,h,g-1,a.sourceStrategies),j=d(a.mergePolicy,h,g-1,b.concreteTrundler));var l,m,n,o=b.concreteTrundler(j,f),p=b.derefMergePolicy(o);p.replace?(l=1-i.length,m=0,n=-1):(l=0,m=i.length-1,n=1);for(var q,r=[],s=l;m>=s;++s){var t=n*s,u=a.sourceStrategies[t](i[t],f,g,h);if(void 0!==u&&(r[t]=u,void 0===k)){if(-1===n){q=c[f]=u;break}q=c[f]=b.mergeOneImpl(q,u,s,r,p,g,h,a)}}return void 0!==k&&(q=k),r.length>0&&(b.isPrimitive(q)||b.fetchMergeChildren(q,g,h,r,o,a)),void 0===k&&0===r.length&&delete c[f],q};return a.strategy=c,c},b.driveStrategy=function(a,c,d){c=b.makeArray(c);for(var e=0;e<c.length;++e){if(!a)return void 0;a=d(a,c[e],e+1,c)}return a},b.concreteTrundler=function(a,b){return a?a[b]:void 0},b.merge=function(a){var c=Array.prototype.slice.call(arguments,1),d=b.compileMergePolicy(a).builtins,e=b.makeMergeOptions(d,c,{});return e.initter(),e.target},b.simpleGingerBlock=function(a,c){var d={target:a,simple:!0,strategy:b.concreteTrundler,initter:b.identity,recordType:c,priority:b.mergeRecordTypes[c]};return d},b.makeMergeOptions=function(c,d,e){var f={mergePolicy:c,sources:d};return f=a.extend(f,e),f.target=f.target||b.freshContainer(f.sources[0]),f.sourceStrategies=f.sourceStrategies||b.generate(f.sources.length,b.concreteTrundler),f.initter=function(){f.evaluateFully=!0,b.fetchMergeChildren(f.target,0,[],f.sources,f.mergePolicy,f)},b.makeMergeStrategy(f),f},b.transformOptions=function(a,c){b.expect("Options transformation record",["transformer","config"],c);var d=b.getGlobalValue(c.transformer);return d.call(null,a,c.config)},b.findMergeBlocks=function(a,c){return b.remove_if(b.makeArray(a),function(a){return a.recordType!==c})},b.transformOptionsBlocks=function(a,c,d){b.each(d,function(d){var e=b.findMergeBlocks(a,d);b.each(e,function(a){a[a.simple?"target":"source"]=b.transformOptions(a.source,c)})})},b.deliverOptionsStrategy=b.identity,b.computeComponentAccessor=b.identity,b.computeDynamicComponents=b.identity,b.mergeRecordTypes={defaults:0,localOptions:50,defaultValueMerge:100,subcomponentRecord:200,distribution:300,user:500,demands:600},b.destroyValue=function(a,c){a&&b.model.applyChangeRequest(a,{type:"DELETE",path:c})},b.mergeComponentOptions=function(c,d,e,f){function g(){s=b.driveStrategy(l,"mergePolicy",q.strategy),s=a.extend({},b.rootMergePolicy,s),r=b.compileMergePolicy(s),a.extend(!0,j,r.builtins)}var h=b.rawDefaults(d),i=b.getGradedDefaults(d,h&&h.gradeNames?null:f.gradeNames),j={},k=[];k=k.concat(b.expandComponentOptions?b.expandComponentOptions(j,i,e,c):[b.simpleGingerBlock(i,"defaults"),b.simpleGingerBlock(e,"user")]);var l={},m=[],n=[],o={target:l,sourceStrategies:m},p=function(){k.sort(b.priorityComparator),m.length=0,n.length=0,b.each(k,function(a){m.push(a.strategy),n.push(a.target)})};p();var q=b.makeMergeOptions(j,n,o);q.mergeBlocks=k,q.updateBlocks=p,q.destroyValue=function(a){for(var c=0;c<k.length;++c)b.destroyValue(k[c].target,a);b.destroyValue(o.target,a)};var r,s;g(),r.hasDefaults&&(b.generateExpandBlock?(k.push(b.generateExpandBlock({options:r.defaultValues,recordType:"defaultValueMerge",priority:b.mergeRecordTypes.defaultValueMerge},c,{})),p()):b.fail("Cannot operate mergePolicy ",s," for component ",c," without including FluidIoC.js")),c.options=l;var t=b.driveStrategy(l,"nickName",q.strategy);c.nickName=t||b.computeNickName(c.typeName),b.driveStrategy(l,"gradeNames",q.strategy),b.deliverOptionsStrategy(c,l,q);var u=b.driveStrategy(l,"transformOptions",q.strategy);return u&&(b.transformOptionsBlocks(k,u,["user","subcomponentRecord"]),p()),b.computeComponentAccessor(c),o.target.mergePolicy||g(),q},b.defaults("fluid.function",{}),b.lifecycleFunctions={preInitFunction:!0,postInitFunction:!0,finalInitFunction:!0},b.rootMergePolicy=a.extend({gradeNames:b.arrayConcatPolicy,distributeOptions:b.arrayConcatPolicy,transformOptions:"replace"},b.transform(b.lifecycleFunctions,function(){return b.mergeListenerPolicy})),b.defaults("fluid.littleComponent",{gradeNames:["autoInit"],initFunction:"fluid.initLittleComponent",mergePolicy:b.rootMergePolicy,argumentMap:{options:0}}),b.defaults("fluid.eventedComponent",{gradeNames:["fluid.littleComponent","autoInit"],events:{onCreate:null,onAttach:null,onClear:null,onDestroy:null,afterDestroy:null},mergePolicy:{listeners:b.makeMergeListenersPolicy(b.mergeListenerPolicy)}}),b.COMPONENT_OPTIONS={type:"fluid.marker",value:"COMPONENT_OPTIONS"},b.emptySubcomponent=function(a){var c=b.typeTag("fluid.emptySubcomponent");c.options=a||{},c.options.gradeNames=[c.typeName],a=b.makeArray(a);for(var d=0;d<a.length;++d)c[a[d]]=b.identity;return c},b.computeNickName=function(a){var c=b.model.parseEL(a);return c[c.length-1]},b.typeFount=function(a){var c=b.initLittleComponent("fluid.typeFount",a);return b.typeTag(c.options.targetTypeName)},b.initLittleComponent=function(a,c,d,e){var f=b.typeTag(a);d=d||{gradeNames:"fluid.littleComponent"},f.destroy=b.makeRootDestroy(f);var g=b.mergeComponentOptions(f,a,c,d),h=f.options,i=b.hasGrade(h,"fluid.eventedComponent");i&&(f.events={}),(e||b.identity)(f,h,g.strategy),b.computeDynamicComponents(f,g);for(var j=0;j<g.mergeBlocks.length;++j)g.mergeBlocks[j].initter();return g.initter(),delete h.mergePolicy,b.initLifecycleFunctions(f),b.fireEvent(h,"preInitFunction",f),i&&(b.instantiateFirers(f,h),b.mergeListeners(f,f.events,h.listeners)),b.hasGrade(h,"autoInit")||b.clearLifecycleFunctions(h),f},b.updateWithDefaultLifecycle=function(a,c,d){var e=d+"."+a.substring(0,a.length-"function".length),f=b.getGlobalValue(e);if("function"==typeof f){c=b.makeArray(c);var g=b.find(c,function(a){var b=a.listener||a;return b===f||b===e?!0:void 0});g||c.push(f)}return c},b.initLifecycleFunctions=function(a){var c=a.options.gradeNames||[];b.each(b.lifecycleFunctions,function(d,e){for(var f=a.options[e],g=c.length-1;g>=0;--g)"autoInit"!==c[g]&&(f=b.updateWithDefaultLifecycle(e,f,c[g]));f&&(a.options[e]=b.makeEventFirer(null,null,e,a.id),b.event.addListenerToFirer(a.options[e],f))})},b.clearLifecycleFunctions=function(a){b.each(b.lifecycleFunctions,function(b,c){delete a[c]}),delete a.initFunction},b.diagnoseFailedView=b.identity,b.makeRootDestroy=function(a){return function(){b.fireEvent(a,"events.onClear",[a,"",null]),b.doDestroy(a),b.fireEvent(a,"events.afterDestroy",[a,"",null])}},b.isDestroyed=function(a){return a.destroy===b.destroyedMarker},b.doDestroy=function(a,c,d){b.fireEvent(a,"events.onDestroy",[a,c||"",d]),a.destroy=b.destroyedMarker;for(var e in a.events)"afterDestroy"!==e&&"function"==typeof a.events[e].destroy&&a.events[e].destroy()},b.resolveReturnedPath=b.identity,b.initComponent=function(a,c){var d=b.defaults(a);d.gradeNames||b.fail("Cannot initialise component "+a+" which has no gradeName registered");var e,f=[a].concat(b.makeArray(c));return b.pushActivity("initComponent","constructing component of type %componentName with arguments %initArgs",{componentName:a,initArgs:c}),e=b.invokeGlobalFunction(d.initFunction,f),b.diagnoseFailedView(a,e,d,f),b.fireEvent(e.options,"postInitFunction",e),b.initDependents&&b.initDependents(e),b.fireEvent(e.options,"finalInitFunction",e),b.clearLifecycleFunctions(e.options),b.fireEvent(e,"events.onCreate",e),b.popActivity(),b.resolveReturnedPath(e.options.returnedPath,e)?b.get(e,e.options.returnedPath):e},b.initSubcomponentImpl=function(a,c,d){var e;if("function"!=typeof c){var f="string"==typeof c?c:c.type;e="fluid.emptySubcomponent"===f?b.emptySubcomponent(c.options):b.invokeGlobalFunction(f,d)}else e=c.apply(null,d);return e},b.initSubcomponents=function(a,c,d){var e=a.options[c];if(e){var f=b.makeArray(e),g=-1,h=[];d=b.makeArray(d);for(var i=0;i<d.length;++i)d[i]===b.COMPONENT_OPTIONS&&(g=i);for(i=0;i<f.length;++i)e=f[i],-1!==g&&(d[g]=e.options),h[i]=b.initSubcomponentImpl(a,e,d);return h}},b.initSubcomponent=function(a,c,d){return b.initSubcomponents(a,c,d)[0]};var r="(?:[\\w\\u00c0-\\uFFFF*_-";b.simpleCSSMatcher={regexp:new RegExp("([#.]?)("+r+"]|\\\\.)+)","g"),charToTag:{"":"tag","#":"id",".":"clazz"}},b.IoCSSMatcher={regexp:new RegExp("([&#]?)("+r+"]|\\.)+)","g"),charToTag:{"":"context","&":"context","#":"id"}};var s=new RegExp("\\s*(>)?\\s*","g");b.parseSelector=function(c,d){var e=[];c=a.trim(c);var f=d.regexp;f.lastIndex=0;for(var g=0;;){for(var h=[],i=!0;;){var j=f.exec(c);if(!j)break;if(j.index!==g){if(!i)break;b.fail("Error in selector string - cannot match child selector expression starting at "+c.substring(g))}var k={},l=j[2],m=d.charToTag[j[1]];m&&(k[m]=l),h[h.length]=k,g=f.lastIndex,i=!1}s.lastIndex=g;var n={predList:h},o=s.exec(c);if(o&&o.index===g||b.fail("Error in selector string - can not match child selector expression at "+c.substring(g)),">"===o[1]&&(n.child=!0),e[e.length]=n,s.lastIndex>=c.length)break;g=s.lastIndex,f.lastIndex=s.lastIndex}return e},b.stringToRegExp=function(a,b){return new RegExp(a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&"),b)},b.stringTemplate=function(a,c){var d=b.keys(c);d=d.sort(b.compareStringLength());for(var e=0;e<d.length;++e){var f=d[e],g=b.stringToRegExp("%"+f,"g");a=a.replace(g,c[f])}return a},b.defaults("fluid.messageResolver",{gradeNames:["fluid.littleComponent","autoInit"],mergePolicy:{messageBase:"nomerge",parents:"nomerge"},resolveFunc:b.stringTemplate,parseFunc:b.identity,messageBase:{},parents:[]}),b.messageResolver.preInit=function(a){a.messageBase=a.options.parseFunc(a.options.messageBase),a.lookup=function(c){var d=b.messageResolver.resolveOne(a.messageBase,c);return void 0===d?b.find(a.options.parents,function(a){return a?a.lookup(c):void 0}):{template:d,resolveFunc:a.options.resolveFunc}},a.resolve=function(c,d){if(!c)return"[No messagecodes provided]";c=b.makeArray(c);var e=a.lookup(c);return e?e.resolveFunc(e.template,d):"[Message string for key "+c[0]+" not found]"}},b.messageResolver.resolveOne=function(a,b){for(var c=0;c<b.length;++c){var d=b[c],e=a[d];if(void 0!==e)return e}},b.messageLocator=function(a,c){var d=b.messageResolver({messageBase:a,resolveFunc:c});return function(a,b){return d.resolve(a,b)}}}(jQuery,fluid_1_5);var fluid_1_5=fluid_1_5||{};!function(a,b){"use strict";function c(b,c){return b=a(b),b.trigger("fluid-"+c),b.triggerHandler(c),b[c](),b}b.uaMatch=function(a){a=a.toLowerCase();var b=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||a.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:b[1]||"",version:b[2]||"0"}};var d,e;a.browser||(navigator.userAgent.match(/Trident\/7\./)?e={msie:!0,version:11}:(d=b.uaMatch(navigator.userAgent),e={},d.browser&&(e[d.browser]=!0,e.version=d.version),e.chrome?e.webkit=!0:e.webkit&&(e.safari=!0)),a.browser=e);var f="fluid-scoped-data";b.getScopedData=function(b,c){var d=a(b).data(f);return d?d[c]:void 0},b.setScopedData=function(b,c,d){a(b).each(function(){var b=a.data(this,f)||{};b[c]=d,a.data(this,f,b)})};var g=null;a(document).bind("focusin",function(a){g=a.target}),b.getLastFocusedElement=function(){return g};var h="enablement";b.enabled=function(c,d){return c=a(c),void 0===d?b.getScopedData(c,h)!==!1:(a("*",c).add(c).each(function(){void 0!==b.getScopedData(this,h)?b.setScopedData(this,h,d):/select|textarea|input/i.test(this.nodeName)&&a(this).prop("disabled",!d)}),void b.setScopedData(c,h,d))},b.initEnablement=function(a){b.setScopedData(a,h,!0)},b.resolveEventTarget=function(a){for(;a.originalEvent&&a.originalEvent.target;)a=a.originalEvent;return a.target},a.each(["focus","blur"],function(a,d){b[d]=function(a){return c(a,d)}})}(jQuery,fluid_1_5);var fluid_1_5=fluid_1_5||{};!function(a,b){"use strict";b.dom=b.dom||{};var c=function(a){if(a.node.firstChild)return a.node=a.node.firstChild,a.depth+=1,a;for(;a.node;){if(a.node.nextSibling)return a.node=a.node.nextSibling,a;a.node=a.node.parentNode,a.depth-=1}return a};b.dom.iterateDom=function(a,d,e){for(var f,g={node:a,depth:0},h=a;null!==g.node&&g.depth>=0&&g.depth<b.dom.iterateDom.DOM_BAIL_DEPTH;){if(f=null,(1===g.node.nodeType||e)&&(f=d(g.node,g.depth)),f)if("delete"===f)g.node.parentNode.removeChild(g.node),g.node=h;else if("stop"===f)return g.node;h=g.node,g=c(g)}},b.dom.iterateDom.DOM_BAIL_DEPTH=256,b.dom.isContainer=function(a,b){for(;b;b=b.parentNode)if(a===b)return!0;return!1},b.dom.getElementText=function(a){for(var b=a.childNodes,c="",d=0;d<b.length;++d){var e=b[d];3===e.nodeType&&(c+=e.nodeValue)}return c}}(jQuery,fluid_1_5);var fluid_1_5=fluid_1_5||{},fluid=fluid||fluid_1_5;!function(a,b){"use strict";function c(a,b){for(var c="",d=0;b>d;++d)c+=a;return c}function d(a,c,e){var f=c+e.indentChars;if(null===a)return"null";if(b.isPrimitive(a))return JSON.stringify(a);var g,h=[];if(b.isArrayable(a)){if(0===a.length)return"[]";for(g=0;g<a.length;++g)h[g]=d(a[g],f,e);return"[\n"+f+h.join(",\n"+f)+"\n"+c+"]"}return g=0,b.each(a,function(a,b){h[g++]=JSON.stringify(b)+": "+d(a,f,e)}),"{\n"+f+h.join(",\n"+f)+"\n"+c+"}"}b.renderTimestamp=function(a){var b=function(a,b){b||(b=2);var c=void 0===a?"":a.toString();return"00000".substring(5-b+c.length)+c};return b(a.getHours())+":"+b(a.getMinutes())+":"+b(a.getSeconds())+"."+b(a.getMilliseconds(),3)},b.isTracing=!1,b.registerNamespace("fluid.tracing"),b.tracing.pathCount=[],b.tracing.summarisePathCount=function(a){a=a||b.tracing.pathCount;for(var c={},d=0;d<a.length;++d){var e=a[d];c[e]?++c[e]:c[e]=1}var f=[];return b.each(c,function(a,b){f.push({path:b,count:a})}),f.sort(function(a,b){return b.count-a.count}),f},b.tracing.condensePathCount=function(a,c){a=b.makeArray(a);var d={};b.each(a,function(a){d[a]=0});var e=[];return b.each(c,function(c){var f=c.path;b.find(a,function(a){return 0===f.indexOf(a)?(d[a]+=c.count,!0):void 0})||e.push(c)}),b.each(d,function(a,b){e.unshift({path:b,count:a})}),e},b.detectStackStyle=function(a){var b="other",c={offset:0};return a.arguments?b="chrome":"undefined"!=typeof window&&window.opera&&a.stacktrace?b="opera10":a.stack?(b="firefox",c.offset=-1===a.stack.indexOf("Trace exception")?1:0):"undefined"==typeof window||!window.opera||"stacktrace"in a||(b="opera"),c.style=b,c},b.obtainException=function(){try{throw new Error("Trace exception")}catch(a){return a}};var e=b.detectStackStyle(b.obtainException());b.registerNamespace("fluid.exceptionDecoders"),b.decodeStack=function(){if("firefox"!==e.style)return null;var a=b.obtainException();return b.exceptionDecoders[e.style](a)},b.exceptionDecoders.firefox=function(a){var c=a.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^\(/gm,"{anonymous}(").split("\n");return b.transform(c,function(a){var b=a.indexOf("@");return-1===b?[a]:[a.substring(b+1),a.substring(0,b)]})},b.getCallerInfo=function(a){a=(a||3)-e.offset;var c=b.decodeStack();return c?c[a][0]:null},b.prettyPrintJSON=function(b,e){return e=a.extend({indent:4},e),e.indentChars=c(" ",e.indent),d(b,"",e)},b.dumpEl=function(c){var d;if(!c)return"null";if(3===c.nodeType||8===c.nodeType)return"[data: "+c.data+"]";if(9===c.nodeType)return"[document: location "+c.location+"]";if(!c.nodeType&&b.isArrayable(c)){d="[";for(var e=0;e<c.length;++e)d+=b.dumpEl(c[e]),e<c.length-1&&(d+=", ");return d+"]"}return c=a(c),d=c.get(0).tagName,c.id&&(d+="#"+c.id),c.attr("class")&&(d+="."+c.attr("class")),d}}(jQuery,fluid_1_5);var fluid_1_5=fluid_1_5||{};!function(a,b){"use strict";function c(a,b){var c=j[a]||[];a:for(var d=0;d<c.length;++d){for(var e=c[d],f=0;f<b.length;++f)if(e.contexts[f]!==b[f])continue a;return e.spec}}function d(a,c,d,e){for(var f=0;d>f;++f)a=e(a,c[f],f,b.makeArray(c));return a}b.visitComponentChildren=function(a,c,d,e,f){var g=b.getInstantiator(a);for(var h in a){var i=g.composePath(e,h),j=a[h];if(!(!b.isComponent(j)||d.visited&&d.visited[j.id])){if(d.visited&&(d.visited[j.id]=!0),c(j,h,i,e,f))return!0;d.flat||b.visitComponentChildren(j,c,d,i)}}},b.getMemberNames=function(a,c){var d=a.idToPath(c[c.length-1].id),e=b.model.parseEL(d);return e.unshift.apply(e,b.generate(c.length-e.length,"")),e};var e=function(a,c,d,e){e=e||{visited:{},flat:!0,instantiator:a};for(var f=b.getMemberNames(a,c),g=c.length-1;g>=0;--g){var h,i=c[g];if(i.typeName&&(e.visited[i.id]=!0,h=a.idToPath[i.id],d(i,f[g],h,h,g)))return;if(b.visitComponentChildren(i,d,e,h,g))return}};b.mountStrategy=function(a,b,c){var d=a.length;return function(b,e,f,g){if(!(f<=a.length)){for(var h=0;h<a.length;++h)if(g[h]!==a[h])return;return c(b,e,f-a.length,g.slice(d))}}},b.invokerFromRecord=function(a,c,d){b.pushActivity("makeInvoker","beginning instantiation of invoker with name %name and record %record as child of %that",{name:c,record:a,that:d});var e=b.makeInvoker(d,a,c);return b.popActivity(),e},b.memberFromRecord=function(a,c,d){var e=b.expandOptions(a,d,null,null,{freeRoot:!0});return e},b.recordStrategy=function(a,c,d,e,f,g){return g=g||[],{strategy:function(g,h,i){if(1===i){var j=b.driveStrategy(c,[e,h],d);if(void 0!==j){b.set(g,[h],b.inEvaluationMarker);var k=f(j,h,a);return b.set(g,[h],k),k}}},initter:function(){var f=b.driveStrategy(c,e,d)||{};for(var h in f)b.getForComponent(a,g.concat([h]))}}},b.instantiateFirers=function(a){var c=b.shadowForComponent(a),d=b.get(c,["eventStrategyBlock","initter"])||b.identity;d()},b.makeDistributionRecord=function(c,d,e,f,g,h,i){h=h||0,i=i||"distribution";var j=b.copy(b.get(d,e));b.each(g,function(a){b.model.applyChangeRequest(j,{path:a,type:"DELETE"})});var k={options:{}},l=b.isPrimitive(j);return b.model.applyChangeRequest(k,{path:f,type:l?"ADD":"MERGE",value:j}),a.extend(k,{contextThat:c,recordType:i,priority:b.mergeRecordTypes.distribution+h})},b.filterBlocks=function(c,d,e,f,g,h){var i=[],j=0;return b.each(d,function(d){var k=b.get(d.source,e);if(k){i.push(b.makeDistributionRecord(c,d.source,e,f,g,j++,d.recordType));var l=a.extend({},k);h&&b.model.applyChangeRequest(d.source,{path:e,type:"DELETE"}),b.each(g,function(a){var c=b.get(l,a);b.set(d.source,e.concat(a),c)})}}),i},b.matchIoCSelector=function(a,b,c,d,e){for(var f=b.length-1,g=a.length-1;;){for(var h=f===b.length-1||a[g].child,i=b[f],j=a[g],k=!0,l=0;l<j.predList.length;++l){var m=j.predList[l];if(m.context&&!c[f][m.context]&&d[f]!==m.context){k=!1;break}if(m.id&&i.id!==m.id){k=!1;break}}if(0===g&&f>e&&h&&(k=!1),k){if(0===g)return!0;--f,--g}else{if(h)return!1;--f}if(e>f)return!1}},b.noteCollectedDistribution=function(a,c,d){b.model.setSimple(a,["collectedDistributions",c,d.id],!0)},b.isCollectedDistribution=function(a,c,d){return b.model.getSimple(a,["collectedDistributions",c,d.id])},b.clearCollectedDistributions=function(a,c){b.model.applyChangeRequest(a,{path:["collectedDistributions",c],type:"DELETE"})},b.collectDistributions=function(a,c,d,e,f,g,h){var i=g[g.length-1];!b.isCollectedDistribution(c,i,d)&&b.matchIoCSelector(d.selector,e,f,g,h)&&(a.push.apply(a,d.blocks),b.noteCollectedDistribution(c,i,d))},b.registerCollectedClearer=function(a,c,d){!a.collectedClearer&&c&&(a.collectedClearer=function(){b.clearCollectedDistributions(c,d)})},b.receiveDistributions=function(a,c,d,e){var f=b.getInstantiator(a||e),g=f.getThatStack(a||e),h=b.getMemberNames(f,g),i=[],j=b.transform(g,function(a){return f.idToShadow[a.id]}),k=j[j.length-(a?1:2)],l=b.getMembers(j,"contextHash");a?(h.push(d),l.push(b.gradeNamesToHash(c)),g.push(e)):b.registerCollectedClearer(j[j.length-1],k,h[h.length-1]);for(var m=0;m<g.length-1;++m)b.each(j[m].distributions,function(a){b.collectDistributions(i,k,a,g,l,h,m)});return i},b.applyDistributions=function(a,c,d){var e=b.transform(c,function(c){return b.generateExpandBlock(c,a,d.mergePolicy)}),f=d.mergeOptions;return f.mergeBlocks.push.apply(f.mergeBlocks,e),f.updateBlocks(),e},b.parseExpectedOptionsPath=function(a,c){var d=b.model.parseEL(a);return d.length>1&&"options"!==d[0]&&b.fail("Error in options distribution path ",a," - only "+c+' paths beginning with "options" are supported'),d.slice(1)},b.isIoCSSSelector=function(a){return-1!==a.indexOf(" ")},b.pushDistributions=function(a,c,d){var e=b.shadowForComponent(a),f=b.allocateGuid(),g=e.distributions=e.distributions||[];return g.push({id:f,selector:c,blocks:d}),f},b.clearDistributions=function(a,c){var d=b.shadowForComponent(a);b.remove_if(d.distributions,function(a){return a.id===c})},b.extractSelectorHead=function(a){var b=a[0].predList,c=b[0].context;return b.length=0,c},b.undistributableOptions=["gradeNames","distributeOptions","returnedPath","argumentMap","initFunction","mergePolicy","progressiveCheckerOptions"],b.distributeOptions=function(a,c){var d=b.makeArray(b.driveStrategy(a.options,"distributeOptions",c));b.each(d,function(c){var d,e,f=b.parseContextReference(c.target);if(b.isIoCSSSelector(f.context)){e=b.parseSelector(f.context,b.IoCSSMatcher);var g=b.extractSelectorHead(e);"that"!==g&&b.fail('Downwards options distribution not supported from component other than "that"'),d=a}else d=b.resolveContext(f.context,a),d||b.fail("Error in options distribution record ",c," - could not resolve context selector {"+f.context+"} to a root component");var h,i=b.model.parseEL(f.path);if(void 0!==c.record)h=[b.makeDistributionRecord(a,c.record,[],i,[],0)];else{var j=b.shadowForComponent(a),k=b.parseContextReference(c.source||"{that}.options");"that"!==k.context&&b.fail("Error in options distribution record ",c," only a context of {that} is supported");var l=b.parseExpectedOptionsPath(k.path,"source"),m=b.makeArray(c.exclusions).concat(0===l.length?b.undistributableOptions:[]),n=b.transform(m,function(a){return b.model.parseEL(a)});h=b.filterBlocks(a,j.mergeOptions.mergeBlocks,l,i,n,c.removeSource),j.mergeOptions.updateBlocks()}if(e)b.pushDistributions(d,e,h);else{var o=b.shadowForComponent(d);b.applyDistributions(a,h,o)}})},b.gradeNamesToHash=function(a){var c={};return b.each(a,function(a){c[a]=!0,c[b.computeNickName(a)]=!0}),c},b.cacheShadowGrades=function(a,c){var d=b.gradeNamesToHash(a.options.gradeNames);d[a.nickName]=!0,c.contextHash=d},b.deliverOptionsStrategy=function(a,c,d){var e=b.shadowForComponent(a,e);b.cacheShadowGrades(a,e),e.mergeOptions=d},b.resolveReturnedPath=function(a,c){var d=b.shadowForComponent(c);return d&&""!==d.path?null:a},b.defaults("fluid.gradeLinkageRecord",{gradeNames:["fluid.littleComponent"]}),b.defaults("fluid.applyGradeLinkage",{}),b.gradeLinkageIndexer=function(a){return a.contextGrades&&a.resultGrades?["*"]:void 0},b.getLinkedGrades=function(a){var c=[],d=b.indexDefaults("gradeLinkages",{gradeNames:"fluid.gradeLinkageRecord",indexFunc:b.gradeLinkageIndexer});return b.each(d["*"],function(d){var e=b.defaults(d),f=b.find(b.makeArray(e.contextGrades),function(c){return b.contains(a,c)?void 0:!0});f||c.push.apply(c,b.makeArray(e.resultGrades))}),c},b.expandDynamicGrades=function(a,c,d,e){var f=[];b.each(e,function(c){var d=b.expandOptions(c,a);"function"==typeof d&&(d=d()),d&&(f=f.concat(d))});var g=b.makeArray(d).concat(f);if(b.contains(g,"fluid.applyGradeLinkage")){var h=b.getLinkedGrades(g);b.remove_if(h,function(a){return b.contains(g,a)}),f=f.concat(h)}var i=b.receiveDistributions(null,null,null,a);if(i.length>0){var j=b.applyDistributions(a,i,c),k=b.transform(b.getMembers(j,["source","gradeNames"]),b.makeArray);f=f.concat.apply(f,k)}return f},b.collectDynamicGrades=function(a,c,d,e,f,g){var h=b.copy(b.getGradedDefaults(a.typeName,g));e.length=0,e.push.apply(e,h.gradeNames),b.cacheShadowGrades(a,c),c.mergeOptions.destroyValue("mergePolicy"),c.mergeOptions.destroyValue("components"),c.mergeOptions.destroyValue("invokers"),d.source=h,c.mergeOptions.updateBlocks();var i=b.remove_if(e,function(a){return"{"===a.charAt(0)&&!b.contains(f,a)},[]);return f.push.apply(f,i),i=b.expandDynamicGrades(a,c,e,i),g.push.apply(g,i),i},b.computeDynamicGrades=function(a,c,d){delete a.options.gradeNames;var e=b.driveStrategy(a.options,"gradeNames",d),f=b.findMergeBlocks(c.mergeOptions.mergeBlocks,"defaults")[0],g=b.remove_if(e,function(a){return"{"===a.charAt(0)||!b.hasGrade(f.target,a)},[]),h=b.expandDynamicGrades(a,c,e,g);if(0!==h.length){var i;do i=b.collectDynamicGrades(a,c,f,e,g,h);while(0!==i.length)}c.collectedClearer&&(c.collectedClearer(),delete c.collectedClearer)},b.computeDynamicComponentKey=function(a,b){return a+(0===b?"":"-"+b)},b.registerDynamicRecord=function(a,c,d,e,f){var g=b.computeDynamicComponentKey(c,d),h=b.copy(e);return delete h[f],b.set(a.options,["components",g],h),g},b.computeDynamicComponents=function(a,c){var d=b.shadowForComponent(a),e=d.subcomponentLocal={},f=b.driveStrategy(a.options,"dynamicComponents",c.strategy);b.each(f,function(c,f){if(c.sources||c.createOnEvent||b.fail("Cannot process dynamicComponents record ",c,' without a "sources" or "createOnEvent" entry'),c.sources){var g=b.expandOptions(c.sources,a);b.each(g,function(d,g){var h=b.registerDynamicRecord(a,f,g,c,"sources");e[h]={source:d,sourcePath:g}})}else if(c.createOnEvent){var h=b.event.expandOneEvent(a,c.createOnEvent);b.set(d,["dynamicComponentCount",f],0);var i=function(){var g=b.registerDynamicRecord(a,f,d.dynamicComponentCount[f]++,c,"createOnEvent");e[g]={arguments:b.makeArray(arguments)},b.initDependent(a,g)};h.addListener(i),b.recordListener(h,i,d)
}})},b.computeComponentAccessor=function(a){var c=b.shadowForComponent(a),d=a.options,e=c.mergeOptions.strategy,f=b.mountStrategy(["options"],d,e);c.invokerStrategy=b.recordStrategy(a,d,e,"invokers",b.invokerFromRecord),c.eventStrategyBlock=b.recordStrategy(a,d,e,"events",b.eventFromRecord,["events"]);var g=b.mountStrategy(["events"],a,c.eventStrategyBlock.strategy,["events"]);return c.memberStrategy=b.recordStrategy(a,d,e,"members",b.memberFromRecord),c.getConfig={strategies:[b.model.funcResolverStrategy,b.makeGingerStrategy(a),f,c.invokerStrategy.strategy,c.memberStrategy.strategy,g]},b.computeDynamicGrades(a,c,e,c.mergeOptions.mergeBlocks),b.distributeOptions(a,e),c.getConfig},b.shadowForComponent=function(a){var c=b.getInstantiator(a);return c&&a?c.idToShadow[a.id]:null},b.getForComponent=function(a,c){var d=b.shadowForComponent(a),e=d?d.getConfig:void 0;return b.get(a,c,e)},b.makeGingerStrategy=function(a){var c=b.getInstantiator(a);return function(a,d,e,f){var g=a[d];if(g===b.inEvaluationMarker&&e===f.length&&b.fail('Error in component configuration - a circular reference was found during evaluation of path segment "'+d+'": for more details, see the activity records following this message in the console, or issue fluid.setLogging(fluid.logLevel.TRACE) when running your application'),e>1)return g;if(void 0===g&&a.hasOwnProperty(d))return b.NO_VALUE;if(void 0===g){var h=c.idToShadow[a.id].path,i=b.composePath(h,d);g=c.pathToComponent[i]}return void 0===g&&b.getForComponent(a,["options","components",d])&&(b.initDependent(a,d),g=a[d]),g}},b.filterBuiltinGrades=function(a){return b.remove_if(b.makeArray(a),function(a){return/^(autoInit|fluid.littleComponent|fluid.modelComponent|fluid.eventedComponent|fluid.viewComponent|fluid.typeFount)$/.test(a)})},b.dumpGradeNames=function(a){return a.options&&a.options.gradeNames?" gradeNames: "+JSON.stringify(b.filterBuiltinGrades(a.options.gradeNames)):""},b.dumpThat=function(a){return'{ typeName: "'+a.typeName+'"'+b.dumpGradeNames(a)+" id: "+a.id+"}"},b.dumpThatStack=function(a,c){var d=b.transform(a,function(a){var d=c.idToPath(a.id);return b.dumpThat(a)+(d?" - path: "+d:"")});return d.join("\n")},b.resolveContext=function(a,c){var d=b.getInstantiator(c);if("instantiator"===a)return d;if("that"===a)return c;var f,g=d.getFullStack(c);return e(d,g,function(c,d){var e=b.shadowForComponent(c);return a===d||e&&e.contextHash&&e.contextHash[a]||a===c.typeName||a===c.nickName?(f=c,!0):b.getForComponent(c,["options","components",a,"type"])&&!c[a]?(f=b.getForComponent(c,a),!0):void 0}),f};var f=/^(arguments|options|container|source|sourcePath|change)$/;b.makeStackFetcher=function(a,c){var d=function(d){a&&a.destroy===b.destroyedMarker&&b.fail("Cannot resolve reference ",d," from component "+b.dumpThat(a)+" which has been destroyed");var e=d.context;if(c&&f.test(e)){var g=b.get(c[e],d.path);return"arguments"===e||"source"===e||"sourcePath"===e||"change"===e?g:{marker:"options"===e?b.EXPAND:b.EXPAND_NOW,value:g}}var h=b.resolveContext(e,a);if(!h&&""!==d.path){var i=b.renderContextReference(d);b.fail("Failed to resolve reference "+i+" - could not match context with name "+e+" from component "+b.dumpThat(a),a)}return b.getForComponent(h,d.path)};return d},b.makeStackResolverOptions=function(c,d){return a.extend(b.copy(b.rawDefaults("fluid.makeExpandOptions")),{fetcher:b.makeStackFetcher(c,d),contextThat:c})},b.clearListeners=function(a){b.each(a.listeners,function(a){a.event.removeListener(a.listener)}),delete a.listeners},b.recordListener=function(a,b,c){if(a.ownerId!==c.that.id){var d=c.listeners;d||(d=c.listeners=[]),d.push({event:a,listener:b})}};var g={};b.instantiator=function(a){function c(a,c,e){if(e){g[a.id]=d;var f=d.idToShadow[a.id]={};f.that=a,f.path=c}d.pathToComponent[c]&&b.fail("Error during instantiation - path "+c+" which has just created component "+b.dumpThat(a)+" has already been used for component "+b.dumpThat(d.pathToComponent[c])+" - this is a circular instantiation or other oversight. Please clear the component using instantiator.clearComponent() before reusing the path."),d.pathToComponent[c]=a}var d={id:b.allocateGuid(),free:a,nickName:"instantiator",pathToComponent:{},idToShadow:{},modelTransactions:{init:{}},composePath:b.composePath};return d.idToPath=function(a){var b=d.idToShadow[a];return b?b.path:""},d.getThatStack=function(a){var c=d.idToShadow[a.id];if(c){var e=c.path,f=b.model.parseEL(e),g=b.transform(f,function(a,c){var e=b.model.composeSegments.apply(null,f.slice(0,c+1));return d.pathToComponent[e]}),h=d.pathToComponent[""];return h&&g.unshift(h),g}return[a]},d.getEnvironmentalStack=function(){var c=[b.staticEnvironment];return a||c.push(b.globalThreadLocal()),c},d.getFullStack=function(a){var b=a?d.getThatStack(a):[];return d.getEnvironmentalStack().concat(b)},d.recordRoot=function(a){a&&a.id&&!d.pathToComponent[""]&&c(a,"",!0)},d.recordKnownComponent=function(a,b,e,f){var g=d.idToShadow[a.id].path,h=d.composePath(g,e);c(b,h,f)},d.clearComponent=function(a,c,e,f,h,i){var j=d.idToShadow[a.id].path;f=f||{flat:!0,instantiator:d},e=e||a[c],i=i||j,void 0===i&&b.fail("Cannot clear component "+c+" from component ",a," which was not created by this instantiator"),b.fireEvent(e,"events.onClear",[e,c,a]);var k=d.composePath(i,c),l=d.idToShadow[e.id];l&&l.path===k&&(b.doDestroy(e,c,a),b.clearListeners(l),b.visitComponentChildren(e,function(a,b,c,g){d.clearComponent(e,b,null,f,!0,g)},f,k),b.fireEvent(e,"events.afterDestroy",[e,c,a]),delete d.idToShadow[e.id],delete g[e.id]),delete d.pathToComponent[k],h||delete a[c]},d},b.freeInstantiator=b.instantiator(!0),b.getInstantiator=function(a){return a&&g[a.id]||b.freeInstantiator},b.expandOptions=function(a,c,d,e,f){if(!a)return a;b.pushActivity("expandOptions","expanding options %args for component %that ",{that:c,args:a});var g=b.makeStackResolverOptions(c,e);g.mergePolicy=d,g.freeRoot=f&&f.freeRoot;var h=f&&f.defer?b.makeExpandOptions(a,g):b.expand(a,g);return b.popActivity(),h},b.localRecordExpected=["type","options","args","mergeOptions","createOnEvent","priority","recordType"],b.checkComponentRecord=function(a,c){var d=b.arrayToHash(b.localRecordExpected);b.each(a&&a.argumentMap,function(a,b){d[b]=!0}),b.each(c,function(a,c){d[c]||b.fail('Probable error in subcomponent record - key "'+c+'" found, where the only legal options are '+b.keys(d).join(", "))})},b.pushDemands=function(a,c){function d(b){b.recordType="demands",b.priority=f++,a.push(b)}function e(a){d({options:a})}c=b.makeArray(c);for(var f=b.mergeRecordTypes.demands,g=0;g<c.length;++g){var h=c[g];if(h.options)d(h);else if(h.mergeOptions){var i=b.makeArray(h.mergeOptions);b.each(i,e)}else b.fail("Uninterpretable demands record without options or mergeOptions ",h)}},b.mergeRecordsToList=function(a){var c=[];return b.each(a,function(a,d){if(a.recordType=d,"distributions"===d)c.push.apply(c,a);else if("demands"!==d){if(!a.options)return;a.priority=b.mergeRecordTypes[d],void 0===a.priority&&b.fail("Merge record with unrecognised type "+d+": ",a),c.push(a)}else b.pushDemands(c,a)}),c};var h=function(a){return b.each(["gradeNames","mergePolicy","argumentMap","components","dynamicComponents","members","invokers","events","listeners","modelListeners","distributeOptions","transformOptions"],function(c){b.set(a,[c,"*","noexpand"],!0)}),a};b.generateExpandBlock=function(a,c,d,e){var f=b.expandOptions(a.options,a.contextThat||c,d,e,{defer:!0});return f.priority=a.priority,f.recordType=a.recordType,f};var i=function(c,d,e,f){var g=b.copy(d);h(c);var i=b.shadowForComponent(f);i.mergePolicy=c;var j={defaults:{options:g}};e&&(e.marker===b.EXPAND?(a.extend(j,e.mergeRecords),j.subcomponentRecord&&b.checkComponentRecord(d,j.subcomponentRecord)):j.user={options:b.expandCompact(e,!0)});var k=b.mergeRecordsToList(j),l=b.transform(k,function(a){return b.generateExpandBlock(a,f,c,e&&e.localRecord)});return l};b.makeIoCRootDestroy=function(a,c){return function(){a.clearComponent(c,"",c,null,!0),b.doDestroy(c),b.fireEvent(c,"events.afterDestroy",[c,"",null])}},b.expandComponentOptions=function(a,c,d,e){var f,g=d&&d.marker===b.EXPAND&&void 0!==d.memberName?d.instantiator:null;g||(g=b.instantiator(),f=!0,b.log("Created new instantiator with id "+g.id+" in order to operate on component "+(e?e.typeName:"[none]")),e.destroy=b.makeIoCRootDestroy(g,e)),b.pushActivity("expandComponentOptions","expanding component options %options with record %record for component %that",{options:d&&d.mergeRecords,record:d,that:e}),f?g.recordRoot(e):g.recordKnownComponent(d.parentThat,e,d.memberName,!0);var h=i(a,c,d,e);return b.popActivity(),h},b.argMapToDemands=function(a){var c=[];return b.each(a,function(a,b){c[a]="{"+b+"}"}),c},b.makePassArgsSpec=function(a){return b.transform(a,function(a,b){return"{arguments}."+b})},b.pushDemandSpec=function(a,b,c){b&&"{options}"!==b&&a.push({options:b}),c&&a.push({mergeOptions:c})},b.embodyDemands=function(c,d,e,f){f=f||{},d.mergeOptions&&d.options&&b.fail("demandspec ",d," is invalid - cannot specify literal options together with mergeOptions"),d.transformOptions&&(d.options=a.extend(!0,{},d.options,{transformOptions:d.transformOptions}));var g=b.makeArray(d.args),h=b.defaults(d.funcName),i={},j=h&&c?b.receiveDistributions(c,h.gradeNames,f.memberName,i):[],k=h?h.argumentMap:null,l=!1;if(h&&(f.passArgs=!1),!k&&(h||f&&f.componentRecord))if(l=!0,g.length<2)k=b.rawDefaults("fluid.littleComponent").argumentMap;else{var m=a.inArray("{options}",g);-1===m&&(m=g.length-1),k={options:m}}f=f||{},0===g.length&&(k?g=b.argMapToDemands(k):f.passArgs&&(g=b.makePassArgsSpec(e)));var n=b.shadowForComponent(c),o=n&&f.memberName?n.subcomponentLocal[f.memberName]:null,p=a.extend({arguments:e},b.censorKeys(f.componentRecord,["type"]),o);b.each(k,function(a,b){if(e.length>0&&(p[b]=p.arguments[a]),void 0!==d[b]&&void 0===p[b]&&(p[b]=d[b]),"options"!==b)for(var c=0;c<j.length;++c)void 0!==j[c][b]&&(p[b]=j[c][b])});var q;for(q=0;q<j.length;++q)void 0!==j[q].type&&(d.funcName=j[q].type);var r={distributions:j};void 0!==f.componentRecord&&(r.subcomponentRecord=a.extend({},f.componentRecord));var s=b.makeStackResolverOptions(c,p),t=function(a){b.pushDemandSpec(r.demands,a.options,a.mergeOptions)},u=[];if(g)for(q=0;q<g.length;++q){var v=g[q];if(b.isMarker(v)&&v.value===b.COMPONENT_OPTIONS.value&&(v="{options}",l&&(k={options:q})),"string"==typeof v&&"@"===v.charAt(0)){var w=v.substring(1);v="{arguments}."+w}g[q]=v,k&&k.options===q?(f.passArgs&&b.fail("Error invoking function "+d.funcName+": found component creator rather than free function"),"object"!=typeof v||v.targetTypeName||(v.targetTypeName=d.funcName),r.demands=[],b.each(d.backSpecs.reverse(),t),b.pushDemandSpec(r.demands,d.options||v,d.mergeOptions),e.length>0&&(r.user={options:p.options}),u[q]={marker:b.EXPAND,localRecord:o,mergeRecords:r,instantiator:b.getInstantiator(c),parentThat:c,memberName:f.memberName}):u[q]=b.expand(v,s),u[q]&&b.isMarker(u[q].marker,b.EXPAND_NOW)&&(u[q]=b.expand(u[q].value,s))}else u=e?e:[];var x={args:u,preExpand:g,funcName:d.funcName};return x},b.fabricateDestroyMethod=function(a,b,c,d){return function(){c.clearComponent(a,b,d)}},b.initDependent=function(a,c,d){if(!a[c]){d=d||[];var e=a.options.components[c];b.pushActivity("initDependent",'instantiating dependent component with name "%name" with record %record as child of %parent',{name:c,record:e,parent:a});var f,h=g[a.id];if("string"==typeof e)f=b.expandOptions(e,a),h.recordKnownComponent(a,f,c,!1);else if(e.type){var i=b.expandOptions(e.type,a);i||b.fail("Error in subcomponent record: ",e.type," could not be resolved to a type for component ",c," of parent ",a);var j=b.resolveDemands(a,[i,c],d,{componentRecord:e,memberName:c});f=b.initSubcomponentImpl(a,{type:j.funcName},j.args);var k=h.composePath(h.idToPath(a.id),c),l=h.pathToComponent[k];l&&l!==f&&h.clearComponent(a,c,l),f&&f.typeName&&f.id&&f!==l&&h.recordKnownComponent(a,f,c,!0),f.destroy=b.fabricateDestroyMethod(a,c,h,f)}else b.fail("Unrecognised material in place of subcomponent "+c+' - no "type" field found');return a[c]=f,b.fireEvent(f,"events.onAttach",[f,c,a]),b.popActivity(),f}},b.bindDeferredComponent=function(a,c,d){var e=b.makeArray(d.createOnEvent);b.each(e,function(e){var f="{"===e.charAt(0)?b.expandOptions(e,a):a.events[e];f.addListener(function(){if(b.pushActivity("initDeferred","instantiating deferred component %componentName of parent %that due to event %eventName",{componentName:c,that:a,eventName:e}),a[c]){var d=g[a.id];d.clearComponent(a,c)}b.initDependent(a,c),b.popActivity()},null,null,d.priority)})},b.priorityForComponent=function(a){return a.priority?a.priority:"fluid.typeFount"===a.type||b.hasGrade(b.defaults(a.type),"fluid.typeFount")?"first":void 0},b.initDependents=function(a){b.pushActivity("initDependents","instantiating dependent components for component %that",{that:a});var c=b.shadowForComponent(a);c.memberStrategy.initter();var d=a.options,e=d.components||{},f={};b.each(e,function(c,d){if(c.createOnEvent)b.bindDeferredComponent(a,d,c);else{var e=b.priorityForComponent(c);f[d]={key:d,priority:b.event.mapPriority(e,0)}}});var g=b.event.sortListeners(f);b.each(g,function(c){b.initDependent(a,c.key)}),c.invokerStrategy.initter(),b.popActivity()};var j={},k=!1;b.setDemandLogging=function(a){k=a},b.isDemandLogging=function(){return k&&b.isLogging()},b.demands=function(a,d,e){var f=b.makeArray(d).sort();if(!e)return c(a,f);if(e.length&&(e={args:e}),b.getCallerInfo&&b.isDemandLogging()){var g=b.getCallerInfo(5);g&&(e.registeredFrom=g)}e.demandId=b.allocateGuid();var h=j[a];h||(h=[],j[a]=h),h.push({contexts:f,spec:e})},b.compareDemands=function(a,b){return b.intersect-a.intersect},b.locateAllDemands=function(a,c){var d=b.isDemandLogging(c);d&&b.log("Resolving demands for function names ",c," in context of "+(a?"component "+a.typeName:"no component"));var f={},g=[],h=b.getInstantiator(a),i=h.getFullStack(a);e(h,i,function(a,c,d,e,h){f[a.typeName]=h;var i=b.makeArray(b.get(a,["options","gradeNames"]));b.each(i,function(a){f[a]=h}),g.push(a)}),d&&b.log("Components in scope for resolution:\n"+b.dumpThatStack(g,h));for(var k=[],l=0;l<c.length;++l)for(var m=j[c[l]]||[],n=0;n<m.length;++n){for(var o=m[n],p=o.spec.horizon?f[o.spec.horizon]:-1,q={spec:o,intersect:0,uncess:0},r=0;r<o.contexts.length;++r){var s=f[o.contexts[r]];q[void 0!==s&&s>=p?"intersect":"uncess"]+=2}0===o.contexts.length&&q.intersect++,0===q.uncess&&k.push(q)}return k.sort(b.compareDemands),k},b.locateDemands=function(a,c){var d=b.locateAllDemands(a,c),e=b.getMembers(d,["spec","spec"]);return b.isDemandLogging(c)&&(e.length?b.log("Located "+d.length+" potential match"+(1===d.length?"":"es")+", selected best match with "+d[0].intersect+" matched context names: ",e):b.log("No matches found for demands, using direct implementation")),e},b.determineDemands=function(c,d){d=b.makeArray(d);var e=d[0],f=b.locateDemands(c,d);return f.length&&f[0].funcName&&(e=f[0].funcName),a.extend(!0,{funcName:e,args:f[0]?b.makeArray(f[0].args):[]},{backSpecs:f.slice(1)},b.censorKeys(f[0],["funcName","args"]))},b.resolveDemands=function(a,c,d,e){var f=b.determineDemands(a,c);return b.embodyDemands(a,f,d,e)},b.thisistToApplicable=function(a,c,d){return{apply:function(e,f){var g=b.expandOptions(c,d);"string"==typeof g&&(g=b.getGlobalValue(g)),g||b.fail("Could not resolve reference "+c+" to a value");var h=g[a.method];return"function"!=typeof h&&b.fail("Object ",g," at reference "+c+" has no member named "+a.method+" which is a function "),b.log("Applying arguments ",f," to method "+a.method+" of instance ",g),h.apply(g,f)}}},b.changeToApplicable=function(a,c){return{apply:function(d,e){var f=b.parseValidModelReference(c,"changePath listener record",a.changePath),g=b.expandOptions(a.value,c,{},{arguments:e});b.fireSourcedChange(f.applier,f.path,g,a.source)}}},b.recordToApplicable=function(a,c){if(a.changePath)return b.changeToApplicable(a,c);var d=a["this"];return a.method^d&&b.fail("Record ",c,' must contain both entries "method" and "this" if it contains either'),a.method?b.thisistToApplicable(a,d,c):null},b.invoke=function(a,c,d,e){b.pushActivity("invokeFunc",'invoking function with name "%functionName" from component %that',{functionName:a,that:d});var f=b.resolveDemands(d,a,b.makeArray(c),{passArgs:!0}),g=b.invokeGlobalFunction(f.funcName,f.args,e);return b.popActivity(),g},b.makeFreeInvoker=function(a,c){var d=b.determineDemands(null,a);return function(){var a=b.embodyDemands(null,d,b.makeArray(arguments),{passArgs:!0});return b.invokeGlobalFunction(a.funcName,a.args,c)}};var l="{arguments}.";b.parseInteger=function(a){return isFinite(a)&&a%1===0?Number(a):0/0},b.makeFastInvoker=function(a,c){var d;if(a.preExpand){d={};for(var e=0;e<a.preExpand.length;++e){var f=a.preExpand[e];if("string"==typeof f){if(-1!==f.indexOf("}.model"))return{noFast:!0};if("{arguments}"===f)d[e]="*";else if(0===f.indexOf(l)){var g=b.parseInteger(f.substring(l.length));if(isNaN(g))return{noFast:!0};d[e]=g}}}}var h=a.args,i=d?function(a){for(var b in d)h[b]="*"===d[b]?a:a[d[b]];return c.apply(null,h)}:function(a){return c.apply(null,a)};return{invoke:i}},b.makeInvoker=function(a,c,d,e){var f;"string"==typeof c&&("{"===c.charAt(0)?c={func:c}:f=c);var g=f?b.determineDemands(a,f):c,h={noFast:c.dynamic};return function(){b.defeatLogging===!1&&b.pushActivity("invokeInvoker","invoking invoker with name %name and record %record from component %that",{name:d,record:c,that:a});var f;if(h.invoke)f=h.invoke(arguments);else{var i=b.recordToApplicable(c,a),j=b.makeArray(arguments),k=b.embodyDemands(a,g,j,{passArgs:!0});i=i||(k.funcName?b.getGlobalValue(k.funcName,e):b.expandOptions(g.func,a)),i&&i.apply||b.fail("Error in invoker record: could not resolve members func, funcName or method to a function implementation - got "+i+" from ",g),h.noFast!==!0&&(h=b.makeFastInvoker(k,i)),f=i.apply(null,k.args)}return b.defeatLogging===!1&&b.popActivity(),f}},b.event.makeTrackedListenerAdder=function(a){var c=b.shadowForComponent(a);return function(a){return{addListener:function(d){b.recordListener(a,d,c),a.addListener.apply(null,arguments)}}}},b.event.listenerEngine=function(a,c,d){function e(){var d=b.find(a,function(a,b){return void 0===f[b]?!0:void 0});if(!d){var e=f;f={},c(e)}}var f={};b.each(a,function(a,c){d(a).addListener(function(){f[c]=b.makeArray(arguments),e()})})},b.event.dispatchListener=function(a,c,d,e,f){var g=function(){b.pushActivity("dispatchListener","firing to listener to event named %eventName of component %that",{eventName:d,that:a});var g=f?arguments[0]:b.makeArray(arguments),h=b.determineDemands(a,d);0===h.args.length&&e.args&&(h.args=e.args);var i=b.embodyDemands(a,h,g,{passArgs:!0}),j=b.event.invokeListener(c,i.args);return b.popActivity(),j};return b.event.impersonateListener(c,g),g},b.event.resolveSoftNamespace=function(a){if("string"!=typeof a)return null;var b=Math.max(a.lastIndexOf("."),a.lastIndexOf("}"));return a.substring(b+1)},b.event.resolveListenerRecord=function(a,c,d,e,f){var g=function(a,c){b.fail("Error in listener record - could not resolve reference ",a,' to a listener or firer. Did you miss out "events." when referring to an event firer?'+c)};b.pushActivity("resolveListenerRecord","resolving listener record for event named %eventName for component %that",{eventName:d,that:c});var h=b.makeArray(a),i=b.transform(h,function(a){var h=b.isPrimitive(a)||a.expander?{listener:a}:b.copy(a),i=b.recordToApplicable(a,c);h.listener=i?i:h.listener||h.func||h.funcName,h.listener||g(a,' Listener record must contain a member named "listener", "func", "funcName" or "method"');var j=a.method?b.event.resolveSoftNamespace(a["this"])+"."+a.method:b.event.resolveSoftNamespace(h.listener);h.namespace||e||!j||(h.softNamespace=!0,h.namespace=(a.componentSource?a.componentSource:c.typeName)+"."+j);var k=h.listener=b.expandOptions(h.listener,c);k||g(a,"");var l=!1;return"fluid.event.firer"===k.typeName&&(k=k.fire,l=!0),h.listener=f&&(h.args||l)?b.event.dispatchListener(c,k,d,h):k,h}),j={records:i,adderWrapper:f?b.event.makeTrackedListenerAdder(c):null};return b.popActivity(),j},b.event.expandOneEvent=function(a,c){var d;return d="string"==typeof c&&"{"!==c.charAt(0)?b.getForComponent(a,["events",c]):b.expandOptions(c,a),d&&"fluid.event.firer"===d.typeName||b.fail("Error in event specification - could not resolve base event reference ",c," to an event firer: got ",d),d},b.event.expandEvents=function(a,c){return"string"==typeof c?b.event.expandOneEvent(a,c):b.transform(c,function(c){return b.event.expandOneEvent(a,c)})},b.event.resolveEvent=function(a,c,d){b.pushActivity("resolveEvent","resolving event with name %eventName attached to component %that",{eventName:c,that:a});var e=b.event.makeTrackedListenerAdder(a);"string"==typeof d&&(d={event:d});var f=d.event||d.events;f||b.fail("Event specification for event with name "+c+" does not include a base event specification: ",d);var g,h=b.event.expandEvents(a,f),i="fluid.event.firer"!==h.typeName,j=d.args||i;if(j){g=b.makeEventFirer(null,null," [composite] "+b.event.nameEvent(a,c));var k=b.event.dispatchListener(a,g.fire,c,d,i);i?b.event.listenerEngine(h,k,e):e(h).addListener(k)}else g={typeName:"fluid.event.firer"},g.fire=function(){var a=b.makeArray(arguments);b.pushActivity("fireSynthetic","firing synthetic event %eventName ",{eventName:c});var d=h.fire.apply(null,a);return b.popActivity(),d},g.addListener=function(f,g,i,j,k){var l=b.event.dispatchListener(a,f,c,d);e(h).addListener(l,g,i,j,k)},g.removeListener=function(a){h.removeListener(a)};return b.popActivity(),g},b.withEnvironment=function(c,d,e){return e=e||b.globalThreadLocal(),b.tryCatch(function(){for(var b in c)e[b]=c[b];return a.extend(e,c),d()},null,function(){for(var a in c)delete e[a]})},b.fetchContextReference=function(a,c,d,e,f){e&&(a=e(a,d));var g=a.context?d[a.context]:c;if(!g){var h=f&&f(a);return h||g}return a.noDereference?a.path:b.get(g,a.path)},b.makeEnvironmentFetcher=function(a,c,d,e){return d=d||b.globalThreadLocal,function(f){var g=d();return b.fetchContextReference(f,a,g,c,e)}},b.coerceToPrimitive=function(a){return"false"===a?!1:"true"===a?!0:isFinite(a)?Number(a):a},b.compactStringToRec=function(c,d){var e=c.indexOf("("),f=c.indexOf(")");if((-1===e^-1===f||e>f)&&b.fail("Badly-formed compact "+d+" record without matching parentheses: ",c),-1!==e&&-1!==f){var g=c.substring(0,e),h=c.substring(e+1,f),i=b.transform(h.split(","),a.trim,b.coerceToPrimitive),j={args:i};return"invoker"===d&&"!"===g.charAt(e-1)&&(g=c.substring(0,e-1),j.dynamic=!0),j["{"===g.charAt(0)?"func":"funcName"]=g,j}return"expander"===d&&b.fail("Badly-formed compact expander record without parentheses: ",c),c},b.expandPrefix="@expand:",b.expandCompactString=function(a,c){var d=a;if(0===a.indexOf(b.expandPrefix)){var e=a.substring(b.expandPrefix.length);d={expander:b.compactStringToRec(e,"expander")}}else c&&(d=b.compactStringToRec(a,c));return d};var m={listeners:"listener",modelListeners:"modelListener"},n=a.extend({invokers:"invoker"},m);b.expandCompactRec=function(a,c,d,e){var f=a.length>0?a[a.length-1]:"",g=n[f];!g&&a.length>1&&(g=m[a[a.length-2]]),b.each(d,function(d,f){return!b.isPlainObject(d)||b.isDOMish(d)||e&&"model"===f&&0===a.length?("string"==typeof d&&(d=b.expandCompactString(d,g)),void(c[f]=d)):(c[f]=b.freshContainer(d),a.push(f),b.expandCompactRec(a,c[f],d),void a.pop())})},b.expandCompact=function(a,c){var d={};return b.expandCompactRec([],d,a,c),d},b.extractEL=function(a,b){if("ALL"===b.ELstyle)return a;if(1===b.ELstyle.length){if(a.charAt(0)===b.ELstyle)return a.substring(1)}else if("${}"===b.ELstyle){var c=a.indexOf("${"),d=a.lastIndexOf("}");if(0===c&&-1!==d)return a.substring(2,d)}},b.extractELWithContext=function(a,c){var d=b.extractEL(a,c);return d&&"{"===d.charAt(0)&&d.indexOf("}")>0?b.parseContextReference(d):d?{path:d}:d},b.parseContextReference=function(a,c,d){c=c||0;var e=a.indexOf("}",c+1);-1===e&&b.fail('Cannot parse context reference "'+a+'": Malformed context reference without }');var f=a.substring(c+1,e),g=d?a.indexOf(d,e+1):a.length,h=a.substring(e+1,g);return"."===h.charAt(0)&&(h=h.substring(1)),{context:f,path:h,endpos:g}},b.renderContextReference=function(a){return"{"+a.context+"}."+a.path},b.resolveContextValue=function(a,c){function d(d){b.pushActivity("resolveContextValue","resolving context value %string",{string:a});var e=c.fetcher(d);return b.pushActivity("resolvedContextValue","resolved value %string to value %value",{string:a,value:e}),b.popActivity(2),e}var e;if(c.bareContextRefs&&"{"===a.charAt(0)&&a.indexOf("}")>0)return e=b.parseContextReference(a),d(e);if(c.ELstyle&&"${}"!==c.ELstyle&&(e=b.extractELWithContext(a,c)))return d(e);for(;"string"==typeof a;){var f=a.indexOf("${"),g=a.indexOf("}",f+2);if(-1===f||-1===g)break;"{"===a.charAt(f+2)?(e=b.parseContextReference(a,f+2,"}"),g=e.endpos):e={path:a.substring(f+2,g)};var h=d(e),i=0===f&&g===a.length-1;if(void 0===h||null===h)return h;a=i?h:a.substring(0,f)+h+a.substring(g+1)}return a},b.expandExpander=function(a,c,d){var e=b.getGlobalValue(c.expander.type||"fluid.deferredInvokeCall");return e?e.call(null,a,c,d):void 0},b.fetchExpandChildren=function(c,d,e,f,g,h,i){if(f.expander){var j=b.expandExpander(c,f,i);if(i.freeRoot||b.isPrimitive(j)||b.isDOMish(j)||!b.isPlainObject(j)||b.isArrayable(j)^b.isArrayable(c))return j;a.extend(!0,c,j)}return b.each(f,function(a,b){void 0===a?c[b]=void 0:"expander"!==b&&(e[d]=b,i.strategy(c,b,d+1,e,f,g,h))}),c},b.isUnexpandable=function(a){return b.isPrimitive(a)||b.isComponent(a)||void 0!==a.nodeType||a.jquery||!b.isPlainObject(a)},b.expandSource=function(a,c,d,e,f,g,h,i,j){var k,l,m,n=b.derefMergePolicy(h);return"string"!=typeof g||n.noexpand?n.noexpand||b.isUnexpandable(g)?k=g:g.expander?k=b.expandExpander(f,g,a):(n.preserve?(k=g,m=!0):k=b.freshContainer(g),l=!0):a.defaultEL&&"{"!==g.charAt(0)?k=g:(b.pushActivity("expandContextValue","expanding context value %source held at path %path",{source:g,path:b.path.apply(null,e.slice(0,d))}),k=b.resolveContextValue(g,a),b.popActivity(1)),m||k===b.NO_VALUE||f(k),l&&j(k,g,d,e,h,i||m),m&&k!==b.NO_VALUE&&f(k),k},b.makeExpandStrategy=function(a){var c=function(c,d,e,f,g,h){return b.fetchExpandChildren(c,e||0,f||[],d,g,h,a)},e=function(e,f,g,h,i,j,k){function l(a){e[f]=a}if(g>b.strategyRecursionBailout&&b.fail("Overflow/circularity in options expansion, current path is ",h," at depth ",g,' - please ensure options are not circularly connected, or protect from expansion using the "noexpand" policy or expander'),e){if(!k&&e.hasOwnProperty(f))return e[f];void 0===i&&(i=d(a.source,h,g-1,a.sourceStrategy),j=d(a.mergePolicy,h,g-1,b.concreteTrundler));var m=a.sourceStrategy(i,f,g,h),n=b.concreteTrundler(j,f);return b.expandSource(a,e,g,h,l,m,n,k,c)}};return a.recurse=c,a.strategy=e,e},b.defaults("fluid.makeExpandOptions",{ELstyle:"${}",bareContextRefs:!0,target:b.inCreationMarker}),b.makeExpandOptions=function(c,d){return d=a.extend({},b.rawDefaults("fluid.makeExpandOptions"),d),d.defaultEL="${}"===d.ELStyle&&d.bareContextRefs,d.expandSource=function(a){return b.expandSource(d,null,0,[],b.identity,a,d.mergePolicy,!1)},b.isUnexpandable(c)?(d.strategy=b.concreteTrundler,d.initter=b.identity,d.target="string"==typeof c?d.expandSource(c):c):(d.source=c,d.target=b.freshContainer(c),d.sourceStrategy=d.sourceStrategy||b.concreteTrundler,b.makeExpandStrategy(d),d.initter=function(){d.target=b.fetchExpandChildren(d.target,0,[],d.source,d.mergePolicy,!1,d)}),d},b.expand=function(a,c){var d=b.makeExpandOptions(a,c);return d.initter(),d.target},b.registerNamespace("fluid.expander"),b.expander.deferredCall=function(a,c,d){var e=c.expander,f=!e.args||b.isArrayable(e.args)?e.args:b.makeArray(e.args);return f=d.recurse([],f),b.invokeGlobalFunction(e.func,f)},b.deferredCall=b.expander.deferredCall,b.deferredInvokeCall=function(a,c,d){var e=c.expander,f=b.makeArray(e.args);f=d.recurse([],f);var g=e.func||e.funcName,h=d.expandSource(g)||b.recordToApplicable(e,d.contextThat);return h||b.fail("Error in expander record - "+g+" could not be resolved to a function for component ",d.contextThat),h.apply?h.apply(null,f):b.invoke(h,f,d.contextThat)},b.expander.noexpand=function(a,b){return b.expander.value?b.expander.value:b.expander.tree},b.noexpand=b.expander.noexpand}(jQuery,fluid_1_5);var fluid_1_5=fluid_1_5||{};!function(a,b){"use strict";function c(a){return a.lastIndexOf(".")}function d(a,c){return function(d){var e=c().sources,f=arguments,g=d.source||"";b.tryCatch(function(){void 0===e[g]&&(e[g]=0),++e[g],a.apply(null,f)},null,function(){--e[g]})}}b.model.makeEnvironmentStrategy=function(a){return function(b,c,d){return 0===d&&a[c]?a[c]:void 0}},b.model.defaultCreatorStrategy=function(a,b){return void 0===a[b]?(a[b]={},a[b]):void 0},b.model.defaultFetchStrategy=function(a,b){return a[b]},b.model.funcResolverStrategy=function(a,b){return a.resolvePathSegment?a.resolvePathSegment(b):void 0},b.model.traverseWithStrategy=function(a,c,d,e,f){for(var g=e.strategies,h=c.length-f,i=d;h>i;++i){if(!a)return a;for(var j,k=0;k<g.length&&(j=g[k](a,c[i],i+1,c),void 0===j);++k);j===b.NO_VALUE&&(j=void 0),a=j}return a},b.model.getValueAndSegments=function(a,c,d,e){return b.model.accessWithStrategy(a,c,b.NO_VALUE,d,e,!0)},b.model.makeTrundler=function(a){return function(c,d){return b.model.getValueAndSegments(c.root,d,a,c.segs)}},b.model.getWithStrategy=function(a,c,d,e){return b.model.accessWithStrategy(a,c,b.NO_VALUE,d,e)},b.model.setWithStrategy=function(a,c,d,e,f){b.model.accessWithStrategy(a,c,d,e,f)},b.model.accessWithStrategy=function(a,c,d,e,f,g){if(b.isPrimitive(c)||b.isArrayable(c))return b.model.accessImpl(a,c,d,e,f,g,b.model.traverseWithStrategy);var h=c.type||"default",i=e.resolvers[h];i||b.fail("Unable to find resolver of type "+h);var j=b.model.makeTrundler(e),k={root:a,segs:f};return k=i(k,c,j),c.path&&k&&(k=j(k,c.path)),g?k:k?k.root:void 0},b.registerNamespace("fluid.pathUtil");var e=function(a,b,c){var d=null;a&&(d="");for(var e=!1,f=b.length;f>c;++c){var g=b.charAt(c);if(e)e=!1,null!==d&&(d+=g);else{if("."===g)break;"\\"===g?e=!0:null!==d&&(d+=g)}}return null!==d&&(a[0]=d),c},f=[];b.pathUtil.parseEL=function(a){for(var b=[],c=0,d=a.length;d>c;){var g=e(f,a,c);b.push(f[0]),c=g+1}return b},b.pathUtil.composeSegment=function(a,b){b=b.toString();for(var c=0;c<b.length;++c){var d=b.charAt(c);("."===d||"\\"===d||"}"===d)&&(a+="\\"),a+=d}return a},b.pathUtil.escapeSegment=function(a){return b.pathUtil.composeSegment("",a)},b.pathUtil.composePath=function(a,c){return 0!==a.length&&(a+="."),b.pathUtil.composeSegment(a,c)},b.pathUtil.composeSegments=function(){for(var a="",c=0;c<arguments.length;++c)a=b.pathUtil.composePath(a,arguments[c]);return a},b.model.unescapedParser={parse:b.model.parseEL,compose:b.model.composeSegments},b.model.defaultGetConfig={parser:b.model.unescapedParser,strategies:[b.model.funcResolverStrategy,b.model.defaultFetchStrategy]},b.model.defaultSetConfig={parser:b.model.unescapedParser,strategies:[b.model.funcResolverStrategy,b.model.defaultFetchStrategy,b.model.defaultCreatorStrategy]},b.model.escapedParser={parse:b.pathUtil.parseEL,compose:b.pathUtil.composeSegments},b.model.escapedGetConfig={parser:b.model.escapedParser,strategies:[b.model.defaultFetchStrategy]},b.model.escapedSetConfig={parser:b.model.escapedParser,strategies:[b.model.defaultFetchStrategy,b.model.defaultCreatorStrategy]},b.initSimpleModel=function(a,b){return a.model=b||{},a.model},b.initRelayModel=function(a,b){return b},b.isModelComplete=function(a){return a.model!==b.inEvaluationMarker},b.enlistModelComponent=function(a){var c=b.getInstantiator(a),d=c.modelTransactions.init[a.id];return d||(d={that:a,complete:b.isModelComplete(a)},c.modelTransactions.init[a.id]=d),d},b.clearLinkCounts=function(a,c){b.each(a,function(b,d){"number"==typeof b?a[d]=0:c&&b.options&&"number"==typeof b.options.relayCount&&(b.options.relayCount=0)})},b.sortCompleteLast=function(a,b){return(a.completeOnInit?1:0)-(b.completeOnInit?1:0)
},b.operateInitialTransaction=function(a,c){var d,e=b.allocateGuid(),f=b.getModelTransactionRec(a,e),g=b.transform(c,function(a){return d=a.that.applier.initiate(e),f[a.that.applier.applierId]={transaction:d},d}),h=b.values(c).sort(b.sortCompleteLast);b.each(h,function(a){var c=a.that,d=g[c.id];a.completeOnInit?b.initModelEvent(c,d,c.applier.changeListeners.listeners):b.each(a.initModels,function(a){d.fireChangeRequest({type:"ADD",segs:[],value:a}),b.clearLinkCounts(f,!0)});var e=b.shadowForComponent(c);e.modelComplete=!0}),d.commit()},b.deenlistModelComponent=function(a){var c=b.getInstantiator(a),d=c.modelTransactions.init;a.model=void 0,d[a.id].complete=!0;var e=b.find_if(d,function(a){return a.complete!==!0});e||(b.operateInitialTransaction(c,d),c.modelTransactions.init={})},b.transformToAdapter=function(a,c){var d={};return d[c]=a,function(a,c){b.model.transformWithRules(c,d,{finalApplier:a})}},b.parseModelReference=function(a,c){var d=b.parseContextReference(c);return d.segs=a.applier.parseEL(d.path),d},b.parseValidModelReference=function(a,c,d){var e,f,g=function(a){b.fail("Error in "+c+": "+d+a)};return"{"===d.charAt(0)?(e=b.parseModelReference(a,d),"model"!==e.segs[0]?g(' must be a reference into a component model beginning with "model"'):(e.modelSegs=e.segs.slice(1),delete e.path),f=b.resolveContext(e.context,a),f||g(" must be a reference to an existing component")):(f=a,e={path:d,modelSegs:a.applier.parseEL(d)}),f.applier||b.getForComponent(f,["applier"]),f.applier||g(" must be a reference to a component with a ChangeApplier (descended from fluid.modelComponent)"),e.that=f,e.applier=f.applier,e.path||(e.path=f.applier.composeSegments.apply(null,e.modelSegs)),e},b.getModelTransactionRec=function(a,c){c||b.fail("Cannot get transaction record without transaction id");var d=a.modelTransactions[c];return d||a.free||(d=a.modelTransactions[c]={},d.externalChanges={}),d},b.recordChangeListener=function(a,c,d){var e=b.shadowForComponent(a);b.recordListener(c.modelChanged,d,e)},b.registerDirectChangeRelay=function(a,c,d,e,f,g,h){var i=b.getInstantiator(a),j=h.targetApplier||a.applier,k=h.sourceApplier||d.applier,l=j.applierId;c=b.makeArray(c),e=e?b.makeArray(e):e;var m=function(a,d,k,m,n,o){var p=n.id,q=b.getModelTransactionRec(i,p);o&&n&&(q[o.applierId]={transaction:n});var r=q[l];q[f]=q[f]||0;var s=!0;if(s){if(++q[f],!r){var t=j.initiate(p,!0);r=q[l]={transaction:t,options:h}}g&&!h.targetApplier?g(r.transaction,h.sourceApplier?void 0:a,e,c):void 0!==a&&r.transaction.fireChangeRequest({type:"ADD",segs:c,value:a})}};e&&k.modelChanged.addListener({isRelay:!0,segs:e,transactional:h.transactional},m),d&&(b.recordChangeListener(d,k,m),a!==d&&b.recordChangeListener(a,k,m))},b.connectModelRelay=function(a,c,d,e,f){function g(a){var c=b.enlistModelComponent(a);if(c.complete){var d=b.shadowForComponent(a);d.modelComplete&&(c.completeOnInit=!0)}}var h=b.allocateGuid();g(d),g(a),f.update?f.targetApplier?b.registerDirectChangeRelay(a,c,d,e,h,null,{targetApplier:f.targetApplier,relayCount:f.relayCount,update:f.update}):b.registerDirectChangeRelay(d,e,a,[],h+"-transform",f.forwardAdapter,{transactional:!0,sourceApplier:f.forwardApplier}):(b.registerDirectChangeRelay(d,e,a,c,h,f.forwardAdapter,{}),c&&b.registerDirectChangeRelay(a,c,d,e,h,f.backwardAdapter,{}))},b.model.guardedAdapter=function(a,c,d,e){var f=a.modelRelay===b.inEvaluationMarker,g=c[f?"init":"live"];g&&d.apply(null,e)},b.makeTransformPackage=function(a,c,d,e,f,g){var h={forwardHolder:{model:c},backwardHolder:{model:null}};h.generateAdapters=function(a){h.forwardAdapterImpl=b.transformToAdapter(a?a.newHolder.model:h.forwardHolder.model,e),null!==d&&(h.backwardHolder.model=b.model.transform.invertConfiguration(c),h.backwardAdapterImpl=b.transformToAdapter(h.backwardHolder.model,d))},h.forwardAdapter=function(c,d){void 0===d&&h.generateAdapters(),b.model.guardedAdapter(a,f,h.forwardAdapterImpl,arguments)},h.runTransform=function(a){a.commit(),a.reset()},h.forwardApplier=b.makeNewChangeApplier(h.forwardHolder),h.forwardApplier.isRelayApplier=!0,h.invalidator=b.makeEventFirer(null,null,"Invalidator for model relay with applier "+h.forwardApplier.applierId),null!==d&&(h.backwardApplier=b.makeNewChangeApplier(h.backwardHolder),h.backwardAdapter=function(){b.model.guardedAdapter(a,g,h.backwardAdapterImpl,arguments)}),h.update=h.invalidator.fire;var i={relayCount:0,targetApplier:h.forwardApplier,update:h.update,refCount:0};return h.forwardHolder.model=b.parseImplicitRelay(a,c,[],i),h.refCount=i.refCount,h.generateAdapters(),h.invalidator.addListener(h.generateAdapters),h.invalidator.addListener(h.runTransform),h},b.singleTransformToFull=function(b){var c=a.extend(!0,{valuePath:""},b);return{"":{transform:c}}},b.model.relayConditions={initOnly:{init:!0,live:!1},liveOnly:{init:!1,live:!0},never:{init:!1,live:!1},always:{init:!0,live:!0}},b.model.parseRelayCondition=function(a){return b.model.relayConditions[a||"always"]},b.parseModelRelay=function(a,c){var d=c.source?b.parseValidModelReference(a,'modelRelay record member "source"',c.source):{path:null,modelSegs:null},e=b.parseValidModelReference(a,'modelRelay record member "target"',c.target),f=c.singleTransform?b.singleTransformToFull(c.singleTransform):c.transform;f||b.fail('Cannot parse modelRelay record without element "singleTransform" or "transform":',c);var g=b.model.parseRelayCondition(c.forward),h=b.model.parseRelayCondition(c.backward),i=b.makeTransformPackage(a,f,d.path,e.path,g,h);0===i.refCount?b.connectModelRelay(d.that||a,d.modelSegs,e.that,e.modelSegs,{forwardAdapter:i.forwardAdapter,backwardAdapter:i.backwardAdapter}):b.connectModelRelay(d.that||a,d.modelSegs,e.that,e.modelSegs,i)},b.parseImplicitRelay=function(a,c,d,e){var f;if("string"==typeof c&&"{"===c.charAt(0)){var g=b.parseModelReference(a,c),h=b.resolveContext(g.context,a);if("model"===g.segs[0]){var i=g.segs.slice(1);++e.refCount,b.connectModelRelay(a,d,h,i,e)}else f=b.getForComponent(h,g.segs)}else b.isPrimitive(c)||!b.isPlainObject(c)?f=c:c.expander&&b.isPlainObject(c.expander)?f=b.expandOptions(c,a):(f=b.freshContainer(c),b.each(c,function(c,g){d.push(g);var h=b.parseImplicitRelay(a,c,d,e);void 0!==h&&(f[g]=h),d.pop()}));return f},b.model.notifyExternal=function(a){var c=a?b.values(a.externalChanges):[];c.sort(b.priorityComparator);for(var d=0;d<c.length;++d){var e=c[d];e.listener.apply(null,e.args)}},b.model.commitRelays=function(a,c){var d=a.modelTransactions[c];b.each(d,function(a){a.transaction&&(a.transaction.commit("relay"),a.transaction.reset())}),b.clearLinkCounts(d,!0)},b.model.updateRelays=function(a,c){var d=a.modelTransactions[c],e=0;return b.each(d,function(a){a.options&&a.transaction&&a.transaction.changeRecord.changes>0&&a.options.relayCount<2&&a.options.update&&(a.options.relayCount++,b.clearLinkCounts(d),a.options.update(a.transaction,d),++e)}),e},b.establishModelRelay=function(a,c,d,e,f){function g(a){for(;b.model.updateRelays(l,a.id)>0;);}function h(a,c,d){"relay"!==d&&b.model.commitRelays(l,a.id)}function i(a,c,d){"relay"!==d&&(b.model.notifyExternal(l.modelTransactions[a.id]),delete l.modelTransactions[a.id])}b.mergeModelListeners(a,d);var j=b.enlistModelComponent(a);b.each(e,function(c){b.parseModelRelay(a,c)});var k=b.transform(c,function(c){return b.parseImplicitRelay(a,c,[],{refCount:0})});j.initModels=k;var l=b.getInstantiator(a);return f.preCommit.addListener(g),f.preCommit.addListener(h),f.postCommit.addListener(i),b.deenlistModelComponent(a),f.holder.model},b.defaults("fluid.commonModelComponent",{gradeNames:["fluid.littleComponent","autoInit"],mergePolicy:{modelListeners:b.makeMergeListenersPolicy(b.arrayConcatPolicy)}}),b.defaults("fluid.modelComponent",{gradeNames:["fluid.commonModelComponent","autoInit"],members:{model:"@expand:fluid.initSimpleModel({that}, {that}.options.model)",applier:"@expand:fluid.makeChangeApplier({that}.model, {that}.options.changeApplierOptions)",modelListeners:"@expand:fluid.mergeModelListeners({that}, {that}.options.modelListeners)"},mergePolicy:{model:"preserve"}}),b.defaults("fluid.modelRelayComponent",{gradeNames:["fluid.commonModelComponent","fluid.eventedComponent","autoInit"],changeApplierOptions:{relayStyle:!0,cullUnchanged:!0},members:{model:"@expand:fluid.initRelayModel({that}, {that}.modelRelay)",applier:"@expand:fluid.makeNewChangeApplier({that}, {that}.options.changeApplierOptions)",modelRelay:"@expand:fluid.establishModelRelay({that}, {that}.options.model, {that}.options.modelListeners, {that}.options.modelRelay, {that}.applier)"},mergePolicy:{model:{noexpand:!0,func:b.arrayConcatPolicy},modelRelay:{noexpand:!0,func:b.arrayConcatPolicy}}}),b.defaults("fluid.standardComponent",{gradeNames:["fluid.modelComponent","fluid.eventedComponent","autoInit"]}),b.defaults("fluid.standardRelayComponent",{gradeNames:["fluid.modelRelayComponent","autoInit"]}),b.modelChangedToChange=function(a,c){var d=c[0],e=c[1],f=c[3];return a?{value:c[0],oldValue:c[1],path:c[2]}:{value:b.get(d,f),oldValue:b.get(e,f),path:f}},b.resolveModelListener=function(a,c,d){var e=function(){var e=b.modelChangedToChange(d,arguments),f=[e],g={change:e,arguments:f};c.args&&(f=b.expandOptions(c.args,a,{},g)),b.event.invokeListener(c.listener,b.makeArray(f))};return b.event.impersonateListener(c.listener,e),e},b.mergeModelListeners=function(a,c){var d=0;b.each(c,function(c,e){"string"==typeof c&&(c={funcName:c});var f=b.event.resolveListenerRecord(c,a,"modelListeners",null,!1),g=b.parseValidModelReference(a,"modelListeners entry",e),h=g.applier.preCommit;b.each(f.records,function(c){function e(){if(h&&b.isModelComplete(g.that)){var c=g.applier.initiate();b.initModelEvent(a,c,[i]),c.commit()}}var f=b.resolveModelListener(a,c,h),i={listener:f,listenerIndex:d,segs:g.modelSegs,path:g.path,priority:b.event.mapPriority(c.priority,d),transactional:!0};++d,b.addSourceGuardedListener(g.applier,i,c.guardSource,f,"modelChanged",c.namespace,c.softNamespace),b.recordChangeListener(a,g.applier,f),a===g.that||b.isModelComplete(a)||a.events.onCreate.addListener(e)})})},b.addSourceGuardedListener=function(a,c,d,e,f,g,h){f=f||"modelChanged";var i=function(b,c,f,g){return a.hasChangeSource(d,g)?void 0:e.apply(null,arguments)};b.event.impersonateListener(e,i),a[f].addListener(c,i,g,h)},b.fireSourcedChange=function(a,b,c,d){a.fireChangeRequest({path:b,value:c,source:d})},b.requestChanges=function(a,b){for(var c=0;c<b.length;++c)a.fireChangeRequest(b[c])},b.bindRequestChange=function(a){a.requestChange=a.change=function(b,c,d){var e={path:b,value:c,type:d};a.fireChangeRequest(e)}},b.identifyChangeListener=function(a){return b.event.identifyListener(a)||a},b.typeCode=function(a){return b.isPrimitive(a)||!b.isPlainObject(a)?"primitive":b.isArrayable(a)?"array":"object"},b.model.isChangedPath=function(a,b){for(var c=0;c<=b.length;++c){if("string"==typeof a)return!0;c<b.length&&a&&(a=a[b[c]])}return!1},b.model.setChangedPath=function(a,c,d){var e=function(e){c.unshift(e),b.model.setSimple(a,c,d),c.shift()};b.model.isChangedPath(a.changeMap,c)||(++a.changes,e("changeMap")),b.model.isChangedPath(a.deltaMap,c)||(++a.deltas,e("deltaMap"))},b.model.fetchChangeChildren=function(a,c,d,e,f){b.each(e,function(e,g){d[c]=g,b.model.applyChangeStrategy(a,g,c,d,e,f),d.length=c})},b.model.isSameValue=function(a,b){if("number"!=typeof a||"number"!=typeof b)return a===b;if(a===b)return!0;var c=Math.abs((a-b)/b);return 1e-12>c},b.model.applyChangeStrategy=function(a,c,d,e,f,g){var h=a[c],i=b.typeCode(f),j=b.typeCode(h),k=b.NO_VALUE;"primitive"===i?b.model.isSameValue(h,f)||(k=f):(j!==i||"array"===i&&f.length!==h.length)&&(k=b.freshContainer(f)),k!==b.NO_VALUE&&(a[c]=k,g.changeMap&&b.model.setChangedPath(g,e,"ADD")),"primitive"!==i&&b.model.fetchChangeChildren(a[c],d+1,e,f,g)},b.model.stepTargetAccess=function(a,c,d,e,f,g){for(var h=e;f>h;++h){var i=a[d[h]];a=b.model.traverseWithStrategy(a,d,h,g["ADD"===c?"resolverSetConfig":"resolverGetConfig"],d.length-h-1),i!==a&&g.changeMap&&b.model.setChangedPath(g,d.slice(0,h+1),"ADD")}return{root:a,last:d[f]}},b.model.defaultAccessorConfig=function(a){return a=a||{},a.resolverSetConfig=a.resolverSetConfig||b.model.defaultSetConfig,a.resolverGetConfig=a.resolverGetConfig||b.model.defaultGetConfig,a},b.model.applyHolderChangeRequest=function(a,c,d){d=b.model.defaultAccessorConfig(d),d.deltaMap=d.changeMap?{}:null,d.deltas=0;var e,f=c.segs.length,g=0===f;if(g?e={root:a,last:"model"}:(a.model||(a.model={},b.model.setChangedPath(d,[],"ADD")),e=b.model.stepTargetAccess(a.model,c.type,c.segs,0,f-1,d)),"ADD"===c.type){var h=c.value,i=b.makeArray(c.segs);b.model.applyChangeStrategy(e.root,e.last,f-1,i,h,d,g)}else"DELETE"===c.type?e.root&&void 0!==e.root[e.last]&&(delete e.root[e.last],d.changeMap&&b.model.setChangedPath(d,c.segs,"DELETE")):b.fail("Unrecognised change type of "+c.type);return d.deltas?d.deltaMap:null},b.matchChanges=function(a,c,d){for(var e=d.model,f=a,g=["model"],h=!1,i=[],j=0;j<c.length;++j){var k=c[j];"*"===k?j===c.length-1?h=!0:b.fail("Wildcard specification in modelChanged listener is only supported for the final path segment: "+c.join(".")):(g.push(k),f=b.isPrimitive(f)?f:f[k],e=e?e[k]:void 0)}return f&&(h?b.each(e,function(a,b){i.push(g.concat(b))}):i.push(g)),i},b.storeExternalChange=function(a,c,d,e,f){var g=c.composeSegments.apply(null,d),h=[c.applierId,b.event.identifyListener(e.listener),e.listenerIndex,g],i=h.join("|");a.externalChanges[i]={listener:e.listener,priority:e.priority,args:f}},b.notifyModelChanges=function(a,c,d,e,f,g,h,i){for(var j=b.getInstantiator(i),k=g&&b.getModelTransactionRec(j,g.id),l=0;l<a.length;++l)for(var m=a[l],n=b.matchChanges(c,m.segs,d),o=0;o<n.length;++o){var p=n[o];m.listener=b.event.resolveListener(m.listener);var q=[b.model.getSimple(d,p),b.model.getSimple(e,p),p.slice(1),f,g,h];k&&!m.isRelay&&m.transactional?b.storeExternalChange(k,h,p,m,q):m.listener.apply(null,q)}},b.bindELMethods=function(a){a.parseEL=function(c){return b.model.pathToSegments(c,a.options.resolverSetConfig)},a.composeSegments=function(){return a.options.resolverSetConfig.parser.compose.apply(null,arguments)}},b.initModelEvent=function(a,c,d){b.notifyModelChanges(d,"ADD",c.oldHolder,b.emptyHolder,null,c,a)},b.emptyHolder={model:void 0},b.makeNewChangeApplier=function(a,c){function d(a){a.type||(a.type="ADD"),a.segs=a.segs||f.parseEL(a.path)}c=b.model.defaultAccessorConfig(c);var e=b.allocateGuid(),f={applierId:e,holder:a,changeListeners:{listeners:[],transListeners:[]},options:c,modelChanged:{},preCommit:b.makeEventFirer(null,null,"preCommit event for ChangeApplier "+e),postCommit:b.makeEventFirer(null,null,"postCommit event for ChangeApplier "+e)};return f.modelChanged.addListener=function(a,c,d,e){a="string"==typeof a?{path:a}:b.copy(a),a.id=b.event.identifyListener(c),a.namespace=d,a.softNamespace=e,"string"==typeof c&&(c={globalName:c}),a.listener=c;var g=a.transactional;a.segs=a.segs||f.parseEL(a.path);var h=g?"transListeners":"listeners";f.changeListeners[h].push(a)},f.modelChanged.removeListener=function(a){var c=b.event.identifyListener(a),d="string"==typeof a?a:null,e=function(a){return a.id===c||a.namespace===d};b.remove_if(f.changeListeners.listeners,e),b.remove_if(f.changeListeners.transListeners,e)},f.modelChanged.isRelayEvent=!0,f.fireChangeRequest=function(a){var b=f.initiate();b.fireChangeRequest(a),b.commit()},f.initiate=function(e,g){var h={instanceId:b.allocateGuid(),id:e||b.allocateGuid(),changeRecord:{resolverSetConfig:c.resolverSetConfig,resolverGetConfig:c.resolverGetConfig},reset:function(){h.oldHolder=a,h.newHolder={model:b.copy(a.model)},h.changeRecord.changes=0,h.changeRecord.changeMap={}},commit:function(c){if(f.preCommit.fire(h,f,c),h.changeRecord.changes>0){var d={model:a.model};a.model=h.newHolder.model,b.notifyModelChanges(f.changeListeners.transListeners,h.changeRecord.changeMap,a,d,null,h,f,a)}g||f.postCommit.fire(h,f,c)},fireChangeRequest:function(c){d(c),c.transactionId=h.id;var e=b.model.applyHolderChangeRequest(h.newHolder,c,h.changeRecord);b.notifyModelChanges(f.changeListeners.listeners,e,h.newHolder,a,c,h,f,a)}};return h.reset(),b.bindRequestChange(h),h},f.hasChangeSource=function(a,b){return b?b[a]:!1},b.bindRequestChange(f),b.bindELMethods(f),f},b.pathUtil.getPathSegment=function(a,b){return e(f,a,b),f[0]},b.pathUtil.getHeadPath=function(a){return b.pathUtil.getPathSegment(a,0)},b.pathUtil.getFromHeadPath=function(a){var b=e(null,a,0);return b===a.length?"":a.substring(b+1)},b.pathUtil.getToTailPath=function(a){var b=c(a);return-1===b?"":a.substring(0,b)},b.pathUtil.getTailPath=function(a){var d=c(a);return b.pathUtil.getPathSegment(a,d+1)},b.pathUtil.matchSegments=function(a,b,c,d){if(d-c!==a.length)return!1;for(var e=c;d>e;++e)if(b[e]!==a[e-c])return!1;return!0},b.pathUtil.getExcessPath=function(a,c){var d=c.indexOf(a);return 0!==d&&b.fail("Path "+a+" is not a prefix of path "+c),a.length===c.length?"":("."!==c[a.length]&&b.fail("Path "+a+" is not properly nested in path "+c),c.substring(a.length+1))},b.pathUtil.matchPath=function(a,c,d){for(var e=[];;){if(""===c^""===a&&d)return null;if(!a||!c)break;var f=b.pathUtil.getHeadPath(a),g=b.pathUtil.getHeadPath(c);if("*"!==f&&f!==g)return null;e.push(g),a=b.pathUtil.getFromHeadPath(a),c=b.pathUtil.getFromHeadPath(c)}return e},b.model.isNullChange=function(a,c,d){if("ADD"===c.type&&!c.forceChange){var e=b.get(a,c.segs,d);if(e===c.value)return!0}},b.model.applyChangeRequest=function(c,d,e){var f=b.model.accessWithStrategy(c,d.path,b.VALUE,e||b.model.defaultSetConfig,null,!0),g=f.segs[f.segs.length-1];"ADD"===d.type||"MERGE"===d.type?0===f.segs.length||"MERGE"===d.type&&f.root[g]?("ADD"===d.type&&b.clear(f.root),a.extend(!0,0===f.segs.length?f.root:f.root[g],d.value)):f.root[g]=d.value:"DELETE"===d.type&&(0===f.segs.length?b.clear(f.root):delete f.root[g])},b.makeChangeApplier=function(a,c){return b.makeHolderChangeApplier({model:a},c)},b.makeHolderChangeApplier=function(a,c){function e(a){if(!a)return null;var c=function(a){return function(d,e,f){var g=a(d,e,f);return g===!1?!1:b.model.isNullChange(d,e)?(c.culled=!0,!1):void 0}};return c}function f(a,c){var d=c,e=!1,f=Number.MAX_VALUE;"string"==typeof c&&(c={path:c}),d=c.path,e=c.transactional,void 0!==c.priority&&(f=c.priority),"!"===d.charAt(0)&&(e=!0,d=d.substring(1));var g=function(c,g,h){var i=b.event.identifyListener(a),j=g.guids[i];if(j&&h)h&&(j.accumulate||(j.accumulate=[]),j.accumulate.push(h));else{var k=b.pathUtil.matchPath(d,c);if(null!==k){var l={match:k,pathSpec:d,listener:a,priority:f,transactional:e};h&&(l.accumulate=[h]),g.guids[i]=l;var m=e?"transListeners":"listeners";g[m].push(l),g.all.push(l)}}};return b.event.impersonateListener(a,g),g}function g(a,b,c,d,e){return p[a].fireToListeners(b[d],c,e)}function h(a,b){return a.priority-b.priority}function i(a,b,c,d){p[a].fire(b,c,d),c.all.sort(h),c.listeners.sort(h),c.transListeners.sort(h)}function j(){return{guids:{},all:[],listeners:[],transListeners:[]}}function k(a,b){var c=j();return i(a,b,c),c}function l(a,b,c,d){var e=k(a,b);return g(a,e,c,"all",d)}function m(a,b){a[b]={addListener:function(a,c,d,e){p[b].addListener(f(c,a),d,null,null,e)},removeListener:function(a){p[b].removeListener(a)}}}function n(a){a.type||(a.type="ADD"),a.segs=r.parseEL(a.path)}function o(a,b,c,d,e,f){for(var g=j(),h=0;h<c.length;++h)i(a,c[h].path,g,c[h]);for(var k=0;k<g[b].length;++k){var l=g[b][k];void 0!==e&&(d[e]=l.accumulate),void 0!==f&&(d[f]=l.match);var m=l.listener.apply(null,d);if(m===!1)return!1}}c=b.model.defaultAccessorConfig(c);var p={guards:b.event.getEventFirer(!1,!0,"guard event"),postGuards:b.event.getEventFirer(!1,!0,"postGuard event"),modelChanged:b.event.getEventFirer(!1,!1,"modelChanged event")},q=b.threadLocal(function(){return{sources:{}}}),r={applierId:b.allocateGuid(),holder:a,options:c};m(r,"guards"),m(r,"postGuards"),m(r,"modelChanged");var s={fireChangeRequest:function(a){r.fireChangeRequest(a,!0)}};return b.bindRequestChange(s),r.fireChangeRequest=function(a){n(a);var b=r.initiate();b.fireChangeRequest(a),b.commit()},r.fireChangeRequest=d(r.fireChangeRequest,q),b.bindRequestChange(r),b.bindELMethods(r),r.initiate=function(f){var g=!1,h=[];c.thin?f=a.model:(f=f||{},b.model.copyModel(f,a.model));var i={commit:function(){var d;if(g)return!1;var e=o("postGuards","transListeners",h,[f,null,i],1);return e===!1||g?!1:(c.thin?d=a.model:(d={},b.model.copyModel(d,a.model),b.clear(a.model),b.model.copyModel(a.model,f)),void o("modelChanged","all",h,[a.model,d,null,null],2,3))},fireChangeRequest:function(d){if(n(d),!c.cullUnchanged||!b.model.isNullChange(a.model,d,c.resolverGetConfig)){var j=e(c.cullUnchanged),k=l("guards",d.path,[f,d,i],j);k!==!1||j&&j.culled||(g=!0),g||j&&j.culled||(b.model.applyChangeRequest(f,d,c.resolverSetConfig),h.push(d))}}};return i.fireChangeRequest=d(i.fireChangeRequest,q),b.bindRequestChange(i),i},r.hasChangeSource=function(a){return q().sources[a]>0},r},b.makeSuperApplier=function(){var a=[],c={};return c.addSubApplier=function(b,c){a.push({path:b,subApplier:c})},c.fireChangeRequest=function(c){for(var d=0;d<a.length;++d){var e=a[d].path;if(0===c.path.indexOf(e)){var f=c.path.substring(e.length+1),g=b.copy(c);g.path=f,a[d].subApplier.fireChangeRequest(g)}}},b.bindRequestChange(c),c},b.attachModel=function(a,c,d){for(var e=b.model.parseEL(c),f=0;f<e.length-1;++f){var g=e[f],h=a[g];h||(a[g]=h={}),a=h}a[e[e.length-1]]=d},b.assembleModel=function(a){var c={},d=b.makeSuperApplier(),e={model:c,applier:d};for(var f in a){var g=a[f];b.attachModel(c,f,g.model),g.applier&&d.addSubApplier(f,g.applier)}return e}}(jQuery,fluid_1_5);var fluid_1_5=fluid_1_5||{},fluid=fluid||fluid_1_5;!function(a,b){"use strict";b.registerNamespace("fluid.model.transform"),b.defaults("fluid.transformFunction",{gradeNames:"fluid.function"}),b.defaults("fluid.standardInputTransformFunction",{gradeNames:"fluid.transformFunction"}),b.defaults("fluid.standardOutputTransformFunction",{gradeNames:"fluid.transformFunction"}),b.defaults("fluid.multiInputTransformFunction",{gradeNames:"fluid.transformFunction"}),b.defaults("fluid.standardTransformFunction",{gradeNames:["fluid.standardInputTransformFunction","fluid.standardOutputTransformFunction"]}),b.defaults("fluid.lens",{gradeNames:"fluid.transformFunction",invertConfiguration:null}),b.model.transform.pathToRule=function(a){return{transform:{type:"fluid.transforms.value",inputPath:a}}},b.model.transform.literalValueToRule=function(a){return{transform:{type:"fluid.transforms.literalValue",value:a}}},b.model.composePaths=function(a,b){return a=0===a?"0":a||"",b=0===b?"0":b||"",a?b?a+"."+b:a:b},b.model.transform.accumulateInputPath=function(a,c,d){void 0!==a&&d.push(b.model.composePaths(c.inputPrefix,a))},b.model.transform.accumulateStandardInputPath=function(a,c,d,e){b.model.transform.getValue(void 0,c[a],d),b.model.transform.accumulateInputPath(c[a+"Path"],d,e)},b.model.transform.accumulateMultiInputPaths=function(a,c,d,e){b.each(a,function(a,f){b.model.transform.accumulateStandardInputPath(f,c,d,e)})},b.model.transform.getValue=function(a,c,d){var e;return void 0!==a&&(e=b.get(d.source,b.model.composePaths(d.inputPrefix,a),d.resolverGetConfig)),void 0===e&&(e=b.isPrimitive(c)?c:d.expand(c)),e},b.model.transform.NONDEFAULT_OUTPUT_PATH_RETURN={},b.model.transform.setValue=function(a,c,d,e){var f=b.copy(c),g=b.model.composePaths(d.outputPrefix,a);return void 0!==f&&d.applier.requestChange(g,f,e?"MERGE":void 0),a?b.model.transform.NONDEFAULT_OUTPUT_PATH_RETURN:f},b.model.transform.resolveParam=function(a,c,d,e){var f=b.model.transform.getValue(a[d+"Path"],a[d],c);return void 0!==f?f:e},b.deepEquals=function(a,c,d){b.isPrimitive(a)?a===c?++d.matchCount:(++d.mismatchCount,d.messages.push("Value mismatch at path "+d.path+": expected "+a+" actual "+c)):typeof a!=typeof c?(++d.mismatchCount,d.messages.push("Type mismatch at path "+d.path+": expected "+typeof a+" actual "+typeof c)):b.each(a,function(e,f){d.pathOps.push(f),b.deepEquals(a[f],c[f],d),d.pathOps.pop(f)})},b.model.transform.matchValue=function(a,c){if(b.isPrimitive(a))return a===c?1:0;var d={matchCount:0,mismatchCount:0,messages:[]};return b.model.makePathStack(d,"path"),b.deepEquals(a,c,d),d.matchCount},b.model.transform.compareMatches=function(a,b){return b.matchCount-a.matchCount},b.firstDefined=function(a,b){return void 0===a?b:a},b.model.transform.prefixApplier=function(a,b){a.inputPrefix&&b.inputPrefixOp.push(a.inputPrefix),a.outputPrefix&&b.outputPrefixOp.push(a.outputPrefix),b.expand(a.value),a.inputPrefix&&b.inputPrefixOp.pop(),a.outputPrefix&&b.outputPrefixOp.pop()},b.defaults("fluid.model.transform.prefixApplier",{gradeNames:["fluid.transformFunction"]}),b.model.makePathStack=function(a,c){var d=a[c+"Stack"]=[];return a[c]="",{push:function(e){var f=b.model.composePaths(a[c],e);d.push(a[c]),a[c]=f},pop:function(){a[c]=d.pop()}}},b.model.transform.aliasStandardInput=function(a){return{value:void 0===a.value?a.input:a.value,valuePath:void 0===a.valuePath?a.inputPath:a.valuePath}},b.model.transform.doTransform=function(a,c,d){var e=d.defaults,f=b.getGlobalValue(d.typeName);"function"!=typeof f&&b.fail("Transformation record specifies transformation function with name "+a.type+" which is not a function - ",f),b.hasGrade(e,"fluid.transformFunction")||(e=b.defaults("fluid.standardTransformFunction"));var g=[a,c];if(b.hasGrade(e,"fluid.standardInputTransformFunction")){var h=b.model.transform.aliasStandardInput(a),i=b.model.transform.getValue(h.valuePath,h.value,c);if(g.unshift(i),void 0===i)return void 0}else if(b.hasGrade(e,"fluid.multiInputTransformFunction")){var j={};b.each(e.inputVariables,function(d,e){j[e]=function(){var f=b.model.transform.getValue(a[e+"Path"],a[e],c);return f=void 0===f&&null!==d?d:f}}),g.unshift(j)}var k=f.apply(null,g);if(b.hasGrade(e,"fluid.standardOutputTransformFunction")){var l=void 0!==a.outputPath?a.outputPath:d.doOutput?"":void 0;void 0!==l&&void 0!==k&&(b.model.transform.setValue(a.outputPath,k,c,a.merge),k=void 0)}return k},b.model.transform.expandWildcards=function(a,c){b.each(c,function(c,d){var e=a.queuedTransforms;a.pathOp.push(b.pathUtil.escapeSegment(d.toString()));for(var f=0;f<e.length;++f)if(b.pathUtil.matchPath(e[f].matchPath,a.path,!0)){var g=b.copy(e[f].transformSpec);(void 0===g.inputPath||b.model.transform.hasWildcard(g.inputPath))&&(g.inputPath=""),a.inputPrefixOp.push(a.path),a.outputPrefixOp.push(a.path);var h=b.model.transform.lookupType(g.type),i=b.model.transform.doTransform(g,a,h);void 0!==i&&b.model.transform.setValue(null,i,a),a.outputPrefixOp.pop(),a.inputPrefixOp.pop()}b.isPrimitive(c)||b.model.transform.expandWildcards(a,c),a.pathOp.pop()})},b.model.transform.hasWildcard=function(a){return"string"==typeof a&&-1!==a.indexOf("*")},b.model.transform.maybePushWildcard=function(a,c){var d,e=b.model.transform.hasWildcard;return e(a.inputPath)?d=b.model.composePaths(c.inputPrefix,a.inputPath):(e(c.outputPrefix)||e(a.outputPath))&&(d=b.model.composePaths(c.outputPrefix,a.outputPath)),d?(c.queuedTransforms.push({transformSpec:a,outputPrefix:c.outputPrefix,inputPrefix:c.inputPrefix,matchPath:d}),!0):!1},b.model.sortByKeyLength=function(a){var c=b.keys(a);return c.sort(b.compareStringLength(!0))},b.model.transform.handleTransformStrategy=function(a,c,d){return b.model.transform.maybePushWildcard(a,c)?void 0:b.model.transform.doTransform(a,c,d)},b.model.transform.handleInvertStrategy=function(a,c,d){var e=d.defaults&&d.defaults.invertConfiguration;if(e){var f=b.invokeGlobalFunction(e,[a,c]);c.inverted.push(f)}},b.model.transform.handleCollectStrategy=function(a,c,d){var e=d.defaults,f=b.hasGrade(e,"fluid.standardInputTransformFunction"),g=b.hasGrade(e,"fluid.multiInputTransformFunction");if(f)b.model.transform.accumulateStandardInputPath("input",a,c,c.inputPaths);else if(g)b.model.transform.accumulateMultiInputPaths(e.inputVariables,a,c,c.inputPaths);else{var h=e.collectInputPaths;if(h){var i=b.makeArray(b.invokeGlobalFunction(h,[a,c]));c.inputPaths=c.inputPaths.concat(i)}}},b.model.transform.lookupType=function(a,c){a||b.fail("Transformation record is missing a type name: ",c),-1===a.indexOf(".")&&(a="fluid.transforms."+a);var d=b.defaults(a);return{defaults:d,typeName:a}},b.model.transform.processRule=function(a,c){"string"==typeof a?a=b.model.transform.pathToRule(a):a.literalValue&&""!==c.outputPrefix&&(a=b.model.transform.literalValueToRule(a.literalValue));var d;if(a.transform){var e,f;if(b.isArrayable(a.transform)){var g=a.transform;d=void 0;for(var h=0;h<g.length;++h)e=g[h],f=b.model.transform.lookupType(e.type),c.transformHandler(e,c,f)}else e=a.transform,f=b.model.transform.lookupType(e.type),d=c.transformHandler(e,c,f)}return b.isArrayable(a)&&(c.collectedFlatSchemaOpts=c.collectedFlatSchemaOpts||{},c.collectedFlatSchemaOpts[c.outputPrefix]="array"),b.each(a,function(a,d){if("transform"!==d){c.outputPrefixOp.push(d);var e=c.expand(a,c);void 0!==e&&(b.model.transform.setValue(null,e,c),e=void 0),c.outputPrefixOp.pop()}}),d},b.model.transform.makeStrategy=function(a,c,d){d=d||b.model.transform.processRule,a.expand=function(b){return d(b,a)},a.outputPrefixOp=b.model.makePathStack(a,"outputPrefix"),a.inputPrefixOp=b.model.makePathStack(a,"inputPrefix"),a.transformHandler=c},b.model.transform.invertConfiguration=function(a){var c={inverted:[]};return b.model.transform.makeStrategy(c,b.model.transform.handleInvertStrategy),c.expand(a),{transform:c.inverted}},b.model.transform.collectInputPaths=function(a){var c={inputPaths:[]};return b.model.transform.makeStrategy(c,b.model.transform.handleCollectStrategy),c.expand(a),c.inputPaths},b.model.transform.flatSchemaStrategy=function(a,c){var d=b.model.sortByKeyLength(a);return function(e,f,g,h){for(var i=c.parser.compose.apply(null,h.slice(0,g)),j=0;j<d.length;++j){var k=d[j];if(null!==b.pathUtil.matchPath(k,i,!0))return a[k]}}},b.model.transform.defaultSchemaValue=function(a){var c=b.isPrimitive(a)?a:a.type;return"array"===c?[]:{}},b.model.transform.isomorphicSchemaStrategy=function(a,c){return function(d,e,f,g){var h=b.get(a,g.slice(0,f),c);return b.isArrayable(h)?"array":"object"}},b.model.transform.decodeStrategy=function(a,c,d){return c.isomorphic?b.model.transform.isomorphicSchemaStrategy(a,d):c.flatSchema?b.model.transform.flatSchemaStrategy(c.flatSchema,d):void 0},b.model.transform.schemaToCreatorStrategy=function(a){return function(c,d,e,f){if(void 0===c[d]){var g=a(c,d,e,f);return c[d]=b.model.transform.defaultSchemaValue(g),c[d]}}},b.model.transform.sequence=function(a,c,d){for(var e=0;e<c.length;++e)a=b.model.transform(a,c[e],d);return a},b.model.compareByPathLength=function(a,b){var c=a.path.length-b.path.length;return 0===c?a.sequence-b.sequence:c},b.model.fireSortedChanges=function(a,c){a.sort(b.model.compareByPathLength),b.requestChanges(c,a)},b.model.transformWithRules=function(c,d,e){e=e||{};var f=b.model.escapedGetConfig,g=b.model.transform.decodeStrategy(c,e,f),h={source:c,target:g?b.model.transform.defaultSchemaValue(g(null,"",0,[""])):{},resolverGetConfig:f,collectedFlatSchemaOpts:void 0,queuedChanges:[],queuedTransforms:[]};b.model.transform.makeStrategy(h,b.model.transform.handleTransformStrategy),h.applier={fireChangeRequest:function(a){a.sequence=h.queuedChanges.length,h.queuedChanges.push(a)}},b.bindRequestChange(h.applier),h.expand(d);var i=b.copy(b.model.escapedSetConfig);return void 0!==h.collectedFlatSchemaOpts&&(a.extend(h.collectedFlatSchemaOpts,e.flatSchema),g=b.model.transform.flatSchemaStrategy(h.collectedFlatSchemaOpts,f)),i.strategies=[b.model.defaultFetchStrategy,g?b.model.transform.schemaToCreatorStrategy(g):b.model.defaultCreatorStrategy],h.finalApplier=e.finalApplier||b.makeChangeApplier(h.target,{resolverSetConfig:i}),h.queuedTransforms.length>0&&(h.typeStack=[],h.pathOp=b.model.makePathStack(h,"path"),b.model.transform.expandWildcards(h,c)),b.model.fireSortedChanges(h.queuedChanges,h.finalApplier),h.target},a.extend(b.model.transformWithRules,b.model.transform),b.model.transform=b.model.transformWithRules,b.transformOne=function(a){return{transformOptions:{transformer:"fluid.model.transformWithRules",config:a}}
},b.transformMany=function(a){return{transformOptions:{transformer:"fluid.model.transform.sequence",config:a}}}}(jQuery,fluid_1_5);var fluid_1_5=fluid_1_5||{},fluid=fluid||fluid_1_5;!function(a,b){"use strict";b.registerNamespace("fluid.model.transform"),b.registerNamespace("fluid.transforms"),b.defaults("fluid.transforms.value",{gradeNames:"fluid.standardTransformFunction",invertConfiguration:"fluid.transforms.value.invert"}),b.transforms.value=b.identity,b.transforms.value.invert=function(a,c){var d=b.copy(a);return d.inputPath=b.model.composePaths(c.outputPrefix,a.outputPath),d.outputPath=b.model.composePaths(c.inputPrefix,a.inputPath),d},b.transforms.identity=b.transforms.value,b.defaults("fluid.transforms.identity",{gradeNames:"fluid.transforms.value"}),b.defaults("fluid.transforms.literalValue",{gradeNames:"fluid.standardOutputTransformFunction"}),b.transforms.literalValue=function(a){return a.value},b.defaults("fluid.transforms.arrayValue",{gradeNames:"fluid.standardTransformFunction"}),b.transforms.arrayValue=b.makeArray,b.defaults("fluid.transforms.count",{gradeNames:"fluid.standardTransformFunction"}),b.transforms.count=function(a){return b.makeArray(a).length},b.defaults("fluid.transforms.round",{gradeNames:"fluid.standardTransformFunction"}),b.transforms.round=function(a){return Math.round(a)},b.defaults("fluid.transforms.delete",{gradeNames:"fluid.transformFunction"}),b.transforms["delete"]=function(a,c){var d=b.model.composePaths(c.outputPrefix,a.outputPath);c.applier.requestChange(d,null,"DELETE")},b.defaults("fluid.transforms.firstValue",{gradeNames:"fluid.transformFunction"}),b.transforms.firstValue=function(a,c){a.values&&a.values.length||b.fail('firstValue transformer requires an array of values at path named "values", supplied',a);for(var d=0;d<a.values.length;d++){var e=a.values[d],f=c.expand(e);if(void 0!==f)return f}},b.defaults("fluid.transforms.linearScale",{gradeNames:["fluid.multiInputTransformFunction","fluid.standardOutputTransformFunction","fluid.lens"],invertConfiguration:"fluid.transforms.linearScale.invert",inputVariables:{value:null,factor:1,offset:0}}),b.transforms.linearScale=function(a){var b=a.value(),c=a.factor(),d=a.offset();return"number"!=typeof b||"number"!=typeof c||"number"!=typeof d?void 0:b*c+d},b.transforms.linearScale.invert=function(a,c){var d=b.copy(a);return d.factor&&(d.factor=0===d.factor?0:1/d.factor),d.offset&&(d.offset=-d.offset*(void 0!==d.factor?d.factor:1)),d.valuePath=b.model.composePaths(c.outputPrefix,a.outputPath),d.outputPath=b.model.composePaths(c.inputPrefix,a.valuePath),d},b.defaults("fluid.transforms.binaryOp",{gradeNames:["fluid.multiInputTransformFunction","fluid.standardOutputTransformFunction"],inputVariables:{left:null,right:null}}),b.transforms.binaryLookup={"===":function(a,b){return a===b},"!==":function(a,b){return a!==b},"<=":function(a,b){return b>=a},"<":function(a,b){return b>a},">=":function(a,b){return a>=b},">":function(a,b){return a>b},"+":function(a,b){return a+b},"-":function(a,b){return a-b},"*":function(a,b){return a*b},"/":function(a,b){return a/b},"%":function(a,b){return a%b},"&&":function(a,b){return a&&b},"||":function(a,b){return a||b}},b.transforms.binaryOp=function(a,c,d){var e=a.left(),f=a.right(),g=b.model.transform.getValue(void 0,c.operator,d),h=b.transforms.binaryLookup[g];return void 0===h||void 0===e||void 0===f?void 0:h(e,f)},b.defaults("fluid.transforms.condition",{gradeNames:["fluid.multiInputTransformFunction","fluid.standardOutputTransformFunction"],inputVariables:{"true":null,"false":null,condition:null}}),b.transforms.condition=function(a){var b=a.condition();return null===b?void 0:a[b?"true":"false"]()},b.defaults("fluid.transforms.valueMapper",{gradeNames:["fluid.transformFunction","fluid.lens"],invertConfiguration:"fluid.transforms.valueMapper.invert",collectInputPaths:"fluid.transforms.valueMapper.collect"}),b.model.transform.matchValueMapperFull=function(a,c,d){var e=c.options;if(0===e.length&&b.fail("valueMapper supplied empty list of options: ",c),1===e.length)return 0;for(var f=[],g=0;g<e.length;++g){var h=e[g],i=b.firstDefined(b.model.transform.getValue(h.inputPath,void 0,d),a),j=b.model.transform.matchValue(h.undefinedInputValue?void 0:h.inputValue,i);f[g]={index:g,matchCount:j}}return f.sort(b.model.transform.compareMatches),f[0].matchCount===f[1].matchCount?-1:f[0].index},b.transforms.valueMapper=function(a,c){a.options||b.fail('demultiplexValue requires a list or hash of options at path named "options", supplied ',a);var d=b.model.transform.getValue(a.inputPath,void 0,c),e=b.isArrayable(a.options)?function(d){var e=b.model.transform.matchValueMapperFull(d,a,c);return-1===e?null:a.options[e]}:function(b){return a.options[b]},f=e(d);if(f||(f=e(a.defaultInputValue)),f){var g=void 0===f.outputPath?a.defaultOutputPath:f.outputPath;c.outputPrefixOp.push(g);var h;return b.isPrimitive(f)?h=f:f.undefinedOutputValue?h=void 0:(h=b.model.transform.resolveParam(f,c,"outputValue",void 0),h=void 0===h?a.defaultOutputValue:h),"string"==typeof g&&void 0!==h&&(b.model.transform.setValue(void 0,h,c,a.merge),h=void 0),c.outputPrefixOp.pop(),h}},b.transforms.valueMapper.invert=function(a,c){var d=[],e={type:"fluid.transforms.valueMapper",options:d},f=b.isArrayable(a.options),g=function(c){return b.find(a.options,function(a){return a[c]?!0:void 0})},h=g("outputPath"),i=g("inputPath");h||(e.inputPath=b.model.composePaths(c.outputPrefix,a.outputPath)),i||(e.defaultOutputPath=b.model.composePaths(c.inputPrefix,a.inputPath));var j=b.firstDefined;return b.each(a.options,function(e,g){var k={},l=j(f?e.inputValue:g,a.defaultInputValue);void 0===l&&b.fail("Failure inverting configuration for valueMapper - inputValue could not be resolved for record "+g+": ",a),k.outputValue=l;var m=j(e.outputValue,a.defaultOutputValue);k.inputValue=b.model.transform.getValue(e.outputValuePath,m,c),h&&(k.inputPath=b.model.composePaths(c.outputPrefix,j(e.outputPath,a.outputPath))),i&&(k.outputPath=b.model.composePaths(c.inputPrefix,j(e.inputPath,a.inputPath))),e.outputValuePath&&(k.inputValuePath=e.outputValuePath),d.push(k)}),e},b.transforms.valueMapper.collect=function(a,c){var d=[];return b.model.transform.accumulateInputPath(a.inputPath,c,d),b.each(a.options,function(a){b.model.transform.accumulateInputPath(a.inputPath,c,d)}),d},b.defaults("fluid.transforms.arrayToSetMembership",{gradeNames:["fluid.standardInputTransformFunction","fluid.lens"],invertConfiguration:"fluid.transforms.arrayToSetMembership.invert"}),b.transforms.arrayToSetMembership=function(c,d,e){var f=d.options;c&&b.isArrayable(c)||b.fail("arrayToSetMembership didn't find array at inputPath nor passed as value.",d),f||b.fail("arrayToSetMembership requires an options block set"),void 0===d.presentValue&&(d.presentValue=!0),void 0===d.missingValue&&(d.missingValue=!1),b.each(f,function(f,g){var h=-1!==a.inArray(g,c)?d.presentValue:d.missingValue;b.model.transform.setValue(f,h,e)})},b.transforms.arrayToSetMembership.invert=function(a,c){var d=b.copy(a);delete d.inputPath,d.type="fluid.transforms.setMembershipToArray",d.outputPath=b.model.composePaths(c.inputPrefix,a.inputPath);var e={};return b.each(a.options,function(a,d){var f=b.model.composePaths(c.outputPrefix,a);e[f]=d}),d.options=e,d},b.defaults("fluid.transforms.setMembershipToArray",{gradeNames:["fluid.standardOutputTransformFunction"]}),b.transforms.setMembershipToArray=function(a,c){var d=a.options;d||b.fail("setMembershipToArray requires an options block specified"),void 0===a.presentValue&&(a.presentValue=!0),void 0===a.missingValue&&(a.missingValue=!1);var e=[];return b.each(d,function(d,f){var g=b.model.transform.getValue(f,void 0,c);g===a.presentValue&&e.push(d)}),e},b.model.transform.applyPaths=function(a,b,c){for(var d=0;d<c.length;++d)"push"===a?b.push(c[d]):b.pop()},b.model.transform.expandInnerValues=function(c,d,e,f){var g=e.inputPrefixOp,h=e.outputPrefixOp,i=b.model.transform.applyPaths;i("push",g,c),i("push",h,d);var j={};return b.each(f,function(c){var d=e.expand(c);b.isPrimitive(d)?j=d:a.extend(!0,j,d)}),i("pop",h,d),i("pop",g,c),j},b.defaults("fluid.transforms.arrayToObject",{gradeNames:["fluid.standardTransformFunction","fluid.lens"],invertConfiguration:"fluid.transforms.arrayToObject.invert"}),b.transforms.arrayToObject=function(a,c,d){void 0===c.key&&b.fail("arrayToObject requires a 'key' option.",c),b.isArrayable(a)||b.fail("arrayToObject didn't find array at inputPath.",c);var e={},f=c.key;return b.each(a,function(a,g){var h=a[f],i=typeof h;"string"!==i&&"boolean"!==i&&"number"!==i&&b.fail("arrayToObject encountered untransformable array due to missing or invalid key",a);var j=b.copy(a);delete j[f],c.innerValue&&(j=b.model.transform.expandInnerValues([d.inputPrefix,c.inputPath,g.toString()],[h],d,c.innerValue)),e[h]=j}),e},b.transforms.arrayToObject.invert=function(a,c){var d=b.copy(a);if(d.type="fluid.transforms.objectToArray",d.inputPath=b.model.composePaths(c.outputPrefix,a.outputPath),d.outputPath=b.model.composePaths(c.inputPrefix,a.inputPath),d.innerValue)for(var e=d.innerValue,f=0;f<e.length;++f)e[f]=b.model.transform.invertConfiguration(e[f]);return d},b.defaults("fluid.transforms.objectToArray",{gradeNames:"fluid.standardTransformFunction"}),b.transforms.objectToArray=function(c,d,e){void 0===d.key&&b.fail("objectToArray requires a 'key' option.",d);var f=[],g=d.key;return b.each(c,function(c,h){var i={};i[g]=h,d.innerValue&&(c=b.model.transform.expandInnerValues([d.inputPath,h],[d.outputPath,f.length.toString()],e,d.innerValue)),a.extend(!0,i,c),f.push(i)}),f},b.defaults("fluid.transforms.limitRange",{gradeNames:"fluid.standardTransformFunction"}),b.transforms.limitRange=function(a,b){var c=b.min;if(void 0!==c){var d=b.excludeMin||0;c+=d,c>a&&(a=c)}var e=b.max;if(void 0!==e){var f=b.excludeMax||0;e-=f,a>e&&(a=e)}return a},b.defaults("fluid.transforms.free",{gradeNames:"fluid.transformFunction"}),b.transforms.free=function(a){var c=b.makeArray(a.args);return b.invokeGlobalFunction(a.func,c)}}(jQuery,fluid_1_5);var fluid_1_5=fluid_1_5||{};!function(a,b){"use strict";b.defaults("fluid.commonViewComponent",{gradeNames:["fluid.littleComponent","autoInit"],initFunction:"fluid.initView",argumentMap:{container:0,options:1},members:{dom:"@expand:fluid.initDomBinder({that}, {that}.options.selectors)"}}),b.defaults("fluid.viewComponent",{gradeNames:["fluid.commonViewComponent","fluid.standardComponent","autoInit"]}),b.defaults("fluid.viewRelayComponent",{gradeNames:["fluid.commonViewComponent","fluid.standardRelayComponent","autoInit"]}),b.dumpSelector=function(a){return"string"==typeof a?a:a.selector?a.selector:""},b.diagnoseFailedView=function(a,c,d,e){if(!c&&(b.hasGrade(d,"fluid.viewComponent")||b.hasGrade(d,"fluid.viewRelayComponent"))){var f=b.wrap(e[1]),g="Instantiation of autoInit component with type "+a+" failed, since ";f?0===f.length?b.fail(g+'selector "',b.dumpSelector(e[1]),'" did not match any markup in the document'):b.fail(g+" component creator function did not return a value"):b.fail(g+" container argument is empty")}},b.checkTryCatchParameter=function(){var a=window.location||{search:"",protocol:"file:"},c=a.search.slice(1).split("&");return b.find(c,function(a){return 0===a.indexOf("notrycatch")?!0:void 0})===!0},b.notrycatch=b.checkTryCatchParameter(),b.wrap=function(b,c){return c=c||a,!b||b.jquery?b:c(b)},b.unwrap=function(a){return a&&a.jquery&&1===a.length?a[0]:a},b.container=function(a,c,d){d&&(a=b.unwrap(a));var e=b.wrap(a,d);if(c&&(!e||0===e.length))return null;if(!e||!e.jquery||1!==e.length){"string"!=typeof a&&(a=e.selector);var f=void 0!==e.length?e.length:0;b.fail((f>1?"More than one ("+f+") container elements were":"No container element was")+" found for selector "+a)}return b.isDOMNode(e[0])||b.fail("fluid.container was supplied a non-jQueryable element"),e},b.createDomBinder=function(a,c){function d(a,c){return b.allocateSimpleId(c)+"-"+a}function e(a,b,c){f[d(a,b)]=c}var f={},g={id:b.allocateGuid()},h=a.constructor;return g.locate=function(d,f){var g,i,j;return g=c[d],i=f?f:a,i||b.fail("DOM binder invoked for selector "+d+" without container"),g?(j="function"==typeof g?h(g.call(null,b.unwrap(i))):h(g,i),j.get(0)===document&&(j=[]),j.selector||(j.selector=g,j.context=i),j.selectorName=d,e(d,i,j),j):i},g.fastLocate=function(b,c){var e=c?c:a,h=d(b,e),i=f[h];return i?i:g.locate(b,c)},g.clear=function(){f={}},g.refresh=function(b,c){var d=c?c:a;"string"==typeof b&&(b=[b]),void 0===d.length&&(d=[d]);for(var e=0;e<b.length;++e)for(var f=0;f<d.length;++f)g.locate(b[e],d[f])},g.resolvePathSegment=g.locate,g},b.expectFilledSelector=function(a,c){a&&0===a.length&&a.jquery&&b.fail(c+': selector "'+a.selector+'" with name '+a.selectorName+" returned no results in context "+b.dumpEl(a.context))},b.initView=function(c,d,e,f){var g=b.container(d,!0);if(b.expectFilledSelector(g,'Error instantiating component with name "'+c),!g)return null;var h=function(a){a.container=g},i=b.initLittleComponent(c,e,f||{gradeNames:["fluid.viewComponent"]},h);i.dom||b.initDomBinder(i);var j=i.options.jQuery;return b.log("Constructing view component "+c+" with container "+g.constructor.expando+(j?" user jQuery "+j.expando:"")+" env: "+a.expando),i},b.initDomBinder=function(a,c){return a.dom=b.createDomBinder(a.container,c||a.options.selectors||{}),a.locate=a.dom.locate,a.dom},b.findAncestor=function(a,c){for(a=b.unwrap(a);a;){if(c(a))return a;a=a.parentNode}},b.findForm=function(a){return b.findAncestor(a,function(a){return"form"===a.nodeName.toLowerCase()})},b.each(["text","html"],function(c){b[c]=function(b,d){return b=a(b),void 0===d?b[c]():b[c](d)}}),b.value=function(c,d){var e=b.unwrap(c),f=!1;if(void 0===e.nodeType&&e.length>1&&(e=e[0],f=!0),"input"!==e.nodeName.toLowerCase()||!/radio|checkbox/.test(e.type))return void 0===d?a(e).val():a(e).val(d);var g=e.name;void 0===g&&b.fail("Cannot acquire value from node "+b.dumpEl(e)+" which does not have name attribute set");var h;if(f)h=c;else{h=e.ownerDocument.getElementsByName(g);var i=b.findForm(e);h=a.grep(h,function(a){return a.name!==g?!1:!i||b.dom.isContainer(i,a)})}if(void 0===d){var j=a.map(h,function(a){return a.checked?a.value:null});return"radio"===e.type?j[0]:j}"boolean"==typeof d&&(d=d?"true":"false"),a.each(h,function(){this.checked=d instanceof Array?-1!==a.inArray(this.value,d):d===this.value})},b.BINDING_ROOT_KEY="fluid-binding-root",b.findData=function(b,c){for(;b;){var d=a.data(b,c);if(d)return d;b=b.parentNode}},b.bindFossils=function(c,d,e){a.data(c,b.BINDING_ROOT_KEY,{data:d,fossils:e})},b.boundPathForNode=function(a,c){a=b.unwrap(a);var d=a.name||a.id,e=c[d];return e?e.EL:null},b.applyBoundChange=function(a,c,d){a=b.unwrap(a),void 0===c&&(c=b.value(a)),void 0===a.nodeType&&a.length>0&&(a=a[0]);var e=b.findData(a,b.BINDING_ROOT_KEY);e||b.fail("Bound data could not be discovered in any node above "+b.dumpEl(a));var f=a.name,g=e.fossils[f];g||b.fail("No fossil discovered for name "+f+" in fossil record above "+b.dumpEl(a)),"boolean"==typeof g.oldvalue&&(c=c[0]?!0:!1);var h=e.fossils[f].EL;d?d.fireChangeRequest({path:h,value:c,source:"DOM:"+a.id}):b.set(e.data,h,c)},b.jById=function(c,d){d=d&&9===d.nodeType?d:document;var e=b.byId(c,d),f=e?a(e):[];return f.selector="#"+c,f.context=d,f},b.byId=function(a,c){c=c&&9===c.nodeType?c:document;var d=c.getElementById(a);return d?(d.id!==a&&b.fail("Problem in document structure - picked up element "+b.dumpEl(d)+" for id "+a+" without this id - most likely the element has a name which conflicts with this id"),d):null},b.getId=function(a){return b.unwrap(a).id},b.allocateSimpleId=function(a){var c="fluid-id-"+b.allocateGuid();return!a||b.isPrimitive(a)?c:(a=b.unwrap(a),a.id||(a.id=c),a.id)},b.defaults("fluid.ariaLabeller",{labelAttribute:"aria-label",liveRegionMarkup:'<div class="liveRegion fl-offScreen-hidden" aria-live="polite"></div>',liveRegionId:"fluid-ariaLabeller-liveRegion",events:{generateLiveElement:"unicast"},listeners:{generateLiveElement:"fluid.ariaLabeller.generateLiveElement"}}),b.ariaLabeller=function(a,c){var d=b.initView("fluid.ariaLabeller",a,c);return d.update=function(a){if(a=a||d.options,d.container.attr(d.options.labelAttribute,a.text),a.dynamicLabel){var c=b.jById(d.options.liveRegionId);0===c.length&&(c=d.events.generateLiveElement.fire(d)),c.text(a.text)}},d.update(),d},b.ariaLabeller.generateLiveElement=function(b){var c=a(b.options.liveRegionMarkup);return c.prop("id",b.options.liveRegionId),a("body").append(c),c};var c="aria-labelling";b.getAriaLabeller=function(d){d=a(d);var e=b.getScopedData(d,c);return e},b.updateAriaLabel=function(d,e,f){f=a.extend({},f||{},{text:e});var g=b.getAriaLabeller(d);return g?g.update(f):(g=b.ariaLabeller(d,f),b.setScopedData(d,c,g)),g};var d={};a(document).click(function(a){for(var c=b.resolveEventTarget(a);c;){if(d[c.id])return;c=c.parentNode}b.each(d,function(b,c){b(a),delete d[c]})}),b.globalDismissal=function(a,c){b.each(a,function(a){var e=b.unwrap(a).ownerDocument===document?b.allocateSimpleId(a):b.allocateGuid();c?d[e]=c:delete d[e]})},b.now=function(){return Date.now?Date.now():(new Date).getTime()},b.deadMansBlur=function(c,d){var e={options:a.extend(!0,{},b.defaults("fluid.deadMansBlur"),d)};return e.blurPending=!1,e.lastCancel=0,e.canceller=function(a){b.log("Cancellation through "+a.type+" on "+b.dumpEl(a.target)),e.lastCancel=b.now(),e.blurPending=!1},e.noteProceeded=function(){b.globalDismissal(e.options.exclusions)},e.reArm=function(){b.globalDismissal(e.options.exclusions,e.proceed)},e.addExclusion=function(a){b.globalDismissal(a,e.proceed)},e.proceed=function(a){b.log("Direct proceed through "+a.type+" on "+b.dumpEl(a.target)),e.blurPending=!1,e.options.handler(c)},b.each(e.options.exclusions,function(c){c=a(c),b.each(c,function(b){a(b).bind("focusin",e.canceller).bind("fluid-focus",e.canceller).click(e.canceller).mousedown(e.canceller)})}),e.options.cancelByDefault?e.reArm():a(c).bind("focusout",function(a){b.log("Starting blur timer for element "+b.dumpEl(a.target));var d=b.now();b.log("back delay: "+(d-e.lastCancel)),d-e.lastCancel>e.options.backDelay&&(e.blurPending=!0),setTimeout(function(){e.blurPending&&e.options.handler(c)},e.options.delay)}),e},b.defaults("fluid.deadMansBlur",{delay:150,backDelay:100})}(jQuery,fluid_1_5);var fluid_1_5=fluid_1_5||{};!function(a,b){"use strict";function c(a){return a}var d={},e={};b.fetchResources=function(a,c,d){var e=b.initLittleComponent("fluid.fetchResources",d);return e.resourceSpecs=a,e.callback=c,e.operate=function(){b.fetchResources.fetchResourcesImpl(e)},b.each(a,function(a,c){a.recurseFirer=b.event.getEventFirer(null,null,'I/O completion for resource "'+c+'"'),a.recurseFirer.addListener(e.operate),a.url&&!a.href&&(a.href=a.url)}),e.options.amalgamateClasses&&b.fetchResources.amalgamateClasses(a,e.options.amalgamateClasses,e.operate),e.operate(),e},b.fetchResources.amalgamateClasses=function(a,c,d){b.each(c,function(c){var f=e[c];b.each(f,function(b,e){a[c+"!"+e]=b,b.recurseFirer.addListener(d)})})},b.fetchResources.timeSuccessCallback=function(a){if(a.timeSuccess&&a.options&&a.options.success){var c=a.options.success;a.options.success=function(){var d=new Date,e=c.apply(null,arguments);return b.log("External callback for URL "+a.href+" completed - callback time: "+((new Date).getTime()-d.getTime())+"ms"),e}}},b.fetchResources.clearResourceCache=function(a){a?delete d[c(a)]:b.clear(d)},b.fetchResources.handleCachedRequest=function(a,f){var g=c(a.href),h=d[g];if(h.$$firer$$){b.log("Handling request for "+g+" from cache");var i=a.fetchClass;i&&e[i]&&(b.log("Clearing pendingClass entry for class "+i),delete e[i][g]),d[g]=f,h.fire(f)}},b.fetchResources.completeRequest=function(a){a.queued=!1,a.completeTime=new Date,b.log("Request to URL "+a.href+" completed - total elapsed time: "+(a.completeTime.getTime()-a.initTime.getTime())+"ms"),a.recurseFirer.fire()},b.fetchResources.makeResourceCallback=function(a){return{success:function(c){a.resourceText=c,a.resourceKey=a.href,a.forceCache&&b.fetchResources.handleCachedRequest(a,c),b.fetchResources.completeRequest(a)},error:function(c,d,e){a.fetchError={status:c.status,textStatus:c.textStatus,errorThrown:e},b.fetchResources.completeRequest(a)}}},b.fetchResources.issueCachedRequest=function(f,g){var h=c(f.href),i=d[h];if(i)i.$$firer$$?(b.log("Request for cached resource which is in flight: url "+h),i.addListener(function(a){g.success(a)})):g.success(i);else{b.log("First request for cached resource with url "+h),i=b.event.getEventFirer(null,null,"cache notifier for resource URL "+h),i.$$firer$$=!0,d[h]=i;var j=f.fetchClass;j&&(e[j]||(e[j]={}),e[j][h]=f),g.cache=!1,a.ajax(g)}},b.fetchResources.composeCallbacks=function(a,c){return c?a?function(){try{c.apply(null,arguments)}catch(d){b.log("Exception applying external fetchResources callback: "+d)}a.apply(null,arguments)}:c:a},b.fetchResources.composePolicy=function(a,c){return b.fetchResources.composeCallbacks(a,c)},b.defaults("fluid.fetchResources.issueRequest",{mergePolicy:{success:b.fetchResources.composePolicy,error:b.fetchResources.composePolicy,url:"reverse"}}),b.fetchResources.issueRequest=function(c,d){var e=b.fetchResources.makeResourceCallback(c),f={url:c.href,success:e.success,error:e.error,dataType:c.dataType||"text"};b.fetchResources.timeSuccessCallback(c),f=b.merge(b.defaults("fluid.fetchResources.issueRequest").mergePolicy,f,c.options),c.queued=!0,c.initTime=new Date,b.log("Request with key "+d+" queued for "+c.href),c.forceCache?b.fetchResources.issueCachedRequest(c,f):a.ajax(f)},b.fetchResources.fetchResourcesImpl=function(c){var d=!0,e=!0,f=c.resourceSpecs;for(var g in f){var h=f[g];if((!h.options||h.options.async)&&(e=!1),h.href&&!h.completeTime)h.queued||b.fetchResources.issueRequest(h,g),h.queued&&(d=!1);else if(h.nodeId&&!h.resourceText){var i=document.getElementById(h.nodeId);h.resourceText=b.dom.getElementText(i),h.resourceKey=h.nodeId}}d&&c.callback&&!c.callbackCalled&&(c.callbackCalled=!0,a.browser.mozilla&&!e?setTimeout(function(){c.callback(f)},1):c.callback(f))},b.fetchResources.primeCacheFromResources=function(a){var c=b.defaults(a).resources,d=(b.expandOptions?b.expandOptions:b.identity)(b.copy(c));b.fetchResources(d)},b.registerNamespace("fluid.expander"),b.expander.makeDefaultFetchOptions=function(c,d,e){return a.extend(!0,{dataType:"text"},e,{success:function(a,b){var d=JSON.parse(a);b(c(d))},error:function(a,c){b.log("Error fetching "+d+": "+c)}})},b.expander.makeFetchExpander=function(a){return{expander:{type:"fluid.expander.deferredFetcher",href:a.url,options:b.expander.makeDefaultFetchOptions(a.disposer,a.url,a.options),resourceSpecCollector:"{resourceSpecCollector}",fetchKey:a.fetchKey}}},b.expander.deferredFetcher=function(a,c,d){var e=c.expander,f=b.copy(e),g=b.expand(e.resourceSpecCollector,d);delete f.type,delete f.resourceSpecCollector,delete f.fetchKey;var h=function(b){a(b)};f.options.success=function(a){e.options.success(a,h)};var i=e.fetchKey||b.allocateGuid();return g[i]=f,b.NO_VALUE}}(jQuery,fluid_1_5),function(){var a="undefined"!=typeof window?window:"undefined"!=typeof self?self:global;!function(){if(!a.DSP){var b={};b.add=function(a,b,c){var d;if(c instanceof Float32Array)for(d=Math.min(a.length,b.length,c.length)-1;d>=0;--d)a[d]=b[d]+c[d];else for(d=Math.min(a.length,b.length)-1;d>=0;--d)a[d]=b[d]+c},b.sub=function(a,b,c){var d;if(c instanceof Float32Array)for(d=Math.min(a.length,b.length,c.length)-1;d>=0;--d)a[d]=b[d]-c[d];else for(d=Math.min(a.length,b.length)-1;d>=0;--d)a[d]=b[d]-c},b.mul=function(a,b,c){var d;if(c instanceof Float32Array)for(d=Math.min(a.length,b.length,c.length)-1;d>=0;--d)a[d]=b[d]*c[d];else for(d=Math.min(a.length,b.length)-1;d>=0;--d)a[d]=b[d]*c},b.mulCplx=function(a,b,c,d,e,f){var g,h,i,j,k;if(e instanceof Float32Array)for(g=Math.min(a.length,b.length,c.length,d.length,e.length,f.length)-1;g>=0;--g)h=c[g],i=d[g],j=e[g],k=f[g],a[g]=h*j-i*k,b[g]=h*k+i*j;else for(g=Math.min(a.length,b.length,c.length,d.length)-1;g>=0;--g)h=c[g],i=d[g],a[g]=h*e-i*f,b[g]=h*f+i*e},b.div=function(a,b,c){var d;if(c instanceof Float32Array)for(d=Math.min(a.length,b.length,c.length)-1;d>=0;--d)a[d]=b[d]/c[d];else for(d=Math.min(a.length,b.length)-1;d>=0;--d)a[d]=b[d]/c},b.divCplx=function(a,b,c,d,e,f){var g,h,i,j,k,l;if(e instanceof Float32Array)for(g=Math.min(a.length,b.length,c.length,d.length,e.length,f.length)-1;g>=0;--g)h=c[g],i=d[g],j=e[g],k=f[g],l=1/(j*j+k*k),a[g]=(h*j+i*k)*l,b[g]=(i*j-h*k)*l;else for(l=1/(e*e+f*f),g=Math.min(a.length,b.length,c.length,d.length)-1;g>=0;--g)h=c[g],i=d[g],a[g]=(h*e+i*f)*l,b[g]=(i*e-h*f)*l},b.madd=function(a,b,c,d){var e;if(d instanceof Float32Array)for(e=Math.min(a.length,b.length,c.length,d.length)-1;e>=0;--e)a[e]=b[e]+c[e]*d[e];else for(e=Math.min(a.length,b.length)-1;e>=0;--e)a[e]=b[e]+c[e]*d},b.abs=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.abs(b[c])},b.absCplx=function(a,b,c){for(var d=Math.min(a.length,b.length,c.length)-1;d>=0;--d)a[d]=Math.sqrt(b[d]*b[d]+c[d]*c[d])},b.acos=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.acos(b[c])},b.asin=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.asin(b[c])},b.atan=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.atan(b[c])},b.atan2=function(a,b,c){for(var d=Math.min(a.length,c.length,b.length)-1;d>=0;--d)a[d]=Math.atan2(b[d],c[d])},b.ceil=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.ceil(b[c])},b.cos=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.cos(b[c])},b.exp=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.exp(b[c])},b.floor=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.floor(b[c])},b.log=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.log(b[c])},b.max=function(a){for(var b=-1/0,c=a.length-1;c>=0;--c){var d=a[c];d>b&&(b=d)}return b},b.min=function(a){for(var b=1/0,c=a.length-1;c>=0;--c){var d=a[c];b>d&&(b=d)}return b},b.pow=function(a,b,c){var d;if(c instanceof Float32Array)for(d=Math.min(a.length,b.length,c.length)-1;d>=0;--d)a[d]=Math.pow(b[d],c[d]);else if(2==c)for(d=Math.min(a.length,b.length)-1;d>=0;--d){var e=b[d];a[d]=e*e}else if(3==c)for(d=Math.min(a.length,b.length)-1;d>=0;--d){var e=b[d];a[d]=e*e*e}else if(4==c)for(d=Math.min(a.length,b.length)-1;d>=0;--d){var e=b[d];e*=e,a[d]=e*e}else if(-1==c)for(d=Math.min(a.length,b.length)-1;d>=0;--d)a[d]=1/b[d];else if(-2==c)for(d=Math.min(a.length,b.length)-1;d>=0;--d){var e=1/b[d];a[d]=e*e}else for(d=Math.min(a.length,b.length)-1;d>=0;--d)a[d]=Math.pow(b[d],c)},b.random=function(a,b,c){b||(b=0),isNaN(parseFloat(c))&&(c=1);for(var d=c-b,e=a.length-1;e>=0;--e)a[e]=Math.random()*d+b},b.round=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.round(b[c])},b.sin=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.sin(b[c])},b.sqrt=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.sqrt(b[c])},b.tan=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=Math.tan(b[c])},b.clamp=function(a,b,c,d){for(var e=Math.min(a.length,b.length)-1;e>=0;--e){var f=b[e];a[e]=c>f?c:f>d?d:f}},b.fract=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c){var d=b[c];a[c]=d-Math.floor(d)}},b.ramp=function(a,b,c){var d=a.length-1;if(d>=0&&(a[0]=b),d>0)for(var e=(c-b)/d,f=1;d>=f;++f)a[f]=b+e*f},b.sign=function(a,b){for(var c=Math.min(a.length,b.length)-1;c>=0;--c)a[c]=b[c]<0?-1:1},b.sum=function(a){for(var b=0,c=a.length-1;c>=0;--c)b+=a[c];return b},b.sampleLinear=function(a,b,c,d){var e=b.length,f=e-1;if(d)for(var g=Math.min(a.length,c.length)-1;g>=0;--g){var h=c[g];h-=Math.floor(h/e)*e;var i=Math.floor(h),j=h-i,k=b[i],l=b[f>i?i+1:0];a[g]=k+j*(l-k)}else for(var g=Math.min(a.length,c.length)-1;g>=0;--g){var h=c[g];h=0>h?0:h>f?f:h;var i=Math.floor(h),j=h-i,k=b[i],l=b[f>i?i+1:f];a[g]=k+j*(l-k)}},b.sampleCubic=function(a,b,c,d){var e=b.length,f=e-1;if(d)for(var g=Math.min(a.length,c.length)-1;g>=0;--g){var h=c[g];h-=Math.floor(h/e)*e;var i=Math.floor(h),j=h-i,k=j*j,l=k*j,m=-2*l+3*k,n=1-m,o=l-k,p=o-k+j,q=b[i>0?i-1:f],r=b[i],s=b[f>i?i+1:0],t=b[f-1>i?i+2:i+2-Math.floor((i+2)/e)*e];a[g]=n*r+m*s+.5*(p*(s-q)+o*(t-r))}else for(var g=Math.min(a.length,c.length)-1;g>=0;--g){var h=c[g];h=0>h?0:h>f?f:h;var i=Math.floor(h),j=h-i,k=j*j,l=k*j,m=-2*l+3*k,n=1-m,o=l-k,p=o-k+j,q=b[i>0?i-1:0],r=b[i],s=b[f>i?i+1:f],t=b[f-1>i?i+2:f];a[g]=n*r+m*s+.5*(p*(s-q)+o*(t-r))}},b.pack=function(a,b,c,d,e,f,g){var h=Math.floor((a.length-b)/c),i=Math.min(h,d.length);if(e)if(f)if(g)for(var j=0;i>j;++j)a[b]=d[j],a[b+1]=e[j],a[b+2]=f[j],a[b+3]=g[j],b+=c;else for(var j=0;i>j;++j)a[b]=d[j],a[b+1]=e[j],a[b+2]=f[j],b+=c;else for(var j=0;i>j;++j)a[b]=d[j],a[b+1]=e[j],b+=c;else for(var j=0;i>j;++j)a[b]=d[j],b+=c},b.unpack=function(a,b,c,d,e,f,g){var h=Math.floor((a.length-b)/c),i=Math.min(h,d.length);if(e)if(f)if(g)for(var j=0;i>j;++j)d[j]=a[b],e[j]=a[b+1],f[j]=a[b+2],g[j]=a[b+3],b+=c;else for(var j=0;i>j;++j)d[j]=a[b],e[j]=a[b+1],f[j]=a[b+2],b+=c;else for(var j=0;i>j;++j)d[j]=a[b],e[j]=a[b+1],b+=c;else for(var j=0;i>j;++j)d[j]=a[b],b+=c},a.DSP=b}}(),function(){if(!a.Filter){var b=function(a,b){(isNaN(parseFloat(a))||!isFinite(a))&&(a=1),b||(b=0),this.b=new Float32Array(a),this.b[0]=1,this.a=new Float32Array(b),this._bHist=new Float32Array(a),this._aHist=new Float32Array(b)};b.prototype.filter=function(a,b){var c,d=this.a,e=d.length,f=this.b,g=f.length,h=this._aHist,i=this._bHist,j=b.length,k=a.length,l=g-1,m=e;for(c=0;(l||m)&&j>c;++c){var n,o;o=g-l,l&&l--;var p=f[0]*b[c];for(n=1;o>n;++n)p+=f[n]*b[c-n];for(;g>n;++n)p+=f[n]*i[n-o];for(o=e-m,m&&m--,n=0;o>n;++n)p-=d[n]*a[c-1-n];for(;e>n;++n)p-=d[n]*h[n-o];a[c]=p}if(3==g&&2==e)for(var q,r,s=f[0],t=f[1],u=f[2],v=d[0],w=d[1],x=b[c-1],y=b[c-2],z=a[c-1],A=a[c-2];j>c;++c)q=y,y=x,x=b[c],r=A,A=z,z=s*x+t*y+u*q-v*A-w*r,a[c]=z;else for(;j>c;++c){var n,p=f[0]*b[c];for(n=1;g>n;++n)p+=f[n]*b[c-n];for(n=0;e>n;++n)p-=d[n]*a[c-1-n];a[c]=p}var B=Math.min(g-1,j);for(c=g-2;c>=B;--c)i[c]=i[c-B];for(c=0;B>c;++c)i[c]=b[j-1-c];for(B=Math.min(e,k),c=e-1;c>=B;--c)h[c]=h[c-B];for(c=0;B>c;++c)h[c]=a[j-1-c]},b.prototype.clearHistory=function(){for(var a=this._bHist.length-1;a>=0;--a)this._bHist[a]=0;for(var a=this._aHist.length-1;a>=0;--a)this._aHist[a]=0},a.Filter=b}}(),function(){if(!a.FFT){var b=function(a,b,c,d,e,f,g){for(var h,i,j,k,l,m,n,o,p=0,q=c,r=c+g,s=q+g;s>q;)j=.5*a[q],k=.5*b[q],l=.5*a[r],m=.5*b[r],n=e[p],o=f[p],h=l*n-m*o,i=l*o+m*n,a[r]=j-h,b[r]=k-i,a[q]=j+h,b[q]=k+i,p+=d,++q,++r},c=function(a,b,c,d,e,f,g){for(var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x=0,y=0,z=2*d,A=c,B=c+g,C=c+2*g,D=f[d*g],E=1/3,F=A+g;F>A;)p=a[A]*E,q=b[A]*E,r=a[B]*E,s=b[B]*E,t=a[C]*E,u=b[C]*E,v=e[x],w=f[x],j=r*v-s*w,k=r*w+s*v,v=e[y],w=f[y],l=t*v-u*w,m=t*w+u*v,n=j+l,o=k+m,h=j-l,i=k-m,r=p-.5*n,s=q-.5*o,h*=D,i*=D,a[A]=p+n,b[A]=q+o,a[C]=r+i,b[C]=s-h,a[B]=r-i,b[B]=s+h,x+=d,y+=z,++A,++B,++C},d=function(a,b,c,d,e,f,g,h){for(var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E=0,F=0,G=0,H=2*d,I=3*d,J=c,K=c+g,L=c+2*g,M=c+3*g,N=.25,O=J+g;O>J;)u=a[J]*N,v=b[J]*N,w=a[K]*N,x=b[K]*N,y=a[L]*N,z=b[L]*N,A=a[M]*N,B=b[M]*N,C=e[E],D=f[E],i=w*C-x*D,j=w*D+x*C,C=e[F],D=f[F],k=y*C-z*D,l=y*D+z*C,C=e[G],D=f[G],m=A*C-B*D,n=A*D+B*C,s=u-k,t=v-l,u+=k,v+=l,o=i+m,p=j+n,q=i-m,r=j-n,a[L]=u-o,b[L]=v-p,a[J]=u+o,b[J]=v+p,h?(a[K]=s-r,b[K]=t+q,a[M]=s+r,b[M]=t-q):(a[K]=s+r,b[K]=t-q,a[M]=s-r,b[M]=t+q),E+=d,F+=H,G+=I,++J,++K,++L,++M},e=function(a,b,c,d,e,f,g){for(var h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T=0,U=0,V=0,W=0,X=2*d,Y=3*d,Z=4*d,$=c,_=c+g,ab=c+2*g,bb=c+3*g,cb=c+4*g,db=e[d*g],eb=f[d*g],fb=e[2*d*g],gb=f[2*d*g],hb=.2,ib=$+g;ib>$;)H=a[$]*hb,I=b[$]*hb,J=a[_]*hb,K=b[_]*hb,L=a[ab]*hb,M=b[ab]*hb,N=a[bb]*hb,O=b[bb]*hb,P=a[cb]*hb,Q=b[cb]*hb,h=H,i=I,R=e[T],S=f[T],j=J*R-K*S,k=J*S+K*R,R=e[U],S=f[U],l=L*R-M*S,m=L*S+M*R,R=e[V],S=f[V],n=N*R-O*S,o=N*S+O*R,R=e[W],S=f[W],p=P*R-Q*S,q=P*S+Q*R,v=j+p,w=k+q,B=j-p,C=k-q,x=l+n,y=m+o,z=l-n,A=m-o,a[$]=H+v+x,b[$]=I+w+y,r=h+v*db+x*fb,s=i+w*db+y*fb,t=C*eb+A*gb,u=-B*eb-z*gb,a[_]=r-t,b[_]=s-u,a[cb]=r+t,b[cb]=s+u,D=h+v*fb+x*db,E=i+w*fb+y*db,F=-C*gb+A*eb,G=B*gb-z*eb,a[ab]=D+F,b[ab]=E+G,a[bb]=D-F,b[bb]=E-G,T+=d,U+=X,V+=Y,W+=Z,++$,++_,++ab,++bb,++cb
},f=function(a,b,c,d,e,f,g,h,i){var j,k,l,m,n,o,p,q,r,s,t=new Float32Array(h),u=new Float32Array(h),v=1/h;for(j=0;g>j;++j){for(m=c+j,k=0;h>k;++k)t[k]=a[m]*v,u[k]=b[m]*v,m+=g;m=c+j;var w=d*j;for(k=0;h>k;++k){n=t[0],o=u[0];var x=0;for(l=1;h>l;++l)x+=w,x>=i&&(x-=i),p=t[l],q=u[l],r=e[x],s=f[x],n+=p*r-q*s,o+=p*s+q*r;a[m]=n,b[m]=o,m+=g,w+=d}}},g=function(a,h,i,j,k,l,m,n,o,p,q,r,s,t){var u=o[p++],v=o[p++],w=i,x=i+u*v,y=m*n;if(1==v){do a[i]=j[l],h[i]=k[l],l+=y,++i;while(i!=x)}else do g(a,h,i,j,k,l,m*u,n,o,p,q,r,s,t),l+=y,i+=v;while(i!=x);switch(i=w,u){case 2:b(a,h,i,m,q,r,v);break;case 3:c(a,h,i,m,q,r,v);break;case 4:d(a,h,i,m,q,r,v,t);break;case 5:e(a,h,i,m,q,r,v);break;default:f(a,h,i,m,q,r,v,u,s)}},h=function(a,b){var c=4,d=Math.floor(Math.sqrt(a)),e=0;do{for(;a%c;){switch(c){case 4:c=2;break;case 2:c=3;break;default:c+=2}c>d&&(c=a)}a=Math.floor(a/c),b[e++]=c,b[e++]=a}while(a>1)},i=function(a){a||(a=256),this.size=a,this._twiddlesFwdRe=new Float32Array(a),this._twiddlesFwdIm=new Float32Array(a),this._twiddlesInvRe=this._twiddlesFwdRe,this._twiddlesInvIm=new Float32Array(a);for(var b=0;a>b;++b){var c=-2*Math.PI*b/a,d=Math.cos(c),e=Math.sin(c);this._twiddlesFwdRe[b]=d,this._twiddlesFwdIm[b]=e,this._twiddlesInvIm[b]=-e}this._factors=new Int32Array(64),h(a,this._factors)};i.prototype.forwardCplx=function(a,b,c,d){var e=this._twiddlesFwdRe,f=this._twiddlesFwdIm;g(a,b,0,c,d,0,1,1,this._factors,0,e,f,this.size,!1)},i.prototype.forward=function(a,b,c){this.forwardCplx(a,b,c,new Float32Array(this.size))},i.prototype.inverseCplx=function(a,b,c,d){var e=this._twiddlesInvRe,f=this._twiddlesInvIm;g(a,b,0,c,d,0,1,1,this._factors,0,e,f,this.size,!0)},i.prototype.inverse=function(a,b,c){this.inverseCplx(a,new Float32Array(this.size),b,c)},a.FFT=i}}()}();var Random=function(a){if(a=void 0===a?(new Date).getTime():a,"number"!=typeof a||Math.ceil(a)!=Math.floor(a))throw new TypeError("seed value must be an integer");this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=new Array(this.N),this.mti=this.N+1,this.init_by_array([a],1)};Random.prototype.init_genrand=function(a){for(this.mt[0]=a>>>0,this.mti=1;this.mti<this.N;this.mti++){var a=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&a)>>>16)<<16)+1812433253*(65535&a)+this.mti,this.mt[this.mti]>>>=0}},Random.prototype.init_by_array=function(a,b){var c,d,e;for(this.init_genrand(19650218),c=1,d=0,e=this.N>b?this.N:b;e;e--){var f=this.mt[c-1]^this.mt[c-1]>>>30;this.mt[c]=(this.mt[c]^(1664525*((4294901760&f)>>>16)<<16)+1664525*(65535&f))+a[d]+d,this.mt[c]>>>=0,c++,d++,c>=this.N&&(this.mt[0]=this.mt[this.N-1],c=1),d>=b&&(d=0)}for(e=this.N-1;e;e--){var f=this.mt[c-1]^this.mt[c-1]>>>30;this.mt[c]=(this.mt[c]^(1566083941*((4294901760&f)>>>16)<<16)+1566083941*(65535&f))-c,this.mt[c]>>>=0,c++,c>=this.N&&(this.mt[0]=this.mt[this.N-1],c=1)}this.mt[0]=2147483648},Random.prototype.genrand_int32=function(){var a,b=new Array(0,this.MATRIX_A);if(this.mti>=this.N){var c;for(this.mti==this.N+1&&this.init_genrand(5489),c=0;c<this.N-this.M;c++)a=this.mt[c]&this.UPPER_MASK|this.mt[c+1]&this.LOWER_MASK,this.mt[c]=this.mt[c+this.M]^a>>>1^b[1&a];for(;c<this.N-1;c++)a=this.mt[c]&this.UPPER_MASK|this.mt[c+1]&this.LOWER_MASK,this.mt[c]=this.mt[c+(this.M-this.N)]^a>>>1^b[1&a];a=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^a>>>1^b[1&a],this.mti=0}return a=this.mt[this.mti++],a^=a>>>11,a^=a<<7&2636928640,a^=a<<15&4022730752,a^=a>>>18,a>>>0},Random.prototype.genrand_int31=function(){return this.genrand_int32()>>>1},Random.prototype.genrand_real1=function(){return this.genrand_int32()*(1/4294967295)},Random.prototype.random=function(){return this.pythonCompatibility&&(this.skip&&this.genrand_int32(),this.skip=!0),this.genrand_int32()*(1/4294967296)},Random.prototype.genrand_real3=function(){return(this.genrand_int32()+.5)*(1/4294967296)},Random.prototype.genrand_res53=function(){var a=this.genrand_int32()>>>5,b=this.genrand_int32()>>>6;return(67108864*a+b)*(1/9007199254740992)},Random.prototype.LOG4=Math.log(4),Random.prototype.SG_MAGICCONST=1+Math.log(4.5),Random.prototype.exponential=function(a){if(1!=arguments.length)throw new SyntaxError("exponential() must  be called with 'lambda' parameter");var b=this.random();return-Math.log(b)/a},Random.prototype.gamma=function(a,b){if(2!=arguments.length)throw new SyntaxError("gamma() must be called with alpha and beta parameters");if(!(a>1)){if(1==a){for(var c=this.random();1e-7>=c;)c=this.random();return-Math.log(c)*b}for(;;){var c=this.random(),d=(Math.E+a)/Math.E,e=d*c;if(1>=e)var f=Math.pow(e,1/a);else var f=-Math.log((d-e)/a);var g=this.random();if(e>1){if(g<=Math.pow(f,a-1))break}else if(g<=Math.exp(-f))break}return f*b}for(var h=Math.sqrt(2*a-1),i=a-this.LOG4,j=a+h;;){var g=this.random();if(!(1e-7>g||c>.9999999)){var k=1-this.random(),l=Math.log(g/(1-g))/h,f=a*Math.exp(l),m=g*g*k,n=i+j*l-f;if(n+this.SG_MAGICCONST-4.5*m>=0||n>=Math.log(m))return f*b}}},Random.prototype.normal=function(a,b){if(2!=arguments.length)throw new SyntaxError("normal() must be called with mu and sigma parameters");var c=this.lastNormal;if(this.lastNormal=0/0,!c){var d=2*this.random()*Math.PI,e=Math.sqrt(-2*Math.log(1-this.random()));c=Math.cos(d)*e,this.lastNormal=Math.sin(d)*e}return a+c*b},Random.prototype.pareto=function(a){if(1!=arguments.length)throw new SyntaxError("pareto() must be called with alpha parameter");var b=this.random();return 1/Math.pow(1-b,1/a)},Random.prototype.triangular=function(a,b,c){if(3!=arguments.length)throw new SyntaxError("triangular() must be called with lower, upper and mode parameters");var d=(c-a)/(b-a),e=this.random();return d>=e?a+Math.sqrt(e*(b-a)*(c-a)):b-Math.sqrt((1-e)*(b-a)*(b-c))},Random.prototype.uniform=function(a,b){if(2!=arguments.length)throw new SyntaxError("uniform() must be called with lower and upper parameters");return a+this.random()*(b-a)},Random.prototype.weibull=function(a,b){if(2!=arguments.length)throw new SyntaxError("weibull() must be called with alpha and beta parameters");var c=1-this.random();return a*Math.pow(-Math.log(c),1/b)};var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";var a=fluid.registerNamespace("jQuery");flock.init=function(a){var b=a?{audioSettings:a}:void 0;flock.enviro.shared=flock.enviro(b)},flock.OUT_UGEN_ID="flocking-out",flock.PI=Math.PI,flock.TWOPI=2*Math.PI,flock.HALFPI=Math.PI/2,flock.LOG01=Math.log(.1),flock.LOG001=Math.log(.001),flock.ROOT2=Math.sqrt(2),flock.rates={AUDIO:"audio",CONTROL:"control",SCHEDULED:"scheduled",DEMAND:"demand",CONSTANT:"constant"},flock.sampleFormats={FLOAT32NE:"float32NE"},flock.browser=function(){if("undefined"==typeof navigator)return{};var a,b,c=navigator.userAgent.toLowerCase(),d={};return a=/(chrome)[ \/]([\w.]+)/.exec(c)||/(webkit)[ \/]([\w.]+)/.exec(c)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(c)||/(msie) ([\w.]+)/.exec(c)||c.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(c)||[],b={browser:a[1]||"",version:a[2]||"0"},b.browser&&(d[b.browser]=!0,d.version=b.version),d.chrome?d.webkit=!0:d.webkit&&(d.safari=!0),d},fluid.registerNamespace("flock.platform"),flock.platform.isBrowser="undefined"!=typeof window,flock.platform.hasRequire="undefined"!=typeof require,flock.platform.os=flock.platform.isBrowser?window.navigator.platform:fluid.require("os").platform(),flock.platform.isLinux=flock.platform.os.indexOf("Linux")>-1,flock.platform.isAndroid=flock.platform.isLinux&&flock.platform.os.indexOf("arm")>-1,flock.platform.isIOS="iPhone"===flock.platform.os||"iPad"===flock.platform.os||"iPod"===flock.platform.os,flock.platform.isMobile=flock.platform.isAndroid||flock.platform.isIOS,flock.platform.browser=flock.browser(),flock.platform.isWebAudio="undefined"!=typeof AudioContext||"undefined"!=typeof webkitAudioContext,flock.platform.audioEngine=flock.platform.isBrowser?flock.platform.isWebAudio?"webAudio":"moz":"nodejs",fluid.staticEnvironment.audioEngine=fluid.typeTag("flock.platform."+flock.platform.audioEngine),flock.defaultBufferSizeForPlatform=function(){return flock.platform.browser.mozilla?16384:flock.platform.isMobile?8192:1024},flock.shim={URL:flock.platform.isBrowser?window.URL||window.webkitURL||window.msURL:void 0},flock.requireModule=function(a,b){return b||(b=a),flock.platform.isBrowser?window[a]:flock.platform.hasRequire?require(b)[a]:void 0},flock.isIterable=function(a){var b=typeof a;return a&&void 0!==a.length&&"string"!==b&&"function"!==b},flock.hasTag=function(a,b){return a&&b?a.tags&&a.tags.indexOf(b)>-1:!1},flock.generate=function(a,b){var c,d="number"==typeof a?new Float32Array(a):a,e="function"==typeof b;for(c=0;c<d.length;c++)d[c]=e?b(c,d):b;return d},flock.generate.silence=function(a){if("number"==typeof a)return new Float32Array(a);var b,c=a;for(b=0;b<c.length;b++)c[b]=0;return c},flock.randomIndex=function(a){var b=a.length-1;return Math.round(Math.random()*b)},flock.arrayChoose=function(a,b){b=b||flock.randomIndex,a=fluid.makeArray(a);var c=b(a);return a[c]},flock.choose=function(a,b){var c,d;return flock.isIterable(a)?d=flock.arrayChoose(a,b):(c=flock.arrayChoose(a.keys,b),d=a[c])},flock.normalize=function(a,b,c){c=c||a;var d,e,f,g=0;for(b=void 0===b?1:b,d=0;d<a.length;d++)e=Math.abs(a[d]),e>g&&(g=e);if(g>0)for(d=0;d<a.length;d++)f=a[d],c[d]=f/g*b;return c},flock.range=function(a){var b,c,d={max:Number.NEGATIVE_INFINITY,min:1/0};for(b=0;b<a.length;b++)c=a[b],c>d.max&&(d.max=c),c<d.min&&(d.min=c);return d},flock.scale=function(a){if(a){var b,c=flock.range(a),d=(c.max-c.min)/2,e=(c.max+c.min)/2;for(b=0;b<a.length;b++)a[b]=(a[b]-e)/d;return a}},flock.copyBuffer=function(a,b,c){void 0===c&&(c=a.length);var d,e,f=c-b,g=new Float32Array(f);for(d=b,e=0;c>d;d++,e++)g[e]=a[d];return g},flock.parseMidiString=function(a){if(!a||a.length<2)return 0/0;a=a.toLowerCase();var b=a.charAt(1),c="#"===b||"b"===b?2:1,d=a.substring(0,c),e=Number(a.substring(c)),f=flock.midiFreq.noteNames[d],g=12*e+f;return g},flock.midiFreq=function(a,b,c,d){return b=void 0===b?440:b,c=void 0===c?69:c,d=d||12,"string"==typeof a&&(a=flock.parseMidiString(a)),b*Math.pow(2,1*(a-c)/d)},flock.midiFreq.noteNames={"b#":0,c:0,"c#":1,db:1,d:2,"d#":3,eb:3,e:4,"e#":5,f:5,"f#":6,gb:6,g:7,"g#":8,ab:8,a:9,"a#":10,bb:10,b:11,cb:11},flock.interpolate={},flock.interpolate.linear=function(a,b){a%=b.length;var c=0|a,d=(c+1)%b.length,e=a-c,f=b[c],g=b[d];return f+e*(g-f)},flock.interpolate.cubic=function(a,b){var c=b.length,d=Math.floor(a),e=d%c,f=a-d,g=e>0?e-1:c-1,h=(e+1)%c,i=(e+2)%c,j=b[g],k=b[e],l=b[h],m=b[i],n=.5*(l-j),o=k-l,p=n+o,q=p+o+.5*(m-k),r=p+q,s=((q*f-r)*f+n)*f+k;return s},flock.expand={},flock.expand.overlay=function(a){if(a){var b=[];for(var c in a.expandInputs){var d=a.expandInputs[c];d.length>b.length&&flock.expand.overlay.extend(b,a.ugenDef,d.length),flock.expand.overlay.merge(b,c,d)}return b}},flock.expand.overlay.extend=function(a,b,c){for(var d=c-a.length,e=0;d>e;e++)a.push(fluid.copy(b));return a},flock.expand.overlay.merge=function(a,b,c){for(var d=0;d<c.length;d++){var e=a[d],f=c[d];flock.set(e,b,f)}return a},flock.pathParseError=function(a,b,c){throw new Error("Error parsing path: "+b+". Segment '"+c+"' could not be resolved. Root object was: "+fluid.prettyPrintJSON(a))},flock.get=function(a,b){if(!a)return fluid.getGlobalValue(b);if(1===arguments.length&&"string"==typeof a)return fluid.getGlobalValue(a);if(b&&""!==b){var c,d=""===b?[]:String(b).split("."),e=a[d[0]];for(c=1;c<d.length;c++)(null===e||void 0===e)&&flock.pathParseError(a,b,d[c-1]),e=e[d[c]];return e}},flock.set=function(a,b,c){if(a&&b&&""!==b){var d,e,f=String(b).split("."),g=f.length,h=f[0];for(d=1;g>d;d++){if(a=a[h],e=typeof a,"object"!==e)throw new Error("A non-container object was found at segment "+h+". Value: "+a);h=f[d],void 0===a[h]&&(a[h]={})}return a[h]=c,c}},flock.invoke=function(a,b,c){var d="function"==typeof a?a:flock.get(a,b);if("function"!=typeof d)throw new Error("Path '"+b+"' does not resolve to a function.");return d.apply(null,c)},flock.input={},flock.input.shouldExpand=function(a,b){var c=flock.parse.specialInputs;return b&&b.options&&b.options.noExpand&&(c=c.concat(b.options.noExpand)),c.indexOf(a)<0},flock.input.pathExpander=function(a){return a.replace(/\.(?![0-9])/g,".inputs.")},flock.input.expandPaths=function(a){var b,c,d,e={};for(b in a)c=flock.input.pathExpander(b),d=a[b],e[c]=d;return e},flock.input.expandPath=function(a){return"string"==typeof a?flock.input.pathExpander(a):flock.input.expandPaths(a)},flock.input.getValueForPath=function(a,b){b=flock.input.expandPath(b);var c=flock.get(a,b);return flock.hasTag(c,"flock.ugen.valueType")?c.model.value:c},flock.input.getValuesForPathArray=function(a,b){var c,d,e={};for(c=0;c<b.length;c++)d=b[c],e[d]=flock.input.get(a,d);return e},flock.input.getValuesForPathObject=function(a,b){var c;for(c in b)b[c]=flock.input.get(a,c);return b},flock.input.get=function(a,b){return"string"==typeof b?flock.input.getValueForPath(a,b):flock.isIterable(b)?flock.input.getValuesForPathArray(a,b):flock.input.getValuesForPathObject(a,b)},flock.input.setValueForPath=function(a,b,c,d,e){b=flock.input.expandPath(b);var f=flock.get(a,b),g=b.lastIndexOf("."),h=b.slice(g+1),i=g>-1?flock.get(a,b.slice(0,b.lastIndexOf(".inputs"))):d,j=flock.input.shouldExpand(h,i)&&e?e(c,b,i,f):c;return flock.set(a,b,j),i&&i.onInputChanged&&i.onInputChanged(h),j},flock.input.setValuesForPaths=function(a,b,c,d){var e,f,g,h={};for(e in b)f=b[e],g=flock.input.set(a,e,f,c,d),h[e]=g;return h},flock.input.set=function(a,b,c,d,e){return"string"==typeof b?flock.input.setValueForPath(a,b,c,d,e):flock.input.setValuesForPaths(a,b,d,e)},fluid.defaults("flock.nodeList",{gradeNames:["fluid.littleComponent","autoInit"],members:{nodes:[],namedNodes:{}}}),flock.nodeList.preInit=function(a){a.head=function(b){return a.nodes.unshift(b),b.nickName&&(a.namedNodes[b.nickName]=b),0},a.before=function(b,c){var d=a.nodes.indexOf(b);return a.insert(d,c),d},a.after=function(b,c){var d=a.nodes.indexOf(b),e=d+1;return a.insert(e,c),e},a.insert=function(b,c){return 0>b?a.head(c):(a.nodes.splice(b,0,c),c.nickName&&(a.namedNodes[c.nickName]=c),b)},a.tail=function(b){return a.nodes.push(b),b.nickName&&(a.namedNodes[b.nickName]=b),a.nodes.length},a.remove=function(b){var c=a.nodes.indexOf(b);return 0>c?c:(a.nodes.splice(c,1),delete a.namedNodes[b.nickName],c)},a.replace=function(b,c){var d=a.nodes.indexOf(c);return 0>d?a.head(b):(a.nodes[d]=b,delete a.namedNodes[c.nickName],b.nickName&&(a.namedNodes[b.nickName]=b),d)}},fluid.defaults("flock.enviro",{gradeNames:["fluid.modelComponent","flock.nodeList","autoInit"],model:{playState:{written:0,total:null},isPlaying:!1},audioSettings:{rates:{audio:48e3,control:void 0,scheduled:void 0,demand:0,constant:0},blockSize:64,chans:2,numBuses:8,bufferSize:flock.defaultBufferSizeForPlatform(),genPollIntervalFactor:flock.platform.isLinux?1:20},components:{asyncScheduler:{type:"flock.scheduler.async"},audioStrategy:{type:"flock.enviro.audioStrategy",options:{audioSettings:"{enviro}.options.audioSettings",model:{playState:"{enviro}.model.playState"}}}}}),flock.enviro.preInit=function(a){a.audioSettings=a.options.audioSettings,a.buses=flock.enviro.createAudioBuffers(a.audioSettings.numBuses,a.audioSettings.blockSize),a.buffers={},a.bufferSources={},a.play=function(b){b=void 0===b?1/0:b;var c=a.model.playState,d=b*a.audioSettings.rates.audio*a.audioSettings.chans;c.total=c.written+d,a.audioStrategy.startGeneratingSamples(),a.model.isPlaying=!0},a.stop=function(){a.audioStrategy.stopGeneratingSamples(),a.model.isPlaying=!1},a.reset=function(){for(a.stop(),a.asyncScheduler.clearAll();a.nodes.length>0;)a.nodes.pop()},a.registerBuffer=function(b){b.id&&(a.buffers[b.id]=b)},a.releaseBuffer=function(b){if(b){var c="string"==typeof b?b:b.id;delete a.buffers[c]}}},flock.enviro.finalInit=function(a){var b=a.options.audioSettings,c=b.rates;a.gen=function(){var b=a.audioStrategy.nodeEvaluator;b.clearBuses(),b.gen()},c.audio=a.audioStrategy.options.audioSettings.rates.audio,c.control=c.audio/b.blockSize,b.chans=a.audioStrategy.options.audioSettings.chans},flock.enviro.createAudioBuffers=function(a,b){var c,d=[];for(c=0;a>c;c++)d[c]=new Float32Array(b);return d},fluid.defaults("flock.enviro.audioStrategy",{gradeNames:["fluid.modelComponent"],components:{nodeEvaluator:{type:"flock.enviro.nodeEvaluator",options:{numBuses:"{enviro}.options.audioSettings.numBuses",blockSize:"{enviro}.options.audioSettings.blockSize",members:{buses:"{enviro}.buses",nodes:"{enviro}.nodes"}}}}}),fluid.defaults("flock.enviro.nodeEvaluator",{gradeNames:["fluid.littleComponent","autoInit"]}),flock.enviro.nodeEvaluator.finalInit=function(a){a.clearBuses=function(){var b,c,d,e=a.options.numBuses,f=a.options.blockSize;for(b=0;e>b;b++)for(c=a.buses[b],d=0;f>d;d++)c[d]=0},a.gen=function(){var b,c,d=a.nodes;for(b=0;b<d.length;b++)c=d[b],c.gen(c.model.blockSize)}},fluid.defaults("flock.autoEnviro",{gradeNames:["fluid.littleComponent","autoInit"]}),flock.autoEnviro.preInit=function(){flock.enviro.shared||flock.init()},fluid.defaults("flock.node",{gradeNames:["flock.autoEnviro","fluid.modelComponent","autoInit"]}),fluid.defaults("flock.ugenNodeList",{gradeNames:["flock.nodeList","autoInit"]}),flock.ugenNodeList.finalInit=function(a){a.insertTree=function(b,c){var d,e,f=c.inputs;for(d in f)e=f[d],"number"!=typeof e&&(b=a.insertTree(b,e),b++);return a.insert(b,c)},a.removeTree=function(b){var c,d,e=b.inputs;for(c in e)d=e[c],"number"!=typeof d&&a.removeTree(d);return a.remove(b)},a.replaceTree=function(b,c){if(!c)return a.insertTree(a.nodes.length,b);var d=a.removeTree(c);return a.insertTree(d,b),d},a.swapTree=function(b,c,d){var e;if(d){for(e in c.inputs)d.indexOf(e)<0?a.removeTree(c.inputs[e]):b.inputs[e]=c.inputs[e];for(e in b.inputs)d.indexOf(e)<0&&a.replaceTree(b.inputs[e],c.inputs[e])}else b.inputs=c.inputs;return a.replace(b,c)}},fluid.defaults("flock.synth",{gradeNames:["fluid.eventedComponent","flock.node","flock.ugenNodeList","autoInit"],invokers:{play:{funcName:"flock.synth.play",args:["{that}","{that}.enviro"]},pause:{funcName:"flock.synth.pause",args:["{that}","{that}.enviro"]}},rate:flock.rates.AUDIO}),flock.synth.play=function(a,b){-1===b.nodes.indexOf(a)&&b.head(a),b.model.isPlaying||b.play()},flock.synth.pause=function(a,b){b.remove(a)},flock.synth.finalInit=function(b){return b.rate=b.options.rate,b.enviro=b.enviro||flock.enviro.shared,b.audioSettings=a.extend(!0,{},b.enviro.audioSettings,b.options.audioSettings),b.model.blockSize=b.rate===flock.rates.AUDIO?b.audioSettings.blockSize:1,b.gen=function(){var a,c,d=b.nodes;for(a=0;a<d.length;a++)c=d[a],void 0!==c.gen&&c.gen(c.model.blockSize)},b.get=function(a){return flock.input.get(b.namedNodes,a)},b.set=function(a,c,d){return flock.input.set(b.namedNodes,a,c,void 0,function(a,c,e,f){return flock.synth.ugenValueParser(b,a,f,d)})},b.input=function(a,c,d){return a?"string"==typeof a?arguments.length<2?b.get(a):b.set(a,c,d):flock.isIterable(a)?b.get(a):b.set(a,c,d):void 0},b.init=function(){var a=b.options,c=a.rate===flock.rates.SCHEDULED||a.rate===flock.rates.DEMAND;a.synthDef||fluid.log(fluid.logLevel.IMPORTANT,"Warning: Instantiating a flock.synth instance with an empty synth def."),b.out=flock.parse.synthDef(a.synthDef,{rate:a.rate,overrideRate:c,visitors:b.tail,buffers:b.enviro.buffers,buses:b.enviro.buses,audioSettings:b.audioSettings}),a.addToEnvironment!==!1&&b.enviro.tail(b)},b.init(),b},flock.synth.ugenValueParser=function(a,b,c,d){if(null===b||void 0===b)return c;var e,f,g,h=flock.parse.ugenDef(b,{audioSettings:a.audioSettings,buses:a.enviro.buses,buffers:a.enviro.buffers}),i=flock.isIterable(h)?h:void 0!==h?[h]:[],j=flock.isIterable(c)?c:void 0!==c?[c]:[],k=Math.min(i.length,j.length),l=d?a.swapTree:a.replaceTree;for(e=0;k>e;e++)f=l(i[e],j[e]);for(g=e;g<i.length;g++)f++,a.insertTree(f,i[g]);for(g=e;g<j.length;g++)a.removeTree(j[g]);return h},flock.synth.make=function(a,b){return b=b||{},b.synthDef=a,flock.synth(b)},fluid.defaults("flock.synth.value",{gradeNames:["flock.synth","autoInit"],rate:"demand",addToEnvironment:!1}),flock.synth.value.finalInit=function(a){a.value=function(){var b=a.nodes,c=b.length-1,d=b[c];return a.gen(1),d.model.value}},fluid.defaults("flock.synth.frameRate",{gradeNames:["flock.synth.value","autoInit"],rate:"scheduled",fps:60,audioSettings:{rates:{scheduled:"{that}.options.fps"}}}),fluid.defaults("flock.synth.group",{gradeNames:["fluid.eventedComponent","flock.node","flock.nodeList","autoInit"],rate:flock.rates.AUDIO}),flock.synth.group.finalInit=function(a){a.rate=a.options.rate,a.enviro=a.enviro||flock.enviro.shared,flock.synth.group.makeDispatchedMethods(a,["input","get","set","gen","play","pause"]),a.init=function(){a.options.addToEnvironment!==!1&&a.enviro.tail(a)},a.init()},flock.synth.group.makeDispatcher=function(a,b){return function(){var c,d,e;for(c=0;c<a.length;c++)d=a[c],e=d[b].apply(d,arguments);return e}},flock.synth.group.makeDispatchedMethods=function(a,b){var c,d;for(d=0;d<b.length;d++)c=b[d],a[c]=flock.synth.group.makeDispatcher(a.nodes,c,flock.synth.group.dispatch);return a},fluid.defaults("flock.synth.polyphonic",{gradeNames:["flock.synth.group","autoInit"],noteSpecs:{on:{"env.gate":1},off:{"env.gate":0}},maxVoices:16,initVoicesLazily:!0,amplitudeKey:"env.sustain",amplitudeNormalizer:"static"}),flock.synth.polyphonic.finalInit=function(b){return b.activeVoices={},b.freeVoices=[],b.noteChange=function(c,d,e){var f=b.options.noteSpecs[d];e=a.extend({},f,e),c.input(e)},b.noteOn=function(a,c){var d=b.nextFreeVoice();return b.activeVoices[a]&&b.noteOff(a),b.activeVoices[a]=d,b.noteChange(d,"on",c),d},b.noteOff=function(a,c){var d=b.activeVoices[a];return d?(b.noteChange(d,"off",c),delete b.activeVoices[a],b.freeVoices.push(d),d):null},b.createVoice=function(){var a,c=flock.synth({synthDef:b.options.synthDef,addToEnvironment:!1}),d=b.options.amplitudeNormalizer,e=b.options.amplitudeKey;return d&&("function"==typeof d?d(c,e):"static"===d&&(a=1/b.options.maxVoices,c.input(e,a))),b.nodes.push(c),c},b.pooledVoiceAllocator=function(){return b.freeVoices.pop()},b.lazyVoiceAllocator=function(){return b.freeVoices.length>1?b.freeVoices.pop():Object.keys(b.activeVoices).length>b.options.maxVoices?null:b.createVoice()},b.init=function(){if(b.options.initVoicesLazily)b.nextFreeVoice=b.lazyVoiceAllocator;else{var a;for(a=0;a<b.options.maxVoices;a++)b.freeVoices[a]=b.createVoice();b.nextFreeVoice=b.pooledVoiceAllocator}},b.init(),b},fluid.defaults("flock.band",{gradeNames:["fluid.eventedComponent","autoInit"],invokers:{play:{func:"{that}.events.onPlay.fire"},pause:{func:"{that}.events.onPause.fire"},set:{func:"{that}.events.onSet.fire"}},events:{onPlay:null,onPause:null,onSet:null},distributeOptions:{source:"{that}.options.synthListeners",removeSource:!0,target:"{that flock.synth}.options.listeners"},synthListeners:{"{band}.events.onPlay":{func:"{that}.play"},"{band}.events.onPause":{func:"{that}.pause"}}}),flock.bufferDesc=function(){throw new Error("flock.bufferDesc is not defined. Did you forget to include the flocking-buffers.js file?")}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";function a(){function a(a,c){var d=function(a,b){return b(c),this},e=function(a){return a(c),this};g.value=c,g.then="reject"===a?d:e,g.resolve=g.reject=function(){throw new Error("Promise already completed")},b(a,c)}function b(a,b){var c,d;for(c=0;c<f.length;c++)d=f[c],d[a]&&d[a](b);f=null}var c=function(b){a("resolve",b),g.state="fulfilled"},d=function(b){a("reject",b),g.state="rejected"},e=function(a,b){if(f)f.push({resolve:a,reject:b});else{var c="fulfilled"===g.state?a:b;c(g.value)}return this},f=[],g={state:"pending",value:void 0,resolve:c,reject:d,then:e,safe:{then:function(a,b){return g.then(a,b),this}}};return g}fluid.defaults("flock.promise",{gradeNames:["fluid.eventedComponent","autoInit"],members:{promise:{expander:{funcName:"flock.promise.make"}}}}),flock.promise.make=function(){return new a},flock.bufferDesc=function(a){return a.container=a.container||{},a.format=a.format||{},a.format.sampleRate=a.format.sampleRate||44100,a.format.numChannels=a.format.numChannels||a.data.channels.length,a.format.numSampleFrames=a.format.numSampleFrames||a.data.channels[0].length,a.format.duration=a.format.numSampleFrames/a.format.sampleRate,a},fluid.defaults("flock.bufferSource",{gradeNames:["fluid.eventedComponent","fluid.modelComponent","autoInit"],model:{state:"start",src:null},components:{bufferPromise:{createOnEvent:"onRefreshPromise",type:"flock.promise",options:{listeners:{onCreate:{"this":"{that}.promise",method:"then",args:["{bufferSource}.events.afterFetch.fire","{bufferSource}.events.onError.fire"]}}}}},invokers:{get:{funcName:"flock.bufferSource.get",args:["{that}","{arguments}.0"]},set:{funcName:"flock.bufferSource.set",args:["{that}","{arguments}.0"]},error:{funcName:"flock.bufferSource.error",args:["{that}","{arguments}.0"]}},listeners:{onCreate:{funcName:"{that}.events.onRefreshPromise.fire"},onRefreshPromise:{funcName:"{that}.applier.requestChange",args:["state","start"]},onFetch:{funcName:"{that}.applier.requestChange",args:["state","in-progress"]},afterFetch:[{funcName:"{that}.applier.requestChange",args:["state","fetched"]},{funcName:"{that}.events.onBufferUpdated.fire",args:["{arguments}.0"]}],onBufferUpdated:{funcName:"flock.enviro.shared.registerBuffer",args:["{arguments}.0"]},onError:{funcName:"{that}.applier.requestChange",args:["state","error"]}},events:{onRefreshPromise:null,onError:null,onFetch:null,afterFetch:null,onBufferUpdated:null}}),flock.bufferSource.get=function(a,b){return"in-progress"===a.model.state||b.src===a.model.src&&!b.replace?a.bufferPromise.promise:(b.src&&("fetched"!==a.model.state&&"errored"!==a.model.state||a.model.src===b.src&&!b.replace||a.events.onRefreshPromise.fire(),"start"===a.model.state&&(a.model.src=b.src,a.events.onFetch.fire(b),flock.audio.decode({src:b.src,success:function(c){b.id&&(c.id=b.id),a.set(c)},error:a.error}))),a.bufferPromise.promise)},flock.bufferSource.set=function(a,b){var c=a.model.state;return("start"===c||"in-progress"===c)&&a.bufferPromise.promise.resolve(b),a.bufferPromise.promise},flock.bufferSource.error=function(a,b){return a.bufferPromise.promise.reject(b),a.bufferPromise.promise}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";var a=fluid.registerNamespace("jQuery");fluid.registerNamespace("flock.parse"),flock.parse.synthDef=function(a,b){return a||(a=[]),flock.parse.synthDef.hasOutUGen(a)||(a={id:flock.OUT_UGEN_ID,ugen:"flock.ugen.valueOut",inputs:{sources:a}},b.rate===flock.rates.AUDIO&&(a.ugen="flock.ugen.out",a.inputs.bus=0,a.inputs.expand=b.audioSettings.chans)),flock.parse.ugenForDef(a,b)},flock.parse.synthDef.hasOutUGen=function(a){return!flock.isIterable(a)&&(a.id===flock.OUT_UGEN_ID||"flock.ugen.out"===a.ugen||"flock.ugen.valueOut"===a.ugen)},flock.parse.makeUGen=function(b,c,d){var e=d.audioSettings.rates,f=d.audioSettings.blockSize;b.rate||(b.rate=flock.rates.AUDIO);var g;g=b.options&&void 0!==b.options.sampleRate?b.options.sampleRate:e[b.rate],b.options=a.extend(!0,{},b.options,{sampleRate:g,rate:b.rate,audioSettings:{rates:e,blockSize:f}}),b.options.audioSettings.buffers=d.buffers,b.options.audioSettings.buses=d.buses;var h,i=b.rate===flock.rates.AUDIO?f:1;if(flock.hasTag(b.options,"flock.ugen.multiChannelOutput")){var j=b.options.numOutputs||1;h=[];for(var k=0;j>k;k++)h.push(new Float32Array(i))}else h=new Float32Array(i);return flock.invoke(void 0,b.ugen,[c,h,b.options])},flock.parse.reservedWords=["id","ugen","rate","inputs","options"],flock.parse.specialInputs=["value","buffer","table"],flock.parse.expandUGenDef=function(a){var b,c={};for(b in a)-1===flock.parse.reservedWords.indexOf(b)&&(c[b]=a[b],delete a[b]);return a.inputs=c,a},flock.parse.ugenDefForConstantValue=function(a){return{ugen:"flock.ugen.value",rate:flock.rates.CONSTANT,inputs:{value:a}}},flock.parse.expandValueDef=function(a){var b=typeof a;if("number"===b)return flock.parse.ugenDefForConstantValue(a);if("object"===b)return a;throw new Error("Invalid value type found in ugen definition. UGenDef was: "+fluid.prettyPrintJSON(a))},flock.parse.rateMap={ar:flock.rates.AUDIO,kr:flock.rates.CONTROL,sr:flock.rates.SCHEDULED,dr:flock.rates.DEMAND,cr:flock.rates.CONSTANT},flock.parse.expandRate=function(a,b){return a.rate=flock.parse.rateMap[a.rate]||a.rate,b.overrideRate&&a.rate!==flock.rates.CONSTANT&&(a.rate=b.rate),a},flock.parse.ugenDef=function(a,b){var c=flock.isIterable(a)?flock.parse.ugensForDefs:flock.parse.ugenForDef,d=c(a,b);return d},flock.parse.ugenDef.mergeOptions=function(b){var c=fluid.defaults(b.ugen)||{};return c=fluid.copy(c),c.options=c.ugenOptions,delete c.ugenOptions,a.extend(!0,{},c,b)},flock.parse.ugensForDefs=function(a,b){var c,d=[];for(c=0;c<a.length;c++)d[c]=flock.parse.ugenForDef(a[c],b);return d},flock.parse.ugenForDef=function(b,c){c=a.extend(!0,{audioSettings:flock.enviro.shared.options.audioSettings,buses:flock.enviro.shared.buses,buffers:flock.enviro.shared.buffers},c);var d=c,e=d.visitors,f=d.audioSettings.rates;if(b=flock.parse.expandValueDef(b),flock.isIterable(b))return flock.parse.ugensForDefs(b,c);b.inputs||(b=flock.parse.expandUGenDef(b)),flock.parse.expandRate(b,c),b=flock.parse.ugenDef.mergeOptions(b,c);var g,h=b.inputs,i={};for(g in h){var j=h[g];null!==j&&(i[g]=flock.input.shouldExpand(g,b)?flock.parse.ugenForDef(j,c):j)}if(!b.ugen)throw new Error("Unit generator definition lacks a 'ugen' property; can't initialize the synth graph. Value: "+fluid.prettyPrintJSON(b));var k=flock.parse.makeUGen(b,i,c);return b.id&&(k.id=b.id,k.nickName=b.id),k.options.ugenDef=b,e&&(e=fluid.makeArray(e),fluid.each(e,function(a){a(k,b,f)})),k},flock.parse.expandBufferDef=function(a){return flock.isIterable(a)?flock.bufferDesc({data:{channels:a}}):"string"!=typeof a?a:{id:a}},flock.parse.bufferForDef=function(a,b,c){a=flock.parse.expandBufferDef(a),a.data&&a.data.channels?flock.parse.bufferForDef.resolveBuffer(a,b,c):flock.parse.bufferForDef.resolveDef(a,b,c)},flock.parse.bufferForDef.findSource=function(a,b){var c;return b&&a.id?(c=b.bufferSources[a.id],c||(c=b.bufferSources[a.id]=flock.bufferSource())):c=flock.bufferSource(),c},flock.parse.bufferForDef.bindToPromise=function(a,b,c){var d=function(a){b.events.onBufferUpdated.addListener(d),c&&c.setBuffer(a)},e=function(a){throw new Error("Error while resolving buffer "+b.model.src+": "+a)};a.then(d,e)},flock.parse.bufferForDef.resolveDef=function(a,b,c){var d,e=flock.parse.bufferForDef.findSource(a,c);a.src=a.url||a.src,a.selector&&"undefined"!=typeof document&&(a.src=document.querySelector(a.selector).files[0]),d=e.get(a),flock.parse.bufferForDef.bindToPromise(d,e,b)},flock.parse.bufferForDef.resolveBuffer=function(a,b,c){var d=flock.parse.bufferForDef.findSource(a,c),e=d.set(a);flock.parse.bufferForDef.bindToPromise(e,d,b)}}(),function(){"use strict";var a="undefined"!=typeof window?window:"undefined"!=typeof self?self:global,b="undefined"!=typeof a.DataView?a.DataView:void 0,c=function(){var a=new ArrayBuffer(4),b=new Uint8Array(a),c=new Uint32Array(a);return b[0]=1,b[1]=2,b[2]=3,b[3]=4,67305985===c[0]}(),d=function(a){a.getString=function(b,c,d,e){d="number"==typeof d?d:a.offsetState;var f,g,h="";for(f=0;b>f;f++)g=a.getUint(c,d,e),g>65535?(g-=65536,h+=String.fromCharCode(55296+(g>>10),56320+(1023&g))):h+=String.fromCharCode(g),d+=c;return h},a.getFloat80=function(b,c){b="number"==typeof b?b:a.offsetState;var d,e=a.getUint(2,b,c),f=a.getUint(4,b+2),g=a.getUint(4,b+6),h=32768,i=1;return e>=h&&(e|=~(h-1)),0>e&&(i=-1,e+=h),e===f===g===0?d=0:32767===e?d=Number.MAX_VALUE:(e-=16383,d=(4294967296*f+g)*Math.pow(2,e-63)),a.offsetState=b+10,i*d}},e=function(b,e,f){var g=[],h={buffer:b,byteOffset:"number"==typeof e?e:0};if(h.byteLength="number"==typeof f?f:b.byteLength-h.byteOffset,h.byteOffset>b.byteLength||h.byteOffset+h.byteLength>b.byteLength)throw new Error("INDEX_SIZE_ERR: DOM Exception 1");
return h.u8Buf=new Uint8Array(b,h.byteOffset,h.byteLength),h.offsetState=h.byteOffset,h.getUints=function(b,d,e,f,g){if(e="number"==typeof e?e:h.offsetState,e+b*d>h.u8Buf.length)throw new Error("INDEX_SIZE_ERR: DOM Exception 1");h.offsetState=e+b*d;var i=a["Uint"+8*d+"Array"];if(b>1&&c===f)return new i(h.buffer,e,b);g=g||new i(b);var j,k,l,m,n,o,p,q;for(f?(j=0,k=1):(j=d-1,k=-1),l=0;b>l;l++){for(m=e+l*d+j,n=0,o=0,p=1;d>o;o++,p*=256)q=h.u8Buf[m],n+=q*p,m+=k;g[l]=n}return g},h.getInts=function(b,d,e,f,g){if(e="number"==typeof e?e:h.offsetState,e+b*d>h.u8Buf.length)throw new Error("INDEX_SIZE_ERR: DOM Exception 1");h.offsetState=e+b*d;var i=a["Int"+8*d+"Array"];if(b>1&&c===f)return new i(h.buffer,e,b);g=g||new i(b);var j,k,l,m,n,o,p,q,r=Math.pow(256,d),s=r/2-1;for(f?(j=0,k=1):(j=d-1,k=-1),l=0;b>l;l++){for(m=e+l*d+j,n=0,o=0,p=1;d>o;o++,p*=256)q=h.u8Buf[m],n+=q*p,m+=k;g[l]=n>s?n-r:n}return g},h.getFloats=function(b,d,e,f,g){var i,j=8*d,k="getFloat"+j,l=a["Float"+j+"Array"];if(b>1&&c===f){if(e="number"==typeof e?e:h.offsetState,e+b*d>h.u8Buf.length)throw new Error("INDEX_SIZE_ERR: DOM Exception 1");return h.offsetState=e+b*d,new l(h.buffer,e,b)}for(g=g||new l(b),i=0;b>i;i++)g[i]=h[k](e,f);return g},h.getUint=function(a,b,c){return 1===a?h.getUint8(b,c):h.getUints(1,a,b,c,g)[0]},h.getInt=function(a,b,c){return h.getInts(1,a,b,c,g)[0]},h.getUint8=function(a){a="number"==typeof a?a:h.offsetState;var b=h.u8Buf[a];return h.offsetState=a+1,b},h.getInt8=function(a,b){return h.getInts(1,1,a,b,g)[0]},h.getUint16=function(a,b){return h.getUints(1,2,a,b,g)[0]},h.getInt16=function(a,b){return h.getInts(1,2,a,b,g)[0]},h.getUint32=function(a,b){return h.getUints(1,4,a,b,g)[0]},h.getInt32=function(a,b){return h.getInts(1,4,a,b,g)[0]},h.getFloat32=function(a,b){var c,d,e,f,g,i,j,k=h.getUints(4,1,a,b);return b?(c=k[3],d=k[2],e=k[1],f=k[0]):(c=k[0],d=k[1],e=k[2],f=k[3]),g=1-2*(c>>7),i=(c<<1&255|d>>7)-127,j=65536*(127&d)|256*e|f,128===i?0!==j?0/0:1/0*g:-127===i?g*j*1.401298464324817e-45:g*(1+1.1920928955078125e-7*j)*Math.pow(2,i)},h.getFloat64=function(a,b){var c,d,e,f,g,i,j,k,l,m,n,o=h.getUints(8,1,a,b);return b?(c=o[7],d=o[6],e=o[5],f=o[4],g=o[3],i=o[2],j=o[1],k=o[0]):(c=o[0],d=o[1],e=o[2],f=o[3],g=o[4],i=o[5],j=o[6],k=o[7]),l=1-2*(c>>7),m=((c<<1&255)<<3|d>>4)-1023,n=281474976710656*(15&d)+1099511627776*e+4294967296*f+16777216*g+65536*i+256*j+k,1024===m?0!==n?0/0:1/0*l:-1023===m?l*n*5e-324:l*(1+2.220446049250313e-16*n)*Math.pow(2,m)},d(h),h},f=function(c,e,f){var g={buffer:c,byteOffset:"number"==typeof e?e:0};g.byteLength="number"==typeof f?f:c.byteLength-g.byteOffset,g.dv=new b(c,g.byteOffset,g.byteLength),g.offsetState=g.byteOffset,g.getUint=function(a,b,c){b="number"==typeof b?b:g.offsetState;var d=g.dv["getUint"+8*a](b,c);return g.offsetState=b+a,d},g.getInt=function(a,b,c){b="number"==typeof b?b:g.offsetState;var d=g.dv["getInt"+8*a](b,c);return g.offsetState=b+a,d};var h=function(b,c,d,e,f,h){var i,j=8*d,k=b+j,l=g.dv,m="get"+k;for(h=h||new a[k+"Array"](c),e="number"==typeof e?e:g.offsetState,i=0;c>i;i++)h[i]=l[m](e,f),e+=d;return g.offsetState=e,h};return g.getUints=function(a,b,c,d,e){return h("Uint",a,b,c,d,e)},g.getInts=function(a,b,c,d,e){return h("Int",a,b,c,d,e)},g.getFloats=function(a,b,c,d,e){return h("Float",a,b,c,d,e)},g.getUint8=function(a){a="number"==typeof a?a:g.offsetState;var b=g.dv.getUint8(a);return g.offsetState=a+1,b},g.getInt8=function(a){a="number"==typeof a?a:g.offsetState;var b=g.dv.getInt8(a);return g.offsetState=a+1,b},g.getUint16=function(a,b){a="number"==typeof a?a:g.offsetState;var c=g.dv.getUint16(a,b);return g.offsetState=a+2,c},g.getInt16=function(a,b){a="number"==typeof a?a:g.offsetState;var c=g.dv.getInt16(a,b);return g.offsetState=a+2,c},g.getUint32=function(a,b){a="number"==typeof a?a:g.offsetState;var c=g.dv.getUint32(a,b);return g.offsetState=a+4,c},g.getInt32=function(a,b){a="number"==typeof a?a:g.offsetState;var c=g.dv.getInt32(a,b);return g.offsetState=a+4,c},g.getFloat32=function(a,b){a="number"==typeof a?a:g.offsetState;var c=g.dv.getFloat32(a,b);return g.offsetState=a+4,c},g.getFloat64=function(a,b){a="number"==typeof a?a:g.offsetState;var c=g.dv.getFloat64(a,b);return g.offsetState=a+8,c},d(g),g};a.PolyDataView=b?f:e}();var fluid="undefined"!=typeof fluid?fluid:"undefined"!=typeof require?require("infusion"):{registerNamespace:function(a){"use strict";if(a){var b,c,d=self,e=a.split(".");for(b=0;b<e.length;b++)c=e[b],d[c]||(d[c]={}),d=d[c];return d}}},flock=fluid.registerNamespace("flock");!function(){"use strict";var a=fluid.registerNamespace("jQuery");flock.applyDeferred=function(a,b,c){a&&(c="undefined"==typeof c?0:c,setTimeout(function(){a.apply(null,b)},c))},fluid.registerNamespace("flock.net"),flock.net.readBufferFromUrl=function(a){var b=a.src,c=new XMLHttpRequest;c.onreadystatechange=function(){if(4===c.readyState)if(200===c.status)a.success(c.response,flock.file.parseFileExtension(b));else{if(!a.error)throw new Error(c.statusText);a.error(c.statusText)}},c.open(a.method||"GET",b,!0),c.responseType=a.responseType||"arraybuffer",c.send(a.data)},fluid.registerNamespace("flock.file"),flock.file.mimeTypes={"audio/wav":"wav","audio/x-wav":"wav","audio/wave":"wav","audio/x-aiff":"aiff","audio/aiff":"aiff","sound/aiff":"aiff"},flock.file.typeAliases={aif:"aiff",wave:"wav"},flock.file.parseFileExtension=function(a){var b,c,d=a.lastIndexOf(".");if(0>d)throw new Error("The file '"+a+"' does not have a valid extension.");return b=a.substring(d+1),b=b.toLowerCase(),c=flock.file.typeAliases[b],c||b},flock.file.parseMIMEType=function(a){return flock.file.mimeTypes[a]},flock.file.stringToBuffer=function(a){var b,c=a.length,d=new ArrayBuffer(c),e=new Uint8Array(d);for(b=0;c>b;b++)e[b]=a.charCodeAt(b);return e.buffer},flock.file.readBufferFromDataUrl=function(a){var b=a.src,c=b.indexOf(","),d=b.substring(0,c),e=b.substring(c+1),f=d.indexOf(";base64"),g=f>-1,h=b.indexOf("data:")+5,i=g?f:c,j=b.substring(h,i);g&&(e=atob(e)),flock.applyDeferred(function(){var b=flock.file.stringToBuffer(e);a.success(b,flock.file.parseMIMEType(j))})},flock.file.readBufferFromFile=function(a){var b=new FileReader;return b.onload=function(b){a.success(b.target.result,flock.file.parseFileExtension(a.src.name))},b.readAsArrayBuffer(a.src),b},fluid.registerNamespace("flock.audio"),flock.audio.loadBuffer=function(a){var b=a.src||a.url;if(b){b instanceof ArrayBuffer&&flock.applyDeferred(a.success,[b,a.type]);var c=flock.audio.loadBuffer.readerForSource(b);c(a)}},flock.audio.loadBuffer.readerForSource=function(a){return"undefined"!=typeof File&&a instanceof File?flock.file.readBufferFromFile:0===a.indexOf("data:")?flock.file.readBufferFromDataUrl:flock.net.readBufferFromUrl},flock.audio.decode=function(a){var b=a.success,c=function(c,d){var e,f=flock.audio.decode;(e=a?a.decoder?"string"==typeof a.decoder?fluid.getGlobalValue(a.decoder):a.decoder:a.async===!1?f.sync:f.async:f.async)({rawData:c,type:d,success:b,error:a.error})};a.success=c,flock.audio.loadBuffer(a)},flock.audio.decode.sync=function(a){try{var b=flock.audio.decodeArrayBuffer(a.rawData,a.type);a.success(b,a.type)}catch(c){if(!a.error)throw c;a.error(c.msg)}},flock.audio.decode.async=function(a){var b=flock.audio.decode.async.findWorkerUrl(a),c=new Worker(b);c.addEventListener("message",function(b){var c=b.data,d=b.data.msg;"afterDecoded"===d?a.success(c.buffer,c.type):"onError"===d&&a.error(c.errorMsg)},!0),c.postMessage({msg:"decode",rawData:a.rawData,type:a.type})},flock.audio.decode.async.findWorkerUrl=function(b){if(b&&b.workerUrl)return b.workerUrl;var c,d,e,f,g,h,i="flocking-audiofile-worker.js",j=flock.audio.decode.async.findWorkerUrl.flockingFileNames;for(c=0;c<j.length&&(d=j[c],e=a("script[src$='"+d+"']"),!(e.length>0));c++);if(e.length<1)throw new Error("Flocking error: could not load the Audio Decoder into a worker because flocking-all.js or flocking-core.js could not be found.");return f=e.eq(0).attr("src"),g=f.indexOf(d),h=f.substring(0,g),h+i},flock.audio.decode.async.findWorkerUrl.flockingFileNames=["flocking-all.js","flocking-all.min.js","flocking-audiofile.js","flocking-core.js"],flock.audio.decodeArrayBuffer=function(a,b){var c=flock.audio.formats[b];if(!c)throw new Error("There is no decoder available for "+b+" files.");return c.reader(a,c)},flock.audio.decode.deinterleaveSampleData=function(a,b,c,d){var e,f,g,h,i=d.length/c,j=[],k=0;for(e=0;c>e;e++)j[e]=new Float32Array(i);if("Int"===a)for(f=Math.pow(2,b-1),g=0;i>g;g++)for(h=0;c>h;h++)j[h][g]=d[k]/f,k++;else for(g=0;i>g;g++)for(h=0;c>h;h++)j[h][g]=d[k],k++;return j},flock.audio.decode.data=function(a,b,c,d){var e=b.numChannels,f=b.numSampleFrames,g=f*e,h=b.bitRate,i=a["get"+c+"s"](g,h/8,void 0,d);return flock.audio.decode.deinterleaveSampleData(c,h,e,i)},flock.audio.decode.dataChunk=function(a,b,c,d,e){var f=d.size;return b.numSampleFrames=b.numSampleFrames||f/(b.bitRate/8)/b.numChannels,b.duration=b.numSampleFrames/b.sampleRate,d.channels=flock.audio.decode.data(a,b,c,e),d},flock.audio.decode.chunk=function(a,b,c,d,e,f,g,h,i){var j,k,l,m=g[b],n=m.offsets,o=m.header;j=flock.audio.decode.chunkFields(a,e,h,n.fields);for(k in o)j[k]=o[k];return n.fields+o.size>a.offsetState&&(n.data=a.offsetState),e.chunkLayouts&&(l=a.byteLength-n.data,flock.audio.decode.scanChunks(a,l,d,h,g),flock.audio.decode.chunks(a,d,e.chunkLayouts,f,g,h,i)),j},flock.audio.decode.scanChunks=function(a,b,c,d,e){e=e||{};for(var f;a.offsetState<b;)f=flock.audio.decode.chunkHeader(a,c,d),e[f.header.id]=f,a.offsetState+=f.header.size;return e},flock.audio.decode.chunks=function(a,b,c,d,e,f,g){g=g||{};var h,i,j,k,l=c.order;for(h=0;h<l.length;h++)i=l[h],j=d[i],k=c[i],g[j]=flock.audio.decode.chunk(a,i,j,b,k,d,e,f,g);return g},flock.audio.decode.chunkFields=function(a,b,c,d){var e,f,g,h={},i=b.order,j=b.fields;for(a.offsetState="number"==typeof d?d:a.offsetState,e=0;e<i.length;e++)f=i[e],g=j[f],h[f]="string"==typeof g?a[g](void 0,c):a[g.getter](g.length,g.width,void 0,c);return h},flock.audio.decode.chunkHeader=function(a,b,c){var d={offsets:{}};return d.offsets.start=a.offsetState,d.header=flock.audio.decode.chunkFields(a,b,c),d.offsets.fields=a.offsetState,d},flock.audio.decode.wavSampleDataType=function(a){var b=a.format.audioFormatType;if(1!==b&&3!==b)throw new Error("Flocking decoder error: this file contains an unrecognized WAV format type.");return 1===b?"Int":"Float"},flock.audio.decode.aiffSampleDataType=function(a){var b=a.container.formatType;if("AIFF"!==b&&"AIFC"!==b)throw new Error("Flocking decoder error: this file contains an unrecognized AIFF format type.");return"AIFF"===b?"Int":"Float"},flock.audio.decode.chunked=function(a,b){var c,d,e,f=new PolyDataView(a,0,a.byteLength),g=b.littleEndian,h=b.headerLayout;return c=flock.audio.decode.scanChunks(f,f.byteLength,h,g),d=flock.audio.decode.chunks(f,h,b.chunkLayouts,b.chunkIDs,c,g),e=b.findSampleDataType(d,c,f),flock.audio.decode.dataChunk(f,d.format,e,d.data,g),d},flock.audio.formats={},flock.audio.formats.wav={reader:flock.audio.decode.chunked,littleEndian:!0,chunkIDs:{RIFF:"container","fmt ":"format",data:"data"},headerLayout:{fields:{id:{getter:"getString",length:4,width:1},size:"getUint32"},order:["id","size"]},chunkLayouts:{RIFF:{fields:{formatType:{getter:"getString",length:4,width:1}},order:["formatType"],chunkLayouts:{"fmt ":{fields:{audioFormatType:"getUint16",numChannels:"getUint16",sampleRate:"getUint32",avgBytesPerSecond:"getUint32",blockAlign:"getUint16",bitRate:"getUint16"},order:["audioFormatType","numChannels","sampleRate","avgBytesPerSecond","blockAlign","bitRate"]},data:{fields:{},order:[]},order:["fmt ","data"]}},order:["RIFF"]},findSampleDataType:flock.audio.decode.wavSampleDataType},flock.audio.formats.aiff={reader:flock.audio.decode.chunked,littleEndian:!1,chunkIDs:{FORM:"container",COMM:"format",SSND:"data"},headerLayout:{fields:{id:{getter:"getString",length:4,width:1},size:"getUint32"},order:["id","size"]},chunkLayouts:{FORM:{fields:{formatType:{getter:"getString",length:4,width:1}},order:["formatType"],chunkLayouts:{COMM:{fields:{numChannels:"getInt16",numSampleFrames:"getUint32",bitRate:"getUint16",sampleRate:"getFloat80"},order:["numChannels","numSampleFrames","bitRate","sampleRate"]},SSND:{fields:{offset:"getUint32",blockSize:"getUint32"},order:["offset","blockSize"]},order:["COMM","SSND"]}},order:["FORM"]},findSampleDataType:flock.audio.decode.aiffSampleDataType}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";flock.shim={URL:"undefined"!=typeof window?window.URL||window.webkitURL||window.msURL:void 0},flock.worker=function(a){var b,c,d=typeof a;if("function"===d)a="("+a.toString()+")();";else if("string"!==d)throw new Error("A flock.worker must be initialized with a String or a Function.");return window.Blob?(c=new Blob([a],{type:"text/javascript"}),b=flock.shim.URL.createObjectURL(c)):b="data:text/javascript;base64,"+window.btoa(a),new Worker(b)},fluid.registerNamespace("flock.scheduler"),fluid.defaults("flock.scheduler.intervalClock",{gradeNames:["fluid.eventedComponent","autoInit"],events:{tick:null}}),flock.scheduler.intervalClock.finalInit=function(a){a.scheduled={},a.schedule=function(b){var c=setInterval(function(){a.events.tick.fire(b)},b);a.scheduled[b]=c},a.clear=function(b){var c=a.scheduled[b];clearInterval(c),delete a.scheduled[b]},a.clearAll=function(){for(var b in a.scheduled)a.clear(b)},a.end=a.clearAll},fluid.defaults("flock.scheduler.scheduleClock",{gradeNames:["fluid.eventedComponent","autoInit"],events:{tick:null}}),flock.scheduler.scheduleClock.finalInit=function(a){a.scheduled=[],a.schedule=function(b){var c;c=setTimeout(function(){a.clear(c),a.events.tick.fire(b)},b),a.scheduled.push(c)},a.clear=function(b,c){c=void 0===c?a.scheduled.indexOf(b):c,c>-1&&a.scheduled.splice(c,1),clearTimeout(b)},a.clearAll=function(){for(var b=0;b<a.scheduled.length;b++){var c=a.scheduled[b];clearTimeout(c)}a.scheduled.length=0},a.end=a.clearAll},fluid.defaults("flock.scheduler.webWorkerClock",{gradeNames:["fluid.modelComponent","fluid.eventedComponent","autoInit"],model:{messages:{schedule:{msg:"schedule"},clear:{msg:"clear"},clearAll:{msg:"clearAll"},end:{msg:"end"}}},events:{tick:null},clockType:"intervalClock"}),flock.scheduler.webWorkerClock.finalInit=function(a){a.worker=new flock.worker(flock.scheduler.webWorkerClock.workerImpl),a.worker.postMessage({msg:"start",value:a.options.clockType}),a.worker.addEventListener("message",function(b){a.events.tick.fire(b.data.value)},!1),a.postToWorker=function(b,c){var d=a.model.messages[b];void 0!==c&&(d.value=c),a.worker.postMessage(d)},a.schedule=function(b){a.postToWorker("schedule",b)},a.clear=function(b){a.postToWorker("clear",b)},a.clearAll=function(){a.postToWorker("clearAll")},a.end=function(){a.postToWorker("end")}},flock.scheduler.webWorkerClock.workerImpl=function(){var a=a||{};a.worker=a.worker||{},a.worker.clock=function(){var a={};return a.tick=function(a){self.postMessage({msg:"tick",value:a})},a},a.worker.intervalClock=function(){var b=a.worker.clock();return b.scheduled={},b.schedule=function(a){var c=setInterval(function(){b.tick(a)},a);b.scheduled[a]=c},b.clear=function(a){var c=b.scheduled[a];clearInterval(c),delete b.scheduled[a]},b.clearAll=function(){for(var a in b.scheduled)b.clear(a)},b},a.worker.scheduleClock=function(){var b=a.worker.clock();return b.scheduled=[],b.schedule=function(a){var c;c=setTimeout(function(){b.clear(c),b.tick(a)},a),b.scheduled.push(c)},b.clear=function(a,c){c=void 0===c?b.scheduled.indexOf(a):c,c>-1&&b.scheduled.splice(c,1),clearTimeout(a)},b.clearAll=function(){for(var a=0;a<b.scheduled.length;a++){var c=b.scheduled[a];clearTimeout(c)}b.scheduled.length=0},b},self.addEventListener("message",function(b){"start"===b.data.msg?a.clock=a.worker[b.data.value]():"end"===b.data.msg?a.clock&&(a.clock.clearAll(),self.close()):a.clock&&a.clock[b.data.msg](b.data.value)},!1)},fluid.defaults("flock.scheduler.webWorkerIntervalClock",{gradeNames:["flock.scheduler.webWorkerClock","autoInit"],clockType:"intervalClock"}),fluid.defaults("flock.scheduler.webWorkerScheduleClock",{gradeNames:["flock.scheduler.webWorkerClock","autoInit"],clockType:"scheduleClock"}),flock.scheduler.makeOneShotValueListener=function(a,b,c){var d=function(e){e===a&&(b(e),c(d))};return d},flock.scheduler.makeRepeatingValueListener=function(a,b){return function(c){c===a&&b(c)}},fluid.defaults("flock.scheduler.async",{gradeNames:["fluid.eventedComponent","autoInit"],components:{timeConverter:{type:"flock.convert.seconds"},intervalClock:{type:"flock.scheduler.webWorkerIntervalClock"},scheduleClock:{type:"flock.scheduler.webWorkerScheduleClock"}}}),flock.scheduler.async.finalInit=function(a){a.intervalListeners={},a.scheduleListeners=[],a.addIntervalListener=function(b,c){var d=flock.scheduler.makeRepeatingValueListener(b,c);return d.wrappedListener=c,a.intervalListeners[b]=a.intervalListeners[b]||[],a.intervalListeners[b].push(d),a.intervalClock.events.tick.addListener(d),d},a.addScheduleListener=function(b,c){var d=flock.scheduler.makeOneShotValueListener(b,c,a.clear);return d.wrappedListener=c,a.scheduleListeners.push(d),a.scheduleClock.events.tick.addListener(d),d},a.scheduleChange=function(b,c,d,e){var f=a.timeConverter.value(b),g=flock.scheduler.async.prepareSchedulerFn(c,a.events),h=d(f,g);return e.schedule(f),h},a.repeat=function(b,c){return a.scheduleChange(b,c,a.addIntervalListener,a.intervalClock)},a.once=function(b,c){return a.scheduleChange(b,c,a.addScheduleListener,a.scheduleClock)},a.sequence=function(b,c){for(var d,e=[],f=0;f<b.length;f++)d=a.once(b[f],c),e.push(d);return e},a.schedule=function(b){b=flock.isIterable(b)?b:[b];var c,d;for(c=0;c<b.length;c++)d=b[c],flock.invoke(a,d.interval,[d.time,d.change])},a.clear=function(b){if(b){var c,d=a.scheduleListeners.indexOf(b);if(d>-1)return a.scheduleClock.events.tick.removeListener(b),void a.scheduleListeners.splice(d,1);a.intervalClock.events.tick.removeListener(b);for(c in a.intervalListeners)d=a.intervalListeners[c].indexOf(b),d>-1&&a.intervalListeners[c].splice(d,1)}},a.clearRepeat=function(b){a.intervalClock.clear(b);var c,d,e=a.intervalListeners[b];if(e){for(c=0;c<e.length;c++)d=e[c],a.intervalClock.events.tick.removeListener(d);return e.length=0,d}},a.clearAll=function(){a.intervalClock.clearAll();for(var b in a.intervalListeners)a.clearRepeat(b);a.scheduleClock.clearAll();for(var c in a.scheduleListeners)a.clear(c)},a.end=function(){a.intervalClock.end(),a.scheduleClock.end()},a.options.score&&a.schedule(a.options.score)},flock.scheduler.async.prepareSchedulerFn=function(a,b){var c,d=typeof a;return c="function"===d?a:"string"===d?b[a].fire:flock.scheduler.async.evaluateChangeSpec(a)},flock.scheduler.async.evaluateChangeSpec=function(a){var b={},c={};for(var d in a.values){var e=a.values[d];e.synthDef?b[d]=flock.synth.value(e):c[d]=e}return function(){for(var d in b){var e=b[d];c[d]=e.value()}var f="string"==typeof a.synth?flock.enviro.shared.namedNodes[a.synth]:a.synth;f.set(c)}},fluid.defaults("flock.scheduler.async.tempo",{gradeNames:["flock.scheduler.async","autoInit"],bpm:60,components:{timeConverter:{type:"flock.convert.beats",options:{bpm:"{tempo}.options.bpm"}}}}),fluid.registerNamespace("flock.convert"),flock.convert.makeStatelessConverter=function(a){return function(){return{value:a}}},flock.convert.ms=flock.convert.makeStatelessConverter(fluid.identity),flock.convert.seconds=flock.convert.makeStatelessConverter(function(a){return 1e3*a}),fluid.defaults("flock.convert.beats",{gradeNames:["fluid.littleComponent","autoInit"],bpm:60}),flock.convert.beats.finalInit=function(a){a.value=function(b){var c=a.options.bpm;return 0>=c?0:b/c*6e4}}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";flock.shim.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,fluid.defaults("flock.enviro.webAudio",{gradeNames:["flock.enviro.audioStrategy","autoInit"],members:{preNode:null,jsNode:null,postNode:null},model:{isGenerating:!1,hasInput:!1}}),flock.enviro.webAudio.finalInit=function(a){a.startGeneratingSamples=function(){var b=a.model;if(a.preNode&&a.preNode.connect(a.jsNode),a.postNode.connect(a.context.destination),a.postNode!==a.jsNode&&a.jsNode.connect(a.postNode),b.shouldInitIOS){var c=a.context.createBufferSource();c.connect(a.jsNode),c.start(0),c.stop(0),c.disconnect(0),b.shouldInitIOS=!1}b.isGenerating=!0},a.stopGeneratingSamples=function(){a.jsNode.disconnect(0),a.postNode.disconnect(0),a.preNode&&a.preNode.disconnect(0),a.model.isGenerating=!1},a.writeSamples=function(b){var c,d,e,f=a.model,g=f.hasInput,h=f.krPeriods,i=a.nodeEvaluator,j=i.buses,k=a.options.audioSettings,l=k.blockSize,m=f.playState,n=k.chans,o=b.inputBuffer,p=b.inputBuffer.numberOfChannels,q=b.outputBuffer;if(i.nodes.length<1)for(c=0;n>c;c++)flock.generate.silence(q.getChannelData(c));else{for(d=0;h>d;d++){var r=d*l;if(i.clearBuses(),g)for(c=0;p>c;c++){var s=o.getChannelData(c),t=n+c,u=j[t];for(e=0;l>e;e++)u[e]=s[e+r]}for(i.gen(),c=0;n>c;c++){var v=j[c],w=q.getChannelData(c);for(e=0;l>e;e++)w[e+r]=v[e]}}m.written+=k.bufferSize*n,m.written>=m.total&&a.stop()}},a.insertInputNode=function(b){var c=a.model;a.preNode&&a.removeInputNode(a.preNode),a.preNode=b,c.hasInput=!0,c.isGenerating&&a.preNode.connect(a.jsNode)},a.insertOutputNode=function(b){a.postNode&&a.removeOutputNode(a.postNode),a.postNode=b},a.removeInputNode=function(){flock.enviro.webAudio.removeNode(a.preNode),a.preNode=null,a.model.hasInput=!1},a.removeOutputNode=function(){flock.enviro.webAudio.removeNode(a.postNode),a.postNode=a.jsNode},a.startReadingAudioInput=function(){flock.shim.getUserMedia.call(navigator,{audio:!0},function(b){var c=a.context.createMediaStreamSource(b);a.insertInputNode(c)},function(a){fluid.log(fluid.logLevel.IMPORTANT,"An error occurred while trying to access the user's microphone. "+a)})},a.stopReadingAudioInput=function(){a.removeInputNode()},a.init=function(){var b=a.model,c=a.options.audioSettings;b.krPeriods=c.bufferSize/c.blockSize,flock.enviro.webAudio.audioContext||(flock.enviro.webAudio.audioContext=new flock.enviro.webAudio.contextConstructor),a.context=flock.enviro.webAudio.audioContext,c.rates.audio=a.context.sampleRate,flock.platform.browser.safari||(c.chans=a.context.destination.maxChannelCount,a.context.destination.channelCount=c.chans),a.jsNode=flock.enviro.webAudio.createScriptNode(a.context,c),a.insertOutputNode(a.jsNode),a.jsNode.onaudioprocess=a.writeSamples,b.shouldInitIOS=flock.platform.isIOS},a.init()},flock.enviro.webAudio.createScriptNode=function(a,b){var c=a.createScriptProcessor?"createScriptProcessor":"createJavaScriptNode",d=a[c](b.bufferSize,b.chans,b.chans);return d.channelCountMode="explicit",d.channelCount=b.chans,d},flock.enviro.webAudio.removeNode=function(a){a.disconnect(0)},flock.enviro.webAudio.contextConstructor=window.AudioContext||window.webkitAudioContext,fluid.demands("flock.enviro.audioStrategy","flock.platform.webAudio",{funcName:"flock.enviro.webAudio"})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";var a=fluid.registerNamespace("jQuery"),b=flock.requireModule("DSP","dspapi"),c=flock.requireModule("Filter","dspapi");flock.aliasUGen=function(b,c,d,e){var f=flock.get(b);flock.set(f,c,function(b,c,d){return d=a.extend(!0,{},e,d),f(b,c,d)}),fluid.defaults(b+"."+c,d)},flock.aliasUGens=function(a,b){var c,d;for(c in b)d=b[c],flock.aliasUGen(a,c,{inputs:d.inputDefaults},d.options)},flock.krMul=function(a,b,c){var d,e=c.output[0];for(d=0;a>d;d++)b[d]=b[d]*e},flock.mul=function(a,b,c){var d,e=c.output;for(d=0;a>d;d++)b[d]=b[d]*e[d]},flock.krAdd=function(a,b,c,d){var e,f=d.output[0];for(e=0;a>e;e++)b[e]=b[e]+f},flock.add=function(a,b,c,d){var e,f=d.output;for(e=0;a>e;e++)b[e]=b[e]+f[e]},flock.krMulAdd=function(a,b,c,d){var e,f=c.output[0],g=d.output;for(e=0;a>e;e++)b[e]=b[e]*f+g[e]},flock.mulKrAdd=function(a,b,c,d){var e,f=c.output,g=d.output[0];for(e=0;a>e;e++)b[e]=b[e]*f[e]+g},flock.krMulKrAdd=function(a,b,c,d){var e,f=c.output[0],g=d.output[0];for(e=0;a>e;e++)b[e]=b[e]*f+g},flock.mulAdd=function(a,b,c,d){var e,f=c.output,g=d.output;for(e=0;a>e;e++)b[e]=b[e]*f[e]+g[e]},flock.onMulAddInputChanged=function(a){var b,c=a.inputs.mul,d=a.inputs.add;return c||d?(b=c?d?c.rate!==flock.rates.AUDIO?d.rate!==flock.rates.AUDIO?flock.krMulKrAdd:flock.krMulAdd:d.rate!==flock.rates.AUDIO?flock.mulKrAdd:flock.mulAdd:c.rate!==flock.rates.AUDIO?flock.krMul:flock.mul:d.rate!==flock.rates.AUDIO?flock.krAdd:flock.add,void(a.mulAdd=function(e){b(e,a.output,c,d)})):void(a.mulAdd=fluid.identity)},flock.ugen=function(a,b,c){c=c||{};var d={rate:c.rate||flock.rates.AUDIO,inputs:a,output:b,options:c,model:c.model||{},multiInputs:{},tags:["flock.ugen"]};return d.get=function(a){return flock.input.get(d.inputs,a)},d.set=function(a,b){return flock.input.set(d.inputs,a,b,d,function(a){return null!==a&&void 0!==a?flock.parse.ugenDef(a,{audioSettings:d.options.audioSettings,buses:d.options.audioSettings.buses,buffers:d.options.audioSettings.buffers}):void 0})},d.input=function(a,b){return a?"string"==typeof a?arguments.length<2?d.get(a):d.set(a,b):flock.isIterable(a)?d.get(a):d.set(a,b):void 0},d.calculateStrides=function(){var a,b,c=d.model,e=d.options.strideInputs,f=d.inputs;if(c.strides=c.strides||{},e)for(a=0;a<e.length;a++)b=e[a],c.strides[b]=f[b].rate===flock.rates.AUDIO?1:0},d.collectMultiInputs=function(){var a,b,c,e,f=d.options.multiInputNames,g=d.multiInputs;for(a=0;a<f.length;a++)b=f[a],c=g[b],c?c.length=0:c=g[b]=[],e=d.inputs[b],flock.ugen.collectMultiInputs(e,c)},d.onInputChanged=function(a){var b=d.options.multiInputNames;flock.onMulAddInputChanged(d),d.options.strideInputs&&d.calculateStrides(),!b||a&&!b.indexOf(a)||d.collectMultiInputs()},d.init=function(){var a,b,c,e=fluid.makeArray(d.options.tags),f=d.model,g=d.options;for(a=0;a<e.length;a++)d.tags.push(e[a]);b=g.audioSettings=g.audioSettings||flock.enviro.shared.audioSettings,f.sampleRate=g.sampleRate||b.rates[d.rate],f.nyquistRate=f.sampleRate,f.blockSize=d.rate===flock.rates.AUDIO?b.blockSize:1,f.sampleDur=1/f.sampleRate,d.interpolate=flock.interpolate[g.interpolation],d.rate===flock.rates.DEMAND&&d.inputs.freq&&(c=flock.parse.ugenDefForConstantValue(1),d.inputs.freq=flock.parse.ugenDef(c))},d.init(),d},flock.ugen.collectMultiInputs=function(a,b){flock.isIterable(a)||(a=a=fluid.makeArray(a));for(var c=0;c<a.length;c++){var d=a[c];flock.ugen.collectChannelsForInput(d,b)}return b},flock.ugen.collectChannelsForInput=function(a,b){var c,d=flock.hasTag(a,"flock.ugen.multiChannelOutput"),e=d?a.output:[a.output];for(c=0;c<e.length;c++)b.push({rate:a.rate,output:e[c]});return b},flock.ugen.value=function(a,b,c){var d=flock.ugen(a,b,c);return d.dynamicGen=function(a){for(var b=d.output,c=d.model,e=0;a>e;e++)b[e]=c.value;d.mulAdd(a)},d.onInputChanged=function(){var a=d.inputs,b=d.model;b.value=a.value,d.gen="constant"!==d.rate?d.dynamicGen:void 0,flock.onMulAddInputChanged(d),d.dynamicGen(1)},d.onInputChanged(),d},fluid.defaults("flock.ugen.value",{rate:"control",inputs:{value:1,mul:null,add:null},ugenOptions:{tags:["flock.ugen.valueType"]}}),flock.ugen.passThrough=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.inputs.source.output,e=d.output;for(b=0;b<c.length;b++)e[b]=c[b];for(;a>b;b++)e[b]=0;d.mulAdd(a)},d.onInputChanged(),d},fluid.defaults("flock.ugen.passThrough",{rate:"audio",inputs:{source:null,mul:null,add:null}}),flock.ugen.valueChangeTrigger=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.inputs.source.output,h=d.output;for(b=0,c=0;a>b;b++,c+=f.strides.source)e=g[c],h[b]=e!==f.prevVal?1:0,f.prevVal=e},d.onInputChanged=function(a){d.calculateStrides(),"source"===a&&(d.model.prevVal=null)},d.calculateStrides(),d},fluid.defaults("flock.ugen.valueChangeTrigger",{rate:"control",inputs:{source:0},ugenOptions:{model:{prevVal:0},strideInputs:["source"]}}),flock.ugen.inputChangeTrigger=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h=d.model,i=d.inputs.source.output,j=h.strides.source,k=d.inputs.duration.output,l=h.strides.duration,m=h.prevDur,n=d.output;for(b=c=e=0;a>b;b++,c+=j,e+=l)f=i[c],g=k[e],g!==m&&(h.prevDur=g,h.remainingOpenSamples=f>0?g>0?h.sampleRate*g:1:0),h.remainingOpenSamples>0?(n[b]=f,h.remainingOpenSamples--):n[b]=0},d.onInputChanged=function(a){d.calculateStrides(),"source"===a&&(d.model.prevDur=null)},d.calculateStrides(),d},fluid.defaults("flock.ugen.inputChangeTrigger",{rate:"control",inputs:{source:0,duration:0},ugenOptions:{model:{prevDuration:0,remainingOpenSamples:0},strideInputs:["source","duration"]}}),flock.ugen.triggerCallback=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h=d.model,i=d.options,j=d.output,k=d.inputs,l=h.strides.trigger,m=h.strides.source,n=k.trigger.output,o=k.source.output,p=i.callback,q=p.func,r=p.args,s=p.this,t=h.lastArgIdx,u=h.prevTrig;for(b=c=e=0;a>b;b++,c+=l,e+=m)f=n[c],g=o[e],f>0&&0>=u&&q&&(r[t]=g,q.apply(s,r)),j[b]=g,u=f;h.prevTrig=u},d.onInputChanged=function(){var a=d.options,b=d.model,c=a.callback,e=c.funcName;if(e)c.func=fluid.getGlobalValue(e);else if(c.this&&c.method){if("string"!=typeof c.this)throw new Error("flock.ugen.triggerCallback doesn't support raw 'this' objects.Use a global key path instead.");c.this="string"==typeof c.this?fluid.getGlobalValue(c.this):c.this,c.func=fluid.get(c.this,c.method)}b.lastArgIdx=c.args.length,d.calculateStrides()},d.onInputChanged(),d},fluid.defaults("flock.ugen.triggerCallback",{rate:"audio",inputs:{source:0,trigger:0},ugenOptions:{model:{funcName:void 0,lastArgIdx:0},callback:{"this":void 0,method:void 0,func:void 0,args:[]},strideInputs:["source","trigger"]}}),flock.ugen.math=function(a,c,d){var e=flock.ugen(a,c,d);return e.expandedSource=new Float32Array(e.options.audioSettings.blockSize),e.krSourceKrInputGen=function(){var a=e.activeInput,c=e.inputs[a],d=flock.generate(e.expandedSource,e.inputs.source.output[0]);b[a](e.output,d,c.output[0])},e.krSourceArInputGen=function(){var a=e.activeInput,c=e.inputs[a],d=flock.generate(e.expandedSource,e.inputs.source.output[0]);b[a](e.output,d,c.output)},e.arSourceKrInputGen=function(){var a=e.activeInput,c=e.inputs[a],d=e.inputs.source.output;b[a](e.output,d,c.output[0])},e.arSourceArInputGen=function(){var a=e.activeInput,c=e.inputs[a];b[a](e.output,e.inputs.source.output,c.output)},e.onInputChanged=function(){var a,b,c,d=Object.keys(e.inputs);for(a=0;a<d.length;a++)if(b=d[a],"source"!==b){e.activeInput=b,c="audio"===e.inputs[b].rate,e.gen="audio"===e.inputs.source.rate?c?e.arSourceArInputGen:e.arSourceKrInputGen:c?e.krSourceArInputGen:e.krSourceKrInputGen;break}},e.init=function(){if("undefined"==typeof b)throw new Error("DSP is undefined. Please include dspapi.js to use the flock.math unit generator.");e.onInputChanged()},e.init(),e},fluid.defaults("flock.ugen.math",{rate:"audio",inputs:{source:null}}),flock.ugen.sum=function(a,b,c){var d=flock.ugen(a,b,c);return d.copyGen=function(a){var b,c=d.output,e=d.inputs.sources.output;for(b=0;a>b;b++)c[b]=e[b]},d.sumGen=function(a){var b,c,e,f=d.inputs.sources,g=d.output;for(b=0;a>b;b++){for(e=0,c=0;c<f.length;c++)e+=f[c].output[b];g[b]=e}},d.onInputChanged=function(){d.gen="number"==typeof d.inputs.sources.length?d.sumGen:d.copyGen},d.onInputChanged(),d},fluid.defaults("flock.ugen.sum",{rate:"audio",inputs:{sources:null}}),flock.ugen.osc=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g=d.model,h=d.inputs,i=h.freq.output,j=h.phase.output,k=h.table,l=g.tableLen,m=g.tableIncHz,n=g.tableIncRad,o=d.output,p=g.phase;for(b=0,c=0,e=0;a>b;b++,c+=g.strides.phase,e+=g.strides.freq)f=p+j[c]*n,f>=l?f-=l:0>f&&(f+=l),o[b]=d.interpolate?d.interpolate(f,k):k[0|f],p+=i[e]*m,p>=l?p-=l:0>p&&(p+=l);g.phase=p,d.mulAdd(a)},d.onInputChanged=function(){flock.ugen.osc.onInputChanged(d);var a=d.model;a.tableLen=d.inputs.table.length,a.tableIncHz=a.tableLen/a.sampleRate,a.tableIncRad=a.tableLen/flock.TWOPI
},d.onInputChanged(),d},flock.ugen.osc.onInputChanged=function(a){a.calculateStrides(),flock.onMulAddInputChanged(a)},fluid.defaults("flock.ugen.osc",{rate:"audio",inputs:{freq:440,phase:0,table:null,mul:null,add:null},ugenOptions:{interpolation:"linear",model:{phase:0},strideInputs:["freq","phase"]},tableSize:8192}),flock.ugen.osc.define=function(a,b){var c=a.lastIndexOf("."),d=a.substring(0,c),e=a.substring(c+1),f=flock.get(d);f[e]=function(a,c,d){var e=fluid.defaults("flock.ugen.osc"),f=fluid.merge(null,e,d),g=f.tableSize;return a.table=b(g,flock.TWOPI/g),flock.ugen.osc(a,c,d)},fluid.defaults(a,fluid.defaults("flock.ugen.osc"))},flock.ugen.osc.define("flock.ugen.sinOsc",function(a,b){return flock.generate(a,function(a){return Math.sin(a*b)})}),flock.ugen.osc.fourierTable=function(a,b,c,d,e){return d*=flock.TWOPI,flock.generate(a,function(a){var f,g,h,i=0;for(f=0;c>f;f++)g=e?e[f]:1,h=(f+1)*a*b,i+=g*Math.cos(h+d);return i})},flock.ugen.osc.normalizedFourierTable=function(a,b,c,d,e){var f=flock.generate(c,function(a){return e(a+1)}),g=flock.ugen.osc.fourierTable(a,b,c,d,f);return flock.normalize(g)},flock.ugen.osc.define("flock.ugen.triOsc",function(a,b){return flock.ugen.osc.normalizedFourierTable(a,b,1e3,1,function(a){return a%2===0?0:1/(a*a)})}),flock.ugen.osc.define("flock.ugen.sawOsc",function(a,b){return flock.ugen.osc.normalizedFourierTable(a,b,10,-.25,function(a){return 1/a})}),flock.ugen.osc.define("flock.ugen.squareOsc",function(a,b){return flock.ugen.osc.normalizedFourierTable(a,b,10,-.25,function(a){return a%2===0?0:1/a})}),flock.ugen.sin=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.inputs.freq.output,h=d.inputs.phase.output,i=d.output,j=f.phase,k=f.sampleRate;for(b=0,c=0,e=0;a>b;b++,c+=f.strides.phase,e+=f.strides.freq)i[b]=Math.sin(j+h[c]),j+=g[e]/k*flock.TWOPI;f.phase=j,d.mulAdd(a)},d.onInputChanged=function(){flock.ugen.osc.onInputChanged(d)},d.onInputChanged(),d},fluid.defaults("flock.ugen.sin",{rate:"audio",inputs:{freq:440,phase:0,mul:null,add:null},ugenOptions:{model:{phase:0},strideInputs:["freq","phase"]}}),flock.ugen.lfSaw=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.model,f=d.inputs.freq.output,g=d.output,h=e.scale,i=d.inputs.phase.output[0],j=e.phase;for(b=0,c=0;a>b;b++,c+=e.strides.freq)g[b]=j+i,j+=f[c]*h,j>=1?j-=2:-1>=j&&(j+=2);e.phase=j,d.mulAdd(a)},d.onInputChanged=function(){var a=d.model;a.freqInc=d.inputs.freq.rate===flock.rates.AUDIO?1:0,a.phase=0,d.calculateStrides(),flock.onMulAddInputChanged(d)},d.init=function(){d.model.scale=2*(1/d.options.sampleRate),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.lfSaw",{rate:"audio",inputs:{freq:440,phase:0,mul:null,add:null},ugenOptions:{strideInputs:["freq"]}}),flock.ugen.lfPulse=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.inputs,f=d.model,g=e.freq.output,h=f.freqInc,i=e.width.output[0],j=d.output,k=f.scale,l=void 0!==f.phase?f.phase:e.phase.output[0];for(b=0,c=0;a>b;b++,c+=h)l>=1?(l-=1,j[b]=.5>i?1:-1):j[b]=i>l?1:-1,l+=g[c]*k;f.phase=l,d.mulAdd(a)},d.onInputChanged=function(){d.model.freqInc=d.inputs.freq.rate===flock.rates.AUDIO?1:0,flock.onMulAddInputChanged(d)},d.init=function(){d.model.scale=1/d.options.sampleRate,d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.lfPulse",{rate:"audio",inputs:{freq:440,phase:0,width:.5,mul:null,add:null}}),flock.ugen.impulse=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.inputs,g=d.model,h=d.output,i=f.freq.output,j=g.strides.freq,k=f.phase.output[0],l=g.phase,m=g.scale;for(l+=k,b=0,c=0;a>b;b++,c+=j)l>=1?(l-=1,e=1):e=0,h[b]=e,l+=i[c]*m;g.phase=l-k,d.mulAdd(a)},d.onInputChanged=function(){d.calculateStrides(),flock.onMulAddInputChanged(d)},d.init=function(){d.model.scale=1/d.model.sampleRate,d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.impulse",{rate:"audio",inputs:{freq:440,phase:0,mul:null,add:null},ugenOptions:{model:{phase:0},strideInputs:["freq"]}}),flock.ugen.t2a=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(){for(var a=d.model,b=d.inputs.source.output[0],c=0|d.inputs.offset.output[0],e=d.output,f=0;f<e.length;f++)e[f]=0;b>0&&a.prevTrig<=0&&(e[c]=b),a.prevTrig=b},d},fluid.defaults("flock.ugen.t2a",{rate:"audio",inputs:{source:null,offset:0},ugenOptions:{model:{prevTrig:0}}}),flock.ugen.latch=function(a,b,c){var d=flock.ugen(a,b,c);return d.arGen=function(a){var b,c,e,f=d.model,g=d.inputs,h=g.source.output,i=g.trigger,j=f.strides.source,k=d.output;for(void 0===f.holdVal&&(f.holdVal=h[0]),b=0,c=0;a>b;b++,c+=j)e=i.output[b],k[b]=e>0&&f.prevTrig<=0?f.holdVal=h[c]:f.holdVal,f.prevTrig=e;d.mulAdd(a)},d.krGen=function(a){var b,c=d.model,e=d.inputs.trigger.output[0];for((void 0===c.holdVal||e>0&&c.prevTrig<=0)&&(c.holdVal=d.inputs.source.output[0]),c.prevTrig=e,b=0;a>b;b++)d.output[b]=c.holdVal;d.mulAdd(a)},d.onInputChanged=function(){d.calculateStrides(),d.gen=d.inputs.trigger.rate===flock.rates.AUDIO?d.arGen:d.krGen,flock.onMulAddInputChanged(d)},d.onInputChanged(),d},fluid.defaults("flock.ugen.latch",{rate:"audio",inputs:{source:null,trigger:0,mul:null,add:null},ugenOptions:{strideInputs:["source"],model:{prevTrig:0}}}),flock.ugen.buffer=function(a){a.onBufferInputChanged=function(b){var c=a.model,d=a.inputs;(c.bufDef!==d.buffer||"buffer"===b)&&(c.bufDef=d.buffer,flock.parse.bufferForDef(c.bufDef,a,flock.enviro.shared))},a.setBuffer=function(b){a.buffer=b,a.onBufferReady&&a.onBufferReady(b)},a.initBuffer=function(){a.buffer=a.model.bufDef=flock.bufferDesc({format:{sampleRate:a.options.audioSettings.rates.audio},data:{channels:[new Float32Array(a.output.length)]}})}},flock.ugen.playBuffer=function(a,b,c){var d=flock.ugen(a,b,c);return d.crRegularSpeedGen=function(b){var c,e,f,g=d.model,h=d.output,i=d.inputs.channel.output[0],j=d.buffer.data.channels[i],k=a.trigger.output,l=g.idx,m=j.length,n=d.inputs.loop.output[0],o=d.inputs.start.output[0]*m|0,p=d.inputs.end.output[0]*m|0;for(c=0,e=0;b>c;c++,e+=g.strides.trigger){if(k[e]>0&&g.prevTrig<=0)l=o;else if(l>=p){if(!(n>0)){h[c]=0;continue}l=o}g.prevTrig=k[e],f=d.interpolate?d.interpolate(l,j):j[0|l],h[c]=f,l+=g.stepSize}g.idx=l,d.mulAdd(b)},d.krSpeedGen=function(b){var c,e,f,g=d.model,h=d.output,i=d.inputs.channel.output[0],j=d.inputs.speed.output[0],k=d.buffer.data.channels[i],l=a.trigger.output,m=g.idx,n=k.length,o=d.inputs.loop.output[0],p=d.inputs.start.output[0]*n|0,q=d.inputs.end.output[0]*n|0;for(c=0,e=0;b>c;c++,e+=g.strides.trigger){if(l[e]>0&&g.prevTrig<=0)m=p;else if(m>=q){if(!(o>0)){h[c]=0;continue}m=p}g.prevTrig=l[e],f=d.interpolate?d.interpolate(m,k):k[0|m],h[c]=f,m+=g.stepSize*j}g.idx=m,d.mulAdd(b)},d.onInputChanged=function(a){var b=d.inputs,c=b.speed;d.onBufferInputChanged(a),d.gen=c.rate===flock.rates.CONSTANT&&1===c.output[0]?d.crRegularSpeedGen:d.krSpeedGen,d.calculateStrides(),flock.onMulAddInputChanged(d)},d.onBufferReady=function(){var a=d.model,b=d.inputs.end.output[0],c=d.inputs.channel.output[0],e=d.buffer.data.channels[c];a.idx=b*e.length|0,a.stepSize=d.buffer.format.sampleRate/a.sampleRate},d.init=function(){flock.ugen.buffer(d),d.initBuffer(),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.playBuffer",{rate:"audio",inputs:{channel:0,loop:0,speed:1,start:0,end:1,trigger:1,buffer:null,mul:null,add:null},ugenOptions:{model:{idx:0,stepSize:0,prevTrig:0,channel:void 0},strideInputs:["trigger"],interpolation:"linear"}}),flock.ugen.readBuffer=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g=d.model,h=g.strides.phase,i=d.output,j=d.inputs.channel.output[0],k=d.inputs.phase.output,l=d.buffer.data.channels[j],m=l.length;for(b=e=0;a>b;b++,e+=h)c=k[e]*m,f=d.interpolate?d.interpolate(c,l):l[0|c],i[b]=f;d.mulAdd(a)},d.onInputChanged=function(a){d.onBufferInputChanged(a),d.calculateStrides(),flock.onMulAddInputChanged(d)},d.init=function(){flock.ugen.buffer(d),d.initBuffer(),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.readBuffer",{rate:"audio",inputs:{buffer:null,channel:0,phase:0,mul:null,add:null},ugenOptions:{model:{channel:void 0},strideInputs:["phase"],interpolation:"linear"}}),flock.ugen.bufferDuration=function(a,b,c){var d=flock.ugen(a,b,c);return d.krGen=function(a){var b,c=d.model,e=d.inputs.channel.output[0],f=d.buffer.data.channels[e],g=d.buffer.format.sampleRate;for(b=0;a>b;b++)d.output[b]=c.value=f.length/g},d.onInputChanged=function(a){d.onBufferInputChanged(a)},d.onBufferReady=function(a){var b=d.inputs.channel.output[0];d.output[0]=d.model.value=a.data.channels[b].length/d.buffer.format.sampleRate},d.init=function(){var a=d.rate;d.gen=a===flock.rates.CONTROL||a===flock.rates.AUDIO?d.krGen:void 0,d.output[0]=d.model.value=0,flock.ugen.buffer(d),d.initBuffer(),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.bufferDuration",{rate:"constant",inputs:{buffer:null,channel:0},ugenOptions:{model:{value:0}}}),flock.ugen.bufferLength=function(a,b,c){var d=flock.ugen(a,b,c);return d.krGen=function(a){var b,c=d.model,e=d.inputs.channel.output[0],f=d.buffer.data.channels[e];for(b=0;a>b;b++)d.output[b]=c.value=f.length},d.onInputChanged=function(a){d.onBufferInputChanged(a)},d.onBufferReady=function(a){var b=d.inputs.channel.output[0];d.output[0]=d.model.value=a.data.channels[b].length},d.init=function(){var a=d.rate;d.gen=a===flock.rates.CONTROL||a===flock.rates.AUDIO?d.krGen:void 0,d.output[0]=d.model.value=0,flock.ugen.buffer(d),d.initBuffer(),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.bufferLength",{rate:"constant",inputs:{buffer:null,channel:0},ugenOptions:{model:{value:0}}}),flock.ugen.bufferPhaseStep=function(a,b,c){var d=flock.ugen(a,b,c);return d.krGen=function(a){var b,c=d.output,e=d.model.value;for(b=0;a>b;b++)c[b]=e;d.mulAdd(a)},d.onInputChanged=function(a){d.onBufferInputChanged(a),flock.onMulAddInputChanged(d)},d.onBufferReady=function(a){var b=d.model,c=d.inputs.channel.output[0],e=a.data.channels[c],f=d.options.audioSettings.rates.audio,g=d.buffer.format.sampleRate||f;b.scale=g/f,d.output[0]=b.value=1/(e.length*b.scale)},d.init=function(){var a=d.rate;d.gen=a===flock.rates.CONTROL||a===flock.rates.AUDIO?d.krGen:void 0,d.output[0]=d.model.value=0,flock.ugen.buffer(d),d.initBuffer(),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.bufferPhaseStep",{rate:"constant",inputs:{buffer:null,channel:0},ugenOptions:{model:{scale:1,value:0}}}),flock.ugen.sampleRate=function(a,b,c){var d=flock.ugen(a,b,c);return d.output[0]=d.options.audioSettings.rates.audio,d},fluid.defaults("flock.ugen.sampleRate",{rate:"constant",inputs:{}}),flock.ugen.dust=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(c){var e,f,g,h,i=d.model,j=a.density.output[0];for(j!==i.density?(i.density=j,e=i.threshold=j*i.sampleDur,f=i.scale=e>0?1/e:0):(e=i.threshold,f=i.scale),h=0;c>h;h++)g=Math.random(),b[h]=e>g?g*f:0;d.mulAdd(c)},d.onInputChanged(),d},fluid.defaults("flock.ugen.dust",{rate:"audio",inputs:{density:1,mul:null,add:null},ugenOptions:{model:{density:0,scale:0,threshold:0}}}),flock.ugen.whiteNoise=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.output;for(b=0;a>b;b++)c[b]=Math.random();d.mulAdd(a)},d.onInputChanged(),d},fluid.defaults("flock.ugen.whiteNoise",{rate:"audio",inputs:{mul:null,add:null}}),flock.ugen.pinkNoise=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g=d.model.state,h=d.a,i=d.p,j=d.model.offset,k=d.output;for(b=0;a>b;b++){for(f=0,c=0;c<g.length;c++)e=Math.random(),g[c]=i[c]*(g[c]-e)+e,f+=h[c]*g[c];k[b]=2*f-j}d.mulAdd(a)},d.init=function(){d.a=new Float32Array(d.options.coeffs.a),d.p=new Float32Array(d.options.coeffs.p),d.model.state=new Float32Array(d.a.length);for(var a=0;a<d.a.length;a++)d.model.offset+=d.a[a];d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.pinkNoise",{rate:"audio",inputs:{mul:null,add:null},ugenOptions:{model:{offset:0},coeffs:{a:[.02109238,.07113478,.68873558],p:[.319,.7756,.9613]}}}),flock.ugen.lfNoise=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(b){var c,e,f=d.model,g=a.freq.output[0],h=b,i=d.output,j=0;g=g>.001?g:.001;do for(f.counter<=0&&(f.counter=f.sampleRate/g,f.counter=f.counter>1?f.counter:1,"linear"===d.options.interpolation?(f.start=f.value=f.end,f.end=Math.random(),f.ramp=f.ramp=(f.end-f.start)/f.counter):(f.start=f.value=Math.random(),f.ramp=0)),c=h<f.counter?h:f.counter,h-=c,f.counter-=c,e=0;c>e;e++)i[j]=f.value,f.value+=f.ramp,j++;while(h);d.mulAdd(b)},d.input=function(){d.model.end=Math.random(),d.onInputChanged()},d.input(),d},fluid.defaults("flock.ugen.lfNoise",{rate:"audio",inputs:{freq:440,mul:null,add:null},ugenOptions:{model:{counter:0,level:0}}}),flock.ugen.random=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.generator,e=d.output;for(b=0;a>b;b++)e[b]=c.uniform(-1,1);d.mulAdd(a)},d.onInputChanged=function(a){"seed"===a&&d.initGenerator(),flock.onMulAddInputChanged(d)},d.initGenerator=function(){var a=d.inputs.seed;d.generator=a?new Random(a):new Random},d.init=function(){d.initGenerator(),d.calculateStrides(),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.random",{rate:"audio",inputs:{seed:null,mul:null,add:null}}),flock.ugen.random.exponential=function(a,b,c){var d=flock.ugen.random(a,b,c);return d.gen=function(a){var b,c,e=d.generator,f=d.output,g=d.inputs.lambda.output,h=d.model.strides.lambda;for(b=c=0;a>b;b++,c+=h)f[b]=e.exponential(g[c]);d.mulAdd(a)},d},fluid.defaults("flock.ugen.random.exponential",{rate:"audio",inputs:{seed:null,lambda:1,mul:null,add:null},ugenOptions:{strideInputs:["lambda"]}}),flock.ugen.random.gamma=function(a,b,c){var d=flock.ugen.random(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.inputs,h=d.generator,i=d.output,j=f.strides.alpha,k=g.alpha.output,l=f.strides.beta,m=g.beta.output;for(b=c=e=0;a>b;b++,c+=j,e+=l)i[b]=h.gamma(k[c],m[e]);d.mulAdd(a)},d},fluid.defaults("flock.ugen.random.gamma",{rate:"audio",inputs:{seed:null,alpha:1,beta:2,mul:null,add:null},ugenOptions:{strideInputs:["alpha","beta"]}}),flock.ugen.random.normal=function(a,b,c){var d=flock.ugen.random(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.output,h=d.inputs,i=d.generator,j=f.strides.mu,k=h.mu.output,l=f.strides.sigma,m=h.sigma.output;for(b=c=e=0;a>b;b++,c+=j,e+=l)g[b]=i.normal(k[c],m[e]);d.mulAdd(a)},d},fluid.defaults("flock.ugen.random.normal",{rate:"audio",inputs:{seed:null,mu:0,sigma:1,mul:null,add:null},ugenOptions:{strideInputs:["mu","sigma"]}}),flock.ugen.random.pareto=function(a,b,c){var d=flock.ugen.random(a,b,c);return d.gen=function(a){var b,c,e=d.generator,f=d.output,g=d.model.strides.alpha,h=d.inputs.alpha.output;for(b=c=0;a>b;b++,c+=g)f[b]=e.pareto(h[c]);d.mulAdd(a)},d},fluid.defaults("flock.ugen.random.pareto",{rate:"audio",inputs:{seed:null,alpha:5,mul:null,add:null},ugenOptions:{strideInputs:["alpha"]}}),flock.ugen.random.triangular=function(a,b,c){var d=flock.ugen.random(a,b,c);return d.gen=function(a){var b,c,e=d.generator,f=d.output,g=d.model.strides.mode,h=d.inputs.mode.output;for(b=c=0;a>b;b++,c+=g)f[b]=e.triangular(-1,1,h[c]);d.mulAdd(a)},d},fluid.defaults("flock.ugen.random.triangular",{rate:"audio",inputs:{seed:null,mode:.5,mul:null,add:null},ugenOptions:{strideInputs:["mode"]}}),flock.ugen.random.weibull=function(a,b,c){var d=flock.ugen.random(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.inputs,h=d.generator,i=d.output,j=f.strides.alpha,k=g.alpha.output,l=f.strides.beta,m=g.beta.output;for(b=c=e=0;a>b;b++,c+=j,e+=l)i[b]=h.weibull(k[c],m[e]);d.mulAdd(a)},d},fluid.defaults("flock.ugen.random.weibull",{rate:"audio",inputs:{seed:null,alpha:1,beta:1,mul:null,add:null},ugenOptions:{strideInputs:["alpha","beta"]}}),flock.ugen.line=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.model,e=c.stepSize,f=c.numSteps,g=f>=a?a:f,h=a-g,i=c.level,j=d.output;for(b=0;g>b;b++)j[b]=i,f--,i+=e;if(h>0)for(b=0;h>b;b++)j[b]=i;c.level=i,c.numSteps=f,d.mulAdd(a)},d.onInputChanged=function(){var a=d.model;a.start=d.inputs.start.output[0],a.end=d.inputs.end.output[0],a.numSteps=Math.round(d.inputs.duration.output[0]*a.sampleRate),0===a.numSteps?(a.stepSize=0,a.level=a.end):(a.stepSize=(a.end-a.start)/a.numSteps,a.level=a.start),flock.onMulAddInputChanged(d)},d.onInputChanged(),d},fluid.defaults("flock.ugen.line",{rate:"control",inputs:{start:0,end:1,duration:1,mul:null,add:null}}),flock.ugen.xLine=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.model,e=c.multiplier,f=c.numSteps,g=f>=a?a:f,h=a-g,i=c.level,j=d.output;for(b=0;g>b;b++)j[b]=i,f--,i*=e;if(h>0)for(b=0;h>b;b++)j[b]=i;c.level=i,c.numSteps=f,d.mulAdd(a)},d.onInputChanged=function(){var a=d.model;flock.onMulAddInputChanged(d),a.start=d.inputs.start.output[0],0===a.start&&(a.start=Number.MIN_VALUE),a.end=d.inputs.end.output[0],a.numSteps=Math.round(d.inputs.duration.output[0]*a.sampleRate),a.multiplier=Math.pow(a.end/a.start,1/a.numSteps),a.level=a.start},d.onInputChanged(),d},fluid.defaults("flock.ugen.xLine",{rate:"control",inputs:{start:0,end:1,duration:1,mul:null,add:null}}),flock.ugen.phasor=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.inputs,h=d.output,i=g.step.output,j=g.trigger.output;for(void 0===f.value&&(f.value=g.start.output[0]),b=0,c=0,e=0;a>b;b++,c+=f.strides.trigger,e+=f.strides.step)j[c]>0&&f.prevTrig<=0&&(f.value=g.reset.output[0]),f.prevTrig=j[c],f.value>=g.end.output[0]&&(f.value=g.start.output[0]),h[b]=f.value,f.value+=i[e];d.mulAdd(a)},d.onInputChanged(),d},fluid.defaults("flock.ugen.phasor",{rate:"control",inputs:{start:0,end:1,reset:0,step:.1,trigger:0,mul:null,add:null},ugenOptions:{strideInputs:["trigger","step"]}}),flock.ugen.env={},flock.ugen.env.simpleASR=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.model,f=d.output,g=e.previousGate,h=d.inputs.gate.output[0],i=e.level,j=e.stage,k=j.currentStep,l=j.stepInc,m=j.numSteps,n=e.targetLevel,o=!1;for(0>=g&&h>0?(n=d.inputs.sustain.output[0],b=d.inputs.attack.output[0],o=!0):0>=h&&k>=m&&(n=d.inputs.start.output[0],b=d.inputs.release.output[0],o=!0),o&&(m=Math.round(b*e.sampleRate),l=(n-i)/m,k=0),c=0;a>c;c++)f[c]=i,k++,i=m>k?i+l:k===m?n:i;e.level=i,e.targetLevel=n,e.previousGate=h,j.currentStep=k,j.stepInc=l,j.numSteps=m},d.init=function(){var a=d.model;a.level=d.inputs.start.output[0],a.targetLevel=d.inputs.sustain.output[0]},d.init(),d},fluid.defaults("flock.ugen.env.simpleASR",{rate:"control",inputs:{start:0,attack:.01,sustain:1,release:1,gate:0},ugenOptions:{model:{previousGate:0,stage:{currentStep:0,stepInc:0,numSteps:0}}}}),flock.ugen.amplitude=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=d.inputs.source.output,h=d.output,i=f.attackTime,j=d.inputs.attack.output[0],k=f.releaseTime,l=d.inputs.release.output[0],m=f.prevVal,n=f.attackCoef,o=f.releaseCoef;for(j!==i&&(f.attackTime=j,n=f.attackCoef=0===j?0:Math.exp(flock.LOG01/(j*f.sampleRate))),l!==k&&(f.releaseTime=l,o=f.releaseCoef=0===l?0:Math.exp(flock.LOG01/(l*f.sampleRate))),b=0;a>b;b++)c=Math.abs(g[b]),e=m>c?o:n,h[b]=m=c+(m-c)*e;f.prevVal=m,d.mulAdd(a)},d.onInputChanged(),d},fluid.defaults("flock.ugen.amplitude",{rate:"audio",inputs:{source:null,attack:.01,release:.01,mul:null,add:null},ugenOptions:{model:{prevVal:0}}}),flock.ugen.normalize=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(){var a=d.output,b=d.inputs.max.output[0],c=d.inputs.source.output;flock.normalize(c,b,a)},d.onInputChanged(),d},fluid.defaults("flock.ugen.normalize",{rate:"audio",inputs:{max:1,source:null}}),flock.ugen.gate=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.model,g=f.strides,h=d.output,i=d.inputs,j=i.source.output,k=i.sideChain.output,l=g.sideChain,m=i.threshold.output,n=g.threshold,o=d.options.holdLastValue,p=f.lastValue;for(b=c=e=0;a>b;b++,c+=l,e+=n)h[b]=k[c]>=m[e]?p=j[b]:o?p:0;f.lastValue=p,d.mulAdd(a)},d.onInputChanged=function(){d.inputs.sideChain||(d.inputs.sideChain=d.inputs.source),flock.onMulAddInputChanged(d),d.calculateStrides()},d.onInputChanged(),d},fluid.defaults("flock.ugen.gate",{rate:"audio",inputs:{source:null,sideChain:null,threshold:Number.MIN_VALUE,mul:null,add:null},ugenOptions:{model:{lastValue:0},holdLastValue:!1,strideInputs:["sideChain","threshold"]}}),flock.ugen.pan2=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g=d.model,h=d.output,i=h[0],j=h[1],k=d.inputs,l=k.source.output,m=k.pan.output;for(b=0,c=0;a>b;b++,c+=g.strides.pan)e=l[b],f=.5*m[c]+.5,j[b]=e*Math.sin(f*flock.HALFPI),i[b]=e*Math.cos(f*flock.HALFPI)},d.onInputChanged(),d},fluid.defaults("flock.ugen.pan2",{rate:"audio",inputs:{source:null,pan:0},ugenOptions:{tags:["flock.ugen.multiChannelOutput"],strideInputs:["pan"],numOutputs:2}}),flock.ugen.out=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h,i,j,k,l=d.multiInputs.sources,m=d.options.audioSettings.buses,n=d.inputs.bus.output[0],o=d.inputs.expand.output[0];if(b=l.length,c=Math.max(o,b),!(1>b)){for(e=0;c>e;e++)for(g=l[e%b],h=g.rate,i=m[n+e],j=h===flock.rates.AUDIO?1:0,k=0,f=0;a>f;f++,k+=j)i[f]=i[f]+g.output[k];d.mulAdd(a)}},d.init=function(){d.sourceBuffers=[],d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.out",{rate:"audio",inputs:{sources:null,bus:0,expand:2},ugenOptions:{tags:["flock.ugen.outputType"],multiInputNames:["sources"]}}),flock.ugen.valueOut=function(a,b,c){var d=flock.ugen(a,b,c);return d.arraySourceGen=function(){var a,b=d.inputs.sources;for(a=0;a<b.length;a++)d.model.value[a]=b[a].output[0]},d.ugenSourceGen=function(){d.model.value=d.inputs.sources.output[0]},d.onInputChanged=function(){var a=d.inputs.sources;flock.isIterable(a)?(d.gen=d.arraySourceGen,d.model.value=new Float32Array(a.length)):d.gen=d.ugenSourceGen},d.onInputChanged(),d},fluid.defaults("flock.ugen.valueOut",{rate:"control",inputs:{sources:null},ugenOptions:{model:{value:null},tags:["flock.ugen.outputType","flock.ugen.valueType"]}}),flock.ugen["in"]=function(a,b,c){var d=flock.ugen(a,b,c);return d.singleBusGen=function(a){var b,c=d.output,e=0|d.inputs.bus.output[0],f=d.options.audioSettings.buses[e];for(b=0;a>b;b++)c[b]=f[b];d.mulAdd(a)},d.multiBusGen=function(a){var b,c,e,f=d.inputs.bus,g=d.options.audioSettings.buses,h=d.output;for(b=0;a>b;b++)for(h[b]=0,c=0;c<f.length;c++)e=0|f[c].output[0],h[b]+=g[e][b];d.mulAdd(a)},d.onInputChanged=function(){d.gen=flock.isIterable(d.inputs.bus)?d.multiBusGen:d.singleBusGen,flock.onMulAddInputChanged(d)},d.onInputChanged(),d},fluid.defaults("flock.ugen.in",{rate:"audio",inputs:{bus:0,mul:null,add:null}}),flock.ugen.audioIn=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.output,e=0|d.inputs.bus.output[0],f=d.options.audioSettings.buses[e];for(b=0;a>b;b++)c[b]=f[b];d.mulAdd(a)},d.onInputChanged=function(){flock.onMulAddInputChanged(d)},d.init=function(){flock.enviro.shared.audioStrategy.startReadingAudioInput(),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.audioIn",{rate:"audio",inputs:{bus:2,mul:null,add:null}}),flock.ugen.filter=function(a,b,d){var e=flock.ugen(a,b,d);return e.gen=function(){var a=e.model,b=e.inputs,c=b.q.output[0],d=b.freq.output[0];(a.prevFreq!==d||a.prevQ!==c)&&e.updateCoefficients(a,d,c),e.filterEngine.filter(e.output,e.inputs.source.output),a.prevQ=c,a.prevFreq=d},e.init=function(){var a=e.options.recipe,b="string"==typeof a?flock.get(a):a;if(!b)throw new Error("Can't instantiate a flock.ugen.filter() without specifying a filter coefficient recipe.");e.filterEngine=new c(b.sizes.b,b.sizes.a),e.model.coeffs={a:e.filterEngine.a,b:e.filterEngine.b},e.updateCoefficients=flock.get(b,e.options.type),e.onInputChanged()},e.init(),e},fluid.defaults("flock.ugen.filter",{rate:"audio",inputs:{freq:440,q:1,source:null}}),flock.ugen.filter.biquad=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.model,f=d.inputs,g=d.output,h=e.coeffs,i=f.freq.output[0],j=f.q.output[0],k=f.source.output;for((e.prevFreq!==i||e.prevQ!==j)&&d.updateCoefficients(e,i,j),b=0;a>b;b++)c=k[b]-h.a[0]*e.d0-h.a[1]*e.d1,g[b]=h.b[0]*c+h.b[1]*e.d0+h.b[2]*e.d1,e.d1=e.d0,e.d0=c;e.prevQ=j,e.prevFreq=i},d.onInputChanged=function(){var a=d.options.type;d.updateCoefficients="string"==typeof a?flock.get(a):a},d.init=function(){d.model.d0=0,d.model.d1=0,d.model.coeffs={a:new Float32Array(2),b:new Float32Array(3)},d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.filter.biquad",{inputs:{freq:440,q:1,source:null}}),flock.ugen.filter.biquad.types={hp:{inputDefaults:{freq:440,q:1},options:{type:"flock.coefficients.butterworth.highPass"}},rhp:{inputDefaults:{freq:440,q:1},options:{type:"flock.coefficients.rbj.highPass"}},lp:{inputDefaults:{freq:440,q:1},options:{type:"flock.coefficients.butterworth.lowPass"}},rlp:{inputDefaults:{freq:440,q:1},options:{type:"flock.coefficients.rbj.lowPass"}},bp:{inputDefaults:{freq:440,q:4},options:{type:"flock.coefficients.butterworth.bandPass"}},br:{inputDefaults:{freq:440,q:1},options:{type:"flock.coefficients.butterworth.bandReject"}}},flock.aliasUGens("flock.ugen.filter.biquad",flock.ugen.filter.biquad.types),flock.coefficients={butterworth:{sizes:{a:2,b:3},lowPass:function(a,b){var c=a.coeffs,d=1/Math.tan(Math.PI*b/a.sampleRate),e=d*d,f=flock.ROOT2*d,g=1/(1+f+e);c.b[0]=g,c.b[1]=2*g,c.b[2]=g,c.a[0]=2*(1-e)*g,c.a[1]=(1-f+e)*g},highPass:function(a,b){var c=a.coeffs,d=Math.tan(Math.PI*b/a.sampleRate);1/0===d&&(d=0);var e=d*d,f=flock.ROOT2*d,g=1/(1+f+e);c.b[0]=g,c.b[1]=-2*g,c.b[2]=g,c.a[0]=2*(e-1)*g,c.a[1]=(1-f+e)*g},bandPass:function(a,b,c){var d=a.coeffs,e=b/c,f=1/Math.tan(Math.PI*e/a.sampleRate),g=2*Math.cos(flock.TWOPI*b/a.sampleRate),h=1/(1+f);d.b[0]=h,d.b[1]=0,d.b[2]=-h,d.a[0]=-(f*g*h),d.a[1]=h*(f-1)},bandReject:function(a,b,c){var d=a.coeffs,e=b/c,f=Math.tan(Math.PI*e/a.sampleRate),g=2*Math.cos(flock.TWOPI*b/a.sampleRate),h=1/(1+f),i=-g*h;d.b[0]=h,d.b[1]=i,d.b[2]=h,d.a[0]=i,d.a[1]=(1-f)*h}},rbj:{sizes:{a:2,b:3},lowPass:function(a,b,c){var d=a.coeffs,e=flock.TWOPI*b/a.sampleRate,f=Math.cos(e),g=Math.sin(e),h=g/(2*c),i=1-f,j=1+h,k=i/2/j;d.b[0]=k,d.b[1]=i/j,d.b[2]=k,d.a[0]=-2*f/j,d.a[1]=(1-h)/j},highPass:function(a,b,c){var d=a.coeffs,e=flock.TWOPI*b/a.sampleRate,f=Math.cos(e),g=Math.sin(e),h=g/(2*c),i=1+f,j=1+h,k=i/2/j;d.b[0]=k,d.b[1]=-i/j,d.b[2]=k,d.a[0]=-2*f/j,d.a[1]=(1-h)/j},bandPass:function(a,b,c){var d=a.coeffs,e=flock.TWOPI*b/a.sampleRate,f=Math.cos(e),g=Math.sin(e),h=g/(2*c),i=1+h,j=c*h;d.b[0]=j/i,d.b[1]=0,d.b[2]=-j/i,d.a[0]=-2*f/i,d.a[1]=(1-h)/i},bandReject:function(a,b,c){var d=a.coeffs,e=flock.TWOPI*b/a.sampleRate,f=Math.cos(e),g=Math.sin(e),h=g/(2*c),i=1+h,j=1/i,k=-2*f/i;d.b[0]=j,d.b[1]=k,d.b[2]=j,d.a[0]=k,d.a[1]=(1-h)/i}}},flock.ugen.filter.moog=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h,i,j=d.model,k=d.inputs,l=d.output,m=k.source.output,n=j.strides.source,o=k.resonance.output,p=j.strides.resonance,q=k.cutoff.output,r=j.strides.cutoff,s=j.f,t=j.fSq,u=j.fSqSq,v=j.oneMinusF,w=j.fb;for(b=c=e=f=0;a>b;b++,c+=n,e+=p,f+=r)g=q[f],h=o[e],g!==j.prevCutoff&&(g>j.nyquistRate&&(g=j.nyquistRate),s=j.f=g/j.nyquistRate*1.16,t=j.fSq=s*s,u=j.fSqSq=t*t,v=j.oneMinusF=1-s,j.prevRes=void 0),h!==j.prevRes&&(h>4?h=4:0>h&&(h=0),w=j.fb=h*(1-.15*t)),i=m[c]-j.out4*w,i*=.35013*u,j.out1=i+.3*j.in1+v*j.out1,j.in1=i,j.out2=j.out1+.3*j.in2+v*j.out2,j.in2=j.out1,j.out3=j.out2+.3*j.in3+v*j.out3,j.in3=j.out2,j.out4=j.out3+.3*j.in4+v*j.out4,j.in4=j.out3,l[b]=j.out4;d.mulAdd(a)},d.onInputChanged(),d},fluid.defaults("flock.ugen.filter.moog",{rate:"audio",inputs:{cutoff:3e3,resonance:3.99,source:null},ugenOptions:{model:{in1:0,in2:0,in3:0,in4:0,out1:0,out2:0,out3:0,out4:0,prevCutoff:void 0,prevResonance:void 0,f:void 0,fSq:void 0,fSqSq:void 0,oneMinusF:void 0,fb:void 0},strideInputs:["source","cutoff","resonance"]}}),flock.ugen.delay=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.model,e=d.inputs,f=d.output,g=e.source.output,h=e.time.output[0],i=d.delayBuffer;for(h!==c.time&&(c.time=h,c.delaySamps=h*d.model.sampleRate),b=0;a>b;b++)c.pos>=c.delaySamps&&(c.pos=0),f[b]=i[c.pos],i[c.pos]=g[b],c.pos++;d.mulAdd(a)},d.onInputChanged=function(a){if(flock.onMulAddInputChanged(d),!a||"maxTime"===a){var b=d.model.sampleRate*d.inputs.maxTime.output[0];d.delayBuffer=new Float32Array(b)}},d.onInputChanged(),d},fluid.defaults("flock.ugen.delay",{rate:"audio",inputs:{maxTime:1,time:1,source:null},ugenOptions:{model:{pos:0}}}),flock.ugen.delay1=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.model,e=d.inputs,f=d.output,g=e.source.output;for(b=0;a>b;b++)f[b]=c.prevVal,c.prevVal=g[b];d.mulAdd(a)},d.onInputChanged=function(){flock.onMulAddInputChanged(d)},d.onInputChanged(),d},fluid.defaults("flock.ugen.delay1",{rate:"audio",inputs:{source:null},ugenOptions:{model:{prevVal:0}}}),flock.ugen.freeverb=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.options,f=d.inputs,g=d.output,h=e.tunings,i=e.allPassTunings,j=f.source.output,k=f.mix.output[0],l=f.roomSize.output[0],m=f.damp.output[0],n=1-k,o=.28*l+.7,p=.4*m,q=1-p;for(b=0;a>b;b++){var r=j[b],s=.015*r;for(c=0;c<d.buffers_a.length;c++)++d.bufferindices_a[c]===i[c]&&(d.bufferindices_a[c]=0),d.readsamp_a[c]=d.buffers_a[c][d.bufferindices_a[c]];for(c=0;c<d.buffers_c.length;c++){++d.bufferindices_c[c]===h[c]&&(d.bufferindices_c[c]=0);var t=d.buffers_c[c][d.bufferindices_c[c]];d.filterx_c[c]=q*d.filtery_c[c]+p*d.filterx_c[c],d.buffers_c[c][d.bufferindices_c[c]]=s+o*d.filterx_c[c],d.filtery_c[c]=t}var u=d.filtery_c[6]+d.filtery_c[7];d.buffers_a[3][d.bufferindices_a[3]]=.5*d.filterx_a[3]+d.filtery_c[0]+(d.filtery_c[1]+d.filtery_c[2])+(d.filtery_c[3]+d.filtery_c[4]+(d.filtery_c[5]+u)),d.filterx_a[3]=d.readsamp_a[3],d.filtery_a[3]=d.filterx_a[3]-(d.filtery_c[0]+d.filtery_c[1]+(d.filtery_c[2]+d.filtery_c[3])+(d.filtery_c[4]+d.filtery_c[5]+u)),d.buffers_a[2][d.bufferindices_a[2]]=.5*d.filterx_a[2]+d.filtery_a[3],d.filterx_a[2]=d.readsamp_a[2],d.filtery_a[2]=d.filterx_a[2]-d.filtery_a[3],d.buffers_a[1][d.bufferindices_a[1]]=.5*d.filterx_a[1]+d.filtery_a[2],d.filterx_a[1]=d.readsamp_a[1],d.filtery_a[1]=d.filterx_a[1]-d.filtery_a[2],d.buffers_a[0][d.bufferindices_a[0]]=.5*d.filterx_a[0]+d.filtery_a[1],d.filterx_a[0]=d.readsamp_a[0],d.filtery_a[0]=d.filterx_a[0]-d.filtery_a[1],g[b]=n*r+k*d.filtery_a[0]}d.mulAdd(a)},d.onInputChanged=function(){flock.onMulAddInputChanged(d)},d.initDelayLines=function(){var a=d.options,b=a.tunings,c=a.allPassTunings;d.buffers_c=[],d.bufferindices_c=new Int32Array(8),d.filterx_c=new Float32Array(8),d.filtery_c=new Float32Array(8);var e,f,g=d.model.spread;for(e=0;e<d.buffers_c.length;e++)for(d.buffers_c[e]=new Float32Array(b[e]+g),d.bufferindices_c[e]=0,d.filterx_c[e]=0,d.filtery_c[e]=0,f=0;f<b[e]+g;f++)d.buffers_c[e][f]=0;for(d.buffers_a=[],d.bufferindices_a=new Int32Array(4),d.filterx_a=new Float32Array(4),d.filtery_a=new Float32Array(4),d.readsamp_a=new Float32Array(4),e=0;4>e;e++){for(d.bufferindices_a[e]=0,d.filterx_a[e]=0,d.filtery_a[e]=0,d.readsamp_a[e]=0,f=0;f<c.length;f++)c[f]+=g;for(d.buffers_a[e]=new Float32Array(c[e]),f=0;f<c[e];f++)d.buffers_a[e][f]=0}},d.init=function(){d.initDelayLines(),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.freeverb",{rate:"audio",inputs:{mix:.5,roomSize:.6,damp:.1,source:null,mul:null,add:null},ugenOptions:{model:{spread:0},tunings:[1116,1188,1277,1356,1422,1491,1557,1617],allPassTunings:[556,441,341,225]}}),flock.ugen.decay=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.model,e=d.inputs,f=d.output,g=e.source.output,h=e.time.output[0];if(h!==c.time&&(c.time=h,c.coeff=0===h?0:Math.exp(flock.LOG001/(h*d.model.sampleRate))),0===c.coeff)for(b=0;a>b;b++)f[b]=g[b];else for(b=0;a>b;b++)c.lastSamp=g[b]+c.coeff*c.lastSamp,f[b]=c.lastSamp;d.mulAdd(a)},d.onInputChanged(),d},fluid.defaults("flock.ugen.decay",{rate:"audio",inputs:{source:null,time:1},ugenOptions:{model:{time:0,lastSamp:0,coeff:0}}}),flock.ugen.triggerGrains=function(a,b,c){var d=flock.ugen(a,b,c);
return d.gen=function(a){var b,c,e,f,g,h,i=d.model,j=d.inputs,k=d.output,l=j.channel.output[0],m=d.buffer.data.channels[l],n=j.dur.output[0],o=j.amp.output,p=j.centerPos.output,q=j.trigger.output,r=j.speed.output,s=0,t=0,u=0,v=0;if(n!==i.dur)for(i.dur=n>i.maxDur?i.maxDur:n,i.numGrainSamps=Math.round(i.sampleRate*i.dur),i.grainCenter=Math.round(i.numGrainSamps/2),b=0;b<i.numGrainSamps;b++)i.env[b]=Math.sin(Math.PI*b/i.numGrainSamps);for(b=0;a>b;b++){if(q[t]>0&&i.prevTrigger<=0&&i.activeGrains.length<i.maxNumGrains){for(f=i.freeGrains.pop(),f.sampIdx=0,f.envIdx=0,f.amp=o[u],g=p[s]*i.sampleRate-i.grainCenter;0>g;)g+=m.length;f.readPos=Math.round(g),f.writePos=b,f.speed=r[v],i.activeGrains.push(f)}i.prevTrigger=q[t],k[b]=0,s+=i.strides.centerPos,t+=i.strides.trigger,u+=i.strides.amp,v+=i.strides.speed}for(c=0;c<i.activeGrains.length;){for(f=i.activeGrains[c],e=f.writePos;e<Math.min(i.numGrainSamps-f.sampIdx,a);e++)h=d.interpolate?d.interpolate(f.readPos,m):m[0|f.readPos],k[e]+=h*i.env[f.envIdx]*f.amp,f.readPos=(f.readPos+f.speed)%m.length,f.sampIdx++,f.envIdx++;f.sampIdx>=i.numGrainSamps?(i.freeGrains.push(f),i.activeGrains.splice(c,1)):(c++,f.writePos=f.writePos%d.options.audioSettings.blockSize)}d.mulAdd(a)},d.onInputChanged=function(a){d.onBufferInputChanged(a),d.calculateStrides(),flock.onMulAddInputChanged(d)},d.allocateGrains=function(a){a=a||d.model.maxNumGrains;for(var b=0;a>b;b++)d.model.freeGrains.push({sampIdx:0,envIdx:0,readPos:0})},d.init=function(){var a=d.model,b=Math.round(a.maxDur*a.sampleRate);flock.ugen.buffer(d),d.model.env=new Float32Array(b),d.allocateGrains(),d.initBuffer(),d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.triggerGrains",{rate:"audio",inputs:{centerPos:0,channel:0,amp:1,dur:.1,speed:1,buffer:null,mul:null,add:null},ugenOptions:{model:{maxDur:30,maxNumGrains:512,activeGrains:[],freeGrains:[],env:null,strides:{}},strideInputs:["centerPos","trigger","amp","speed"],interpolation:"cubic"}}),flock.ugen.print=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.inputs,e=d.model,f=e.label,g=c.channel,h=g?c.source.output[g.output[0]]:c.source.output,i=c.trigger.output[0],j=c.freq.output[0];for(i>0&&e.prevTrig<=0&&fluid.log(fluid.logLevel.IMPORTANT,f+h),e.freq!==j&&(e.sampInterval=Math.round(e.sampleRate/j),e.freq=j,e.counter=e.sampInterval),b=0;a>b;b++)e.counter>=e.sampInterval&&(fluid.log(fluid.logLevel.IMPORTANT,f+h[b]),e.counter=0),e.counter++,d.output[b]=h[b]},d.init=function(){var a=d.options;d.model.label=a.label?a.label+": ":""},d.init(),d},fluid.defaults("flock.ugen.print",{rate:"audio",inputs:{source:null,trigger:0,freq:1},ugenOptions:{model:{counter:0}}}),flock.ugen.granulator=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f,g,h=d.model,i=d.inputs,j=d.output,k=i.grainDur.output[0],l=i.delayDur.output[0],m=i.numGrains.output[0],n=i.source.output;if(h.delayDur!==l&&(h.delayDur=l,h.delayLength=h.sampleRate*h.delayDur|0,d.delayLine=new Float32Array(d.model.delayLength)),h.grainDur!==k)for(h.grainDur=k,h.grainLength=h.sampleRate*h.grainDur|0,b=0;b<h.grainLength;b++)h.windowFunction[b]=Math.sin(Math.PI*b/h.grainLength);if(h.rawNumGrains!==m){for(h.rawNumGrains=m,m=Math.round(m),b=h.numGrains;m>b;b++)h.currentGrainPosition[b]=0,h.currentGrainWindowPosition[b]=Math.random()*h.grainLength|0;h.numGrains=m}for(b=0;a>b;b++){for(d.delayLine[h.writePos]=n[b],h.writePos=(h.writePos+1)%h.delayLength,j[b]=0,c=0;c<h.numGrains;c++)e=h.currentGrainPosition[c],f=h.currentGrainWindowPosition[c],g=h.windowFunction[f],j[b]+=d.delayLine[e]*g,h.currentGrainPosition[c]=(e+1)%h.delayLength,h.currentGrainWindowPosition[c]=(f+1)%h.grainLength,0===h.currentGrainWindowPosition[c]&&(h.currentGrainPosition[c]=Math.random()*h.delayLength|0);j[b]/=h.numGrains}d.mulAdd(a)},d.onInputChanged(),d},fluid.defaults("flock.ugen.granulator",{rate:"audio",inputs:{source:null,grainDur:.1,delayDur:1,numGrains:5,mul:null,add:null},ugenOptions:{model:{grainLength:0,numGrains:0,currentGrainPosition:[],currentGrainWindowPosition:[],windowFunction:[],writePos:0}}}),flock.ugen.sequence=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e,f=d.inputs.list,g=d.inputs,h=g.freq.output,i=g.loop.output[0],j=d.model,k=j.scale,l=d.output,m=g.start?Math.round(g.start.output[0]):0,n=g.end?Math.round(g.end.output[0]):f.length;for(void 0===j.value&&(b=f[m],j.value=void 0===b?0:b),void 0===j.nextIdx&&(j.nextIdx=m),c=0,e=0;a>c;c++,e+=j.strides.freq){if(j.nextIdx>=n){if(!(i>0)){l[c]=j.value;continue}j.nextIdx=m}l[c]=j.value=f[j.nextIdx],j.phase+=h[e]*k,j.phase>=1&&(j.phase=0,j.nextIdx++)}d.mulAdd(a)},d.onInputChanged=function(){d.model.scale=d.rate!==flock.rates.DEMAND?d.model.sampleDur:1,d.inputs.list||(d.inputs.list=[]),d.calculateStrides(),flock.onMulAddInputChanged(d)},d.init=function(){d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.sequence",{rate:"control",inputs:{start:0,freq:1,loop:0,list:[]},ugenOptions:{model:{phase:0},strideInputs:["freq"],noExpand:["list"]}}),flock.ugen.midiFreq=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c,e=d.model,f=e.a4,g=f.freq,h=f.noteNum,i=e.notesPerOctave,j=d.inputs.source.output,k=d.output;for(b=0,c=0;a>b;b++,c+=e.strides.source)k[b]=flock.midiFreq(j[c],g,h,i)},d.init=function(){d.model.octaveScale=1/d.model.notesPerOctave,d.onInputChanged()},d.init(),d},fluid.defaults("flock.ugen.midiFreq",{rate:"control",inputs:{source:null},ugenOptions:{model:{a4:{noteNum:69,freq:440},notesPerOctave:12},strideInputs:["source"]}})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";var a=fluid.registerNamespace("jQuery");fluid.registerNamespace("flock.ugen"),flock.ugen.scope=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.model,e=c.spf,f=c.bufIdx,g=c.scope.values;for(b=0;a>b;b++)g[f]=d.inputs.source.output[b],e>f?f+=1:(f=0,d.scopeView.refreshView());c.bufIdx=f},d.onInputChanged=function(){d.output=d.inputs.source.output},d.init=function(){d.model.spf=Math.round(d.model.sampleRate/d.options.fps),d.model.bufIdx=0,d.model.scope=d.options.styles,d.model.scope.values=new Float32Array(d.model.spf),d.scopeView=flock.view.scope(d.options.canvas,d.model.scope),d.onInputChanged(),d.scopeView.refreshView()},d.init(),d},fluid.defaults("flock.ugen.scope",{rate:"audio",inputs:{source:null},ugenOptions:{fps:60,styles:{strokeColor:"#777777",strokeWidth:1}}}),flock.ugen.mouse={},flock.ugen.mouse.cursor=function(b,c,d){var e=flock.ugen(b,c,d);return e.exponentialGen=function(a){var b,c,d=e.model,f=d.mousePosition/d.size,g=d.movingAvg,h=e.inputs.lag.output[0],i=e.inputs.add.output[0],j=e.inputs.mul.output[0],k=d.lagCoef,l=e.output,m=Math.pow;for(h!==k&&(k=0===h?0:Math.exp(flock.LOG001/(h*d.sampleRate)),d.lagCoef=k),b=0;a>b;b++)c=j+i,f=m(c/i,f)*i,g=f+k*(g-f),l[b]=g;d.movingAvg=g},e.linearGen=function(a){var b,c=e.model,d=c.mousePosition/c.size,f=c.movingAvg,g=e.inputs.lag.output[0],h=e.inputs.add.output[0],i=e.inputs.mul.output[0],j=c.lagCoef,k=e.output;for(g!==j&&(j=0===g?0:Math.exp(flock.LOG001/(g*c.sampleRate)),c.lagCoef=j),b=0;a>b;b++)f=d+j*(f-d),k[b]=f*i+h;c.movingAvg=f},e.noInterpolationGen=function(a){var b,c=e.model,d=c.mousePosition/c.size,f=e.inputs.add.output[0],g=e.inputs.mul.output[0],h=e.output;for(b=0;a>b;b++)h[b]=d*g+f},e.moveListener=function(b){var c,d=e.model,f=b[d.eventProp];void 0===f&&(c=a(b.target).offset(),b.offsetX=b.clientX-c.left,b.offsetY=b.clientY-c.top,f=b[d.eventProp]),d.mousePosition=d.isWithinTarget?f:0},e.overListener=function(){e.model.isWithinTarget=!0},e.outListener=function(){var a=e.model;a.isWithinTarget=!1,a.mousePosition=0},e.downListener=function(){e.model.isMouseDown=!0},e.upListener=function(){var a=e.model;a.isMouseDown=!1,a.mousePosition=0},e.moveWhileDownListener=function(a){e.model.isMouseDown&&e.moveListener(a)},e.bindEvents=function(){var a=e.model,b=a.target,c=e.moveListener;e.options.onlyOnMouseDown&&(b.mousedown(e.downListener),b.mouseup(e.upListener),c=e.moveWhileDownListener),b.mouseover(e.overListener),b.mouseout(e.outListener),b.mousemove(c)},e.onInputChanged=function(){flock.onMulAddInputChanged(e);var a=e.options.interpolation;e.gen="none"===a?e.noInterpolationGen:"exponential"===a?e.exponentialGen:e.linearGen,e.model.exponential="exponential"===a},e.init=function(){var b=e.model,c=e.options,d=c.axis,f=a(c.target||window);"x"===d||"width"===d||"horizontal"===d?(b.eventProp="offsetX",b.size=f.width()):(b.eventProp="offsetY",b.size=f.height()),b.mousePosition=0,b.movingAvg=0,b.target=f,e.bindEvents(),e.onInputChanged()},e.init(),e},fluid.defaults("flock.ugen.mouse.cursor",{rate:"control",inputs:{lag:.5,add:0,mul:1},ugenOptions:{axis:"x"}}),flock.ugen.mouse.click=function(a,b,c){var d=flock.ugen(a,b,c);return d.gen=function(a){var b,c=d.output,e=d.model;for(b=0;a>b;b++)c[b]=e.value;d.mulAdd(a)},d.mouseDownListener=function(){d.model.value=1},d.mouseUpListener=function(){d.model.value=0},d.init=function(){var a=d.model;a.target="string"==typeof d.options.target?document.querySelector(d.options.target):d.options.target||window,a.value=0,a.target.addEventListener("mousedown",d.mouseDownListener,!1),a.target.addEventListener("mouseup",d.mouseUpListener,!1),d.onInputChanged()},d.onInputChanged=function(){flock.onMulAddInputChanged(d)},d.init(),d},fluid.defaults("flock.ugen.mouse.click",{rate:"control"})}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";fluid.registerNamespace("flock.view"),flock.view.scope=function(a,b){var c={model:b||{values:[]},canvas:"string"==typeof a?document.querySelector(a):a};return c.refreshView=function(){var a,b,d,e=c.ctx,f=c.model.height,g=c.model.halfHeight,h=c.model.width,i=c.model.values,j=i.length,k=c.model.scaleX*(h/j);for(e.clearRect(0,0,h,f),e.beginPath(),a=0;j>a;a++)b=a*k,d=i[a]*c.model.scaleY*g+g,e.lineTo(b,d);e.stroke()},c.init=function(){c.ctx=c.canvas.getContext("2d"),c.ctx.fillStyle=c.model.fill||c.ctx.fillStyle,c.ctx.strokeStyle=c.model.strokeColor||c.ctx.strokeStyle,c.ctx.lineWidth=c.model.strokeWidth||c.ctx.lineWidth,c.model.min=c.model.min||-1,c.model.max=c.model.max||1,c.model.height=c.canvas.height,c.model.halfHeight=c.model.height/2,c.model.width=c.canvas.width,c.model.scaleX=c.model.scaleX||c.model.scale||1,c.model.scaleY=c.model.scaleY||c.model.scale||1,c.refreshView()},c.init(),c}}();var fluid=fluid||require("infusion"),flock=fluid.registerNamespace("flock");!function(){"use strict";fluid.registerNamespace("flock.midi"),flock.midi.requestAccess=function(a,b,c){if(!navigator.requestMIDIAccess){var d="The Web MIDI API is not available. You may need to enable it in your browser's settings.";return fluid.log(fluid.logLevel.WARN,d),void c(d)}var e=navigator.requestMIDIAccess({sysex:a});e.then(b,c)},flock.midi.getPorts=function(a){var b={};return a.inputs&&(b.inputs=a.inputs()),a.outputs&&(b.outputs=a.outputs()),b},flock.midi.read=function(a){var b,c=a[0],d=c>>4,e=15&c;switch(d){case 8:b=flock.midi.read.noteOff;break;case 9:b=a[2]>0?flock.midi.read.noteOn:flock.midi.read.noteOff;break;case 10:b=flock.midi.read.polyAftertouch;break;case 11:b=flock.midi.read.controlChange;break;case 12:b=flock.midi.read.programChange;break;case 13:b=flock.midi.read.channelAftertouch;break;case 14:b=flock.midi.read.pitchbend;break;case 15:b=flock.midi.read.sysex;break;default:throw new Error("Recieved an unrecognized MIDI message: "+a)}return b(e,a)},flock.midi.read.note=function(a,b,c){return{type:a,chan:b,note:c[1],velocity:c[2]}},flock.midi.read.noteOn=function(a,b){return flock.midi.read.note("noteOn",a,b)},flock.midi.read.noteOff=function(a,b){return flock.midi.read.note("noteOff",a,b)},flock.midi.read.polyAftertouch=function(a,b){return{type:"aftertouch",chan:a,note:b[1],pressure:b[2]}},flock.midi.read.controlChange=function(a,b){return{type:"control",chan:a,number:b[1],value:b[2]}},flock.midi.read.programChange=function(a,b){return{type:"program",chan:a,program:b[1]}},flock.midi.read.channelAftertouch=function(a,b){return{type:"aftertouch",chan:a,pressure:b[1]}},flock.midi.read.pitchbend=function(a,b){return{type:"pitchbend",chan:a,value:b[1]<<7|b[2]}},flock.midi.read.sysex=function(a,b){return{type:"system",chan:a,data:b.subarray(1)}},fluid.defaults("flock.midi.system",{gradeNames:["fluid.eventedComponent","autoInit"],sysex:!0,members:{access:void 0,ports:void 0},invokers:{requestAccess:{funcName:"flock.midi.requestAccess",args:["{that}.options.sysex","{that}.events.onAccessGranted.fire","{that}.events.onAccessError.fire"]},refreshPorts:{funcName:"flock.midi.system.refreshPorts",args:["{that}","{that}.access"]}},events:{onAccessGranted:null,onAccessError:null,onReady:null},listeners:{onCreate:{func:"{that}.requestAccess"},onAccessGranted:[{funcName:"flock.midi.system.setAccess",args:["{that}","{arguments}.0"]},{func:"{that}.refreshPorts"},{func:"{that}.events.onReady.fire",args:"{that}.ports"}]}}),flock.midi.system.setAccess=function(a,b){a.access=b},flock.midi.system.refreshPorts=function(a,b){a.ports=flock.midi.getPorts(b)},fluid.defaults("flock.midi.connection",{gradeNames:["fluid.eventedComponent","autoInit"],sysex:!1,openImmediately:!1,ports:0,invokers:{send:{func:"{that}.events.onSendMessage.fire"},open:{funcName:"flock.midi.connection.bind",args:["{system}.ports","{that}.options.ports","{that}.events.raw.fire","{that}.events.onSendMessage"]},close:{funcName:"flock.midi.connection.close",args:["{system}.ports","{that}.events.raw.fire"]}},components:{system:{type:"flock.midi.system"}},events:{onReady:{event:"{system}.events.onReady"},onError:null,onSendMessage:null,raw:null,message:null,note:null,noteOn:null,noteOff:null,control:null,program:null,aftertouch:null,pitchbend:null},listeners:{onReady:{funcName:"flock.midi.connection.autoOpen",args:["{that}.options.openImmediately","{that}.open"]},raw:{funcName:"flock.midi.connection.fireEvent",args:["{arguments}.0","{that}.events"]}}}),flock.midi.connection.autoOpen=function(a,b){a&&b()},flock.midi.findPorts=function(a,b){b=fluid.makeArray(b);var c=[];return fluid.each(b,function(b){var d=flock.midi.findPorts.portFinder(b),e=d(a);c=c.concat(e)}),c},flock.midi.findPorts.portFinder=function(a){if("number"==typeof a)return flock.midi.findPorts.byIndex(a);if(a.id)return function(b){b.find(flock.midi.findPorts.idMatcher(a.id))};var b=a.manufacturer&&a.name?flock.midi.findPorts.bothMatcher(a.manufacturer,a.name):a.manufacturer?flock.midi.findPorts.manufacturerMatcher(a.manufacturer):flock.midi.findPorts.nameMatcher(a.name);return function(a){return a.filter(b)}},flock.midi.findPorts.byIndex=function(a){return function(b){var c=b[a];return c?[c]:[]}},flock.midi.findPorts.lowerRegExMatcher=function(a){return function(b){var c=!1;for(var d in a){var e=b[d],f=a[d];if(c=e&&e.toLowerCase().match(f.toLowerCase()),!c)break}return c}},flock.midi.findPorts.idMatcher=function(a){return function(b){return b.id===a}},flock.midi.findPorts.bothMatcher=function(a,b){return flock.midi.findPorts.lowerRegExMatcher({manufacturer:a,name:b})},flock.midi.findPorts.manufacturerMatcher=function(a){return flock.midi.findPorts.lowerRegExMatcher({manufacturer:a})},flock.midi.findPorts.nameMatcher=function(a){return flock.midi.findPorts.lowerRegExMatcher({name:a})},flock.midi.findPorts.eachPortOfType=function(a,b,c){var d=fluid.makeArray(a);fluid.each(d,function(a){a.type===b&&c(a)})},flock.midi.connection.listen=function(a,b){flock.midi.findPorts.eachPortOfType(a,"input",function(a){a.addEventListener("midimessage",b,!1)})},flock.midi.connection.stopListening=function(a,b){flock.midi.findPorts.eachPortOfType(a,"input",function(a){a.removeEventListener("midimessage",b,!1)})},flock.midi.connection.bindSender=function(a,b){var c=fluid.makeArray(a);fluid.each(c,function(a){b.addListener(a.send.bind(a))})},flock.midi.connection.bind=function(a,b,c,d){b=flock.midi.connection.expandPortSpec(b);var e=flock.midi.findPorts(a.inputs,b.input),f=flock.midi.findPorts(a.outputs,b.output);e&&e.length>0?flock.midi.connection.listen(e,c):void 0!==b.input&&flock.midi.connection.logNoMatchedPorts("input",b),f&&f.length>0?flock.midi.connection.bindSender(f,d):void 0!==b.output&&flock.midi.connection.logNoMatchedPorts("output",b)},flock.midi.connection.close=function(a,b){flock.midi.connection.stopListening(a.inputs,b)},flock.midi.connection.logNoMatchedPorts=function(a,b){fluid.log(fluid.logLevel.WARN,"No matching "+a+" ports were found for port specification: ",b[a])},flock.midi.connection.expandPortSpec=function(a){if(void 0!==a.input||void 0!==a.output)return a;var b={input:{},output:{}};return"number"==typeof a?b.input=b.output=a:(flock.midi.connection.expandPortSpecProperty("manufacturer",a,b),flock.midi.connection.expandPortSpecProperty("name",a,b)),b},flock.midi.connection.expandPortSpecProperty=function(a,b,c){return c.input[a]=c.output[a]=b[a],c},flock.midi.connection.fireEvent=function(a,b){var c=flock.midi.read(a.data),d=c.type?b[c.type]:void 0;b.message.fire(c),("noteOn"===c.type||"noteOff"===c.type)&&b.note.fire(c),d&&d.fire(c)}}();